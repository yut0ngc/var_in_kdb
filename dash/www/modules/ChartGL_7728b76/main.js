define(["Handlebars","QuickBase","moment","xlsx","jstree","css!./css/app.css"],function(R,k,A,f,m){"use strict";var P,B=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var n,o=0,a=e.length;o<a;o++)!n&&o in e||((n=n||Array.prototype.slice.call(e,0,o))[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},x=this&&this.__extends||(P=function(t,e){return(P=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}P(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),L=this&&this.__assign||function(){return(L=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},e={Trigger:{default:"Click",enum:["Click","Hover"],propertyOrder:2,title:"Trigger Action",type:"string"}},i={RuleName:{default:"",propertyOrder:1,title:"Rule Name",type:"string"},RuleSource:{default:"",enumSource:"possible_columns",propertyOrder:3,title:"Rule Source",type:"string",watch:{possibleCols:"arrItem.possibleRulesColumns"}},RuleTarget:{enumSource:"possible_columns",default:"",propertyOrder:2,title:"Rule Target",type:"string",watch:{possibleCols:"arrItem.possibleYColumns"}},RuleType:{options:{hidden:!0},propertyOrder:4,title:"Rule Type",type:"string"},Show:{default:!1,format:"checkbox",propertyOrder:5,title:"Show Rule in Legend",type:"boolean"}},I=(a.getComponentDefinition=function(t){var e={id:667,componentName:"Editable Dropdown",componentDescription:"Editable dropdown",appKey:"EditableList",css:"EditableList",appArgs:{quickStart:[{path:"Layers.0.Data",message:"populate Data Source"}],json:{version:"4.7.5.1",possibleLegendGroups:["None"],possiblePositions:["Top","Bottom","Left","Right"],Style:{advanced:""},Basics:{Hover:"",Selected:"",Zoom:!0,Duration:400,Easing:"easeOutQuart"},Layers:[{_Id:"L0",_Type:V.Bubble,Data:"",CacheStreamingData:!1,XAxis:"",YAxis:"",XAxisId:"X-Axis 1",YAxisId:"Y-Axis 1",Color:_.clone(a.COLOR_DEFAULT),ColorData:"None",Opacity:80,Name:"",ShowCurrentTick:!1,Enabled:!0,Legend:!0,LegendGroup:"None",Bubbles:{RadiusData:"Fixed Size",RadiusScaling:4,ScaleOnZoom:!0,Icon:""},Palette:_.cloneDeep(a.PALETTE_DEFAULT),Actions:[],HighlightRules:[],Labels:{Align:"center",Color:"#000",Enabled:!1,Font:{Bold:!1,Size:12},Frequency:1,Offset:"0",Rotation:0,Template:"{{x}}, {{toFixed y 2}}",MaxLabels:10},possibleRadiusData:["Fixed Size"],possibleRulesColumns:[],possibleXColumns:[],possibleYColumns:[],possibleXAxes:["X-Axis 1"],possibleYAxes:["Y-Axis 1"]}],Xaxes:[{Bounds:"",Type:"Linear",Position:"Bottom",Width:0,Ticks:10,Color:"",Stacked:!1,Title:{Display:!1,LabelString:"",FontSize:16},Format:{Display:!0,BeginAtZero:!1,ShowMajorUnits:!1,Break:864e5,Distribution:"Linear",TriggerBreak:864e5,Format:"Number",Precision:2,FontSize:12,Prefix:"",Suffix:"",HideTrailingZeroes:!1},Range:{UseMinMax:!1,Min:"",Max:"",SelectionMin:"",SelectionMax:""},Gridlines:{GridlinesOffset:!1,GridlinesColor:"",GridlinesOpacity:15}}],Yaxes:[{Bounds:"",Type:"Linear",Position:"Left",Width:0,Ticks:10,Color:"",Stacked:!1,Title:{Display:!1,LabelString:"",FontSize:16},Format:{Display:!0,BeginAtZero:!1,ShowMajorUnits:!1,Break:864e5,Distribution:"Linear",TriggerBreak:864e5,Format:"Number",Precision:2,FontSize:12,Prefix:"",Suffix:"",HideTrailingZeroes:!1},Range:{UseMinMax:!1,Min:"",Max:"",SelectionMin:"",SelectionMax:""},Gridlines:{GridlinesOffset:!1,GridlinesColor:"",GridlinesOpacity:15}}],Overlay:{ShowCrosshairs:!0,ShowCoordinates:!0,SnapToPoint:!0,UseCustomTooltip:!1,CustomTooltip:a.CUSTOM_TOOLTIP_DEFAULT,ShowAllPoints:!1,GroupByLayer:!1},Legend:{Position:"Top",LegendGroups:[]},Annotations:{ShowAnnotateControl:!1,Annotations:""},FileExport:{Actions:[],FileName:[],ShowExportCsvButton:!1,ShowExportExcelButton:!1,ShowExportPngButton:!1,UseChartFormat:!1}},schema:{type:"object",title:"Properties",properties:{possibleXColumns:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},possibleYColumns:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},possibleLegendGroups:{type:"array",options:{hidden:!0},default:["None"]},possiblePositions:{type:"array",options:{hidden:!0},default:["Top","Bottom","Left","Right"]},Basics:{propertyOrder:0,type:"object",title:"Basics",options:{collapsed:!0},properties:{Hover:{title:"Hover",type:"string",default:""},Selected:{title:"Selected",type:"string",default:""},Zoom:{title:"Zoom",type:"boolean",default:!0},Duration:{title:"Animation Duration",type:"number",default:400},Easing:{title:"Animation Easing",type:"string",default:"easeOutQuart",enum:["swingFromTo","swingFrom","swingTo","easeFromTo","easeFrom","easeTo","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeOutBounce","easeInBack","easeOutBack","easeInOutBack","bounce","bouncePast","elastic"]}}},Layers:{propertyOrder:1,type:"array",items:{type:"object",id:"arrItem",title:"Layer",options:{collapsed:!0},headerTemplate:"{{#if self.Name}}{{valueProp self.Name }}{{else}}Layer {{ i1 }}{{/if}}",oneOf:[{title:V.Bubble,options:{linked_oneof_property:{property:"_Type",value:V.Bubble}},properties:_.extend({},a.LAYER_COMMON,a.LAYER_BASIC,a.LAYER_AXIS_VALS,{Bubbles:{title:"Bubbles",type:"object",options:{collapsed:!0},propertyOrder:9,properties:a.LAYER_BUBBLE}})},{title:V.Line,options:{linked_oneof_property:{property:"_Type",value:V.Line}},properties:_.extend({},a.LAYER_COMMON,a.LAYER_BASIC,a.LAYER_AXIS_VALS,{Line:{title:V.Line,type:"object",options:{collapsed:!0},propertyOrder:9,properties:{LineThickness:{title:"Line Width",type:"number",default:1,propertyOrder:7},Fill:{title:"Fill",type:"dropdown",default:"No Fill",data:"possible_columns",watch:{possible_layers:"arrItem.possibleLayers"},propertyOrder:8},FillColor:{default:"#0061FF",options:{gradient:!1,noColor:!1},propertyOrder:8,title:"Fill Color",type:"gradient"},FillOpacity:{title:"Fill Opacity",type:"number",default:80,propertyOrder:8},FadeToTransparent:{title:"Fade to Transparent",type:"boolean",default:!1,propertyOrder:8},SpanGaps:{title:"Span Gaps",type:"boolean",default:!1,propertyOrder:8},Interpolation:{title:"Interpolation",type:"object",options:{collapsed:!0},propertyOrder:10,properties:{Interpolation:{title:"Interpolation",default:"Linear",enum:["Linear","Stepped"],type:"string"},SteppedLine:{title:"Stepped Line",default:"After",enum:["Before","After"],type:"string"}}},FillPalette:{title:"Fill Color Palette",type:"array",format:"table",options:{collapsed:!0},uniqueItems:!1,items:{type:"object",title:"Fill Palette Color",properties:{type:{type:"gradient",options:{gradient:!1},title:"color",default:"#ffa500"}}},default:_.cloneDeep(a.PALETTE_DEFAULT),propertyOrder:10}}}},{Bubbles:{title:"Bubbles",type:"object",options:{collapsed:!0},propertyOrder:9,properties:_.extend({Color:{title:"Color",type:"gradient",options:{gradient:!1},default:_.clone(a.COLOR_DEFAULT)},Opacity:{title:"Opacity",type:"number",default:80}},a.LAYER_BUBBLE)}})},{title:V.Bar,options:{linked_oneof_property:{property:"_Type",value:V.Bar}},properties:_.extend({},a.LAYER_COMMON,a.LAYER_BASIC,a.BAR_PROPERTIES,a.LAYER_AXIS_VALS)},{title:V.Waterfall,options:{linked_oneof_property:{property:"_Type",value:V.Waterfall}},properties:_.extend({IncreaseColor:{default:"#7ad16f",options:{gradient:!1},title:"Increase Color",type:"gradient",propertyOrder:9},DecreaseColor:{default:"#d1776f",options:{gradient:!1},title:"Decrease Color",type:"gradient",propertyOrder:9}},a.LAYER_COMMON,a.LAYER_BASIC,a.BAR_PROPERTIES,a.LAYER_AXIS_VALS)},{title:V.Bounds,options:{linked_oneof_property:{property:"_Type",value:V.Bounds}},properties:_.extend({x1:{title:"X1 coordinate",propertyOrder:9,enumSource:"possible_columns",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},x2:{title:"X2 coordinate",propertyOrder:9,enumSource:"possible_columns",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}}},a.LAYER_COMMON,a.LAYER_BASIC)},{title:V.Candlestick,options:{linked_oneof_property:{property:"_Type",value:V.Candlestick}},properties:_.extend({},a.LAYER_COMMON,a.LAYER_BASIC,a.LAYER_AXIS_VALS,{Open:{enumSource:"possible_columns",propertyOrder:3,title:"Open",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},High:{enumSource:"possible_columns",propertyOrder:3,title:"High",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},Low:{enumSource:"possible_columns",propertyOrder:3,title:"Low",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},Close:{enumSource:"possible_columns",propertyOrder:3,title:"Close",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},CandlestickFormat:{type:"object",title:"Candlestick Format",propertyOrder:9,options:{collapsed:!0},properties:_.extend({},a.BAR_PROPERTIES,{BearColor:{default:"#ff0000",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Bear Color",type:"gradient"},BullColor:{default:"#00ff00",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Bull Color",type:"gradient"},NeutralColor:{default:"#ffffff",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Neutral Color",type:"gradient"},WickColor:{default:"#7b8284",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Wick Color",type:"gradient"}})},YAxis:{options:{hidden:!0}}})},{title:V.Heatmap,options:{linked_oneof_property:{property:"_Type",value:V.Heatmap}},properties:_.extend({HeatmapX1:{enumSource:"possible_columns",propertyOrder:3,title:"X1 Coordinate",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},HeatmapX2:{enumSource:"possible_columns",propertyOrder:3,title:"X2 Coordinate",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},HeatmapY1:{enumSource:"possible_columns",propertyOrder:3,title:"Y1 Coordinate",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},HeatmapY2:{enumSource:"possible_columns",propertyOrder:3,title:"Y2 Coordinate",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},Score:{enumSource:"possible_columns",propertyOrder:3,title:"Score",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}}},a.LAYER_COMMON,a.LAYER_BASIC)},{title:V.Baseline,options:{linked_oneof_property:{property:"_Type",value:V.Baseline}},properties:_.extend({Axis:{title:"Baseline Axis",type:"string",propertyOrder:4,enum:["X-Axis","Y-Axis"],default:"Y-Axis"},Value:{title:"Baseline Value",type:"string",propertyOrder:4,default:"0.5"}},a.LAYER_BASIC)}]}},Xaxes:{title:"X-Axes",type:"array",propertyOrder:2,options:{collapsed:!0},items:{title:"X-Axis",type:"object",options:{collapsed:!0},properties:{Bounds:{options:{hidden:!0}},Type:{title:"X-Axis Type",type:"string",propertyOrder:1,enum:["Linear","Category","Time"],default:"Linear"},Position:{title:"Position",type:"string",enum:["Top","Bottom"],propertyOrder:2,default:"Bottom"},Width:{title:"Height",type:"number",propertyOrder:2,default:0},Ticks:{type:"number",title:"Number of Ticks",propertyOrder:2,default:10},Color:{title:"Color",type:"gradient",options:{noColor:!0,gradient:!1},propertyOrder:2,default:""},Stacked:{title:"Stacked",type:"boolean",propertyOrder:2,default:!1},Title:{type:"object",title:"Title",options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!1},LabelString:{title:"Label String",type:"string",default:""},FontSize:{title:"Font Size",type:"number",default:16}}},Range:{type:"object",title:"Range",propertyOrder:2,options:{collapsed:!0,hidden:!1},properties:{UseMinMax:{title:"Use min max",type:"boolean",default:!1},Min:{title:"Min",type:"string",default:""},Max:{title:"Max",type:"string",default:""},SelectionMin:{title:"Selection Min",type:"string",default:""},SelectionMax:{title:"Selection Max",type:"string",default:""}}},Gridlines:{type:"object",title:"Gridlines",propertyOrder:3,options:{collapsed:!0},properties:{GridlinesOffset:{title:"Offset Gridlines",type:"boolean",default:!1},GridlinesColor:{title:"Gridlines Color",type:"gradient",options:{noColor:!0,gradient:!1},default:""},GridlinesOpacity:{title:"Gridlines Opacity",type:"number",default:15}}},Format:{type:"object",title:"Format",propertyOrder:4,options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!0,propertyOrder:1},BeginAtZero:{type:"boolean",title:"Begin at Zero",format:"checkbox",default:!1,propertyOrder:2},ShowMajorUnits:{type:"boolean",title:"Show Major Units",format:"checkbox",default:!1,propertyOrder:3},Break:{title:"Break",type:"number",default:864e5,propertyOrder:3},Distribution:{title:"Distribution",type:"string",enum:["Linear","Smart"],default:"Linear",propertyOrder:3},TriggerBreak:{title:"Trigger Break",type:"number",default:864e5,propertyOrder:3},Format:{title:"Numeric Format",type:"string",enum:["Number","Smart Number","Formatted Number"],default:"Number"},Precision:{title:"Decimal Places",type:"number",default:2},FontSize:{title:"Font Size",type:"number",format:"number",default:12},Prefix:{title:"Prefix",type:"string",default:""},Suffix:{title:"Suffix",type:"string",default:""},HideTrailingZeroes:{type:"boolean",propertyOrder:4,title:"Hide Trailing Zeroes",format:"checkbox",default:!1}}}}}},Yaxes:{title:"Y-Axes",type:"array",propertyOrder:2,options:{collapsed:!0},items:{title:"Y-Axis",type:"object",options:{collapsed:!0},properties:{Bounds:{options:{hidden:!0}},Type:{title:"Y-Axis Type",type:"string",propertyOrder:1,enum:["Linear","Category","Time"],default:"Linear"},Position:{title:"Position",type:"string",enum:["Left","Right"],propertyOrder:2,default:"Left"},Width:{title:"Width",type:"number",propertyOrder:2,default:0},Ticks:{type:"number",title:"Number of Ticks",propertyOrder:2,default:10},Color:{title:"Color",type:"gradient",options:{noColor:!0,gradient:!1},propertyOrder:2,default:""},Stacked:{title:"Stacked",type:"boolean",propertyOrder:2,default:!1},Title:{type:"object",title:"Title",options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!1},LabelString:{title:"Label String",type:"string",default:""},FontSize:{title:"Font Size",type:"number",default:16}}},Range:{type:"object",title:"Range",propertyOrder:2,options:{collapsed:!0,hidden:!1},properties:{UseMinMax:{title:"Use min max",type:"boolean",default:!1},Min:{title:"Min",type:"string",default:""},Max:{title:"Max",type:"string",default:""},SelectionMin:{title:"Selection Min",type:"string",default:""},SelectionMax:{title:"Selection Max",type:"string",default:""}}},Gridlines:{type:"object",title:"Gridlines",propertyOrder:3,options:{collapsed:!0},properties:{GridlinesOffset:{title:"Offset Gridlines",type:"boolean",default:!1},GridlinesColor:{title:"Gridlines Color",type:"gradient",options:{noColor:!0,gradient:!1},default:""},GridlinesOpacity:{title:"Gridlines Opacity",type:"number",default:15}}},Format:{type:"object",title:"Format",propertyOrder:3,options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!0,propertyOrder:1},Break:{title:"Break",type:"number",default:864e5,propertyOrder:3},Distribution:{title:"Distribution",type:"string",enum:["Linear","Smart"],default:"Linear",propertyOrder:3},TriggerBreak:{title:"Trigger Break",type:"number",default:864e5,propertyOrder:3},BeginAtZero:{type:"boolean",title:"Begin at Zero",format:"checkbox",default:!1,propertyOrder:2},ShowMajorUnits:{type:"boolean",title:"Show Major Units",format:"checkbox",default:!1,propertyOrder:3},Format:{title:"Numeric Format",type:"string",enum:["Number","Smart Number","Formatted Number"],default:"Number"},Precision:{title:"Decimal Places",type:"number",default:2},FontSize:{title:"Font Size",type:"number",format:"number",default:12},Prefix:{title:"Prefix",type:"string",default:""},Suffix:{title:"Suffix",type:"string",default:""},HideTrailingZeroes:{type:"boolean",propertyOrder:4,title:"Hide Trailing Zeroes",format:"checkbox",default:!1}}}}}},Overlay:{type:"object",title:"Overlay",options:{collapsed:!0},propertyOrder:209,properties:{ShowCrosshairs:{type:"boolean",title:"Show Crosshairs",default:!0},ShowCoordinates:{type:"boolean",title:"Show Coordinates",default:!0},SnapToPoint:{type:"boolean",title:"Snap Crosshair to Data",default:!0},UseCustomTooltip:{type:"boolean",title:"Use custom tooltip",default:!1},CustomTooltip:{type:"tooltipTemplate",title:"Custom tooltip",templateItems:{this:{type:"array",items:{color:"color",data:"data",icon:"icon",image:"image",name:"name",width:"width",xAxis:"xAxis",yAxis:"yAxis"}}},default:a.CUSTOM_TOOLTIP_DEFAULT},ShowAllPoints:{type:"boolean",title:"Show all data points",default:!1},GroupByLayer:{type:"boolean",title:"Group tooltip by layer",default:!1}}},FileExport:{options:{collapsed:!0},properties:{FileName:{format:"table",items:{options:{collapsed:!0},properties:{FileNamePart:{title:"FileName Part",type:"string"}},title:"Filename Part",type:"object"},options:{collapsed:!0,hidden:!1},title:"FileName",type:"array"},ShowExportCsvButton:{default:!1,format:"checkbox",title:"Show Export Csv Button",type:"boolean"},ShowExportExcelButton:{default:!1,format:"checkbox",title:"Show Export Excel Button",type:"boolean"},ShowExportPngButton:{default:!1,format:"checkbox",title:"Show Export Png Button",type:"boolean"},UseChartFormat:{default:!1,format:"checkbox",title:"Use Chart Formatting",type:"boolean"},Actions:{type:"array",format:"table",title:"Actions",options:{collapsed:!0},items:{type:"object",title:"Action",options:{collapsed:!0},properties:{EventType:{title:"Event Type",type:"string",default:"all",enum:["all","onSuccess","onFail"]},Result:{title:"Last Result",type:"string",default:""}}}}},propertyOrder:320,title:"File Export",type:"object"},Legend:{title:"Legend",type:"object",options:{collapsed:!0},propertyOrder:210,properties:{Position:{title:"Position",type:"dropdown",data:"possiblePositions",watch:{possiblePositions:"root.possiblePositions"},default:"Top"},LegendGroups:{title:"Legend Groups",type:"array",items:{headerTemplate:"{{#if self.Name}}{{valueProp self.Name }}{{else}}Legend Group {{ i1 }}{{/if}}",type:"object",id:"arrItem",title:"Legend Group",options:{collapsed:!0},properties:{Name:{type:"string",default:""},Expanded:{type:"boolean",default:!0},Icon:{type:"icon",title:"Icon",iconTypes:"fa",default:""}}}}}},Annotations:{title:"Annotations",type:"object",options:{collapsed:!0},propertyOrder:250,properties:{ShowAnnotateControl:{default:!1,format:"checkbox",title:"Show Annotate Controls",type:"boolean"},Annotations:{type:"string",title:"Annotations",default:""}}},Style:{type:"object",title:"Style",options:{collapsed:!0},propertyOrder:260,properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};if(0<_.keys(t.settingsModel.attributes).length)for(var i=_.find(a.upgrades,{version:t.settingsModel.get("version")}),n=void 0===i?1:a.upgrades.indexOf(i)+1;n<a.upgrades.length;n+=1){var o=a.upgrades[n];o.fn(t.settingsModel,t),t.settingsModel.set("version",o.version)}return e},a.PALETTE_DEFAULT=[{type:"#0061FF"},{type:"#F23A66"},{type:"#009BAB"},{type:"#7647CC"},{type:"#FFC300"},{type:"#9FA3A6"},{type:"#003A99"},{type:"#A90B31"},{type:"#005D67"},{type:"#452481"}],a.COLOR_DEFAULT="#0061FF",a.TOOLTIP_DEFAULT='<table><thead><tr><th>{{this.0.xAxis}}</th><th></th></tr></thead><tbody>{{#each this}} {{#if open}}<tr><td width="{{width}}">Open: </td><td>{{open}} </td></tr><tr><td width="{{width}}">High: </td><td>{{high}} </td></tr><tr><td width="{{width}}">Low: </td><td>{{low}} </td></tr><tr><td width="{{width}}">Close: </td><td>{{close}} </td></tr>{{else if yAxis}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}};{{image}};"></i> {{name}}: </td><td>{{#if grouped}}{{#each grouped}}<td> {{this}} </td>{{/each}} {{else}} <td>{{yAxis}}</td> {{/if}}</td></tr>{{/if}}{{/each}}</tbody></table>',a.BAR_PROPERTIES={BarWidth:{title:"Bar Percentage",type:"number",default:95,propertyOrder:8},BarFixedWidth:{title:"Bar Fixed Width",type:"number",default:10,propertyOrder:8},BarWidthType:{title:"Bar Width Type",type:"string",default:"Percentage",enum:["Percentage","Fixed Width"],propertyOrder:8},BarOrientation:{title:"Bar Orientation",type:"string",default:"Vertical",enum:["Vertical","Horizontal"],propertyOrder:8}},a.BASICS={Hover:"",Selected:"",Zoom:!0,Duration:400,Easing:"easeOutQuart"},a.CUSTOM_TOOLTIP_DEFAULT='<table><thead><tr><th>{{this.0.xAxis}}</th><th></th></tr></thead><tbody>{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}</tbody></table>',a.LAYER_BASIC={_Id:{type:"string",options:{hidden:!0}},_Type:{type:"string",options:{hidden:!0}},possibleXAxes:{type:"array",options:{hidden:!0}},possibleYAxes:{type:"array",options:{hidden:!0}},Name:{title:"Name",type:"string",default:"",propertyOrder:2},XAxisId:{title:"X-Axis",default:"X-Axis 1",type:"string",enumSource:"possible_xaxis",watch:{possible_xaxis:"arrItem.possibleXAxes"},propertyOrder:3},YAxisId:{title:"Y-Axis",default:"Y-Axis 1",type:"string",enumSource:"possible_yaxis",watch:{possible_yaxis:"arrItem.possibleYAxes"},propertyOrder:3},Color:{title:"Color",type:"gradient",options:{gradient:!1},default:_.clone(a.COLOR_DEFAULT),propertyOrder:8},Opacity:{title:"Opacity",type:"number",default:80,propertyOrder:8},LegendGroup:{title:"Legend Group",type:"dropdown",default:"None",data:"possibleCols",propertyOrder:9,watch:{possibleCols:"root.possibleLegendGroups"}},ShowCurrentTick:{title:"Show Current Tick Label",type:"boolean",default:!1,propertyOrder:9},CacheStreamingData:{title:"Cache Streaming Data",type:"boolean",default:!1,propertyOrder:9},Legend:{title:"Legend Enabled",type:"boolean",default:!0,propertyOrder:9},Enabled:{title:"Enabled",type:"boolean",default:!0,propertyOrder:9},Labels:{options:{collapsed:!0},properties:{Align:{default:"center",enum:["center","right","bottom","left","top"],propertyOrder:4,type:"string"},Color:{default:"#000",options:{gradient:!1,noColor:!1},propertyOrder:2,title:"Label Color",type:"gradient"},Enabled:{default:!1,format:"checkbox",propertyOrder:1,type:"boolean"},Font:{properties:{Bold:{default:!1,format:"checkbox",type:"boolean"},Size:{default:12,minimum:1,type:"number"}},propertyOrder:8,type:"object"},Frequency:{default:1,minimum:1,propertyOrder:3,title:"Label Freq",type:"number"},Offset:{default:"0",propertyOrder:6,type:"string"},Rotation:{default:0,propertyOrder:7,type:"number"},MaxLabels:{default:10,propertyOrder:7,type:"number",title:"Max Label Quantity"},Template:{default:"{{x}}, {{toFixed y 2}}",propertyOrder:7,templateItems:{values:{items:_.keyBy(["x","y","r"]),type:"object"}},title:"Label Template",type:"tooltipTemplate"}},type:"object"}},a.LAYER_BUBBLE={RadiusData:{title:"Radius Data",type:"",propertyOrder:7,default:"Fixed Size",enumSource:"possible_columns",watch:{possibleCols:"arrItem.possibleRadiusData"}},RadiusScaling:{title:"Radius Scaling",type:"number",propertyOrder:7,default:4},ScaleOnZoom:{title:"Scale on Zoom",type:"boolean",default:!0,propertyOrder:7},Icon:{type:"icon",title:"Icon",iconTypes:"fa",propertyOrder:8,default:""}},a.LAYER_AXIS_VALS={XAxis:{title:"X-Axis Data",type:"dropdown",default:"",data:"possible_columns",watch:{possible_columns:"arrItem.possibleXColumns"},propertyOrder:3},YAxis:{title:"Y-Axis Data",type:"customDropdown",default:"",data:"possible_columns",watch:{possible_columns:"arrItem.possibleYColumns"},propertyOrder:3}},a.LAYER_COMMON={possibleColorColumns:{type:"array",options:{hidden:!0}},possibleRadiusData:{type:"array",options:{hidden:!0}},possibleLayers:{type:"array",options:{hidden:!0}},possibleRulesColumns:{type:"array",options:{hidden:!0}},possibleXColumns:{type:"array",options:{hidden:!0}},possibleYColumns:{type:"array",options:{hidden:!0}},Data:{title:"Data Source",type:"data",default:"",propertyOrder:1},ColorData:{title:"Color Enumeration",type:"dropdown",default:"None",data:"possible_columns",watch:{possible_columns:"arrItem.possibleColorColumns"},propertyOrder:8},Palette:{type:"array",format:"table",title:"Color Palette",options:{collapsed:!0},uniqueItems:!1,items:{type:"object",title:"Palette Color",properties:{type:{type:"gradient",options:{gradient:!1},title:"color",default:"#ffa500"}}},default:_.cloneDeep(a.PALETTE_DEFAULT),propertyOrder:10},Actions:{title:"Actions",type:"actions",fields:{map:_.extend({Current:{enumSource:"possible_columns",propertyOrder:10,title:"Source Column",type:"string",watch:{possibleColumns:"arrItem.possibleColorColumns"}}},e),nav:e,query:e,url:e},options:{collapsed:!0}},HighlightRules:{title:"Highlight Rules",type:"array",options:{collapsed:!0},items:{title:"Highlight Rule",type:"object",oneOf:[{options:{linked_oneof_property:{property:"RuleType",value:"discrete"}},properties:Object.assign({},i,{RuleColor:{default:"#F8F8F8",options:{gradient:!1,noColor:!1},propertyOrder:11,title:"Rule Color",type:"gradient"},RuleOperation:{default:"",enum:["","search","regexp","contains","starts with","ends with","==","<",">","<=",">=","!=","in"],propertyOrder:9,title:"Rule Operation",type:"string"},RuleValue:{data:"possible_columns",default:"",propertyOrder:10,title:"Rule Value",type:"string"}}),title:"Discrete"},{options:{additionalProperties:!1,linked_oneof_property:{property:"RuleType",value:"gradient"}},properties:Object.assign({},i,{Palette:{default:[{type:"#b71c1c"},{type:"#F57F17"},{type:"#33691E"}],format:"table",items:{properties:{type:{default:"#ffa500",options:{gradient:!1},title:"color",type:"gradient"}},title:"Palette Color",type:"object"},options:{collapsed:!0},propertyOrder:8,title:"Color Palette",type:"array",uniqueItems:!1},RuleMax:{default:1,format:"number",propertyOrder:7,title:"Rule Max",type:"number"},RuleMin:{default:0,format:"number",propertyOrder:6,title:"Rule Min",type:"number"}}),title:"Gradient"}]}}},a.upgrades=[{version:"0",fn:function(t,e){}},{version:"4.5.0",fn:function(t){t.get("Basics")&&!t.get("Basics.Easing")&&t.unset("Basics")}},{version:"4.5.1.1",fn:function(o){o.get("Palette")||o.set("Palette",a.PALETTE_DEFAULT),_.each(o.get("Layers"),function(t,e){o.get("Layers."+e+".Name")||o.set("Layers."+e+".Name","Layer "+(e+1))}),o.get("Xaxis")&&!o.get("Xaxes.Range.SelectionMin")&&(o.set("Xaxis.Range.SelectionMin",""),o.set("Xaxis.Range.SelectionMax",""),o.set("Yaxis.Range.SelectionMin",""),o.set("Yaxis.Range.SelectionMax","")),o.get("Basics.Easing")||o.set("Basics",a.BASICS),o.get("Xaxes")&&o.get("Xaxes.0.Format")||(o.set("Xaxes",[_.extend({},o.get("Xaxis"),{Position:{title:"Position",type:"string",enum:["Top","Bottom"],default:"Bottom"}})]),o.set("Yaxes",[_.extend({},o.get("Yaxis"),{Position:{title:"Position",type:"string",enum:["Left","Right"],default:"Left"}})]),o.set("Yaxes.0.Position","Left"),o.set("Xaxes.0.Position","Bottom"),o.unset("Xaxis"),o.unset("Yaxis"),_.each(o.get("Layers"),function(t,e){o.set("Layers."+e+".XAxisId","X-Axis 1"),o.set("Layers."+e+".YAxisId","Y-Axis 1"),o.set("Layers."+e+".possibleXAxes",["X-Axis 1"]),o.set("Layers."+e+".possibleYAxes",["Y-Axis 1"])}));'<table>{{#each this}}{{#eq @index 0}}<thead><tr><th>{{xAxis}}</th><th></th></tr></thead>{{/eq}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}</table>'===o.get("Overlay.CustomTooltip")&&o.set("Overlay.CustomTooltip",'<table><thead><tr><th>{{this.0.0.xAxis}}</th><th></th></tr></thead>{{#each this}}{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}{{/each}}</table>'),o.get("Overlay.ShowAllPoints")||o.set("Overlay.ShowAllPoints",!1),o.get("Overlay.GroupByLayer")||o.set("Overlay.GroupByLayer",!1),_.each(o.get("Layers"),function(t,e){o.get("Layers."+e+".Enabled")||o.set("Layers."+e+".Enabled",!0),o.get("Layers."+e+".Opacity")||o.set("Layers."+e+".Opacity",80);var i="Layers."+e+".BarWidth",n="Layers."+e+".BarFixedWidth",e="Layers."+e+".BarWidthType";o.get(i)&&!o.get(n)&&(o.set(i,100*o.get(i)),o.set(e,"Percentage"),o.set(n,10))})}},{version:"4.6.0a",fn:function(n){_.each(n.get("Layers"),function(t,e){var i;void 0===n.get("Layers."+e+".ScaleOnZoom")&&(i=n.get("Layers."+e+".PointSize"),n.set("Layers."+e+".ScaleOnZoom",!0),n.set("Layers."+e+".RadiusData","Fixed Size"),n.set("Layers."+e+".RadiusScaling",i),n.unset("Layers."+e+".PointSize"))});'<table><thead><tr><th>{{this.0.0.xAxis}}</th><th></th></tr></thead>{{#each this}}{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}{{/each}}</table>'===n.get("Overlay.CustomTooltip")&&n.set("Overlay.CustomTooltip",a.CUSTOM_TOOLTIP_DEFAULT),n.get("Layers").forEach(function(t,e){n.get("Layers."+e+"._Type")===V.Line&&(n.get("Layers."+e+".Fill")||(n.set("Layers."+e+".Fill","No Fill"),n.set("Layers."+e+".FillColor","#0061FF"),n.set("Layers."+e+".FillOpacity",80)),n.get("Layers."+e+"._Type")===V.Line)&&void 0===n.get("Layers."+e+".FadeToTransparent")&&n.set("Layers."+e+".FadeToTransparent",!1)})}},{version:"4.6.0b",fn:function(t){void 0===t.get("Overlay.ShowCoordinates")&&t.set("Overlay.ShowCoordinates",!0),void 0===t.get("Overlay.SnapToPoint")&&t.set("Overlay.SnapToPoint",!0)}},{version:"4.6.0c",fn:function(i){i.get("Layers").forEach(function(t,e){void 0===t.ColorData&&(i.set("Layers."+e+".possibleColorColumns",["None"]),i.set("Layers."+e+".ColorData","None")),void 0===t.Palette&&(t=i.get("Palette")||a.PALETTE_DEFAULT,i.set("Layers."+e+".Palette",t))}),i.get("Xaxes").forEach(function(t,e){void 0===t.Format.BeginAtZero&&i.set("Xaxes."+e+".Format.BeginAtZero",!1)}),i.get("Yaxes").forEach(function(t,e){void 0===t.Format.BeginAtZero&&i.set("Yaxes."+e+".Format.BeginAtZero",!1)})}},{version:"4.6.0d",fn:function(i){i.get("Layers").forEach(function(t,e){e="Layers."+e;void 0===t.Palette&&(t=i.get("Palette")||a.PALETTE_DEFAULT,i.set(e+".Palette",t)),"No Fill"===i.get(e+".Fill")&&(i.set(e+".FillColor",void 0),i.set(e+".Fade",void 0),i.set(e+".FillOpacity",void 0))})}},{version:"4.7.2",fn:function(i){i.get("Layers").forEach(function(t,e){e="Layers."+e;t._Type===V.Line&&void 0===i.get(e+".SpanGaps")&&i.set(e+".SpanGaps",!1),void 0===t.LegendGroup&&i.set(e+".LegendGroup","None")}),void 0===i.get("Legend")&&(i.set("Legend.LegendGroups",[]),i.set("Legend.Position","Top"))}},{version:"4.7.2",fn:function(t){_.isNil(t.get("FileExport"))&&t.set("FileExport",{FileName:[],ShowExportCsvButton:!1,ShowExportExcelButton:!1})}},{version:"4.7.3",fn:function(o){o.get("Layers").forEach(function(t,e){var i,n="Layers."+e;t._Type===V.Line&&void 0===o.get(n+".Line")&&(e=["Fill","FillColor","FillOpacity","FadeToTransparent","SpanGaps"],o.set(n+".Line"),o.set(n+".Line.FillPalette",a.PALETTE_DEFAULT),e.forEach(function(t){return o.set(n+".Line."+t,o.get(n+"."+t))}),e.forEach(function(t){return o.unset(n+"."+t)})),void 0===t.Labels&&(o.set(n+".Labels"),i=[!1,"center","#000",!1,12,1,0,0,"{{x}}, {{toFixed y 2}}",10],["Enabled","Align","Color","Font.Bold","Font.Size","Frequency","Offset","Rotation","Template","MaxLabels"].forEach(function(t,e){return o.set(n+".Labels."+t,i[e])}))})}},{version:"4.7.3",fn:function(t){_.isNil(t.get("Annotations"))&&t.set("Annotations",{ShowAnnotateControl:!1,Annotations:""})}},{version:"4.7.3.1",fn:function(t){t=t.get("FileExport");t.ShowExportPngButton=!_.isNil(t.ShowExportPngButton)&&t.howExportPngButton}},{version:"4.7.4",fn:function(i){(_.isNil(i.get("Xaxes.0.Stacked"))||_.isNil(i.get("Yaxes.0.Stacked")))&&(i.get("Xaxes").forEach(function(t,e){i.set("Xaxes."+e+".Stacked",!1)}),i.get("Yaxes").forEach(function(t,e){i.set("Yaxes."+e+".Stacked",!1)})),_.isNil(i.get("Basics.Zoom"))&&i.set("Basics.Zoom",!0),i.get("Layers").forEach(function(t,e){i.get("Layers."+e+"._Type")!==V.Bar||i.get("Layers."+e+".BarOrientation")||i.set("Layers."+e+".BarOrientation","Vertical")})}},{version:"4.7.4.1",fn:function(i){var t=i.get("Xaxes"),e=i.get("Xaxes");t.forEach(function(t,e){void 0===i.get("Xaxes."+e+".Color")&&i.set("Xaxes."+e+".Color","")}),e.forEach(function(t,e){void 0===i.get("Yaxes."+e+".Color")&&i.set("Yaxes."+e+".Color","")});'<table><thead><tr><th>{{this.0.xAxis}}</th><th></th></tr></thead>{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}</table>'===i.get("Overlay.CustomTooltip")&&i.set("Overlay.CustomTooltip",a.CUSTOM_TOOLTIP_DEFAULT)}},{version:"4.7.4.2",fn:function(t){t=t.get("FileExport");t.UseChartFormat=!_.isNil(t.UseChartFormat)&&t.UseChartFormat}},{version:"4.7.4.3",fn:function(i){i.get("Layers").forEach(function(t,e){t._Type!==V.Line||i.get((t="Layers."+e+".Line.Interpolation")+".Interpolation")||(i.set(t+".Interpolation","Linear"),i.set(t+".SteppedLine","After"))})}},{version:"4.7.4.4",fn:function(i){var t=i.get("Xaxes"),e=i.get("Xaxes");t.forEach(function(t,e){e="Xaxes."+e;"Time"===i.get(e+".Type")&&void 0===i.get(e+".Format.ShowMajorUnits")&&i.set(e+".Format.ShowMajorUnits",!1)}),e.forEach(function(t,e){e="Yaxes."+e;"Time"===i.get(e+".Type")&&void 0===i.get(e+".Format.ShowMajorUnits")&&i.set(e+".Format.ShowMajorUnits",!1)}),i.get("Layers").forEach(function(t,e){void 0===t.ShowCurrentTick&&i.set("Layers."+e+".ShowCurrentTick",!1)})}},{version:"4.7.4.5",fn:function(i){i.get("Layers").forEach(function(t,e){void 0===t.CacheStreamingData&&i.set("Layers."+e+".CacheStreamingData",!1)})}},{version:"4.7.5",fn:function(n){n.get("Layers").forEach(function(t,e){var i;void 0!==t.Bubbles||t._Type!==V.Bubble&&t._Type!==V.Line||(i=t.Type===V.Bubble?4:0,n.set((e="Layers."+e)+".Bubbles.RadiusScaling",n.get(e+".RadiusScaling")||i),n.set(e+".Bubbles.RadiusData",n.get(e+".RadiusData")||""),n.set(e+".Bubbles.ScaleOnZoom",n.get(e+".ScaleOnZoom")||!0),n.set(e+".Bubbles.Icon",n.get(e+".Icon")||""),t._Type===V.Bubble?(n.unset(e+".RadiusScaling"),n.unset(e+".RadiusData"),n.unset(e+".ScaleOnZoom"),n.unset(e+".Icon")):(n.set(e+".Bubbles.Color",n.get(e+".Color")||a.COLOR_DEFAULT),n.set(e+".Bubbles.Opacity",n.get(e+".Opacity")||80)))})}},{version:"4.7.5.1",fn:function(i){var t=i.get("FileExport");t.Actions=_.isNil(t.Actions)?[]:t.Actions,i.get("Layers").forEach(function(t,e){t._Type===V.Line&&void 0===t.LineThickness&&i.set("Layers."+e+".Line.LineThickness",1)})}}],a);function a(){}W.annotate=R.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,s=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="chartGLAnnotateControl">\n    <span class="lnksAnnotate link-disabled">\n    <a class="lnkAnnotate btn-annotate" title="'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Enable Annotation mode",{name:"t",hash:{},data:o,loc:{start:{line:3,column:47},end:{line:3,column:77}}}))+'"><i class="fa fa-fw fa-pencil draw-icon"></i>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Annotate",{name:"t",hash:{},data:o,loc:{start:{line:3,column:123},end:{line:3,column:139}}}))+'</a>\n    <a class="lnkEditAnnotate btn-annotate" title="'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Edit annotations",{name:"t",hash:{},data:o,loc:{start:{line:4,column:51},end:{line:4,column:75}}}))+'"><i class="fa fas fa-edit"></i></a>\n    <a class="lnkUndoAnnotate btn-annotate btn-disabled" title="'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Undo",{name:"t",hash:{},data:o,loc:{start:{line:5,column:64},end:{line:5,column:76}}}))+'"><i class="fa fa-undo"></i></a>\n    <a class="lnkRedoAnnotate btn-annotate btn-disabled" title="'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Redo",{name:"t",hash:{},data:o,loc:{start:{line:6,column:64},end:{line:6,column:76}}}))+'"><i class="fa fa-repeat"></i></a>\n    </span>   \n</div>'},useData:!0}),W.annotateDialog=R.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,s=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="draw-menu">\n    <fieldset class="options-annotate-new">\n        <legend>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Annotate Settings",{name:"t",hash:{},data:o,loc:{start:{line:3,column:16},end:{line:3,column:41}}}))+'</legend>\n            <div class="pnlNew">\n            <label>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Annotation type",{name:"t",hash:{},data:o,loc:{start:{line:5,column:19},end:{line:5,column:42}}}))+'</label>\n            <select class="annotate-type-select select2-container--dashboards select2-selection--single">\n                <option value="text-note">'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Text note",{name:"t",hash:{},data:o,loc:{start:{line:7,column:42},end:{line:7,column:59}}}))+'</option>\n                <option value="rectangle">'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Rectangle",{name:"t",hash:{},data:o,loc:{start:{line:8,column:42},end:{line:8,column:59}}}))+'</option>\n                <option value="horizontal-line">'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Horizontal line",{name:"t",hash:{},data:o,loc:{start:{line:9,column:48},end:{line:9,column:71}}}))+'</option>\n                <option value="vertical-line">'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Vertical line",{name:"t",hash:{},data:o,loc:{start:{line:10,column:46},end:{line:10,column:67}}}))+'</option>\n                <option value="trend-line">'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Trend line",{name:"t",hash:{},data:o,loc:{start:{line:11,column:43},end:{line:11,column:61}}}))+'</option>\n            </select>\n            </div>\n            <div class="pnlNew">\n            <label>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Annotation color",{name:"t",hash:{},data:o,loc:{start:{line:15,column:19},end:{line:15,column:43}}}))+'</label>\n                <span class="fa fa-fw watermark fa-tint annotate-color-icon"></span>\n                <button class="annotate-color-btn ui-widget ui-state-default ui-corner-all">\n                </button>\n    </fieldset>\n    <fieldset class="options-annotate-edit">\n    <legend>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Edit",{name:"t",hash:{},data:o,loc:{start:{line:21,column:12},end:{line:21,column:24}}}))+'</legend>\n        <div class="delete-all-div">\n            <a class="delete-all-btn"><i class="fa fa-trash"></i>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Delete All",{name:"t",hash:{},data:o,loc:{start:{line:23,column:65},end:{line:23,column:83}}}))+'</a>\n        </div>\n        <table class="table-annotate-edit">\n            <thead class="ui-widget-header ui-corner-all ui-helper-clearfix">\n                <tr>\n                    <th>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Annotation Type",{name:"t",hash:{},data:o,loc:{start:{line:28,column:24},end:{line:28,column:47}}}))+'</th>\n                    <th class="th-color">'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Color",{name:"t",hash:{},data:o,loc:{start:{line:29,column:41},end:{line:29,column:54}}}))+"</th>  \n                    <th>"+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Delete",{name:"t",hash:{},data:o,loc:{start:{line:30,column:24},end:{line:30,column:38}}}))+'</th>\n                </tr>\n            </thead>\n            <tbody class="tbody-annotate-edit">\n            </tbody>\n        </table>\n    </fieldset>\n\n</div>'},useData:!0}),W.annotateFragment=R.template({1:function(t,e,i,n,o){return"#version 300 es"},3:function(t,e,i,n,o){return"in"},5:function(t,e,i,n,o){return" varying"},7:function(t,e,i,n,o){return"out vec4 outColor;\n"},9:function(t,e,i,n,o){return"outColor"},11:function(t,e,i,n,o){return"gl_FragColor"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var a,r=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(a=s(i,"if").call(r,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:1,column:38}}}))?a:"")+"\nprecision mediump float;\n"+(null!=(a=s(i,"if").call(r,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.program(5,o,0),data:o,loc:{start:{line:3,column:0},end:{line:3,column:41}}}))?a:"")+" vec4 vColor;\n\n"+(null!=(a=s(i,"if").call(r,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:0},end:{line:7,column:7}}}))?a:"")+"\nvoid main(void) {\n    "+(null!=(a=s(i,"if").call(r,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.program(11,o,0),data:o,loc:{start:{line:10,column:4},end:{line:10,column:55}}}))?a:"")+" = vColor;\n}"},useData:!0}),W.annotateVertex=R.template({1:function(t,e,i,n,o){return"#version 300 es"},3:function(t,e,i,n,o){return"in"},5:function(t,e,i,n,o){return" attribute"},7:function(t,e,i,n,o){return"out"},9:function(t,e,i,n,o){return" varying"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var a,r=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(a=s(i,"if").call(r,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:1,column:38}}}))?a:"")+"\n"+(null!=(a=s(i,"if").call(r,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.program(5,o,0),data:o,loc:{start:{line:2,column:0},end:{line:2,column:43}}}))?a:"")+" vec2 aPosition;\nuniform vec2 u_resolution;\n"+(null!=(a=s(i,"if").call(r,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.program(5,o,0),data:o,loc:{start:{line:4,column:0},end:{line:4,column:43}}}))?a:"")+" vec4 aColor;\n"+(null!=(a=s(i,"if").call(r,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.program(9,o,0),data:o,loc:{start:{line:5,column:0},end:{line:5,column:42}}}))?a:"")+" vec4 vColor;\n\nvoid main(void) {\n    gl_PointSize = 10.0;\n    \n    // convert the position from pixels to 0.0 to 1.0\n    vec2 zeroToOne = aPosition / u_resolution;\n\n    // 32-bit below here                \n    // convert from 0->1 to 0->2\n    vec2 zeroToTwo = zeroToOne * 2.0;\n\n    // convert from 0->2 to -1->+1 (clip space)\n    vec2 clipSpace = zeroToTwo - 1.0;\n\n    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n\n    vColor = aColor;\n}"},useData:!0}),W.app=R.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<canvas class="axis"></canvas>\n<canvas id='+t.escapeExpression("function"==typeof(i=null!=(i=a(i,"uid")||(null!=e?a(e,"uid"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"uid",hash:{},data:o,loc:{start:{line:2,column:11},end:{line:2,column:18}}}):i)+'></canvas>\n<div class="draw-div"></div>\n<div class="export-div"></div>\n<div class="legend-div"></div>\n<canvas class="data-labels"></canvas>\n<canvas class="annotations"></canvas>\n<canvas class="annotations2d"></canvas>\n<svg class="overlay">\n    <defs>\n        <marker id="sArrow" markerWidth="9" markerHeight="6" orient="auto" refY="3" refX="0">\n            <path d="M7,0 L7,6 L0,3 z"></path>\n        </marker>\n        <marker id="eArrow" markerWidth="9" markerHeight="6" orient="auto" refY="3" refX="7">\n            <path d="M0,0 L0,6 L7,3 z"></path>\n        </marker>\n    </defs>\n</svg>\n<div class="GL-highlight-rule"></div>\n<img></img>\n'},useData:!0}),W.dualVertex=R.template({1:function(t,e,i,n,o){return"#version 300 es"},3:function(t,e,i,n,o,a,r){var s=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,h="function",p=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(t=u(i,"if").call(s,null!=r[1]?u(r[1],"isWebGL2"):r[1],{name:"if",hash:{},fn:t.program(4,o,0,a,r),inverse:t.program(6,o,0,a,r),data:o,loc:{start:{line:4,column:0},end:{line:4,column:45}}}))?t:"")+" "+p(typeof(a=null!=(a=u(i,"vt")||(null!=e?u(e,"vt"):e))?a:l)==h?a.call(s,{name:"vt",hash:{},data:o,loc:{start:{line:4,column:46},end:{line:4,column:52}}}):a)+" "+p(typeof(a=null!=(a=u(i,"name")||(null!=e?u(e,"name"):e))?a:l)==h?a.call(s,{name:"name",hash:{},data:o,loc:{start:{line:4,column:53},end:{line:4,column:61}}}):a)+"_position;\nuniform "+p(typeof(a=null!=(a=u(i,"ut")||(null!=e?u(e,"ut"):e))?a:l)==h?a.call(s,{name:"ut",hash:{},data:o,loc:{start:{line:5,column:8},end:{line:5,column:14}}}):a)+" "+p(typeof(a=null!=(a=u(i,"name")||(null!=e?u(e,"name"):e))?a:l)==h?a.call(s,{name:"name",hash:{},data:o,loc:{start:{line:5,column:15},end:{line:5,column:23}}}):a)+"_u_min;\nuniform "+p(typeof(a=null!=(a=u(i,"ut")||(null!=e?u(e,"ut"):e))?a:l)==h?a.call(s,{name:"ut",hash:{},data:o,loc:{start:{line:6,column:8},end:{line:6,column:14}}}):a)+" "+p(typeof(a=null!=(a=u(i,"name")||(null!=e?u(e,"name"):e))?a:l)==h?a.call(s,{name:"name",hash:{},data:o,loc:{start:{line:6,column:15},end:{line:6,column:23}}}):a)+"_u_max;\n"},4:function(t,e,i,n,o){return"in"},6:function(t,e,i,n,o){return"attribute"},8:function(t,e,i,n,o){var a,r=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(a=s(i,"if").call(r,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(6,o,0),data:o,loc:{start:{line:10,column:0},end:{line:10,column:42}}}))?a:"")+" vec4 h_color;\n"+(null!=(a=s(i,"if").call(r,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.program(11,o,0),data:o,loc:{start:{line:11,column:0},end:{line:11,column:41}}}))?a:"")+" lowp vec4 v_color;\n"},9:function(t,e,i,n,o){return"out"},11:function(t,e,i,n,o){return"varying"},13:function(t,e,i,n,o){return"vec2 ds_sub (vec2 dsa, vec2 dsb) {\n    vec2 dsc;\n    float e, t1, t2;\n    t1 = dsa.x - dsb.x;\n    e = t1 - dsa.x;\n    t2 = ((-dsb.x - e) + (dsa.x - (t1 - e))) + dsa.y - dsb.y;\n    dsc.x = t1 + t2;\n    dsc.y = t2 - (dsc.x - t1);\n    return dsc;\n}\n\nvec2 ds_div(vec2 dsa, vec2 dsb)\n{\n    vec2 dsc;\n    float c11, c21, c2, e, s1, s2, t1, t2, t11, t12, t21, t22;\n    float a1, a2, b1, b2, cona, conb, split = 8193.;\n\n    // Compute a DP approximation to the quotient.\n    s1 = dsa.x / dsb.x;\n\n    // On systems with a fused multiply add, such as IBM systems, it is faster to\n    // uncomment the next two lines and comment out the following lines until !>.\n    // On other systems, do the opposite.\n    //  c11 = s1 * dsb(1)\n    // c21 = s1 * dsb(1) - c11\n    cona = s1 * split;\n    conb = dsb.x * split;\n    a1 = cona - (cona - s1);\n    b1 = conb - (conb - dsb.x);\n    a2 = s1 - a1;\n    b2 = dsb.x - b1;\n\n    // Multiply s1 * dsb.x using Dekker's method.\n    c11 = s1 * dsb.x;\n    c21 = (((a1 * b1 - c11) + a1 * b2) + a2 * b1) + a2 * b2;\n\n    // Compute s1 * dsb.y (only high-order word is needed).\n    c2 = s1 * dsb.y;\n    \n    // Compute (c11, c21) + c2 using Knuth's trick.\n    t1 = c11 + c2;\n    e = t1 - c11;\n    t2 = ((c2 - e) + (c11 - (t1 - e))) + c21;\n\n    // The result is t1 + t2, after normalization.\n    t12 = t1 + t2;\n    t22 = t2 - (t12 - t1);\n\n    // Compute dsa - (t12, t22) using Knuth's trick.\n    t11 = dsa.x - t12;\n    e = t11 - dsa.x;\n    t21 = ((-t12 - e) + (dsa.x - (t11 - e))) + dsa.y - t22;\n\n    // Compute high-order word of (t11, t21) and divide by dsb(1).\n    s2 = (t11 + t21) / dsb.x;\n    \n    // The result is s1 + s2, after normalization.\n    dsc.x = s1 + s2;\n    dsc.y = s2 - (dsc.x - s1);\n\n    return dsc;\n}\n"},15:function(t,e,i,n,o){var a,r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(a=(l(i,"eq")||e&&l(e,"eq")||s).call(r,null!=e?l(e,"vt"):e,"uint",{name:"eq",hash:{},fn:t.program(16,o,0),inverse:t.noop,data:o,loc:{start:{line:85,column:4},end:{line:89,column:11}}}))?a:"")+(null!=(a=(l(i,"eq")||e&&l(e,"eq")||s).call(r,null!=e?l(e,"vt"):e,"int",{name:"eq",hash:{},fn:t.program(18,o,0),inverse:t.noop,data:o,loc:{start:{line:90,column:4},end:{line:94,column:11}}}))?a:"")+(null!=(a=(l(i,"eq")||e&&l(e,"eq")||s).call(r,null!=e?l(e,"vt"):e,"float",{name:"eq",hash:{},fn:t.program(20,o,0),inverse:t.noop,data:o,loc:{start:{line:95,column:4},end:{line:98,column:11}}}))?a:"")+(null!=(a=(l(i,"eq")||e&&l(e,"eq")||s).call(r,null!=e?l(e,"vt"):e,"vec2",{name:"eq",hash:{},fn:t.program(22,o,0),inverse:t.noop,data:o,loc:{start:{line:99,column:4},end:{line:104,column:11}}}))?a:"")},16:function(t,e,i,n,o){var a,r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    float "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:86,column:10},end:{line:86,column:18}}}):a)+"_u_range = float(int("+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:86,column:39},end:{line:86,column:47}}}):a)+"_u_max) - int("+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:86,column:61},end:{line:86,column:69}}}):a)+"_u_min));\n    float "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:87,column:10},end:{line:87,column:18}}}):a)+"a = float(int("+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:87,column:32},end:{line:87,column:40}}}):a)+"_position) - "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:87,column:53},end:{line:87,column:61}}}):a)+"_u_min);\n    zeroToOne."+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:88,column:14},end:{line:88,column:22}}}):a)+" = "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:88,column:25},end:{line:88,column:33}}}):a)+"a / "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:88,column:37},end:{line:88,column:45}}}):a)+"_u_range;\n"},18:function(t,e,i,n,o){var a,r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    float "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:91,column:10},end:{line:91,column:18}}}):a)+"_u_range = float(int("+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:91,column:39},end:{line:91,column:47}}}):a)+"_u_max) - int("+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:91,column:61},end:{line:91,column:69}}}):a)+"_u_min));\n    float "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:92,column:10},end:{line:92,column:18}}}):a)+"a = float("+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:92,column:28},end:{line:92,column:36}}}):a)+"_position - "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:92,column:48},end:{line:92,column:56}}}):a)+"_u_min);\n    zeroToOne."+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:93,column:14},end:{line:93,column:22}}}):a)+" = "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:93,column:25},end:{line:93,column:33}}}):a)+"a / "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:93,column:37},end:{line:93,column:45}}}):a)+"_u_range;\n"},20:function(t,e,i,n,o){var a,r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    float "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:96,column:10},end:{line:96,column:18}}}):a)+"_u_range = float("+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:96,column:35},end:{line:96,column:43}}}):a)+"_u_max - "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:96,column:52},end:{line:96,column:60}}}):a)+"_u_min);\n    zeroToOne."+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:97,column:14},end:{line:97,column:22}}}):a)+" = ("+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:97,column:26},end:{line:97,column:34}}}):a)+"_position - "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:97,column:46},end:{line:97,column:54}}}):a)+"_u_min) / "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:97,column:64},end:{line:97,column:72}}}):a)+"_u_range;\n"},22:function(t,e,i,n,o){var a,r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    vec2 "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:100,column:9},end:{line:100,column:17}}}):a)+"_u_range = ds_sub("+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:100,column:35},end:{line:100,column:43}}}):a)+"_u_max, "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:100,column:51},end:{line:100,column:59}}}):a)+"_u_min);  \n    vec2 "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:101,column:9},end:{line:101,column:17}}}):a)+"_position2 = ds_sub("+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:101,column:37},end:{line:101,column:45}}}):a)+"_position, "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:101,column:56},end:{line:101,column:64}}}):a)+"_u_min);             \n    vec2 "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:102,column:9},end:{line:102,column:17}}}):a)+"_zeroToOne = ds_div("+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:102,column:37},end:{line:102,column:45}}}):a)+"_position2,"+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:102,column:56},end:{line:102,column:64}}}):a)+"_u_range);\n    zeroToOne."+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:103,column:14},end:{line:103,column:22}}}):a)+" = "+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:s)==l?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:103,column:25},end:{line:103,column:33}}}):a)+"_zeroToOne.x;\n"},24:function(t,e,i,n,o){return"    gl_PointSize = pointSize;\n    "},26:function(t,e,i,n,o){return" gl_PointSize = u_point_size;\n"},28:function(t,e,i,n,o){return"    v_color = h_color;\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o,a,r){var s,l=null!=e?e:t.nullContext||{},h=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(s=h(i,"if").call(l,null!=e?h(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(1,o,0,a,r),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:1,column:38}}}))?s:"")+"\n\n"+(null!=(s=h(i,"each").call(l,null!=e?h(e,"axis"):e,{name:"each",hash:{},fn:t.program(3,o,0,a,r),inverse:t.noop,data:o,loc:{start:{line:3,column:0},end:{line:7,column:9}}}))?s:"")+"\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isColored"):e,{name:"if",hash:{},fn:t.program(8,o,0,a,r),inverse:t.noop,data:o,loc:{start:{line:9,column:0},end:{line:12,column:7}}}))?s:"")+"\nuniform float u_point_size;\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(4,o,0,a,r),inverse:t.program(6,o,0,a,r),data:o,loc:{start:{line:15,column:0},end:{line:15,column:42}}}))?s:"")+" float pointSize;\n\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"math"):e,{name:"if",hash:{},fn:t.program(13,o,0,a,r),inverse:t.noop,data:o,loc:{start:{line:17,column:0},end:{line:80,column:7}}}))?s:"")+"\nvoid main() {\n    vec2 zeroToOne;\n"+(null!=(s=h(i,"each").call(l,null!=e?h(e,"axis"):e,{name:"each",hash:{},fn:t.program(15,o,0,a,r),inverse:t.noop,data:o,loc:{start:{line:84,column:4},end:{line:105,column:13}}}))?s:"")+"\n    // 32-bit below here                \n    // convert from 0->1 to 0->2\n    vec2 zeroToTwo = zeroToOne * 2.0;\n\n    // convert from 0->2 to -1->+1 (clip space)\n    vec2 clipSpace = zeroToTwo - 1.0;\n\n    gl_Position = vec4(clipSpace, 0, 1);\n\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isSize"):e,{name:"if",hash:{},fn:t.program(24,o,0,a,r),inverse:t.program(26,o,0,a,r),data:o,loc:{start:{line:116,column:4},end:{line:119,column:11}}}))?s:"")+"\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isColored"):e,{name:"if",hash:{},fn:t.program(28,o,0,a,r),inverse:t.noop,data:o,loc:{start:{line:121,column:4},end:{line:123,column:11}}}))?s:"")+"}\n"},useData:!0,useDepths:!0}),W.fileExporter=R.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,s=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="chartGLExportButtons">\n    <span class="lnksExport link-disabled">\n        <i class="fa fa-fw fa-download" title="'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Data",{name:"t",hash:{},data:o,loc:{start:{line:3,column:47},end:{line:3,column:59}}}))+'"></i>\n        <a class="lnkExcelExport" title="'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Download the current dataset in Excel format",{name:"t",hash:{},data:o,loc:{start:{line:4,column:41},end:{line:4,column:93}}}))+'">'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Excel",{name:"t",hash:{},data:o,loc:{start:{line:4,column:95},end:{line:4,column:108}}}))+'</a>\n        <a class="lnkCsvExport" title="'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Download the current dataset in CSV format",{name:"t",hash:{},data:o,loc:{start:{line:5,column:39},end:{line:5,column:89}}}))+'">'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"CSV",{name:"t",hash:{},data:o,loc:{start:{line:5,column:91},end:{line:5,column:102}}}))+'</a>\n         <a class="lnkPngExport" title="'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Download the current dataset in PNG format",{name:"t",hash:{},data:o,loc:{start:{line:6,column:40},end:{line:6,column:90}}}))+'">'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"PNG",{name:"t",hash:{},data:o,loc:{start:{line:6,column:92},end:{line:6,column:103}}}))+"</a>\n    </span> \n</div> \n"},useData:!0}),W.fragment=R.template({1:function(t,e,i,n,o){return"#version 300 es"},3:function(t,e,i,n,o){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(6,o,0),data:o,loc:{start:{line:9,column:0},end:{line:9,column:40}}}))?i:"")+" vec4 v_color;\n"},4:function(t,e,i,n,o){return"in"},6:function(t,e,i,n,o){return"varying"},8:function(t,e,i,n,o){return"uniform vec4 a_color; \n"},10:function(t,e,i,n,o){return"out vec4 outColor;\n"},12:function(t,e,i,n,o){return"uniform sampler2D spriteTexture;\n"},14:function(t,e,i,n,o){return"outColor"},16:function(t,e,i,n,o){return"gl_FragColor"},18:function(t,e,i,n,o){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"texture"+(null!=(i=a(i,"unless").call(null!=e?e:t.nullContext||{},null!=e?a(e,"isWebGL2"):e,{name:"unless",hash:{},fn:t.program(19,o,0),inverse:t.noop,data:o,loc:{start:{line:22,column:83},end:{line:22,column:116}}}))?i:"")+"(spriteTexture, gl_PointCoord) * "},19:function(t,e,i,n,o){return"2D"},21:function(t,e,i,n,o){return"v_color"},23:function(t,e,i,n,o){return"a_color"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var a,r=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(a=s(i,"if").call(r,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:1,column:38}}}))?a:"")+"\n\n// fragment shaders don't have a default precision so we need\n// to pick one. mediump is a good default\n\nprecision mediump float;\n\n"+(null!=(a=s(i,"if").call(r,null!=e?s(e,"isColored"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.program(8,o,0),data:o,loc:{start:{line:8,column:0},end:{line:12,column:7}}}))?a:"")+"\n"+(null!=(a=s(i,"if").call(r,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(10,o,0),inverse:t.noop,data:o,loc:{start:{line:14,column:0},end:{line:16,column:7}}}))?a:"")+"\n"+(null!=(a=s(i,"if").call(r,null!=e?s(e,"isTextured"):e,{name:"if",hash:{},fn:t.program(12,o,0),inverse:t.noop,data:o,loc:{start:{line:18,column:0},end:{line:19,column:7}}}))?a:"")+"\nvoid main() {\n    "+(null!=(a=s(i,"if").call(r,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(14,o,0),inverse:t.program(16,o,0),data:o,loc:{start:{line:22,column:4},end:{line:22,column:55}}}))?a:"")+" = "+(null!=(a=s(i,"if").call(r,null!=e?s(e,"isTextured"):e,{name:"if",hash:{},fn:t.program(18,o,0),inverse:t.noop,data:o,loc:{start:{line:22,column:58},end:{line:22,column:156}}}))?a:"")+(null!=(a=s(i,"if").call(r,null!=e?s(e,"isColored"):e,{name:"if",hash:{},fn:t.program(21,o,0),inverse:t.program(23,o,0),data:o,loc:{start:{line:22,column:156},end:{line:22,column:202}}}))?a:"")+";\n}\n"},useData:!0}),W.highlightRule=R.template({1:function(t,e,i,n,o){var a,r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li><svg style="background:'+h(typeof(a=null!=(a=t(i,"ruleColor")||(null!=e?t(e,"ruleColor"):e))?a:s)==l?a.call(r,{name:"ruleColor",hash:{},data:o,loc:{start:{line:3,column:31},end:{line:3,column:44}}}):a)+'; margin-right:4px;" width="15" height="16"></svg>\n    <span style="color:'+h(typeof(a=null!=(a=t(i,"color")||(null!=e?t(e,"color"):e))?a:s)==l?a.call(r,{name:"color",hash:{},data:o,loc:{start:{line:4,column:23},end:{line:4,column:32}}}):a)+'">'+h(typeof(a=null!=(a=t(i,"ruleName")||(null!=e?t(e,"ruleName"):e))?a:s)==l?a.call(r,{name:"ruleName",hash:{},data:o,loc:{start:{line:4,column:34},end:{line:4,column:46}}}):a)+"</span></li>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){return'<ul class="chartgl-highlight-rule">\n'+(null!=(i=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(i,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:0},end:{line:5,column:9}}}))?i:"")+"</ul>"},useData:!0}),W.legend=R.template({1:function(t,e,i,n,o){var a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,s="function",l=t.escapeExpression,h=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    <li>\n"+(null!=(t=h(i,"if").call(a,null!=e?h(e,"icon"):e,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.program(4,o,0),data:o,loc:{start:{line:4,column:6},end:{line:19,column:13}}}))?t:"")+'      <span style="color:'+l(typeof(t=null!=(t=h(i,"fontColor")||(null!=e?h(e,"fontColor"):e))?t:r)==s?t.call(a,{name:"fontColor",hash:{},data:o,loc:{start:{line:20,column:25},end:{line:20,column:38}}}):t)+"; text-decoration:"+l(typeof(t=null!=(t=h(i,"strike")||(null!=e?h(e,"strike"):e))?t:r)==s?t.call(a,{name:"strike",hash:{},data:o,loc:{start:{line:20,column:56},end:{line:20,column:66}}}):t)+'">'+l(typeof(t=null!=(t=h(i,"text")||(null!=e?h(e,"text"):e))?t:r)==s?t.call(a,{name:"text",hash:{},data:o,loc:{start:{line:20,column:68},end:{line:20,column:76}}}):t)+"</span>\n    </li>\n"},2:function(t,e,i,n,o){var a,r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <i style="height:'+h(typeof(a=null!=(a=t(i,"width")||(null!=e?t(e,"width"):e))?a:s)==l?a.call(r,{name:"width",hash:{},data:o,loc:{start:{line:5,column:25},end:{line:5,column:34}}}):a)+"px;color:"+h(typeof(a=null!=(a=t(i,"fillStyle")||(null!=e?t(e,"fillStyle"):e))?a:s)==l?a.call(r,{name:"fillStyle",hash:{},data:o,loc:{start:{line:5,column:43},end:{line:5,column:56}}}):a)+";margin-top:2.5px;margin-right:5px;"+h(typeof(a=null!=(a=t(i,"image")||(null!=e?t(e,"image"):e))?a:s)==l?a.call(r,{name:"image",hash:{},data:o,loc:{start:{line:5,column:91},end:{line:5,column:100}}}):a)+'"class="fa '+h(typeof(a=null!=(a=t(i,"icon")||(null!=e?t(e,"icon"):e))?a:s)==l?a.call(r,{name:"icon",hash:{},data:o,loc:{start:{line:5,column:111},end:{line:5,column:119}}}):a)+'"></i>\n'},4:function(t,e,i,n,o){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"bullColor"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.program(7,o,0),data:o,loc:{start:{line:7,column:8},end:{line:18,column:15}}}))?i:""},5:function(t,e,i,n,o){var a,r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'          <span style="margin-right:5px;">\n            <i style="font-size: 16px;color:'+h(typeof(a=null!=(a=t(i,"fillStyle")||(null!=e?t(e,"fillStyle"):e))?a:s)==l?a.call(r,{name:"fillStyle",hash:{},data:o,loc:{start:{line:9,column:44},end:{line:9,column:57}}}):a)+';margin-top:0;" class="fa fa-ellipsis-v"></i>\n            <i style="font-size: 8px;margin-left:-5px;color:'+h(typeof(a=null!=(a=t(i,"bullColor")||(null!=e?t(e,"bullColor"):e))?a:s)==l?a.call(r,{name:"bullColor",hash:{},data:o,loc:{start:{line:10,column:60},end:{line:10,column:73}}}):a)+';margin-top:3px;position: absolute;"class="fa fa-square"></i>\n          </span>\n'},7:function(t,e,i,n,o){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"isHeatmap"):e,{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(10,o,0),data:o,loc:{start:{line:13,column:10},end:{line:17,column:19}}}))?i:""},8:function(t,e,i,n,o){var a,r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <svg style="background:'+h(typeof(a=null!=(a=t(i,"fillStyle")||(null!=e?t(e,"fillStyle"):e))?a:s)==l?a.call(r,{name:"fillStyle",hash:{},data:o,loc:{start:{line:14,column:35},end:{line:14,column:48}}}):a)+"; border-radius:2px;width:"+h(typeof(a=null!=(a=t(i,"width")||(null!=e?t(e,"width"):e))?a:s)==l?a.call(r,{name:"width",hash:{},data:o,loc:{start:{line:14,column:74},end:{line:14,column:83}}}):a)+"px; height:"+h(typeof(a=null!=(a=t(i,"width")||(null!=e?t(e,"width"):e))?a:s)==l?a.call(r,{name:"width",hash:{},data:o,loc:{start:{line:14,column:94},end:{line:14,column:103}}}):a)+"px;margin-top:2px;margin-right:5px;"+h(typeof(a=null!=(a=t(i,"image")||(null!=e?t(e,"image"):e))?a:s)==l?a.call(r,{name:"image",hash:{},data:o,loc:{start:{line:14,column:138},end:{line:14,column:147}}}):a)+'"class="fa fa-square"></svg>\n'},10:function(t,e,i,n,o){var a,r=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <i style="height:'+h(typeof(a=null!=(a=t(i,"width")||(null!=e?t(e,"width"):e))?a:s)==l?a.call(r,{name:"width",hash:{},data:o,loc:{start:{line:16,column:29},end:{line:16,column:38}}}):a)+"px;color:"+h(typeof(a=null!=(a=t(i,"fillStyle")||(null!=e?t(e,"fillStyle"):e))?a:s)==l?a.call(r,{name:"fillStyle",hash:{},data:o,loc:{start:{line:16,column:47},end:{line:16,column:60}}}):a)+";margin-top:2.5px;margin-right:5px;"+h(typeof(a=null!=(a=t(i,"image")||(null!=e?t(e,"image"):e))?a:s)==l?a.call(r,{name:"image",hash:{},data:o,loc:{start:{line:16,column:95},end:{line:16,column:104}}}):a)+'"class="fa fa-square"></i>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){return'<ul class="chartgl-legend">\n'+(null!=(i=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(i,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:2},end:{line:22,column:11}}}))?i:"")+"</ul>"},useData:!0}),W.textNoteDialog=R.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,s=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="edit-text-annotation">\n    <div class="edit-prop prop-text">\n        <label for="note-text">'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Text",{name:"t",hash:{},data:o,loc:{start:{line:3,column:31},end:{line:3,column:43}}}))+'</label>\n        <textarea id="note-text" class="annotate-text ui-widget ui-state-default ui-corner-all" rows="4" cols="25" data-property-name="text"></textarea>\n    </div>\n    <div class="edit-prop prop-text-color">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Text color",{name:"t",hash:{},data:o,loc:{start:{line:7,column:15},end:{line:7,column:33}}}))+'</label>\n        <span class="fa fa-fw watermark fa-tint annotate-color-icon text-color-icon"></span>\n        <button class="annotate-color-btn text-color-btn ui-widget ui-state-default ui-corner-all" data-property-name="aColor">\n        </button>\n    </div>\n    <div class="edit-prop prop-text-size">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Font size",{name:"t",hash:{},data:o,loc:{start:{line:13,column:15},end:{line:13,column:32}}}))+'</label>\n        <input class="text-size ui-widget ui-state-default ui-corner-all" type="number" min="1" data-property-name="fontSize">\n    </div>\n    <div class="edit-prop-chkbox prop-text-bold">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Bold",{name:"t",hash:{},data:o,loc:{start:{line:17,column:15},end:{line:17,column:27}}}))+'</label>\n        <input class="text-bold ui-widget ui-state-default ui-corner-all" type="checkbox" data-property-name="fontBold">\n    </div>\n    <div class="edit-prop prop-text-margin">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Text margin",{name:"t",hash:{},data:o,loc:{start:{line:21,column:15},end:{line:21,column:34}}}))+'</label>\n        <input class="text-margin ui-widget ui-state-default ui-corner-all" type="number" min="0" max="50" data-property-name="textMargin">\n    </div>\n    <div class="edit-prop prop-fill-color">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Fill color",{name:"t",hash:{},data:o,loc:{start:{line:25,column:15},end:{line:25,column:33}}}))+'</label>\n        <span class="fa fa-fw watermark fa-tint annotate-color-icon fill-color-icon"></span>\n        <button class="annotate-color-btn fill-color-btn ui-widget ui-state-default ui-corner-all" data-property-name="fillColor">\n        </button>\n    </div>\n    <div class="edit-prop prop-fill-opacity">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Fill opacity",{name:"t",hash:{},data:o,loc:{start:{line:31,column:15},end:{line:31,column:35}}}))+'</label>\n        <input class="fill-opacity ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" type="range" min="0" max="100" data-property-name="fillOpacity"> \n    </div>\n    <div class="edit-prop prop-border-thickness">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Border thickness",{name:"t",hash:{},data:o,loc:{start:{line:35,column:15},end:{line:35,column:39}}}))+'</label>\n        <input class="border-thickness ui-widget ui-state-default ui-corner-all" type="number" min="1" max="5" data-property-name="borderThickness">\n    </div>\n    <div class="edit-prop prop-border-color">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Border color",{name:"t",hash:{},data:o,loc:{start:{line:39,column:15},end:{line:39,column:35}}}))+'</label>\n        <span class="fa fa-fw watermark fa-tint annotate-color-icon border-color-icon"></span>\n        <button class="annotate-color-btn border-color-btn ui-widget ui-state-default ui-corner-all" data-property-name="borderColor">\n        </button>\n    </div>\n    <div class="edit-prop prop-border-opacity">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Border opacity",{name:"t",hash:{},data:o,loc:{start:{line:45,column:15},end:{line:45,column:37}}}))+'</label>\n           <input class="border-opacity ui-widget ui-state-default ui-corner-all" type="range" min="0" max="100" data-property-name="borderOpacity"> \n    </div>\n    <div class="edit-prop prop-anchor-position">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Anchor position",{name:"t",hash:{},data:o,loc:{start:{line:49,column:15},end:{line:49,column:38}}}))+'</label>\n        <select class="anchor-position select2-container--dashboards select2-selection--single" data-property-name="anchorPosition">\n                <option value="topLeft">'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Top left",{name:"t",hash:{},data:o,loc:{start:{line:51,column:40},end:{line:51,column:56}}}))+'</option>\n                <option  value="bottomLeft">'+s((t(i,"t")||e&&t(e,"t")||r).call(a,"Bottom left",{name:"t",hash:{},data:o,loc:{start:{line:52,column:44},end:{line:52,column:63}}}))+"</option>\n            </select>\n    </div>\n</div>"},useData:!0});var N=W;function W(){}J.prototype.getBarWidth=function(){return this.barWidth},J.drawXBounds=function(t,a,r,s){var l=[],h=[],p=[];return t.forEach(function(t,e){for(var i=a[e],t=(l.push(t,t,i,t,i,i),h.push(t,i),r[e%r.length]),n=Object.values(Mt.hexColorToVec4(t,s)),o=0;o<6;o++)p.push(n)}),[l,h,p]},J.drawYBounds=function(t,e){for(var i=[],n=0;n<e;n++)i.push(t.x,t.y,t.x,t.y,t.x,t.y);return i},J.prototype.getStackedYVals=function(){return this.stackedYVals},J.prototype.getXBarPoints=function(i,r,t,s,l,h,e,p){var n,o,u=this,c=r.barGrouping,a=r.barWidth,d=null==c?void 0:c.barIndices,y=r.barType,g=Y.getMidrange(new F(t.x,t.z),h),f=r.size,g=(g&&(t=new M(Number(Y.toBigInt(t.x)-g),t.y,Number(Y.toBigInt(t.z)-g),t.w)),r.orientation===z.BAR_HORIZONTAL?Math.abs(Number(t.w)-Number(t.y)):Math.abs(Number(t.z)-Number(t.x))),m=(g||(n=.1*Number(t.x),o=Number(t.x)-n,g=Number(t.z)+n-o),(null==d?void 0:d.length)||0),t=a/(r.orientation===z.BAR_VERTICAL||"y"===l?f.x:f.y),P=[],x=0,v=0,O=0,O=c&&d?(v=d.indexOf(c.index)+(e||0),x=g/c.dataLength/(s?1:m),"Percentage"===y?x*a/2:g*t):(o=(n=i.slice(1).map(function(t,e){return t-i[e]})).length?0:.01*g,f=n.length?Y.getDistance(n,i):o,g=g?Math.abs(g+o+o):10,"Percentage"===y?f/2*a:g*t);return _.each(i,function(t,e){var i,n,o=t-O,a=t+O;c?(n=.85*("Percentage"===y?x:2*O),i=0,o=(t=s||"x"!==l?t:t-(i=m*n/2)+n*(v+.5))-.85*O,a=t+.85*O,0===Number(e)&&(u.barWidth=n,u.maxXDist=i)):0===Number(e)&&(n=Y.convertJSToNumber(Y.convertToJsScalar(h,o)),i=Y.convertJSToNumber(Y.convertToJsScalar(h,a)),u.barWidth=Math.abs(n-i)),"y"===l&&r.orientation===z.BAR_HORIZONTAL&&(o=0,a=t,null!=p&&p.prevLayerData&&null!=p&&p.xData&&(o=(n=u.getStackedBars(p.prevLayerData,p.xData,e,a))[0],a=n[1]),u.stackedYVals[e]=a),"x"===l&&r.orientation===z.BAR_HORIZONTAL?P.push(o,a,o,a,o,a):P.push(o,o,a,o,a,a)}),P},J.prototype.getWaterfallPoints=function(o,a,r){var s=[],l=[],h=a.colorArray;return o.forEach(function(t,e){var i=o[e-1],n=0<e&&e<o.length-1&&i!==t?i:0,n=(s.push(n,t,n,t,n,t),0===e||e===o.length-1||t===i);e=h&&h.length&&n&&void 0!==h[r][e]?h[r][e]:(e=Array.isArray(a.defaultColor)?a.defaultColor[r]:a.defaultColor,n=n?e:i<t?a.increaseColor:a.decreaseColor,Mt.hexColorToVec4(n,a.opacity)),l.push(Object.values(e))}),[s,l]},J.prototype.getYBarPoints=function(t,o){var a=this,r=[];return t.forEach(function(t,e){var i,n=0;null!=o&&o.prevLayerData&&null!=o&&o.xData&&(n=(i=a.getStackedBars(o.prevLayerData,o.xData,e,t))[0],a.stackedYVals[e]=t=i[1]),r.push(n,t,n,t,n,t)}),r},J.prototype.getCandlesticks=function(o,a,r){var s=[],l=[];return o[0].forEach(function(t,e){var i,e=o[1][e],n=t===e&&r;n&&(t+=.002*a,e-=.002*a),s.push(t,e,t,e,t,e),r&&(i=Number(r.opa),n=n?r.neutralColor:t<e?r.bullColor:r.bearColor,t=Mt.hexColorToVec4(n,i),l.push(Object.values(t)))}),[s,l]},J.prototype.getMaxDist=function(){return this.maxXDist},J.prototype.getStackedBars=function(t,e,i,n){var o=0,e=e[i]+"";return void 0!==t[e]&&(i=t[e][0],t=t[e][1],n+=o=n<0?i:t),[o,n]};var Z=J;function J(){this.barWidth=0,this.maxXDist=0,this.stackedYVals=[]}q.calcColors=function(t,e,i){for(var n=Math.min.apply(Math,t),o=Math.max.apply(Math,t),a=[],r=0;r<t.length;r++){var s=Yt.interpolateColor(e,n,o,t[r]),s=Mt.hexColorToVec4(s,i);a.push(Object.values(s))}return a},q.calcVals=function(t,i,n){var o=[];return t.forEach(function(t,e){e=i[e];"x"===n?o.push(t,t,e,t,e,e):o.push(t,e,t,e,t,e)}),o};var j=q;function q(){}Q.getSpanGaps=function(r,s){var l,t,h,p=[],u=[],c=[],d=r.nullVal,y=s.nullVal;return r.col.getRange&&r.col.qtype&&(r.col=r.col,t=Y.getRange(r.col),l=Y.getMidrange(new F(t[0],t[1]),r.col.qtype)),s.col.getRange&&s.col.qtype&&(s.col=s.col,t=Y.getRange(s.col),h=Y.getMidrange(new F(t[0],t[1]),s.col.qtype)),_.each(s.col,function(t,e){var i=s.scalar,n=r.scalar,i=i(s.col,e),n=n(r.col,e),o=Number(h?i-h:i),a=Number(l?n-l:n);p.push(o),u.push(a),(Y.isNull(i,y)||Y.isNull(n,d))&&c.push(Number(e))}),{x:u,y:p,indices:c}},Q.spanGaps=function(t,e,i,n){t=t.filter(function(t,e){return-1===i.indexOf(e)}),e=e.filter(function(t,e){return-1===i.indexOf(e)});for(var o=t[t.length-1],a=e[e.length-1],r=t.length;r<n.col.length;r++)t.push(o),e.push(a);return{x:t,y:e}},Q.drawLine=function(t,i,e,n){function o(t,e,i){return(t-e.x)/(e.y-e.x)*i}function s(t,e,i){return t/i*(e.y-e.x)+e.x}var l=[],h=[],a=new F(e.bounds.x,e.bounds.z).applyFn(function(t){return Y.convertJSToScalar(e.xType,t)}),r=new F(e.bounds.y,e.bounds.w).applyFn(function(t){return Y.convertJSToScalar(e.yType,t)}),p=new F(Number(a.x),Number(a.y)),u=new F(Number(r.x),Number(r.y)),c=e.size,d=[],y=t.length,g=B([],i,!0),f=B([],t,!0),r=null==(a=n.triggerData.x)?void 0:a.data,a=null==(a=n.triggerData.y)?void 0:a.data,m=(null!=r&&r.length&&(r=n.triggerData.x.bounds,p=n.zoom?Y.calculateCroppedBounds2(new F(n.zoom.x,n.zoom.z),r,n.xType):r),null!=a&&a.length&&(r=n.triggerData.y.bounds,u=n.zoom?Y.calculateCroppedBounds2(new F(n.zoom.y,n.zoom.w),r,n.yType):r),[]);if(_.isEqual(i,t)){for(var m=new Array(i.length),P=0;P<i.length;P++)m[P]=P;m.sort(function(t,e){return Number(i[t]-i[e])})}for(var x=[],v=0;v<y;v++){var O,b=m.length?m[v]:v,T=m.length?m[v-1]:v-1,A=m.length?m[v+1]:v+1,b=new F(g[b],f[b]),T=0===v?b:new F(g[T],f[T]),A=v===y-1?b:new F(g[A],f[A]),T=(b.x===T.x&&b.y===T.y&&(O=F.normalize(F.subtract(b,A)),T=F.add(T,O)),b.x===A.x&&b.y===A.y&&(O=F.normalize(F.subtract(b,T)),A=F.add(A,O)),T=new F(o(T.x,p,c.x),o(T.y,u,c.y)),A=new F(o(A.x,p,c.x),o(A.y,u,c.y)),b=new F(o(b.x,p,c.x),o(b.y,u,c.y)),F.normalize(F.subtract(b,T))),A=F.normalize(F.subtract(A,b)),L=F.normalize(F.add(T,A)),L=new F(-L.y,L.x),C=new F(-T.y,T.x),E=1/F.dot(L,C),E=Math.abs(E)===1/0?1:E,S=(e.lineThickness+.5)/2,R=new F(-1,-1),D=new F(1,1),w=new F(b.x+R.x*L.x*S*E,b.y+R.x*L.y*S*E),D=new F(b.x+D.x*L.x*S*E,b.y+D.x*L.y*S*E);10<E?(E=F.normalize(F.subtract(T,A)),T=F.dot(L,E),E=(A=0<Math.sign(R.x*T))?D:w,R=new F(L.y,-L.x),L=(T=new F(0<R.y?1:-1,0<R.x?1:-1)).x*T.y,R=new F(b.x-L*S*C.x,b.y-L*S*C.y),T=new F(b.x+L*S*C.x,b.y+L*S*C.y),d.push(A?[L<0?T:R,E,L<0?R:T,2]:[E,0<L?T:R,0<L?R:T,1]),x.push(v)):d.push([w,D])}return d.forEach(function(t,e){var i,n,o,a,r;d[e+1]&&(i=t[0],n=t[1],o=d[e+1][0],e=d[e+1][1],i=new F(s(i.x,p,c.x),s(i.y,u,c.y)),n=new F(s(n.x,p,c.x),s(n.y,u,c.y)),o=new F(s(o.x,p,c.x),s(o.y,u,c.y)),e=new F(s(e.x,p,c.x),s(e.y,u,c.y)),4===t.length?(a=new F(s(t[2].x,p,c.x),s(t[2].y,u,c.y)),r=2===t[3]?n:i,t=2===t[3]?e:o,l.push(i.x,n.x,a.x),h.push(i.y,n.y,a.y),l.push(a.x,r.x,t.x),h.push(a.y,r.y,t.y),l.push(o.x,a.x,e.x),h.push(o.y,a.y,e.y)):(l.push(i.x,n.x,o.x,o.x,n.x,e.x),h.push(i.y,n.y,o.y,o.y,n.y,e.y)))}),[l,h,x]},Q.drawSteppedXLine=function(t){for(var e=[],i=0;i<t.length;i+=2){var n=t[i],o=t[i+1],a=void 0!==t[i+2]?t[i+2]:o;e.push(n,o,o,a)}return e},Q.drawSteppedYLine=function(t){for(var e=[],i=0;i<t.length;i+=2){var n=t[i],o=void 0!==t[i+1]?t[i+1]:n;e.push(n,n,o,o)}return e},Q.getXLineFill=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i],o=t[i+1];e.push(n,n,o,n,o,o)}return e},Q.getYLineFill=function(t,e,i,n){var o=[],a=e.fromBounds?Number(e.fromBounds.y):0,r=e.fromBounds?Number(e.fromBounds.w):0,s=e.toBounds?Number(e.toBounds.y):0,l=e.toBounds?Number(e.toBounds.w):0,h=_.min(t)||0,p=_.max(t)||0,u=a,c=(h<0&&0<p||h<0&&p<0&&0<r?u=0:h<0&&p<0&&(u=r),e.cols?e.cols[0]:null);c&&"Origin"!==e.fill&&i&&"Stepped"!==e.interpolation&&(c="Before"===n?Q.drawSteppedXLine(c):Q.drawSteppedYLine(c));for(var d=0;d<t.length;d++){var y=u,g=u,f=("Origin"!==e.fill&&(y=c[d],g=c[d+1],m=new F(s,l),f=new F(a,r),_.isEqual(m,f)||(y=(r-a)*((y-s)/(m=l-s))+a,g=(r-a)*((g-s)/m)+a)),t[d]),m=t[d+1];o.push(f,y,g,f,g,m)}return o};var K=Q;function Q(){}et.applyRangeToBreakIntervals=function(t){var n,o,e,a,r;return null!=(e=null==t?void 0:t.breakIntervals)&&e.length?(n=t.breakIntervals,o=_.cloneDeep(n),e=Y.calculateCroppedJs2(t.crop,new F(t.min,t.max)),a=e.x,r=e.y-a,n.forEach(function(t,e){var i=t[0],t=t[1];t<a?(o[e]=null,n[e+1]&&(a+=n[e+1][0]-t)):((i<a||0===e&&a<i)&&(i=a,o[e][0]=a),o[e][2]=(t-i)/r)}),o.filter(function(t){return t})):[]},et.applyTriggerBreak=function(s,l,t,h){for(var p=new Array(s.length),e=0;e<s.length;e++)p[e]=e;p.sort(function(t,e){return Number(s[t]-s[e])});for(var u=new Array(s.length),c=0,d=[[s[p[0]]]],i=function(e,t,i,n){var o,a,r=!0;h&&(a=d[d.length-1],o=a?a[0]:null,h.filter(function(t){return _.isEqual(t,[o,e])}).length<1)&&(n&&(u[p[i+n]]=s[p[i+n]]-c),r=!1),r&&(u[p[i+n]]=(a=e+l)-c,c+=t-a,d[d.length-1].push(e),d.push([t-l]))},e=0;e<s.length;e+=2){var n=s[p[e-1]],o=s[p[e]],a=s[p[e+1]],r=o-n,y=a-o;u[p[e]]=o-c,void 0!==n&&t<=r&&i(n,o,e,0),void 0!==a&&(t<=y?i(o,a,e,1):u[p[e+1]]=s[p[e+1]]-c),e>=s.length-2&&1===d[d.length-1].length&&d[d.length-1].push(void 0!==a?a:o)}return[u,d]},et.getTriggerBreakVals=function(t,e,i){function n(t){return a?A.duration(t):A(t)}var i=Math.max.apply(Math,i),o=Y.convertToJsScalar(e,i),a=A.isDuration(o),o=Y.convertJSToNumber(o),r=o-(null==t?void 0:t.triggerBreak),o=o-(null==t?void 0:t.breakVal),t=Y.convertJSToScalar(e,n(r)),r=Y.convertJSToScalar(e,n(o));return[Number(i)-Number(t),Number(i)-Number(r)]};var tt=et;function et(){}function it(t,e,i){if(!(t=t.getUniformLocation(e,i)))throw new Error(i+" failed getUniformLocation");this.location=t}x(at,nt=it),at.prototype.set=function(t,e){t.uniform1f(this.location,e)};var nt,ot=at;function at(){return null!==nt&&nt.apply(this,arguments)||this}x(lt,rt=it),lt.prototype.set=function(t,e){t.uniform4f(this.location,e.x,e.y,e.z,e.w)};var rt,st=lt;function lt(){return null!==rt&&rt.apply(this,arguments)||this}ht.MIN_KEY="_u_min",ht.MAX_KEY="_u_max";e=ht;function ht(t,e,i){var n=t.getUniformLocation(e,i+ht.MIN_KEY),t=t.getUniformLocation(e,i+ht.MAX_KEY);if(!n||!t)throw new Error(i+" axis failed getUniformLocation");this.min=n,this.max=t}x(ct,pt=e),ct.prototype.set=function(t,e){t.uniform1i(this.min,e.x),t.uniform1i(this.max,e.y)};var pt,ut=ct;function ct(){return null!==pt&&pt.apply(this,arguments)||this}x(gt,dt=e),gt.prototype.set=function(t,e){t.uniform1f(this.min,e.x),t.uniform1f(this.max,e.y)};var dt,yt=gt;function gt(){return null!==dt&&dt.apply(this,arguments)||this}x(Pt,ft=e),Pt.prototype.set=function(t,e){t.uniform2f(this.min,e.x,e.x-Math.fround(e.x)),t.uniform2f(this.max,e.y,e.y-Math.fround(e.y))};var ft,mt=Pt;function Pt(){return null!==ft&&ft.apply(this,arguments)||this}vt.prototype.apply=function(t,e){t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(this.location),this.glType===WebGLRenderingContext.FLOAT?t.vertexAttribPointer(this.location,this.size,this.glType,!1,this.stride||0,this.offset||0):t.vertexAttribIPointer(this.location,this.size,this.glType,this.stride||0,this.offset||0)};var xt=vt;function vt(t,e,i,n,o){this.location=t,this.glType=e,this.size=i,this.stride=n,this.offset=o}Object.defineProperty(h.prototype,"Program",{get:function(){return this.program},enumerable:!1,configurable:!0}),h.createBuffer=function(t,e){var i=t.createBuffer();if(i)return t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),i;throw new Error("gl error creating buffer")},h.createTexture=function(t,e,i){var n=t.createTexture();if(n)return t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.generateMipmap(t.TEXTURE_2D),n;throw new Error("gl error creating texture")},h.getShader=function(t,e,i,n,o,a,r){var s=[i,n,o,a,r,t.canvas.id].join(":");return h.shaders[s]||(h.shaders[s]=new h(t,i,n,e,o,a,r)),this.shaders[s]},h.composeFragment=function(t,e,i,n){return N.fragment({isWebGL2:t,isTextured:e,isColored:i,isSize:n})},h.composeVertex=function(t,e,i,n,o){t={x:t,y:e};return N.dualVertex({isWebGL2:i,isColored:n,isSize:o,math:_.some(_.values(t),function(t){return Y.isLong(t)||Y.isDouble(t)}),axis:_.map(t,function(t,e){return _.extend(h.getShaderConfig(t),{name:e})})})},h.createProgram=function(t,e,i){var n=t.createProgram();if(!n)throw new Error("gl error creating program");if(t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS))return n;throw e=t.getProgramInfoLog(n),t.deleteProgram(n),new Error("gl error linking program: "+e)},h.createShader=function(t,e,i){e=t.createShader(e);if(!e)throw new Error("gl error creating shader");if(t.shaderSource(e,i),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))return e;throw i=t.getShaderInfoLog(e),t.deleteShader(e),new Error("gl error compiling shader: "+i)},h.getShaderConfig=function(t){switch(t){case E.Byte:case E.Char:return{vt:"uint",ut:"int"};case E.Short:case E.Int:case E.Month:case E.Date:case E.Minute:case E.Second:case E.Time:return{vt:"int",ut:"int"};case E.List:case E.Symbol:case E.Float:return{vt:"float",ut:"float"};case E.Long:case E.Double:case E.Timestamp:case E.DateTime:case E.Timespan:return{vt:"vec2",ut:"vec2"};default:throw"Not implemented"}},h.prototype.remove=function(t){t.deleteProgram(this.program),t.deleteShader(this.vertexShader),t.deleteShader(this.fragmentShader)},h.prototype.setTexture=function(t,e){t.uniform1i(this.textureLocation,e)},h.prototype.createRange=function(t,e,i){return new(Y.isDouble(t)||Y.isLong(t)?mt:Y.isFloat(t)?yt:ut)(e,this.program,i)},h.prototype.getVertexBinding=function(t,e,i){var n=t.getAttribLocation(this.Program,i+"_position");switch(e){case E.Byte:case E.Char:return new xt(n,t.UNSIGNED_BYTE,1);case E.Short:return new xt(n,t.SHORT,1);case E.Int:case E.Month:case E.Date:case E.Minute:case E.Second:case E.Time:return new xt(n,t.INT,1);case E.List:case E.Symbol:case E.Float:return new xt(n,t.FLOAT,1);case E.Long:case E.Double:case E.Timestamp:case E.DateTime:case E.Timespan:return new xt(n,t.FLOAT,2);default:throw"Not implemented"}},h.shaders={};var Ot,C=h;function h(t,e,i,n,o,a,r){this.textureLocation=null;var s,l=h.composeVertex(e,i,n,a,r),n=h.composeFragment(n,o,a,r);this.vertexShader=h.createShader(t,t.VERTEX_SHADER,l),this.fragmentShader=h.createShader(t,t.FRAGMENT_SHADER,n),this.program=h.createProgram(t,this.vertexShader,this.fragmentShader),this.xRange=this.createRange(e,t,"x"),this.yRange=this.createRange(i,t,"y"),this.xBinding=this.getVertexBinding(t,e,"x"),this.yBinding=this.getVertexBinding(t,i,"y"),o&&(this.textureLocation=t.getUniformLocation(this.Program,"spriteTexture")),a?(s=t.getAttribLocation(this.Program,"h_color"),this.colorLocation=new xt(s,t.FLOAT,4)):this.color=new st(t,this.Program,"a_color"),r?(s=t.getAttribLocation(this.Program,"pointSize"),this.sizeLocation=new xt(s,t.FLOAT,1)):this.pointSize=new ot(t,this.Program,"u_point_size")}Math.fround=Math.fround||(Ot=new Float32Array(1),function(t){return Ot[0]=t,Ot[0]});bt.prototype.applyFn=function(t){return new bt(t(this.x),t(this.y))},bt.add=function(t,e){return new bt(t.x+e.x,t.y+e.y)},bt.dot=function(t,e){return t.x*e.x+t.y*e.y},bt.multiply=function(t,e){return new bt(t.x*e.x,t.y*e.y)},bt.normalize=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return new bt(e?t.x/e:0,e?t.y/e:0)},bt.subtract=function(t,e){return new bt(t.x-e.x,t.y-e.y)};var F=bt;function bt(t,e){this.x=t,this.y=e}Tt.fromVec2=function(t,e){return new Tt(t.x,e.x,t.y,e.y)},Tt.prototype.toString=function(){return _.map([this.x,this.y,this.z,this.w],function(t){return""+t}).join(",")},Tt.prototype.applyFn=function(t){return new Tt(t(this.x),t(this.y),t(this.z),t(this.w))};var M=Tt;function Tt(t,e,i,n){this.x=t,this.y=e,this.z=i,this.w=n}var T,E=k.ipc.TypeNum,Y=(u.calculateCroppedBounds=function(t,e,i,n){i=u.calculateCroppedBounds2(new F(t.x,t.z),new F(e.x,e.z),i),t=u.calculateCroppedBounds2(new F(t.y,t.w),new F(e.y,e.w),n);return new M(i.x,t.x,i.y,t.y)},u.calculateCroppedBounds2=function(t,e,i){function n(t,e,i){return e+(i-e)*t}t=new F(n(t.x,e.x,e.y),n(t.y,e.x,e.y));return i&&(u.isInt(i)||u.isLong(i))&&(e=t,t=new F(Math.floor(e.x),Math.ceil(e.y))),t},u.calculateCroppedJsBounds=function(t,e,i,n){var o=u.scaleJs(t.x,e.x,e.z,i),a=u.scaleJs(t.z,e.x,e.z,i),r=u.scaleJs(t.y,e.y,e.w,n),t=u.scaleJs(t.w,e.y,e.w,n),e=u.calculatePrecision(i,new F(o,a)),i=u.calculatePrecision(n,new F(r,t));return new M(e.x,i.x,e.y,i.y)},u.calculatePrecision=function(e,t){var i;return e&&(u.isInt(e)||e===E.Long||e===E.Timespan)&&(i=t.applyFn(function(t){return u.convertJSToScalar(e,t)}),i=i,i=new F(Math.floor(Number(i.x)),Math.ceil(Number(i.y))),t=new F(u.convertToJsScalar(e,i.x),u.convertToJsScalar(e,i.y))),t},u.calculateCroppedJs2=function(t,e,i){var n=u.scaleJs(t.x,e.x,e.y,i),t=u.scaleJs(t.y,e.x,e.y,i),e=new F(n,t);return i?u.calculatePrecision(i,e):e},u.calculateCrop=function(t,e,i){i===E.Timestamp&&(o=u.convertJSToScalar(i,e.x),a=u.convertJSToScalar(i,e.y),n=u.getMidrange(new F(o,a),i,!0,e))&&(e=new F(Number(u.toBigInt(o)-n),Number(u.toBigInt(a)-n)),o=u.convertJSToScalar(i,t.x),a=u.convertJSToScalar(i,t.y),t=new F(Number(u.toBigInt(o)-n),Number(u.toBigInt(a)-n)));var n,o,a,i=new F(u.calcCrop(t.x,e.x,e.y),u.calcCrop(t.y,e.x,e.y));return new F(isNaN(i.x)?0:i.x,isNaN(i.y)?1:i.y)},u.calcCrop=function(t,e,i){return t=u.convertJSToNumber(t),e=u.convertJSToNumber(e),1-(t-(i=u.convertJSToNumber(i)))/(e-i)},u.calculateBoundsDiagonal=function(t){var e=t.z-t.x,t=t.w-t.y;return Math.sqrt(e*e+t*t)},u.calculateInset=function(t,e){var i=t.z-t.x,n=t.w-t.y,o=2*e;return new M(o<=n?t.x+e:t.x,o<=i?t.y+e:t.y,o<=n?t.z-e:t.z,o<=i?t.w-e:t.w)},u.calculateMergedRange=function(t){if(0===t.length)return null;if(1===t.length)return t[0];for(var e=t[0].x,i=t[0].y,n=1;n<t.length;n++)var o=t[n],e=u.min(e,o.x),i=u.max(i,o.y);return new F(e,i)},u.getCategoryData=function(t){for(var e=t.length,i=new Float32Array(e),n=[],o=[],a=0;a<e;a++){var r=this.getColValue(t,a);o[a]=r}var s={},l=_.uniq(o);l.forEach(function(t,e){s[t]=1<l.length?e/(l.length-1):.5});for(a=0;a<e;a++){r=this.getColValue(t,a);i[a]=s[r],n[a]=u.isString(t.qtype)||t.qtype===E.Char?r:u.convertToJsScalar(t.qtype,r)}return[n,i]},u.getColValue=function(t,e){var i;return void 0!==e||t.qtype!==E.List&&t.qtype!==E.Symbol?t.qtype===E.List?(i=t.getValue(e),u.getValueFromObject(i)):t.qtype===E.Symbol||t.qtype===E.Char?t.getValue(e):t.getScalar(e):null},u.getRange=function(t){return t&&t.getRange&&t.calcRange?t.getRange():[0,1]},u.getStackedData=function(n,t,o){return t.forEach(function(t,e){var e=n[e]+"",i=(o[e]||(o[e]=[0,0]),o[e]);t<0?o[e][0]=Math.min(i[0],t):o[e][1]=Math.max(i[1],t)}),o},u.convertStringToScalar=function(t,e){var i;return isNaN(Number(t))?e?(i=e.fromString(t),e.toScalar(i)):t:Number(t)},u.convertJSToNumber=function(t){return A.isMoment(t)||A.isDuration(t)?t.valueOfNano()/1e6:t},u.convertJSToScalar=function(t,e){var i,n=k.ipc;(i={})[E.Date]=n.QDate,i[E.DateTime]=n.DateTime,i[E.Minute]=n.Minute,i[E.Month]=n.Month,i[E.Second]=n.Second,i[E.Time]=n.Time,i[E.Timespan]=n.Timespan,i[E.Timestamp]=n.Timestamp;n=i[t];if(n&&(A.isMoment(e)||A.isDuration(e)))return n.toScalar(n.fromMoment(e));if(A.isMoment(e)||A.isDuration(e))throw"Invalid Type Conversion";return e},u.convertStringToJsScalar=function(t,e){t=u.convertStringToScalar(t,u.ipcTemp(e));return u.convertToJsScalar(e,t)},u.convertToJsScalar=function(t,e,i){var n=k.ipc;(o={})[E.Date]=n.QDate,o[E.DateTime]=n.DateTime,o[E.Minute]=n.Minute,o[E.Month]=n.Month,o[E.Second]=n.Second,o[E.Time]=n.Time,o[E.Timespan]=n.Timespan,o[E.Timestamp]=n.Timestamp;var o,n=o[t];return n?(t===E.Timespan&&(e=Number(e)),o=u.isLong(t)&&k.Long.isLong(e)?k.Long.fromString(e.toString()):e,i?n.fromScalar(o):k.Tools.convertKDBTemporalToMoment(n.fromScalar(o))):Number(e)},u.convertVec2ToJsScalar=function(t,e,i){return new F(u.convertToJsScalar(e,t.x),u.convertToJsScalar(i,t.y))},u.convertVec4ToJsScalar=function(t,e,i){return new M(u.convertToJsScalar(e,t.x),u.convertToJsScalar(i,t.y),u.convertToJsScalar(e,t.z),u.convertToJsScalar(i,t.w))},u.convertVec4ToScalar=function(t,e,i){return new M(u.convertJSToScalar(e,t.x),u.convertJSToScalar(i,t.y),u.convertJSToScalar(e,t.z),u.convertJSToScalar(i,t.w))},u.dist=function(t,e){var i=t.x-e.x,t=t.y-e.y;return Math.sqrt(i*i+t*t)},u.expandNestedViewStates=function(t,e){var i,n=/([a-zA-Z]+)\.[0-9]+\./,o=Object.keys(t),a=[];return(a=_.every(function(t){t=e.getPropertyMeta(t[0]);return t&&"viewstate"===t.type})?_.uniq(_.filter(_.map(o,function(t){t=n.exec(t);return t?t[1]:null}))):a).length?(i={},_.each(a,function(t){return i[t]=e.getProperty(t)}),i):t},u.floatToEmulateDoubleArray=function(t,e){for(var i=2*t.length,n=new Float32Array(i),o=0,a=0;a<i;a+=2){var r=void 0,r=null!=e&&e.length&&e[a]?e[a]:t.getScalar(o);n[a]=r,n[a+1]=r-Math.fround(r),o++}return n},u.getDistance=function(t,e){for(var i=e[e.length-1]-e[0],n=t.length,o=1/0,a=1/0;n--;)o=t[n]<o&&0<t[n]?t[n]:o,a=Math.abs(t[n]<a&&t[n]<0?t[n]:a);var r=o<a?o:a;return r>i/e.length?r:i/e.length},u.getFormatter=function(i,n,o){return"Number"===i||"Formatted Number"===i||"Smart Number"===i?function(t){var e;if("Smart Number"!==i&&"Formatted Number"!==i||"string"==typeof t&&(t=/^(\-|\+)?([0-9]+(\.[0-9]+)?|Infinity)$/.test(t)?parseFloat(t):t),null==t)return"";if(e="Smart Number"===i?_.isNumber(t)?k.Tools.smartFormatNumber(t,n):_.escape(t):"number"==typeof t?"Formatted Number"===i?k.Tools.formatNumber(t,n):t.toFixed(n):_.escape(t),o&&0<=e.toString().indexOf(".")){for(;"0"===e[e.length-1];)e=e.slice(0,-1);e.indexOf(".")===e.length-1&&(e=e.slice(0,-1))}return e}:"General"===i?function(t){return A.isMoment(t)||A.isDuration(t)?t.format():_.escape(t)}:"Boolean"===i?function(t){return _.escape(t)}:function(t){return _.escape(t)}},u.getMajorPerformanceCaveat=function(t){var e=document.createElement("canvas"),i=(e.setAttribute("width","1"),e.setAttribute("height","1"),document.getElementsByTagName("body")[0]),t=(i.appendChild(e),e.getContext(t,{failIfMajorPerformanceCaveat:!0}));return i.removeChild(e),!t},u.getMidrange=function(t,e,i,n){if(e===E.Timestamp){n=n||new F(u.convertToJsScalar(e,t.x),u.convertToJsScalar(e,t.y));e=new F(u.convertJSToNumber(n.x),u.convertJSToNumber(n.y));if(i||e.y===e.x&&t.x!==t.y)return(u.toBigInt(t.x)+u.toBigInt(t.y))/u.toBigInt(2)}return null},u.getNullVal=function(t){var e;return u.isLong(t)?(e=new k.Long(0,2147483648),"undefined"!=typeof BigInt&&(e=BigInt(e))):u.isDouble(t)||(e=5===t?-32768:-2147483648),e},u.getValueFromObject=function(t){for(var e="",i=0;i<t.length;i++)e+=t.getValue(i);return e},u.formatData=function(t,e,i,n){return u.getFormatter(e,i,n)(t)},u.ipcTemp=function(t){switch(t){case 12:return k.ipc.Timestamp;case 13:return k.ipc.Month;case 14:return k.ipc.QDate;case 15:return k.ipc.DateTime;case 16:return k.ipc.Timespan;case 17:return k.ipc.Minute;case 18:return k.ipc.Second;case 19:return k.ipc.Time}},u.isDouble=function(t){return-1!==u.DOUBLE_TYPES.indexOf(t)},u.isFloat=function(t){return t===E.Float},u.isInt=function(t){return-1!==u.INT_TYPES.indexOf(t)},u.isLong=function(t){return-1!==u.LONG_TYPES.indexOf(t)},u.isNull=function(t,e){return e?Number(t)===Number(e):isNaN(Number(t))||null===t},u.isRegexOrWild=function(t){t="object"==typeof t&&null!=t&&t.attributes?t.attributes.value:t;return!!t&&(0===t.indexOf("/")||-1!==t.indexOf("*"))},u.isString=function(t){return null!==t&&-1!==u.STRING_TYPES.indexOf(t)},u.limitWithin=function(t,e,i){return t=u.toNumber(t),e=u.toNumber(e),i=u.toNumber(i),t<e?e:i<t?i:t},u.log10=function(t){return Math.log10?Math.log10(t):Math.log(t)/Math.LN10},u.longToEmulateDoubleArray=function(e,t){for(var i=2*e.length,n=new Float32Array(i),o=0,a="undefined"!=typeof BigInt?e.getScalar.bind(e):function(t){return e.getLegacyScalar(t).toString()},r=u.getRange(e),s=u.getMidrange(new F(r[0],r[1]),e.qtype),l=0;l<i;l+=2){var h,p=o++;null!=t&&t.length&&t[l]?(n[l]=t[l],n[l+1]=t[l+1]):(p=a(p),p=u.toBigInt(p),p=s?p-s:p,h=Number(p),n[l]=h,p=p-u.toBigInt(Math.fround(h)),n[l+1]=Number(p))}return n},u.mergeRange=function(t){if(0<t.length){for(var e=t[0],i=1;i<t.length;i++)e=new F(u.minJs(e.x,t[i].x),u.maxJs(e.y,t[i].y));return e}},u.max=function(t,e){if(k.Long.isLong(t)){if(k.Long.isLong(e))return t.gt(e)?t:e;t=t.toNumber()}else k.Long.isLong(e)&&(e=e.toNumber());return e<t?t:e},u.maxJs=function(t,e){return A.isMoment(t)&&A.isMoment(e)?t.valueOfNano()>e.valueOfNano()?t:e:e<t?t:e},u.min=function(t,e){if(k.Long.isLong(t)){if(k.Long.isLong(e))return t.gt(e)?e:t;t=t.toNumber()}else k.Long.isLong(e)&&(e=e.toNumber());return e<t?e:t},u.minJs=function(t,e){return A.isMoment(t)&&A.isMoment(e)||A.isDuration(t)&&A.isDuration(e)?t.valueOfNano()>e.valueOfNano()?e:t:e<t?e:t},u.normalize=function(t,e,i){return(t-e)/(i-e)},u.replaceViewStates=function(i,t,l,h){var p=function(t,e){return function i(t,e,n){n=n?n+".":"";e+="";var o=h.getPropertyMeta(n+e);var a=t&&t.has&&t.has("_dataSource")&&t.has("_dataType");a=(_.isArray(t)||_.isObject(t))&&!a;{var r,s;return o&&"data"===o.type?t:o&&"viewstate"===o.type?(s=(n+e).split("."),r=s.pop(),s=s.join("."),l(s,void 0===r?"":r,t,o)):a?(n+=e,p=function(t,e){return i(t,e,n)},(u=_.isArray(t)?_.map:_.mapValues)(t,p)):t}}(t,e,i||"")},u=_.isArray(t)?_.map:_.mapValues;return u(t,p)},u.replaceViewStatesWithValue=function(t,e,i){return u.replaceViewStates(t,e,function(t,e,i,n){return n.value,n.value},i)},u.intToFloat=function(t){for(var e=0,i=new Float32Array(t.length),n=0;n<t.length;n++){var o=t.getScalar(e++);i[n]=o}return i},u.toBigInt=function(t){return"bigint"==typeof t?t:BigInt(Math.round(t))},u.toLong=function(t){return u.isIE11?k.Long.isLong(t)?t:new k.Long(Math.round(Number(t))):"bigint"==typeof t?t:BigInt(Math.round(t))},u.toNumber=function(t){return k.Long.isLong(t)?t.toNumber():"bigint"==typeof t?Number(t):t},u.calculateRelativePoint=function(t,e){return new F(u.calculateRelativeValue(t.x,e.x,e.z),u.calculateRelativeValue(t.y,e.y,e.w))},u.calculateRelativeValue=function(t,e,i){var n;return u.isIE11?((k.Long.isLong(t)?t.toNumber():Number(t))-(n=k.Long.isLong(e)?e.toNumber():Number(e)))/((k.Long.isLong(i)?i.toNumber():Number(i))-n):"bigint"==typeof e&&"bigint"==typeof i?Number(u.toBigInt(t)-e)/Number(i-e):(Number(t)-Number(e))/(Number(i)-Number(e))},u.scale=function(t,e,i){return e+t*(i-e)},u.scale2=function(t,e,i){return new F(e.x+t*(i.x-e.x),e.y+t*(i.y-e.y))},u.scale4=function(t,e,i){return new M(e.x+t*(i.x-e.x),e.y+t*(i.y-e.y),e.z+t*(i.z-e.z),e.w+t*(i.w-e.w))},u.scaleJs=function(t,e,i,n){var o,a,r,s,l,h,p;return A.isMoment(e)&&A.isMoment(i)?(s=p=a=o=void 0,n===E.Timestamp?(h=u.convertJSToScalar(n,e),r=u.convertJSToScalar(n,i),l=new F(e,i),(s=u.getMidrange(new F(h,r),n,!0,l))&&(o=Number(u.toBigInt(h)-s),a=Number(u.toBigInt(r)-s))):(o=e.valueOfNano(),a=i.valueOfNano()),l=o+t*(a-o),s?p=k.Tools.convertValueToMoment(u.convertToJsScalar(E.Timestamp,u.toBigInt(l)+s)):(p=A(l/1e6)).nanoseconds(l%1e6),p):A.isDuration(e)&&A.isDuration(i)?(l=(n=Number(e.valueOf()))+t*(Number(i.valueOf())-n),h=e.nanosecond()+t*(i.nanosecond()-e.nanosecond()),(p=A.duration(l)).nanoseconds(h),p):Number(e)+t*(Number(i)-Number(e))},u.toS=function(t){return"number"!=typeof t&&t.toDashString?t.toDashString():t.toString?t.toString():""},u.xPart=function(t){return new F(t.x,t.z)},u.yPart=function(t){return new F(t.y,t.w)},u.hex2RGB=function(t){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[255,255,255]},u.isIE11=/Trident\/.*rv:11/.test(navigator.userAgent),u.isWebGL2="undefined"!=typeof WebGL2RenderingContext,u.glContext=u.isWebGL2?"webgl2":u.isIE11?"experimental-webgl":"webgl",u.isWebGLHWAcclEnabled=!u.getMajorPerformanceCaveat("webgl"),u.DOUBLE_TYPES=[E.Double,E.DateTime],u.INT_TYPES=[E.Byte,E.Short,E.Int,E.Char,E.Month,E.Date,E.Minute,E.Second],u.LONG_TYPES=[E.Long,E.Timespan,E.Timestamp],u.STRING_TYPES=[E.List,E.Symbol],u);function u(){}(i=T=T||{})[i.Nanosecond=0]="Nanosecond",i[i.Millisecond=1]="Millisecond",i[i.Second=2]="Second",i[i.Minute=3]="Minute",i[i.Hour=4]="Hour",i[i.Day=5]="Day",i[i.Month=6]="Month",i[i.Year=7]="Year";y.prototype.getTicksLength=function(){return this.ticks},y.prototype.isTriggerBreakApplied=function(){return this.triggerBreakApplied},y.prototype.updateBreakIntervals=function(t,e,i,n){this.breakInfo={breakIntervals:t,min:e,max:i,crop:n}},y.prototype.getBaseSize=function(t){return this.displayTitle?t+y.TICKSIZE+1.8*this.titleFontSize:(t+=2*y.TICKSIZE,this.width?t-(t-this.width):t)},y.prototype.getGridlines=function(){return{color:this.gridlinesColor,offset:this.gridlinesOffset,opacity:this.gridlinesOpacity}},y.prototype.getTimeTicks=function(t,e,i,n,o,a,r,s){var l=new F(Y.convertJSToScalar(this.type,this.bounds.x),Y.convertJSToScalar(this.type,this.bounds.y)),h=a&&this.isTriggerBreakApplied()?null:Y.getMidrange(l,this.type,!0,this.bounds),p=(h&&(t=Number(Y.toBigInt(l.x)-h),e=Number(Y.toBigInt(l.y)-h)),[]),u=n===T.Month||n===T.Year,c=u||n===T.Year,d=o.unit,y=(t/=d.size,(e/=d.size)-t),l=this.niceNum(e-t,!1),g=this.stepSize||this.niceNum(l/(l&&l<s?l:s),!0),n=Math.floor(t/g)*g;this.isTriggerBreakApplied()&&!this.stepSize&&(this.stepSize=g);for(var f,m,P,x,v,O,b=n;b<=e;b+=g)t<=b&&(O=void 0,O=i?((f=k.Tools.convertValueToDuration(b*d.size)).nanosecond(b%1e6*d.size),f.formatNano(c?"":d.format)):(f=(u?b+1:b)*d.size,P=h?Y.toBigInt(f)+h:f,m=void 0,m=this.type===E.Date?A(f):h?k.Tools.convertValueToMoment(Y.convertToJsScalar(this.type,P)):k.Tools.convertValueToMoment(f),P=d.format,o.majorUnit&&(x=Number(m),v=m.clone().startOf(o.majorUnitName).valueOf(),Math.abs(x-v)<d.size)&&(P=o.majorUnit.format),m.format(P)),p.push({pos:(b-t)/y/a+r,label:this.prefix+O+this.suffix}));return p},y.prototype.getSimpleTicks=function(){var n,t,o,a,r,e,s=this,i=A.isMoment(this.bounds.x),l=A.isDuration(this.bounds.x),h=Y.convertJSToNumber(this.bounds.x),p=Y.convertJSToNumber(this.bounds.y);return i||l?(n=this.determineUnitForAutoTicks(h,p,this.ticks),i=y.INTERVALS[n],t=e=void 0,this.showMajorTicks&&(e=y.INTERVALS[this.determineMajorUnit(n)],t=this.getUnitName(n)),o={unit:i,majorUnit:e,majorUnitName:t},null!=(i=tt.applyRangeToBreakIntervals(this.breakInfo))&&i.length?(a=p-h,r=0,e=i.map(function(t){h=Y.convertJSToNumber(Y.convertToJsScalar(s.type,t[0])),p=Y.convertJSToNumber(Y.convertToJsScalar(s.type,t[1]));var t=1/t[2],e=r||0,i=s.ticks/t,t=s.getTimeTicks(h,p,l,n,o,t,e,i);return r+=(p-h)/a,t}),Array.prototype.concat.apply([],e)):this.getTimeTicks(h,p,l,n,o,1,0,this.ticks)):this.niceScale(h,p)},y.prototype.measureText=function(t,e){return t.font=this.fontSize+"px "+y.FONTFACE,t.measureText(e)},y.prototype.setRangeViewstate=function(t,e,i){var n,o=t?Y.toS(t.x):"",t=t?Y.toS(t.y):"";null!=(n=this.api.getPropertyMeta(e+"."+i+y.PROP_SEL_MIN))&&n.viewstateType&&this.api.setProperty(e+"."+i+y.PROP_SEL_MIN,o),null!=(n=this.api.getPropertyMeta(e+"."+i+y.PROP_SEL_MAX))&&n.viewstateType&&this.api.setProperty(e+"."+i+y.PROP_SEL_MAX,t)},y.prototype.updateCategoryData=function(t){this.categoryData=t},y.prototype.updateBounds=function(t,e){_.isEqual(t,this.bounds)||(this.bounds=t,this.type=_.min(e))},y.prototype.niceNum=function(t,e){var i=Math.floor(Y.log10(t)),t=t/Math.pow(10,i),e=e?t<1.5?1:t<3?2:t<7?5:10:t<=1?1:t<=2?2:t<=5?5:10;return e*Math.pow(10,i)},y.prototype.determineMajorUnit=function(t){switch(t){case T.Nanosecond:case T.Millisecond:case T.Second:case T.Minute:case T.Hour:return T.Day;case T.Day:return T.Month;default:return T.Year}},y.prototype.determineUnitForAutoTicks=function(t,e,i){var n,o=Number.MAX_SAFE_INTEGER||9007199254740991,a=this.getUnitFromLayer(this.type);for(n in T){var r=isNaN(Number(n))?T[n]:Number(n),s=y.INTERVALS[r],l=s.steps||o,s=Math.ceil((e-t)/(l*s.size)),l=Math.ceil((e-t)/(l*y.INTERVALS[a].size));if(s<=i){if(l<s)return a;if(Number(r)>=a)return r}}return T.Year},y.prototype.getUnitFromLayer=function(t){switch(t){case E.Date:return T.Day;case E.Month:return T.Month;case E.Minute:return T.Minute;case E.Second:return T.Second;case E.Timespan:case E.Timestamp:return T.Nanosecond;case E.DateTime:case E.Time:return T.Millisecond;default:return T.Year}},y.prototype.getUnitName=function(t){switch(t){case T.Nanosecond:case T.Millisecond:case T.Second:case T.Minute:case T.Hour:return"day";case T.Day:return"month";default:return"year"}},y.prototype.niceScale=function(t,e){for(var i=[],n=e-t,o=this.propertyCache[y.PROP_TYPE]===y.TYPE_CATEGORY&&this.categoryData.length,a=this.niceNum(e-t,!1),r=this.niceNum(a/(this.ticks-1),!0),s=0,a=(o&&(r=1/(s=this.categoryData.length-1)),o&&1===this.categoryData.length?e=.5:Math.floor(t/r)*r),l=Math.max(-Math.floor(Y.log10(r)),0),h=Y.getFormatter(this.format,Math.max(l,this.decPlaces),this.hideTrailingZeroes),p=a;p<=e;p+=r){p+r===p&&(r*=2);var u=Math.round(s*p),u=o?this.categoryData[u]:p,c=A.isMoment(u),d=A.isDuration(u);this.propertyCache[y.PROP_TYPE]===y.TYPE_CATEGORY&&(c||d)&&(u=Y.toS(u)),t<=p&&void 0!==u&&i.push({pos:(p-t)/n,label:this.prefix+h(u)+this.suffix})}return i},y.FONTFACE="Segoe UI,Helvetica,Arial,sans-serif",y.PROP_BEGIN_ZERO=".Format.BeginAtZero",y.PROP_COLOR=".Color",y.PROP_FORMAT=".Format.Format",y.PROP_HIDETRAIL=".Format.HideTrailingZeroes",y.PROP_MIN=".Range.Min",y.PROP_MAX=".Range.Max",y.PROP_SEL_MIN=".Range.SelectionMin",y.PROP_SEL_MAX=".Range.SelectionMax",y.PROP_USE_MIN_MAX=".Range.UseMinMax",y.PROP_DISPLAY=".Format.Display",y.PROP_STACKED=".Stacked",y.PROP_TYPE=".Type",y.PROP_BREAK=".Format.Break",y.PROP_DISTRIBUTION=".Format.Distribution",y.PROP_TRIGGER_BREAK=".Format.TriggerBreak",y.PROP_PRECISION=".Format.Precision",y.TICKSIZE=7,y.TYPE_CATEGORY="Category",y.TYPE_LINEAR="Linear",y.TYPE_TIME="Time",y.RANGE_PROPS=[y.PROP_TYPE,y.PROP_STACKED,y.PROP_BEGIN_ZERO,y.PROP_USE_MIN_MAX,y.PROP_MIN,y.PROP_MAX],y.PROP_FONTSIZE=".Format.FontSize",y.PROP_GRIDLINESCOLOR=".Gridlines.GridlinesColor",y.PROP_GRIDLINESOFFSET=".Gridlines.GridlinesOffset",y.PROP_GRIDLINESOPACITY=".Gridlines.GridlinesOpacity",y.PROP_POSITION=".Position",y.PROP_PREFIX=".Format.Prefix",y.PROP_SHOW_MAJOR=".Format.ShowMajorUnits",y.PROP_SUFFIX=".Format.Suffix",y.PROP_TICKS=".Ticks",y.PROP_TITLEDISPLAY=".Title.Display",y.PROP_TITLESTRING=".Title.LabelString",y.PROP_TITLEFONTSIZE=".Title.FontSize",y.PROP_WIDTH=".Width",y.INTERVALS=[{common:!0,size:1e-6,steps:1e6,format:"H:mm:ss.SSSSSSSSS"},{common:!0,size:1,steps:1e3,format:"H:mm:ss.SSS"},{common:!0,size:1e3,steps:60,format:"H:mm:ss"},{common:!0,size:6e4,steps:60,format:"H:mm"},{common:!0,size:36e5,steps:24,format:"HH:mm"},{common:!0,size:864e5,steps:30,format:"YYYY-MM-DD"},{common:!0,size:2628e6,steps:12,format:"MMM YY"},{common:!0,size:3154e7,format:"Y"}];var X=y;function y(t,e,i){var n=this,t=(this.index=t,this.bounds=new F(0,1),this.propertyCache={},this.breakInfo={},this.categoryData=[],this.type=0,this.showMajorTicks=!1,this.stepSize=0,this.triggerBreakApplied=!1,this.api=e,this.width=e.getProperty(i+y.PROP_WIDTH),this.displayTitle=e.getProperty(i+y.PROP_TITLEDISPLAY),this.display=e.getProperty(i+y.PROP_DISPLAY),this.gridlinesOpacity=e.getProperty(i+y.PROP_GRIDLINESOPACITY),this.gridlinesOffset=e.getProperty(i+y.PROP_GRIDLINESOFFSET),this.gridlinesColor=e.getProperty(i+y.PROP_GRIDLINESCOLOR),this.title=e.getProperty(i+y.PROP_TITLESTRING),this.titleFontSize=e.getProperty(i+y.PROP_TITLEFONTSIZE),this.ticks=e.getProperty(i+y.PROP_TICKS),this.fontSize=e.getProperty(i+y.PROP_FONTSIZE),this.position=e.getProperty(i+y.PROP_POSITION),this.prefix=e.getProperty(i+y.PROP_PREFIX),this.suffix=e.getProperty(i+y.PROP_SUFFIX),this.format=e.getProperty(i+y.PROP_FORMAT),this.decPlaces=e.getProperty(i+y.PROP_PRECISION),this.hideTrailingZeroes=e.getProperty(i+y.PROP_HIDETRAIL),y.RANGE_PROPS.forEach(function(t){return n.propertyCache[t]=e.getProperty(i+t)}),e.getProperty(i+y.PROP_TYPE)),o=e.getProperty(i+y.PROP_BREAK);"Time"===t&&void 0===o?(e.setProperty(i+y.PROP_BREAK,864e5),e.setProperty(i+y.PROP_DISTRIBUTION,"Linear"),e.setProperty(i+y.PROP_TRIGGER_BREAK,864e5),e.setProperty(i+y.PROP_SHOW_MAJOR,!1)):"Time"!==t&&void 0!==o&&(e.setProperty(i+y.PROP_BREAK,void 0),e.setProperty(i+y.PROP_DISTRIBUTION,void 0),e.setProperty(i+y.PROP_TRIGGER_BREAK,void 0),e.setProperty(i+y.PROP_SHOW_MAJOR,void 0)),"Smart"===e.getProperty(i+y.PROP_DISTRIBUTION)&&(this.triggerBreakApplied=!0),e.getProperty(i+y.PROP_SHOW_MAJOR)&&(this.showMajorTicks=!0)}var At=function(t,e,i,n,o,a){this.layer=t,this.index=e,this.overpoint=i,this.yAxis=n,this.yIndex=o,this.xProp=a,this.layer.getLayerType()===V.Bounds&&(this.overpoint=new F(this.overpoint.x,1))},Lt=(g.prototype.drawCoordinates=function(t,e,i,n,o,a){var r,s,l,h=n.getElementsByClassName("xCoord")[0],p=n.getElementsByClassName("yCoord")[0],u=(h||p||(h=this.setUpCoordinate(!0,n),p=this.setUpCoordinate(!1,n)),t.width*e.x),e=t.height*e.y;!o||h.innerText===(s=this.formatData("Xaxis",o.val))&&"none"!==h.style.display||(h.style.display="block",l=h.offsetHeight,r=h.offsetWidth,o="Top"===o.position?i.y-l-3:t.height+i.y+3,t=u+i.x,u=r/2,h.style.top=(o+l>n.offsetHeight?o-l:o)+"px",h.style.left=(t-u<0?0:t+u>n.offsetWidth?n.offsetWidth-r:t-u)+"px",h.innerText=s),!a||p.innerText===(s=this.formatData("Yaxis",a.val))&&"none"!==p.style.display||(p.style.display="block",l="Right"===a.position?n.offsetWidth-i.z+3:i.x-p.offsetWidth-3,o=p.offsetHeight,p.style.top=e+i.y-o/2+"px",p.style.left=(l<0?0:l)+"px",p.innerText=s)},g.prototype.hideCoordinates=function(t,e){var i=t.getElementsByClassName("yCoord")[0],t=t.getElementsByClassName("xCoord")[0];"x"===e&&t?t.style.display="none":"y"===e&&i?i.style.display="none":t&&i&&(i.style.display="none",t.style.display="none")},g.prototype.updateTheme=function(t,e){var i,n=e.getElementsByClassName("xCoord")[0],e=e.getElementsByClassName("yCoord")[0];this.theme=t,n&&e&&(n.style.backgroundColor=i=(t="Light"===t)?"rgba(48, 48, 48, 0.9)":"rgba(248, 248, 248, 0.9)",n.style.color=t?"white":"black",e.style.backgroundColor=i,e.style.color=t?"white":"black")},g.prototype.updateTooltipPalette=function(t){this.palette=t},g.prototype.hideTooltip=function(){this.api.removeTooltip(),delete this.tooltip},g.prototype.render=function(t,e,i,n){var o=this,a=t.width*e.overpoint.x+6,r=t.height*(1-e.overpoint.y)+6,s=this.api.getProperty(g.PROP_GROUPBYLAYER),l=this.api.getProperty(g.PROP_SHOWALLPOINTS),h=this.api.getProperty(g.PROP_USECUSTOMTOOLTIP),p=this.api.getProperty(e.layer.indexProp(e.xProp)),u=e,u=(this.closestPointInfo=this.getRowData(u.layer,u.index,u.yAxis,u.yIndex,u.xProp),e.layer.getRowData(u.index)),c=u?u[p]:null,d=[],y=[];e.layer.getLayerType()===V.Baseline?d.push(this.getRowData(e.layer,e.index,e.yAxis,e.yIndex,e.xProp)):_.each(i,function(t){var e=o.api.getProperty(t.layer.indexProp(t.xProp)),i=t.layer.getRowData(t.index),i=i?i[e]:null;null!==i&&(e=function(t){return t.i+""+(t.n||0===t.n?t.n:"")},(i="object"==typeof i&&i.i?e(i):i)===(c="object"==typeof c&&null!=c&&c.i?e(c):c))&&(s&&l&&!h?y.push(t):d.push(o.getRowData(t.layer,t.index,t.yAxis,t.yIndex,t.xProp)))}),s&&l&&!h&&(d=this.groupedLayers(n,y));p={text:h?this.api.getProperty(g.PROP_CUSTOMTOOLTIP):I.TOOLTIP_DEFAULT,data:d,position:{top:r,left:a},anchorEl:t};return this.tooltip=this.api.setTooltip(p),u},g.prototype.returnPointInfo=function(){return this.closestPointInfo},g.prototype.formatData=function(t,e){var i=this.api.getProperty((t="Xaxis"===t?"Xaxes.0":"Yaxes.0")+g.PROP_FORMAT),n=this.api.getProperty(t+g.PROP_PRECISION),t=this.api.getProperty(t+g.PROP_HIDETRAIL);return Y.formatData(e,i,n,t)},g.prototype.formattedData=function(t,e){return t.getRowData(e)},g.prototype.getRowData=function(i,t,e,n,o,a){var r,s=this,l=i.getLayerType(),o="Value"===o?"val":this.api.getProperty(i.indexProp(o)),h=this.api.getProperty(i.indexProp(z.PROP_HIGHLIGHTRULES)),p=(l===V.Heatmap?r=h&&h.length?i.getColorArr(t):(u=i.getHeatmapScore(),r=Y.getRange(u),u=Y.getColValue(u,t),Yt.interpolateColor(i.getPaletteProperty(),Number(r[0]),Number(r[1]),Number(u))):i.isRegexOrWild()?(r=this.palette[i.index][n],(h&&h.length||i.hasColorData())&&(r=i.getColorArr(t,n))):(r=this.api.getProperty(i.indexProp(z.PROP_COLOR)),(h&&h.length||i.hasColorData())&&(r=i.getColorArr(t))),this.formattedData(i,t)),u=i.getLayerName(),n=i.isRegexOrWild()||l===V.Heatmap?e:u,h=p?this.formatData("Xaxis",p[o]):"",t=p?this.formatData("Yaxis",p[e]):"",u=this.getWidth(n,12),o=this.getWidth(h,12),e=this.api.getProperty(i.indexProp(z.PROP_ICON)),c={color:r,data:p,icon:e&&0===e.indexOf("fa")?"fa "+e:"fa fa-square",image:e&&0===e.indexOf("data:image/")?"width: 15px; content: url('"+e+"')":"",name:n,width:Math.max(u+30,o+30),xAxis:h,yAxis:l===V.Bounds?"":t,grouped:a?_.map(a,function(t){return s.formatData("Yaxis",t)}):null};return i.isCandlestick()&&["Open","High","Low","Close"].forEach(function(t){var e=s.api.getProperty(i.indexProp(t));c[t.toLowerCase()]=p?s.formatData("Yaxis",p[e]):""}),c},g.prototype.getWidth=function(t,e){var i=document.createElement("canvas").getContext("2d");if(i)return i.font=e+"px "+X.FONTFACE,i.measureText(t).width;throw new Error("2d context not supported or canvas already initialized")},g.prototype.groupedLayers=function(n,a){var r=this,o=[],t=_.map(n,function(t){return t.layer.getAllCols()}),s=[];return _.each(t,function(t,e){var i=n[e];1===t.length?o.push(_.filter(a,function(t){return t.layer===i.layer&&t.yIndex===i.yIndex})):_.each(t,function(t,e){o.push(_.filter(a,function(t){return t.layer===i.layer&&t.yIndex===Number(e)}))})}),_.each(o,function(n,o){_.each(a,function(t){var e,i=n[0];i&&i.layer===t.layer&&(e=n[0].yAxis,t=_.map(n,function(t){t=r.formattedData(t.layer,t.index);return t?t[e]:null}),s[o]=r.getRowData(i.layer,i.index,i.yAxis,i.yIndex,i.xProp,t))})}),s.filter(function(t){return t})},g.prototype.setUpCoordinate=function(t,e){var i=document.createElement("div");return i.className=t?"xCoord":"yCoord",i.style.borderRadius="3px",i.style.padding="3px",i.style.position="absolute",i.style.fontFamily="sans-serif",e.appendChild(i),this.updateTheme(this.theme,e),i},g.PROP_CUSTOMTOOLTIP="Overlay.CustomTooltip",g.PROP_USECUSTOMTOOLTIP="Overlay.UseCustomTooltip",g.PROP_GROUPBYLAYER="Overlay.GroupByLayer",g.PROP_SHOWALLPOINTS="Overlay.ShowAllPoints",g.PROP_FORMAT=".Format.Format",g.PROP_HIDETRAIL=".Format.HideTrailingZeroes",g.PROP_PRECISION=".Format.Precision",g.FORMATS={1212:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",1213:"YYYY-MM",1214:"YYYY-MM-DD",1215:"YYYY-MM-DD HH:mm:ss.SSS",1216:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",1217:"YYYY-MM-DD HH:mm",1218:"YYYY-MM-DD HH:mm:ss",1219:"YYYY-MM-DD HH:mm:ss.SSS"},g);function g(t){this.palette=[],this.api=t}Ct.prototype.hideCrosshair=function(t){var e=this.el.getElementsByClassName("crosshairX")[0],i=this.el.getElementsByClassName("crosshairY")[0],n=this.el.getElementsByClassName("crosshair-selected")[0];e&&this.el&&(e.setAttribute("visibility","hidden"),i.setAttribute("visibility","hidden"),"hide-both"===t)&&n&&n.setAttribute("visibility","hidden")},Ct.prototype.render=function(t,e,i,n){this.margin=t,"click"===i&&(this.overpoint=e);var o=this.canvas.width*e.x,e=this.canvas.height*(1-e.y),n="Light"===n?"black":"white";this.api.getProperty(Ct.PROP_CROSSHAIR)?(this.crosshairX?(this.crosshairX=this.el.getElementsByClassName("hover"===i?"crosshairX":"crosshair-selected")[0],this.crosshairY=this.el.getElementsByClassName("crosshairY")[0]):(this.crosshairX=document.createElementNS("http://www.w3.org/2000/svg","line"),this.crosshairY=document.createElementNS("http://www.w3.org/2000/svg","line"),"hover"===i?(this.crosshairX.setAttribute("class","crosshairX"),this.crosshairY.setAttribute("class","crosshairY")):this.crosshairX.setAttribute("class","crosshair-selected")),"number"==typeof o&&this.crosshairX&&isFinite(o)&&(this.setCrosshair(this.crosshairX,n,i),this.crosshairX.setAttribute("x1",o+""),this.crosshairX.setAttribute("y1","0"),this.crosshairX.setAttribute("x2",o+""),this.crosshairX.setAttribute("y2",this.canvas.height+t.y+"")),"number"==typeof e&&this.crosshairY&&isFinite(e)&&"hover"===i&&(this.setCrosshair(this.crosshairY,n),this.crosshairY.setAttribute("x1","0"),this.crosshairY.setAttribute("y1",e+""),this.crosshairY.setAttribute("x2",this.canvas.width+t.x+""),this.crosshairY.setAttribute("y2",e+""))):this.hideCrosshair("hide-both")},Ct.prototype.onPan=function(t){var e;this.isSelected()&&this.crosshairX&&(e=Number(this.crosshairX.getAttribute("x1"))/this.canvas.width,this.setPosition(e+t),this.overpoint=new F(e+t,this.overpoint.y))},Ct.prototype.updateSelected=function(t,e){var i;this.isSelected()&&(i=this.overpoint.x,e)&&(e=t.y-t.x,i>t.x&&i<t.y?i=(i-t.x)/e:this.hideCrosshair("hide-both"),this.setPosition(i))},Ct.prototype.isSelected=function(){return this.crosshairX&&this.crosshairX===this.el.getElementsByClassName("crosshair-selected")[0]&&"visible"===this.crosshairX.getAttribute("visibility")},Ct.prototype.setPosition=function(t){var e=this.canvas.width*t,i=this.canvas.height+this.margin.y+"";!isNaN(t)&&isFinite(e)&&this.crosshairX&&(this.crosshairX.setAttribute("x1",e+""),this.crosshairX.setAttribute("y1","0"),this.crosshairX.setAttribute("x2",e+""),this.crosshairX.setAttribute("y2",i))},Ct.prototype.setCrosshair=function(t,e,i){t.setAttribute("visibility","visible"),t.setAttribute("opacity",.7),t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","click"===i?0:3),this.el.getElementsByClassName("overlay")[0].appendChild(t)},Ct.SVG_NS="http://www.w3.org/2000/svg",Ct.PROP_CROSSHAIR="Overlay.ShowCrosshairs";var _t=Ct;function Ct(t,e,i){this.el=t,this.api=e,this.canvas=i,this.crosshairX=null,this.crosshairY=null,this.overpoint=new F(0,1),this.margin=new M(0,0,1,1)}St.prototype.destroyTree=function(){0!==this.treeWidth&&(this.$tree.jstree("destroy"),this.treeWidth=0)},St.prototype.getNames=function(){return this.names},St.prototype.getTreeWidth=function(){return this.treeWidth},St.prototype.onSettingsChange=function(e,t){var i=e.map(function(t){return t.Name}),n=e.map(function(t,e){return e}).filter(function(t){return e[t].Expanded}),o=this.legends.filter(function(t,e){return t.legendGroup&&-1!==n.indexOf(t.index)}).map(function(t){return t.id}),a=e.map(function(t){return t.Icon});this.openedNodes||(this.openedNodes=o,this.icons=a,this.names=i),!_.isEqual(o,this.openedNodes)&&t&&this.expandNodes(o),_.isEqual(i,this.names)&&_.isEqual(a,this.icons)||(this.icons=a,this.appInvalidate(G.Legend))},St.prototype.render=function(t){var e=this;this.destroyTree(),this.legends=this.generateDataObj(t),this.names=this.api.getProperty("Legend.LegendGroups").map(function(t){return t.Name}),this.$tree.jstree({core:{data:this.legends,force_text:!0,dblclick_toggle:!1},checkbox:{three_state:!0,cascade:"undefined",tie_selection:!1},plugins:["checkbox","conditionalselect","changed"]}),this.initTreeEvents(),this.$tree.on("ready.jstree",function(){e.updateTreeWidth(!0),e.updateIconColors()})},St.prototype.updateTreeWidth=function(t){var e=this.$tree.width();e!==this.treeWidth&&(this.treeWidth=e,t)&&this.appInvalidate(G.Axis)},St.prototype.expandNodes=function(t){this.$tree.jstree("close_all"),this.$tree.jstree(!0).open_node(t),this.openedNodes=t},St.prototype.initTreeEvents=function(){var i=this;this.$tree.on("ready.jstree",function(){i.$tree.on("check_node.jstree",function(t,e){i.onNodeCheck(e.node,!0)}),i.$tree.on("uncheck_node.jstree",function(t,e){i.onNodeCheck(e.node,!1)}),i.$tree.on("after_open.jstree",function(t,e){i.setLegendGroupExpanded(e.node.original.index,!0)}),i.$tree.on("after_close.jstree",function(t,e){i.setLegendGroupExpanded(e.node.original.index,!1)})})},St.prototype.generateDataObj=function(t){var i=this;return t.map(function(t,e){return L(L({},t),{id:e,icon:"fa "+(t.icon||"fa-stop"),state:{opened:!t.legendGroup||i.api.getProperty("Legend.LegendGroups."+t.index+".Expanded"),selected:!1,checked:t.enabled},li_attr:{class:"treenode-id-"+e,title:t.text},color:t.fillStyle})})},St.prototype.onNodeCheck=function(t,e){var i=this,n=!1;this.clicks++,1===this.clicks&&setTimeout(function(){1===i.clicks?i.selectedLegend="":1<i.clicks&&(n=!0,i.selectedLegend?(i.$tree.jstree(!0).check_all(),i.selectedLegend="",i.updateIconColors()):(i.$tree.jstree(!0).uncheck_all(),i.$tree.jstree(!0).check_node(t),i.selectedLegend=t.original.text)),i.updateLayerOnNodeCheck(t,e,n),i.clicks=0},300)},St.prototype.setLegendGroupExpanded=function(t,e){this.api.setProperty("Legend.LegendGroups."+t+".Expanded",e),this.updateTreeWidth(),e&&this.updateIconColors(),this.appInvalidate(G.Axis)},St.prototype.updateIconColors=function(){var i=this;this.legends.forEach(function(t,e){t.legendGroup||(e=null==(e=i.el.getElementsByClassName("treenode-id-"+e)[0])?void 0:e.getElementsByClassName("jstree-themeicon-custom")[0])&&(e.style.color=t.color)})},St.prototype.updateLayerOnNodeCheck=function(o,a,r){var t,s=this,e=o.original.text;o.children.length?o.children.forEach(function(t,e){var t=s.$tree.jstree(!0).get_node(t+""),i=t.original.index,e=e<o.children.length-1,n=t.original.wild,t=t.original.text;s.updateLayerState(i,a,r,t,e,n,!0)}):(t=o.original.wild,this.updateLayerState(o.original.index,a,r,e,!1,t))};var Et=St;function St(t,e,i,n){this.el=t,this.api=e,this.updateLayerState=i,this.appInvalidate=n,this.clicks=0,this.icons=[],this.legends=[],this.names=[],this.selectedLegend="",this.$tree=$(this.el).find(".legend-div"),this.names=this.api.getProperty("Legend.LegendGroups").map(function(t){return t.Name})}Dt.prototype.render=function(i){function n(t){return"object"==typeof t&&t.attributes?t.attributes.value:t}var o=[];_.each(this.api.getProperty("Layers"),function(t){_.each(_.filter(t.HighlightRules,function(t){return n(t.Show)}),function(t){if("gradient"===t.RuleType){if(!t.Palette.length)return;var e=t.Palette.map(function(t){return"object"==typeof t.type&&t.type.attributes?t.type.attributes.value:t.type}),e=Yt.createGradient(e)}else e=n(t.RuleColor);o.push({ruleColor:e,ruleName:n(t.RuleName),color:i})})}),this.ruleLegendEl.innerHTML=N.highlightRule(o)};var Rt=Dt;function Dt(t,e){this.api=t,this.el=e,this.ruleLegendEl=this.el.getElementsByClassName("GL-highlight-rule")[0]}n.prototype.onSettingsChange=function(t){this.tree.onSettingsChange(t,this.isLegendGroup)},n.prototype.render=function(t){var a,e,r,i,n,o,s,l,h,p,u,c,d,y=this;this.checkedNode?this.checkedNode=!1:(a=[],e=this.color,r=B([],this.layers,!0),i=this.legendDiv,n=this.exportDiv,o=this.drawDiv,s=this.api.getProperty("Legend.LegendGroups"),l=this.api.getProperty("Layers"),h=[],this.legendHeight=void 0,this.ruleLegendHeight=void 0,this.updatePalette(this.layers,t),this.updateLegendGroupNames(s,l),p=l.some(function(t){return t.LegendGroup&&"None"!==t.LegendGroup}),u=0,l.forEach(function(e){var i,t,n=e.LegendGroup,o=(p&&n&&"None"!==n&&(-1===h.indexOf(n)?(t=s.findIndex(function(t){return t.Name===n}),t=y.renderLegendGroup(t),h.push(n),t.opened=y.api.getProperty("Legend.LegendGroups."+(h.length-1)+".Expanded"),a.push(t),i=u,u++):i=a.findIndex(function(t){return t.text===n})),r.find(function(t){return t.getId()===e._Id}));o&&y.renderLegend(e,o,n).forEach(function(t){p&&(t=L(L({},t),{id:u,legendGroup:!1,index:null==o?void 0:o.index,parent:"None"===n?"#":i,enabled:null==o?void 0:o.isEnabled(),wild:null==o?void 0:o.isRegexOrWild()})),a.push(t),u++})}),p?(i.classList.add("grouped-legend"),i.classList.remove("standard-legend"),"100%"===i.style.width&&(i.style.width="auto"),"100%"!==i.style.height&&(i.style.height="100%"),this.isLegendGroup=!0,this.tree.render(a)):(i.classList.add("standard-legend"),i.classList.remove("grouped-legend"),this.tree.destroyTree(),this.isLegendGroup=!1,i.innerHTML=N.legend(a),c=[],_.each(r,function(t,e){var i=y.api.getProperty("Layers."+e+".Legend"),n=c.filter(function(t){return t}),n=n[n.length-1],t=t.getLayerType()===V.Baseline||t.isCandlestick()?1:t.getAllCols().length;c.push(i?t+(0<e&&n?n:0):0)}),t=this.legendDiv.getElementsByTagName("li"),d=0,_.each(t,function(e,o){e.onclick=function(){i=o,n=0,_.each(c,function(t,e){if(i+1<=t)return n=e,!1});var i,n,t=n;1===++d&&setTimeout(function(){y.updateState(e,t,1<d),d=0},300)}})),this.highlightRule.render(e),this.updateLegendPositions(i,n,o))},n.prototype.getLayers=function(t){this.layers=t},n.prototype.getHeight=function(){var t=this.legendDiv;if(void 0!==this.legendHeight)this.isLegendGroup||t.style.height===this.legendHeight+"px"||(t.style.height=this.legendHeight+"px");else{if(this.api.getProperty("Layers").filter(function(t){return t.Legend}).some(function(t){return t})){var e=t.getElementsByTagName("ul")[0],e=null==e?void 0:e.getBoundingClientRect();if(e)return this.isLegendGroup||(t.style.height=e.height+"px"),this.legendHeight=e.height}this.legendHeight=0,t.style.height=this.legendHeight+"px"}return this.legendHeight},n.prototype.getTreeWidth=function(){return this.tree.getTreeWidth()||200},n.prototype.getWidth=function(){var t,e=this.legendDiv,i=this.exportDiv,n=this.drawDiv,o=this.api.getProperty("Layers").filter(function(t){return t.Legend}),a=this.getFileExporterWidth(),r=this.getAnnotateWidth();return o.some(function(t){return t})?(o=null==(o=this.el.getElementsByClassName("chartgl-legend")[0])?void 0:o.getBoundingClientRect(),"Left"===(t=this.getPosition())||"Right"===t?(this.isLegendGroup||(e.style.width=(null==o?void 0:o.width)+"px"),t={left:"Left"===t?"0":"",right:"Right"===t?"0":""},Object.assign(i.style,t),Object.assign(n.style,t)):(e.style.width="calc(100%  - "+(a+r)+"px)",n.style.left="",n.style.right=a+"px",i.style.left="",i.style.right="0"),i.style.width=a+"px",n.style.width=r+"px",this.isLegendGroup?this.getTreeWidth():null==o?void 0:o.width):(e.style.width="0px",0)},n.prototype.getPosition=function(){var t=this.api.getProperty("Legend.Position");return!this.isLegendGroup||"Top"!==t&&"Bottom"!==t?t:"Right"},n.prototype.getRulesHeight=function(){var t;return void 0!==this.ruleLegendHeight?this.ruleLegendHeight:(t=this.el.getElementsByClassName("chartgl-highlight-rule")[0],this.ruleLegendHeight=(null==t?void 0:t.getBoundingClientRect().height)+10||0)},n.prototype.onResize=function(t){this.height=t,this.legendHeight=void 0,this.ruleLegendHeight=void 0,this.tree.updateTreeWidth()},n.prototype.renderLegend=function(t,e,i){var n,o,a,r,s,l=e.index,h=this.color,p=[],u=e.getLayerType(),c=e.getAllCols(),d=e.isEnabled();return this.disabledColumns[l]&&(d||_.isEqual(this.disabledColumns[l],c))||(this.disabledColumns[l]=d?[]:c),this.api.getProperty("Layers."+l+".Legend")&&(n=this.api.getProperty("Layers."+l+"."+z.PROP_ICON),o=e.isEnabled(),!e.hasColorData()||i&&"None"!==i?e.isRegexOrWild()?(d=e.getAllCols(),a=this.disabledColumns[l],r=e.getPaletteProperty(),_.each(d,function(t,e){p.push({fillStyle:r[e%r.length],icon:n,image:n&&0===n.indexOf("data:image/")?"content: url('"+n+"')":"",width:12,radius:6,text:t,fontColor:h,strike:o&&-1===a.indexOf(t)?"":"line-through"})})):p.push({fillStyle:u===V.Bounds?e.getPaletteProperty()[0]:u===V.Heatmap?Yt.createGradient(e.getPaletteProperty()):this.api.getProperty("Layers."+l+(e.isCandlestick()?".CandlestickFormat.WickColor":".Color")),icon:n,image:n&&0===n.indexOf("data:image/")?"content: url('"+n+"')":"",width:u===V.Heatmap?11:12,radius:6,text:this.api.getProperty("Layers."+l+".Name"),fontColor:h,strike:o?"":"line-through",bullColor:e.isCandlestick()?this.api.getProperty("Layers."+l+".CandlestickFormat.BullColor"):null,isHeatmap:u===V.Heatmap}):(i=(c=e.getColorData())[0],s=c[1],i.forEach(function(t,e){p.push({fillStyle:s[e],icon:n,image:n&&0===n.indexOf("data:image/")?"content: url('"+n+"')":"",width:12,radius:6,text:null==t?void 0:t.toString(),fontColor:h,strike:o?"":"line-through"})}))),p},n.prototype.renderLegendGroup=function(t){var e=this.api.getProperty("Legend.LegendGroups."+t+".Icon");return{fillStyle:this.color,icon:e,image:e&&0===e.indexOf("data:image/")?"content: url('"+e+"')":"",width:12,radius:6,text:this.api.getProperty("Legend.LegendGroups."+t+".Name"),fontColor:this.color,strike:"",bullColor:null,parent:"#",id:t,legendGroup:!0,index:t}},n.prototype.updateLegendPositions=function(t,e,i){var n=this.getPosition(),o=this.el.getElementsByClassName("lnksAnnotate")[0],a=this.el.getElementsByClassName("lnksExport")[0],r=this.api.getProperty("FileExport.ShowExportCsvButton")||this.api.getProperty("FileExport.ShowExportPngButton")||this.api.getProperty("FileExport.ShowExportExcelButton"),s=this.api.getProperty("Annotations.ShowAnnotateControl");"Left"===n||"Right"===n?(t.classList.remove("top-bottom"),e.classList.remove("top-bottom"),i.classList.remove("top-bottom"),"Right"===n?(t.classList.add("right"),e.classList.add("right"),i.classList.add("right")):(t.classList.remove("right"),e.classList.remove("right"),i.classList.remove("right"))):(t.classList.add("top-bottom"),t.classList.remove("right"),e.classList.add("top-bottom"),e.classList.remove("right"),i.classList.add("top-bottom"),i.classList.remove("right")),t.style.top="Bottom"===n?"auto":"Top"===n?"5px":this.isLegendGroup?r&&s?"45px":r||s?"25px":"5px":this.height/2-this.getHeight()/2+"px",this.isLegendGroup&&(t.style.height="calc(100%  - "+t.style.top+")"),i.style.top="Bottom"===n?"auto":"5px",e.style.top="Bottom"===n?"auto":"Top"!==n&&("Left"!==n&&"Right"!==n||this.api.getProperty("Annotations.ShowAnnotateControl"))?"25px":"5px",o.style.textAlign="Left"===n?"left":"right",a.style.textAlign="Left"===n?"left":"right",this.api.getProperty("Layers").some(function(t){return t.HighlightRules&&t.HighlightRules.some(function(t){return t.Show})})?(r=this.el.getElementsByClassName("GL-highlight-rule")[0],s=Math.max(this.getFileExporterWidth(),this.getWidth())+"px",r.style.left="Left"===n?s:"0px",r.style.right="Right"===n?s:"0px","Bottom"===n&&(t.style.bottom=this.getRulesHeight()-5+"px",e.style.bottom=t.style.bottom,i.style.bottom=t.style.bottom)):"Bottom"===n&&(t.style.bottom="5px",e.style.bottom=t.style.bottom,i.style.bottom=t.style.bottom)},n.prototype.updatePalette=function(n,o){var a=this,r=[];_.each(this.api.getProperty("Layers"),function(e,i){null!=(t=e.Palette)&&t.forEach(function(t,e){""===t.type&&(e=(t=I.PALETTE_DEFAULT)[e%t.length],a.api.setProperty("Layers."+i+".Palette."+i,e))});var t=_.findIndex(n,function(t){return t.getId()===e._Id}),t=n[t];t&&t.getLayerType()===V.Bounds?r[i]=t.getPaletteProperty():t&&t.isRegexOrWild()?(t.isEnabled()&&_.isEqual(t.getAllCols(),a.disabledColumns[i])&&(a.disabledColumns[i]=[]),r[i]=t.updateLayerPalette(a.disabledColumns[i],!1,o)):t&&(r[i]=[],a.disabledColumns[i]=[],t.updateLayerPalette([],!0),t.hasColorData())&&t.updateColumns([])}),this.tooltips.updateTooltipPalette(r)},n.prototype.updateTheme=function(t){this.color="Light"===t?"black":"white"},n.prototype.updateWildcards=function(t,e,i,n){t&&(n&&this.disabledColumns[e]||(this.disabledColumns[e]=i&&t.isEnabled()?[]:t.getAllCols()),t.updateColumns(this.disabledColumns[e],n))},n.prototype.doubleClickLegend=function(n,t,o,e){var a=this;this.selectedLegend&&!e?(this.selectedLegend="",this.layers.forEach(function(t,e){a.api.setProperty("Layers."+e+".Enabled",!0),t.isRegexOrWild()&&(a.disabledColumns[e]=[])})):(e||(this.selectedLegend=n),this.api.getProperty("Layers."+o+".Enabled")||this.api.setProperty("Layers."+o+".Enabled",!0),this.layers.forEach(function(t,e){var i=a.api.getProperty("Layers."+e+".LegendGroup"),i=!a.isLegendGroup||i!==n;e!==o&&i&&a.api.setProperty("Layers."+e+".Enabled",!1)}),t.isRegexOrWild()&&!e&&(this.disabledColumns[o]=t.getAllCols().filter(function(t){return t!==n})))},n.prototype.updateLegendGroupNames=function(t,e){var n=this,o=t.map(function(t){return t.Name}),a=this.tree.getNames();e.forEach(function(t,e){var i,t=t.LegendGroup;"None"!==t&&-1===o.indexOf(t)&&(i=a.indexOf(t),t=a.length===o.length?o[i]:"None",n.api.setProperty("Layers."+e+".LegendGroup",t))})},n.prototype.updateState=function(t,e,i){var t=t.getElementsByTagName("span")[0],n=this.layers[e],o=n.isEnabled(),a=n.isRegexOrWild(),r=n.hasColorData();this.setIgnoreSettings(!0),i&&!r?this.doubleClickLegend(t.innerHTML,n,e):(this.selectedLegend="")===t.style.textDecoration?(t.style.textDecoration="line-through",!a&&o&&this.api.setProperty("Layers."+e+".Enabled",!1),a&&(this.disabledColumns[e].length+1!==n.getAllCols().length&&!r||this.api.setProperty("Layers."+e+".Enabled",!1),r||this.disabledColumns[e].push(t.innerHTML))):(t.style.textDecoration="",o||this.api.setProperty("Layers."+e+".Enabled",!0),a&&(r?(this.api.setProperty("Layers."+e+".Enabled",!0),this.disabledColumns[e]=[]):this.disabledColumns[e].splice(this.disabledColumns[e].indexOf(t.innerHTML),1))),r&&this.render(!0),this.updateLayers(!0),!a&&n.getLayerType()!==V.Heatmap||(this.updatePalette(this.layers),this.layers[e].updateColumns(this.disabledColumns[e])),this.setIgnoreSettings(!1),this.appInvalidate(G.Process)},n.prototype.updateTreeState=function(t,e,i,n,o,a,r){var s=this.layers[t],l=(this.setIgnoreSettings(!0),this.checkedNode=!0,s.isRegexOrWild());i?(this.doubleClickLegend(n,s,t,o),this.appInvalidate(G.Process)):(this.selectedLegend="",a?e?(this.disabledColumns[t].splice(this.disabledColumns[t].indexOf(n),1),this.api.setProperty("Layers."+t+".Enabled",!0)):(this.disabledColumns[t].length+1===s.getAllCols().length&&(this.api.setProperty("Layers."+t+".Enabled",!1),this.appInvalidate(G.Process)),this.disabledColumns[t].push(n)):(this.api.setProperty("Layers."+t+".Enabled",e),this.updateLayers(!0),e&&(this.disabledColumns[t]=[]),this.appInvalidate(G.Process))),l&&(e||!r&&!e)&&(this.updatePalette(this.layers),s.updateColumns(this.disabledColumns[t])),this.setIgnoreSettings(!1)};var wt=n;function n(t,e,i,n,o,a,r,s){this.el=t,this.api=e,this.tooltips=i,this.appInvalidate=n,this.setIgnoreSettings=o,this.updateLayers=a,this.getFileExporterWidth=r,this.getAnnotateWidth=s,this.checkedNode=!1,this.color="black",this.disabledColumns=[],this.height=0,this.isLegendGroup=!1,this.layers=[],this.selectedLegend="",this.highlightRule=new Rt(this.api,this.el),this.tree=new Et(this.el,this.api,this.updateTreeState.bind(this),this.appInvalidate.bind(this)),this.legendDiv=this.el.getElementsByClassName("legend-div")[0],this.exportDiv=this.el.getElementsByClassName("export-div")[0],this.drawDiv=this.el.getElementsByClassName("draw-div")[0]}It.prototype.onAxisPan=function(t,e){var i=t.clientX-e.left,n=t.clientY-e.top,o=e.right-t.clientX,e=e.bottom-t.clientY,t=this.axis.getMargin(),a=i<t.x,r=o<t.z,s=n<t.y,t=e<t.w,a=a?"Left":r?"Right":s?"Top":t?"Bottom":"";return[new M(i,n,o,e),a]},It.prototype.onPanning=function(t,e,i,n,o,a,r){var s,l="",h="Top"===e||"Bottom"===e,e="Left"===e||"Right"===e;this.activePan||(this.activePan=t),e?l=this.calculatePanDirection(t.y,"y",this.activePan):h&&(l=this.calculatePanDirection(t.x,"x",this.activePan)),l&&(r=h?r.offsetWidth:r.offsetHeight,r=this.pixelDiff/r,(s=this.num-1)<0||(this.activePan=t,document.body.style.cursor=h?"e-resize":"n-resize",t=("Right"===l||"Left"===l?o:a)[s],o=i[s]||new F(0,1),a=n[s]||new F(0,1),i=(t.y-t.x)*(o.y-o.x)*r,n=(t.y-t.x)*(a.y-a.x)*r,o="Right"===l?-i:"Left"===l?i:0,a="Top"===l?-n:"Bottom"===l?n:0,i=new M(t.x+(h?o:0),t.x+(e?a:0),t.y+(h?o:0),t.y+(e?a:0)),this.onPan(i,"Right"===l?r:"Left"===l?-r:0,s,l)))},It.prototype.onPointDown=function(t,e){this.activePan=t;var i="Top"===e||"Bottom"===e,n="Left"===e||"Right"===e,o=this.axis.getAxes("x"),a=this.axis.getAxes("y"),r=this.axis.getAxes("x","Top"),s=this.axis.getAxes("x","Bottom"),l=this.axis.getAxes("y","Left"),h=this.axis.getAxes("y","Right"),p=0,u=0,c=i?this.axis.getSize(e,"x"):n?this.axis.getSize(e,"y"):[];_.each(c,function(t,e){0<Number(e)&&(c[e]=c[Number(e)-1]+c[e])}),"Right"===e&&(p=t.z),"Left"===e&&(p=t.x),"Top"===e&&(p=t.y),"Bottom"===e&&(p=t.w),_.each(c,function(t,e){if(p<=t)return u=c.length-Number(e),!1}),"Right"===e&&(u=a.indexOf(h[u-1])+1),"Left"===e&&(u=a.indexOf(l[u-1])+1),"Top"===e&&(u=o.indexOf(r[u-1])+1),"Bottom"===e&&(u=o.indexOf(s[u-1])+1),this.num=u},It.prototype.calculatePanDirection=function(t,e,i){if("y"===e){if(this.pixelDiff=Math.abs(i.y-t),i.y<t)return"Bottom";if(i.y>t)return"Top"}else{if(this.pixelDiff=Math.abs(i.x-t),i.x<t)return"Right";if(i.x>t)return"Left"}return""};var Bt=It;function It(t,e,i){this.api=t,this.axis=e,this.onPan=i,this.activePan=null,this.num=0,this.pixelDiff=0}o.prototype.getAxes=function(t,i){return i?_.map(this[t],function(t,e){if(t.position===i)return Number(e)+1}).filter(function(t){return void 0!==t}):_.map(this[t],function(t,e){return Number(e)+1})},o.prototype.getAxisType=function(t,e){var i=[];return[this.api.getProperty(t+"."+e+X.PROP_SEL_MIN),this.api.getProperty(t+"."+e+X.PROP_SEL_MAX),this.api.getProperty(t+"."+e+X.PROP_MIN),this.api.getProperty(t+"."+e+X.PROP_MAX)].filter(function(t){return t}).forEach(function(t){t=k.Tools.inferKdbTypeFromDashString(t),t=t?Number(t.slice(-2)):null;t&&i.push(t)}),i.length?i:[E.Float]},o.prototype.getBounds=function(t,e,i,n){var o=this.api.getProperty(e+"."+i+X.PROP_BEGIN_ZERO),a=this.api.getProperty(e+"."+i+X.PROP_USE_MIN_MAX),r=this.api.getProperty(e+"."+i+X.PROP_MIN),e=this.api.getProperty(e+"."+i+X.PROP_MAX),n=(a&&(i=k.Tools.inferKdbTypeFromDashString(r),s=k.Tools.inferKdbTypeFromDashString(e),i=i?Number(i.slice(-2)):n,s=s?Number(s.slice(-2)):n,r=/\S/.test(r)?Y.convertStringToJsScalar(r,i):t.x,e=/\S/.test(e)?Y.convertStringToJsScalar(e,s):t.y),a?new F(r,e):t),i=t.x<0,s=t.y<0;return new F(!o||s||i?n.x:0,o&&s?0:n.y)},o.prototype.getMargin=function(){return this.margin},o.prototype.getSelectionZoomBounds=function(t,e,i,n,o){var a,r,s=this.api.getProperty(e+"."+i+X.PROP_SEL_MIN),l=this.api.getProperty(e+"."+i+X.PROP_SEL_MAX),h=t?t.x:0,t=t?t.y:1,p=k.Tools.inferKdbTypeFromDashString(s),u=k.Tools.inferKdbTypeFromDashString(l),p=p?Number(p.slice(-2)):n,u=u?Number(u.slice(-2)):n,n=/\S/.test(s)?Y.convertStringToScalar(s,Y.ipcTemp(p)):"",c=/\S/.test(l)?Y.convertStringToScalar(l,Y.ipcTemp(u)):"";return"number"!=typeof n&&"bigint"!=typeof n||(h=Y.convertToJsScalar(p,n)),"number"!=typeof c&&"bigint"!=typeof c||(t=Y.convertToJsScalar(u,c)),this.api.getProperty(e+"."+i+X.PROP_TYPE)===X.TYPE_CATEGORY&&o&&o[1]?s||l?(a=p===E.Symbol?s:h,r=u===E.Symbol?l:t,n=o[0].findIndex(function(t){return _.isEqual(t,a)}),c=o[0].findIndex(function(t){return _.isEqual(t,r)}),new F(o[1][n]||0,o[1][c]||1)):new F(0,1):new F(h,t)},o.prototype.getSize=function(e,t){var i,n,o=this,a=("x"===t?this.x:this.y).filter(function(t){return t.position===e&&t.display}),r=this.legend.getHeight(),s=this.legend.getPosition();return"x"===t?(t=this.legend.getRulesHeight(),i="Top"===e&&"Top"===s?r+5:t+("Bottom"===s?r:0),_.map(a,function(t,e){return(t.display?t.getBaseSize(t.fontSize):0)+(0===e?i:0)})):(t=this.legend.getWidth(),n="Left"===e?"Left"===s?t:0:this.margin.z-this.getWidth(a),_.map(a,function(t,e){var i=_.maxBy(o.yTicks[e],function(t){return t.label.length}),i=t.measureText(o.ctx,(null==i?void 0:i.label)||"");return(t.display?t.getBaseSize(i.width):0)+(0===e?n:0)}))},o.prototype.onResize=function(){this.renderAll=!0},o.prototype.onSettingsChange=function(t,e){"Xaxes"===t&&(this.x[e]=new X(e,this.api,"Xaxes."+e)),"Yaxes"===t&&(this.y[e]=new X(e,this.api,"Yaxes."+e)),this.renderAll=!0},o.prototype.render=function(i,n,t,e,o){var a,r,s,l,h,p,u=this,o=(this.currentTickLabels=o,this.x.length!==t.length&&(this.x=[],_.each(t,function(t,e){u.x[e]=new X(e,u.api,"Xaxes."+e)})),this.y.length!==e.length&&(this.y=[],_.each(e,function(t,e){u.y[e]=new X(e,u.api,"Yaxes."+e)})),this.getSimpleTicks(t,e),this.x.length&&_.some(this.x,function(t){return!0===t.display})),c=this.y.length&&_.some(this.y,function(t){return!0===t.display}),d=this.y.filter(function(t){return"Right"===t.position&&t.display}),y=this.legend.getPosition(),g=this.legend.getWidth(),f=this.legend.getHeight(),m=g!==this.legendWidth,m=i!==this.width||n!==this.height||this.renderAll||m,P=(i!==this.width&&(this.width=i,this.canvas.width=i),n!==this.height&&(this.height=n,this.canvas.height=n),m&&(this.updateTheme(),this.ctx.clearRect(0,0,i,n)),_.some(this.x,function(t,e){return t.bounds&&u.xBounds[e]&&(t.bounds.x!==u.xBounds[e].x||t.bounds.y!==u.xBounds[e].y)})),x=_.some(this.y,function(t,e){return t.bounds&&u.yBounds[e]&&(t.bounds.x!==u.yBounds[e].x||t.bounds.y!==u.yBounds[e].y||!u.currentTicksInit&&(null==(t=u.currentTickLabels[e])?void 0:t.length))}),c=((m||x)&&c&&(x=this.margin,c=X.TICKSIZE,this.ctx.clearRect(0,x.y-c,x.x-X.TICKSIZE,n-x.y-x.w+2*c),this.ctx.clearRect(i-x.z+c,x.y-c,x.z+c,n-x.y-x.w+2*c),this.ctx.clearRect(x.x,x.y,i-x.z-x.x,n-x.y-x.w),this.ctx.clearRect(x.x-c,x.y-c,c+.5,n-x.y+2*c-x.w),this.ctx.clearRect(i-x.z-2,x.y-c-1,c+2,n-x.y+c-x.w+1),this.ctx.clearRect(i-x.z,x.y-1,c,n-x.y+X.TICKSIZE+1-x.w),_.each(e,function(t,e){u.api.getProperty("Yaxes."+e+X.PROP_DISPLAY)&&u.renderY(e,i,n,y,g,f)})),this.m.x!==this.margin.x||this.m.z!==this.margin.z),o=((m||c||P)&&o&&(a=this.margin,x=X.TICKSIZE,e=this.calcTickWidth("Left"),o=this.calcTickWidth("Right"),p=_.some(this.y,function(t){return!0===t.display&&"Left"===t.position}),r=_.some(this.y,function(t){return!0===t.display&&"Right"===t.position}),s=_.some(this.x,function(t){return!0===t.display&&"Top"===t.position}),l=a.x-.5,h=a.z,e&&(e>a.x||!p)&&(l=e),o&&(o>a.z||!r)&&(h=e),this.ctx.clearRect(0,n-a.w+X.TICKSIZE,i,a.w-1+X.TICKSIZE),s&&this.ctx.clearRect(0,0,i,a.y-(!c||m||P?x:0)),this.ctx.clearRect(l,n-a.w,(p=r?i-l-h:i)+1,X.TICKSIZE),s&&this.ctx.clearRect(l,a.y-X.TICKSIZE,p+("Top"===y?.5:"Right"===y?-1:-.5),X.TICKSIZE-1),_.each(t,function(t,e){u.api.getProperty("Xaxes."+e+X.PROP_DISPLAY)&&u.renderX(e,i,n,y,r?a.z:g,f)})),this.margin),e=d.length?i-o.x-o.z-1:i;return this.ctx.clearRect(o.x,o.y-.5,e,n-o.w-o.y),this.drawXGridlines(i,n),this.drawYGridlines(i,n),this.ctx.globalAlpha=1,this.updateTheme(),_.each(this.x,function(t,e){return u.xBounds[e]=t.bounds}),_.each(this.y,function(t,e){return u.yBounds[e]=t.bounds}),this.m=this.margin,this.renderAll=!1,this.legendWidth=g,this.margin},o.prototype.renderAxes=function(){this.renderAll=!0},o.prototype.updateTheme=function(t){this.theme=t||this.theme},o.prototype.calcTickWidth=function(t){var i=this,e=0,t="Left"===t?_.map(this.x,function(t){return _.first(i.xTicks[t.index])}):_.map(this.x,function(t){return _.last(i.xTicks[t.index])});return e=t.length&&(t=_.map(t,function(t){return t?t.label:""}),t=_.max(_.map(t,function(t,e){return i.x[e].measureText(i.ctx,t).width})))?Math.ceil(t/2)+1:e},o.prototype.getSimpleTicks=function(t,e){var n=this;this.xTicks=new Array(t.length),this.yTicks=new Array(e.length),_.each(t,function(t,e){var i=n.api.getProperty("Xaxes."+e+X.PROP_DISPLAY);n.xTicks[e]=i?n.x[e].getSimpleTicks():[]}),_.each(e,function(t,e){var i=n.api.getProperty("Yaxes."+e+X.PROP_DISPLAY);n.yTicks[e]=i?n.y[e].getSimpleTicks():[]})},o.prototype.getStepSize=function(t,e,i){e=e&&e<t?Math.ceil(t/e):1;return e=i.propertyCache[X.PROP_TYPE]===X.TYPE_CATEGORY&&(i=i.getTicksLength())<t&&e<(t=Math.ceil(t/i))?t:e},o.prototype.drawCurrentTickLabels=function(t,s,l,h,p,u){var c=this,t=(this.ctx.textBaseline="middle",this.ctx.textAlign="Left"===p.position?"right":"left",this.currentTickLabels[t]);null!=t&&t.length&&(this.currentTicksInit=!0,t.forEach(function(t){t.forEach(function(t){var e=Number(t[0]),i=(e-Number(p.bounds.x))/(Number(p.bounds.y)-Number(p.bounds.x)),i=s-l*i,n=h?-5:5,o=p.measureText(c.ctx,e.toString()),a=u+3*(h?-1:1),r=i-11,o=(c.ctx.beginPath(),o.width*(h?-1:1)+2.2*n);c.ctx.rect(a+n,r,o,19),c.ctx.moveTo(a+n,r),c.ctx.lineTo(a+n,19+r),c.ctx.lineTo(a,10+r),c.ctx.fillStyle=t[1],c.ctx.fill(),c.ctx.fillStyle="#FFFFFF",c.ctx.fillText(e.toString(),a+2*n,i)})}))},o.prototype.drawXGridlines=function(h,p){var u=this;_.each(this.x,function(t,e){var i=u.xTicks[e];if(i){var n=h-u.margin.x-u.margin.z-2,o=t.getGridlines(),e=_.maxBy(i,function(t){return t.label.length}),e=t.measureText(u.ctx,(null==e?void 0:e.label)||"").width+12,e=0<Math.round(n/e)?Math.round(n/e):1,a=u.getStepSize(i.length,e,t),e=(u.ctx.beginPath(),o.color),t=e||("Dark"===u.theme?"#ffffff":"#000000");u.ctx.strokeStyle=t,u.ctx.globalAlpha=void 0!==o.opacity?o.opacity/100:.15;for(var r=0;r<i.length;r+=a){var s=Math.round(u.margin.x+i[r].pos*n)-.5,l=(0===r&&o.offset&&(l=s/2)>u.margin.x&&(u.ctx.moveTo(l,p-u.margin.w),u.ctx.lineTo(l,u.margin.y)),o.offset?r===i.length-1?u.canvas.width-u.margin.z:u.margin.x+i[r+1].pos*n:0),s=o.offset?s+Math.abs(s-l)/2:s;s<h-u.margin.z&&(u.ctx.moveTo(s,p-u.margin.w),u.ctx.lineTo(s,u.margin.y))}u.ctx.stroke(),u.ctx.closePath()}})},o.prototype.drawYGridlines=function(p,u){var c=this;_.each(this.y,function(t,e){var i=c.yTicks[e];if(i){for(var n=u-c.margin.w,o=n-c.margin.y,a=t.getGridlines(),e=(c.ctx.beginPath(),a.color),e=e||("Dark"===c.theme?"#ffffff":"#000000"),r=(c.ctx.strokeStyle=e,c.ctx.globalAlpha=void 0!==a.opacity?a.opacity/100:.15,c.getStepSize(i.length,null,t)),s=0;s<i.length;s+=r){var l=Math.round(n-i[s].pos*o),h=a.offset?0===s?n:n-i[s-1].pos*o:0,h=a.offset?h-Math.abs(l-h)/2-.5:l+.5;c.ctx.moveTo(c.margin.x,h),c.ctx.lineTo(p-c.margin.z-1,h)}c.ctx.stroke(),c.ctx.closePath()}})},o.prototype.fixOverlappingTriggerBreak=function(t,n,o,a){var r=[];return t.forEach(function(t){var e,i;(!r[r.length-1]||(e=t.pos,i=r[r.length-1].pos,n<o+e*a-(o+i*a)))&&r.push(t)}),r},o.prototype.getHeight=function(t){return _.sumBy(t,function(t){return t.display?t.getBaseSize(t.fontSize):0})},o.prototype.getWidth=function(t){var n=this;return _.sumBy(t,function(t){var e=null!=(e=n.currentTickLabels[t.index])&&e.length?10:0,i=n.yTicks[t.index],i=_.maxBy(i,function(t){return t.label.length}),i=t.measureText(n.ctx,(null==i?void 0:i.label)||"");return t.display?t.getBaseSize(i.width)+e:0})},o.prototype.renderX=function(t,e,i,n,o,a){function r(t,e,i,n){return e<=t&&!i?t:e<=t&&i?n+(t-n):n}var s=this.x[t],l=this.x.filter(function(t){return"Top"===t.position&&t.display}),h=this.x.filter(function(t){return"Bottom"===t.position&&t.display}),p=this.getHeight(l)+("Top"===n?a:0)+5,u="Top"===s.position,c=_.some(this.y,function(t){return!0===t.display&&"Left"===t.position}),d=_.some(this.y,function(t){return!0===t.display&&"Right"===t.position}),y=c?this.margin.x:"Left"===n?o:0,o="Right"===n?o:this.margin.z,g=this.legend.getRulesHeight(),f=(f=this.getHeight(h)+g+("Bottom"===n?a:0))||5,m=u?("Top"===n?a:0)+5+this.getHeight(l.slice(l.indexOf(s))):this.margin.y,P=u?0:this.getHeight(h.slice(h.indexOf(s)))+g+("Bottom"===n?a:0),l=r(this.calcTickWidth("Left"),this.margin.x,c,y),h=r(this.calcTickWidth("Right"),this.margin.z,d,o),x=y=y<l?l:y,v=e-y-(o=o<h?h:o)-3,O=this.xTicks[t],g=_.maxBy(O,function(t){return t.label.length}),n=s.measureText(this.ctx,(null==g?void 0:g.label)||"").width+12,a=(s.isTriggerBreakApplied()&&(O=this.fixOverlappingTriggerBreak(O,n,x,v),this.xTicks[t]=O),0<Math.round(v/n)?Math.round(v/n):1),b=this.getStepSize(O.length,a,s),c=(c=this.api.getProperty("Xaxes."+t+X.PROP_COLOR))||("Light"===this.theme?"#000000":"#ffffff");this.ctx.strokeStyle=c,this.ctx.fillStyle=c,this.ctx.beginPath(),this.ctx.moveTo(y-.5,u?m-.5:i-P+.5),this.ctx.lineTo(e-o-.5,u?m-.5:i-P+.5);for(var T=0;T<O.length;T+=b){var A=Math.round(x+O[T].pos*v)+.5;this.ctx.moveTo(A,.5+(u?m:i-P)),this.ctx.lineTo(A,.5+(u?m-X.TICKSIZE:i-P+X.TICKSIZE))}this.ctx.stroke(),this.ctx.closePath(),this.ctx.textBaseline=u?"bottom":"top",this.ctx.textAlign="center",this.ctx.font=s.fontSize+"px "+X.FONTFACE;for(T=0;T<O.length;T+=b)0===(A=x+O[T].pos*v)&&(A=10),this.ctx.fillText(O[T].label,A+.5,u?m-X.TICKSIZE-.5:i-P+X.TICKSIZE+.5);s.displayTitle&&(this.ctx.textBaseline="middle",this.ctx.font=s.titleFontSize+"px "+X.FONTFACE,this.ctx.fillText(s.title,(e+y-o)/2,u?m-s.titleFontSize-15:i-P+s.titleFontSize+15)),this.margin=new M(y,p,o,f)},o.prototype.renderY=function(t,e,i,n,o,a){var r=this.y[t],s=this.yTicks[t],l=this.x.length&&_.some(this.x,function(t){return t.display}),h=this.getHeight(this.x.filter(function(t){return"Bottom"===t.position})),p=this.getHeight(this.x.filter(function(t){return"Top"===t.position})),u="Left"===r.position,c=this.y.filter(function(t){return"Left"===t.position&&t.display}),d=this.y.filter(function(t){return"Right"===t.position&&t.display}),y=this.getWidth(c)+("Left"===n?o:0),g=this.getWidth(d)+("Right"===n?o:0),f=g,l=Math.round(l?h:5)+this.legend.getRulesHeight()+("Bottom"===n?a:0),h=_.maxBy(s,function(t){return t.label.length}),h=r.measureText(this.ctx,(null==h?void 0:h.label)||""),p=p+(h.emHeightAscent||r.fontSize/2)+("Top"===n?a:0),a=this.getWidth(c.slice(c.indexOf(r)))+("Left"===n?o:0),f=u?f:this.getWidth(d.slice(d.indexOf(r)))+("Right"===n?o:0),m=this.calcTickWidth("Left")+("Left"===n?o:0),c=(m&&(c.length?y<m&&(y+=b=m-y,a+=b):y=m),this.calcTickWidth("Right")+("Right"===n?o:0)),P=(c&&(d.length?g<c&&(g+=b=c-g,f+=b):g=c),l=l||8,p=p||8,Math.floor(u?a:e-f+.5)+.5),x=i-l,v=x-p,O=this.getStepSize(s.length,null,r),m=(m=this.api.getProperty("Yaxes."+t+X.PROP_COLOR))||("Light"===this.theme?"#000000":"#ffffff");this.ctx.strokeStyle=m,this.ctx.fillStyle=m,this.ctx.beginPath();var o=p-("Top"===n?2:6),d=1+x,b=d-o;this.ctx.moveTo(P-1,o),this.ctx.lineTo(P-1,d);for(var T=0;T<s.length;T+=O){var A=Math.round(x-s[T].pos*v)+.5;this.ctx.moveTo(P-1,A),this.ctx.lineTo(u?P-X.TICKSIZE-1:P+X.TICKSIZE,A)}this.ctx.stroke(),this.ctx.closePath(),this.ctx.textBaseline="middle",this.ctx.textAlign="Left"===r.position?"right":"left",this.ctx.font=r.fontSize+"px "+X.FONTFACE;for(T=0;T<s.length;T+=O){A=x-s[T].pos*v+.5;this.ctx.fillText(s[T].label,u?P-X.TICKSIZE:P+X.TICKSIZE,A)}r.displayTitle&&(this.ctx.textAlign="center",this.ctx.textBaseline="bottom",this.ctx.font=r.titleFontSize+"px "+X.FONTFACE,this.ctx.save(),this.ctx.translate(u?Math.abs(r.titleFontSize-P-2)-h.width:P+r.titleFontSize+h.width-2,(i-l+p)/2),this.ctx.rotate(u?-Math.PI/2:Math.PI/2),this.ctx.fillText(r.title,0,0),this.ctx.restore()),this.drawCurrentTickLabels(t,d,b,u,r,P),this.margin=new M(y,p,g,l)};var Nt=o;function o(t,e,i){this.api=t,this.canvas=e,this.legend=i,this.x=[],this.y=[],this.currentTickLabels={},this.currentTicksInit=!1,this.margin=new M(0,0,0,0),this.legendWidth=0,this.m=new M(0,0,0,0),this.xBounds=[],this.yBounds=[],this.renderAll=!0,this.xTicks=[],this.yTicks=[];t=this.canvas.getContext("2d");if(!t)throw new Error("ChartGL: failed to get 2D context");this.ctx=t}c.prototype.clearRangeLines=function(t){this.zoomEnabled||(this.removeDragLine(),this.removeLines(),this.removeMask(),t&&(this.zoomEnabled=!0))},c.prototype.drawRangeLines=function(){this.zoomEnabled&&(this.zoomEnabled=!1),this.clearRangeLines(),this.bounds=this.el.getBoundingClientRect();var t=this.bounds.width,e=t*this.zoomRegion.x,t=1===this.zoomRegion.z?t-2:t*this.zoomRegion.z,i=(null==(i=this.downPoint)?void 0:i.y)||this.bounds.height/2,n=this.bounds.bottom-this.bounds.top;this.dragLine=this.dragLine||this.createDragLine(),this.lines=this.lines||this.createLines(),this.removeRect(),this.dragLine.x1.baseVal.value=.5+e,this.dragLine.y1.baseVal.value=i+.5,this.dragLine.x2.baseVal.value=.5+t,this.dragLine.y2.baseVal.value=i+.5,this.lines[0].x1.baseVal.value=.5+e,this.lines[0].y1.baseVal.value=0,this.lines[0].x2.baseVal.value=.5+e,this.lines[0].y2.baseVal.value=n,this.lines[1].x1.baseVal.value=.5+t,this.lines[1].y1.baseVal.value=0,this.lines[1].x2.baseVal.value=.5+t,this.lines[1].y2.baseVal.value=n},c.prototype.getZoomDirection=function(){return this.direction},c.prototype.isDragging=function(){return null!==this.dragBounds},c.prototype.remove=function(){this.el.removeEventListener("mousedown",this.mouseDownHandler),document.removeEventListener("mousemove",this.mouseOverHandler,{capture:!0}),document.removeEventListener("mouseup",this.mouseUpHandler,{capture:!0}),document.removeEventListener("mousemove",this.mouseMoveHandler,{capture:!0})},c.prototype.resize=function(t,e,i,n){this.el.style.left=t+"px",this.el.style.top=e+"px",this.el.style.width=i+"px",this.el.style.height=n+"px";t=this.el.getBoundingClientRect();this.zoomEnabled||_.isEqual(t,this.bounds)||this.drawRangeLines()},c.prototype.updateRangeSelector=function(t){this.zoomRegion=new M(t.x,0,t.y,1)},c.prototype.createMask=function(){var t=document.createElementNS(c.SVG_NS,"path");return this.el.append(t),t},c.prototype.createDragLine=function(){var t=document.createElementNS(c.SVG_NS,"line");return t.setAttribute("class","drag-line"),t.setAttribute("stroke-dasharray","8,4"),this.el.append(t),t},c.prototype.createLines=function(){var e=this;return _.times(2,function(){var t=document.createElementNS(c.SVG_NS,"line");return e.el.append(t),t})},c.prototype.createRect=function(){var t=document.createElementNS(c.SVG_NS,"rect");return t.style.fill="none",this.el.append(t),t},c.prototype.onOverlayMouseDown=function(t){return 0!==t.button?this.onOverlayMouseUp(t):this.clickTime&&Date.now()-this.clickTime<325?(this.onOverlayMouseUp(t),this.zoomRegion=new M(0,0,1,1),this.removeMask(),this.drawRangeLines(),this.onReset()):(this.clickTime=Date.now(),this.bounds=this.el.getBoundingClientRect(),this.downPoint=new F(t.clientX-this.bounds.left,t.clientY-this.bounds.top),document.body.style["pointer-events"]="none",document.addEventListener("mouseup",this.mouseUpHandler,{capture:!0}),document.addEventListener("mousemove",this.mouseMoveHandler,{capture:!0}),t.preventDefault(),void t.stopPropagation())},c.prototype.onOverlayMouseMove=function(t){if(t.stopPropagation(),this.bounds&&this.downPoint){var e,i=this.bounds.right-this.bounds.left,n=this.bounds.bottom-this.bounds.top,o=Y.limitWithin(t.clientX,this.bounds.left,this.bounds.right)-this.bounds.left,a=Y.limitWithin(t.clientY,this.bounds.top,this.bounds.bottom)-this.bounds.top,r=Math.min(this.downPoint.x,o),s=Math.min(this.downPoint.y,a),l=Math.abs(this.downPoint.x-o),h=Math.abs(this.downPoint.y-a),t=((t=e=e||{})[t.XY=0]="XY",t[t.X=1]="X",t[t.Y=2]="Y",e.XY);switch(this.zoomEnabled?l<c.SNAP_SZ&&h<c.SNAP_SZ?((p=l/h)<c.ASPECT_RATIO||1/c.ASPECT_RATIO<p)&&(t=p<1?e.Y:e.X):l<c.SNAP_SZ?t=e.Y:h<c.SNAP_SZ&&(t=e.X):t=e.X,t){case e.X:s=0,h=n;break;case e.Y:r=0,l=i}this.dragBounds=new M(r,s,r+l,s+h);var p=Y.calculateBoundsDiagonal(this.dragBounds);if(0<p?(this.mask=this.mask||this.createMask(),this.mask.setAttribute("d","M0,0H"+i+"V"+n+"H0V0M"+(Math.round(r)+.5)+","+(Math.round(s)+.5)+"v"+h+"h"+l+"v-"+h+"h-"+l+"Z")):this.removeMask(),15<p)switch(this.dragLine=this.dragLine||this.createDragLine(),t){case e.X:this.direction="x",this.lines=this.lines||this.createLines(),this.removeRect(),this.dragLine.x1.baseVal.value=this.downPoint.x+.5,this.dragLine.y1.baseVal.value=this.downPoint.y+.5,this.dragLine.x2.baseVal.value=.5+o,this.dragLine.y2.baseVal.value=this.downPoint.y+.5,this.lines[0].x1.baseVal.value=this.downPoint.x+.5,this.lines[0].y1.baseVal.value=0,this.lines[0].x2.baseVal.value=this.downPoint.x+.5,this.lines[0].y2.baseVal.value=n,this.lines[1].x1.baseVal.value=.5+o,this.lines[1].y1.baseVal.value=0,this.lines[1].x2.baseVal.value=.5+o,this.lines[1].y2.baseVal.value=n;break;case e.Y:this.direction="y",this.lines=this.lines||this.createLines(),this.removeRect(),this.dragLine.x1.baseVal.value=this.downPoint.x+.5,this.dragLine.y1.baseVal.value=this.downPoint.y+.5,this.dragLine.x2.baseVal.value=this.downPoint.x+.5,this.dragLine.y2.baseVal.value=.5+a,this.lines[0].x1.baseVal.value=0,this.lines[0].y1.baseVal.value=this.downPoint.y+.5,this.lines[0].x2.baseVal.value=i,this.lines[0].y2.baseVal.value=this.downPoint.y+.5,this.lines[1].x1.baseVal.value=0,this.lines[1].y1.baseVal.value=.5+a,this.lines[1].x2.baseVal.value=i,this.lines[1].y2.baseVal.value=.5+a;break;default:this.direction="xy",this.rectangle=this.rectangle||this.createRect(),this.removeLines(),this.dragLine.x1.baseVal.value=this.downPoint.x+.5,this.dragLine.y1.baseVal.value=this.downPoint.y+.5,this.dragLine.x2.baseVal.value=.5+o,this.dragLine.y2.baseVal.value=.5+a,this.rectangle.x.baseVal.value=this.downPoint.x<o?this.downPoint.x+.5:.5+o,this.rectangle.y.baseVal.value=this.downPoint.y<a?this.downPoint.y+.5:.5+a,this.rectangle.width.baseVal.value=l,this.rectangle.height.baseVal.value=h}else this.removeDragLine(),this.removeLines(),this.removeRect()}},c.prototype.onOverlayMouseOver=function(t){var e=this.el.getBoundingClientRect();if(t.clientX<e.left||t.clientX>e.right||t.clientY<e.top||t.clientY>e.bottom)return this.onOver(null);var i=t.clientX-e.left,t=t.clientY-e.top;this.onOver(new F(i/(e.right-e.left),t/(e.top-e.bottom)))},c.prototype.onOverlayMouseUp=function(t){var e;this.bounds&&(document.body.style["pointer-events"]="auto",document.removeEventListener("mouseup",this.mouseUpHandler,{capture:!0}),document.removeEventListener("mousemove",this.mouseMoveHandler,{capture:!0}),t.stopPropagation(),this.dragBounds&&Y.calculateBoundsDiagonal(this.dragBounds)>c.SNAP_SZ/3?(t=this.bounds.right-this.bounds.left,e=this.bounds.bottom-this.bounds.top,this.zoomRegion=new M(this.dragBounds.x/t,this.dragBounds.y/e,this.dragBounds.z/t,this.dragBounds.w/e),this.onZoom(this.zoomRegion)):this.onClick(),this.zoomEnabled&&(this.removeMask(),this.removeDragLine(),this.removeLines(),this.removeRect()),this.dragBounds=null)},c.prototype.removeDragLine=function(){this.dragLine&&this.el.removeChild(this.dragLine),this.dragLine=void 0},c.prototype.removeLines=function(){var e=this;this.lines&&this.lines.forEach(function(t){return e.el.removeChild(t)}),this.lines=void 0},c.prototype.removeRect=function(){this.rectangle&&this.el.removeChild(this.rectangle),this.rectangle=void 0},c.prototype.removeMask=function(){this.mask&&this.el.removeChild(this.mask),this.mask=void 0},c.SVG_NS="http://www.w3.org/2000/svg",c.SNAP_SZ=28,c.ASPECT_RATIO=.45;var kt=c;function c(t,e,i,n,o){this.direction="",this.dragBounds=null,this.zoomEnabled=!0,this.zoomRegion=new M(0,0,1,1),this.el=t,this.onOver=e,this.onZoom=i,this.onReset=n,this.onClick=o,this.mouseDownHandler=this.onOverlayMouseDown.bind(this),this.mouseUpHandler=this.onOverlayMouseUp.bind(this),this.mouseMoveHandler=this.onOverlayMouseMove.bind(this),this.mouseOverHandler=this.onOverlayMouseOver.bind(this),this.el.addEventListener("mousedown",this.mouseDownHandler),document.addEventListener("mousemove",this.mouseOverHandler,{capture:!0})}Ft.calcBarData=function(t,e,i,n,o){for(var a=null!=n&&n.length?n:Array(t.length),r=Y.getRange(t),s=Y.getMidrange(new F(r[0],r[1]),t.qtype),l=null!=n&&n.length?n.length:0;l<t.length;l++){var h=e(t,l);!o&&Y.isNull(h,i)&&(h=0),isNaN(Number(h))||(h=Number(s?Y.toBigInt(h)-s:h)),a[l]=h}return a},Ft.convertBarsOrLineFillData=function(t,e){var i,n,o=Y.isLong(e)&&t.hash&&"bigint"==typeof t.hash(0);return i=t,t=e,n=o,e=Y.getNullVal(t),{scalar:t=Y.isString(t)?function(t,e){return Y.getColValue(i,e)}:Y.isLong(t)?function(t,e){return n?i.getScalar(e):(e=i.getLegacyScalar(e),Y.isNull(e)?e.toString():Y.toBigInt(e))}:function(t,e){return Number(i.getScalar(e))},nullVal:e}},Ft.convertSteppedData=function(t,e,i){i="Before"===i.steppedLine;return"x"===e?i?K.drawSteppedXLine(t):K.drawSteppedYLine(t):"y"===e?i?K.drawSteppedYLine(t):K.drawSteppedXLine(t):t},Ft.getBoundsData=function(t){var e=t.x1,i=t.x2,n=Ft.convertBarsOrLineFillData(e,e.qtype),e=Ft.calcBarData(e,n.scalar,n.nullVal,null,!0),n=Ft.convertBarsOrLineFillData(i,i.qtype),i=Ft.calcBarData(i,n.scalar,n.nullVal,null,!0);return Z.drawXBounds(e,i,t.palette,t.opacity)},Ft.getSpanGapsInfo=function(t,e,i){return t===X.TYPE_CATEGORY?{col:i,scalar:function(t,e){return t[e]}}:{col:e,scalar:(t=Ft.convertBarsOrLineFillData(e,e.qtype)).scalar,nullVal:t.nullVal}},Ft.isDoubleOrLongTemporal=function(t){return t===E.DateTime||t===E.Timestamp||t===E.Timespan};var S=Ft;function Ft(){}O.prototype.getShader=function(t,e,i,n,o,a,r,s){e=C.getShader(t,e,i,n,o,!r&&void 0!==(s||this.colorBuffers[a]),void 0!==this.sizeBuffer);this.shaders[a]=e,t.useProgram(e.Program)},O.prototype.processHeatmapData=function(n,o,t,e){var a=this,r={},s=[],e=(Object.keys(n).forEach(function(t,e){var i=n[t];(n&&"color"!==t||!n)&&(i=a.convertData(o,i,"x1"===t||"x2"===t||"score"===t?"x":"y",0,V.Heatmap,n),"score"===t?s=i:r[t]=i)}),e&&null!=e&&e.length||(e=j.calcColors(s,n.color,n.opacity),this.setColorArray(!1,!0,[e],t,!1)),j.calcVals(r.x1,r.x2,"x")),i=j.calcVals(r.y1,r.y2,"y");this.buffers[0]=C.createBuffer(t,this.getXData(e)),this.buffers[1]=C.createBuffer(t,this.getYData(i)),this.getShader(t,o,E.Float,E.Float,!1,0)},O.prototype.processBaselineOrBounds=function(t,e,i,n,o,a,r){var s=t===V.Baseline,l=s?e.baselineInfo.axis:"x",n=this.convertData(i,"x"===l?n:o[0],l,0,t,e,s?r:void 0),t=(this.buffers["x"===l?0:1]=C.createBuffer(a,n),this.boundsColors&&(this.colorBuffers[0]=C.createBuffer(a,new Float32Array(Array.prototype.concat.apply([],this.boundsColors)))),null!=(o=e.x1)&&o.qtype?e.x1.qtype:this.tx),l=!S.isDoubleOrLongTemporal(t)||r.x?E.Float:t,n=r.y||!s?E.Float:this.tys[0];this.getShader(a,i,l,n,!1,0)},O.prototype.processData=function(i,o,t,n,a,r,s,l,e,h,p,u,c){var d,y,g,f=this,m=t||o.spanGaps||"Stepped"===o.interpolation,P=S.isDoubleOrLongTemporal(this.tx),t=o.mergedBounds;if(i===V.Candlestick&&t&&null!=(t=o.size)&&t.x){var x=n.map(function(t){return t.qtype}).map(function(t){return Y.isInt(t)?E.Float:t}),v=S.isDoubleOrLongTemporal(x[0]);this.processCandlesticks(n,a,r,s,o);for(var O=0;O<this.shaders.length;O++){var b=P?this.tx:E.Float,T=v?x[0]:E.Float;this.getShader(r,a,b,T,l,O,0===O,this.colorBuffers[0])}}else i===V.Heatmap?this.processHeatmapData(o,a,r,u):i===V.Baseline&&o.baselineInfo||i===V.Bounds&&o.x1&&o.x2&&o.yRange?this.processBaselineOrBounds(i,o,a,s,n,r,c):(d=i===V.Bar||i===V.Waterfall,y=0,this.yCategoryData=[[],[]],i===V.Line&&(o.x=s),d&&o.barGrouping&&1<n.length?n.forEach(function(t,e){var i=f.convertData(a,s,"x",e,V.Bar,o,c);f.buffers[e]=C.createBuffer(r,i)}):i===V.Line||o.spanGaps||(t=this.convertData(a,s,"x",0,i,o,c),this.buffers[0]=C.createBuffer(r,t)),this.stackedYData=[],this.waterfallColors=[],g=_.clone(this.buffers).length,n.forEach(function(t,e){t=f.convertData(a,t,"y",e,i,o,c);i===V.Line||o.spanGaps?(f.buffers[y]=C.createBuffer(r,t[0]),f.buffers[y+1]=C.createBuffer(r,t[1]),y+=2):(e=d&&o.barGrouping&&1<n.length?e+(g-1):e+1,f.buffers[e]=C.createBuffer(r,t))}),null!=(t=this.waterfallColors)&&t.length?this.setColorArray(!1,!0,this.waterfallColors,r,!1):(t=p?h:u&&u.length?u:e&&e.length?e:null)&&t.length&&(i===V.Waterfall?o.waterfallInfo.colorArray=t:(u=!(!(h=p&&p[0])||!h.fill||"No Fill"===h.fill),e="Stepped"===o.interpolation,h=!!p&&p[1],p=i===V.LineBubble,this.setColorArray(u,m,t,r,h,e,p,o))),n.forEach(function(t,e){var i=S.isDoubleOrLongTemporal(f.tys[e]),n=!m&&!c.x||P?f.tx:E.Float,i=!m&&!c.y||i?f.tys[e]:E.Float;f.getShader(r,a,(null==o?void 0:o.orientation)===z.BAR_HORIZONTAL?i:n,(null==o?void 0:o.orientation)===z.BAR_HORIZONTAL?n:i,l,e)}));null!==this.cacheData?this.colLength=s.length:this.colLength&&(this.colLength=0)},O.prototype.processLayerData=function(t,e,i,n,o,a,r,s,l,h,p,u,c,d){var y="Stepped"===s.interpolation,i=(this.cacheData=i,this.yCols=e,this.xCol=n===V.Bounds?s.x1:t,n===V.Baseline&&s.baselineInfo?this.count=2:(this.count=Math.min(t.length,_.max(e.map(function(t){return t.length}))||0),"Stepped"===s.interpolation?this.count*=2:n===V.Heatmap&&(this.count*=2,this.tx=s.x1.qtype,this.tys=[s.y1.qtype])),n===V.Bounds),g=n===V.Heatmap,f=n===V.Bar||n===V.Waterfall,m=n===V.Candlestick,P=n===V.LineBubble,x=d&&d[0],v=!(!x||!x.fill||"No Fill"===x.fill),f=f&&void 0!==s.barWidth||g||v||n===V.Line||m||i;(n===V.Line||v||P)&&(s=L(L({},s),{lineFill:x,xCol:t})),h[0]&&(this.pointSizes=this.getPointSizes(h[0],h[1],r,y),this.sizeBuffer=C.createBuffer(o,new Float32Array(this.pointSizes))),this.shaders=new Array(i||g?1:n===V.Candlestick?2:e.length),this.buffers=new Array(i||g?2:n===V.Candlestick?4:e.length+1),this.processData(n,s,f,e,a,o,t,r,l,c,d,u,p)},O.convertGroupedBarsData=function(t,e,i){e=S.convertBarsOrLineFillData(t,e);return S.calcBarData(t,e.scalar,e.nullVal,i)},O.hexColorToVec4=function(t,e){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t&&4===t.length?new M(parseInt(t[1],16)/256,parseInt(t[2],16)/256,parseInt(t[3],16)/256,e/100):new M(.5,.5,.5,1)},O.prototype.convertFillToLayerData=function(i){var n=this,o=[],a={fill:"",cols:null,toBounds:null,fromBounds:null};return this.yCols.forEach(function(t,e){o[e]=n.convertData(Y.isWebGL2,t,"y",0,V.LineFill,{lineFill:a,interpolation:i.interpolation,steppedLine:i.steppedLine})}),o},O.prototype.getBarWidth=function(){return this.barWidth},O.prototype.getCategoryData=function(t){return"x"===t?this.xCategoryData:this.yCategoryData},O.prototype.getCols=function(){return[this.xColData,this.yColsData]},O.prototype.getStackedXData=function(){return this.stackedXData},O.prototype.getStackedYData=function(){return this.stackedYData},O.prototype.remove=function(e){_.each(this.buffers,function(t){e.deleteBuffer(t)})},O.prototype.removeDataCache=function(){this.xDataCache=[],this.yDataCache=[]},O.prototype.render=function(p,n,o,a,u,c,t,d,y,g,e,f){var m,i,r,s,P=this,x=u===V.Bubble||""===u?p.POINTS:u===V.Baseline?p.LINE_STRIP:p.TRIANGLES,v=0;u===V.Bounds&&e&&(i=new F(n.y,n.w).applyFn(function(t){return Y.convertJSToScalar(P.tys[0],t)}),s=Number(i.x),r=Number(i.y),s=Z.drawYBounds(new F(s,r),e.length),r=this.getYData(s),this.buffers[1]=C.createBuffer(p,r)),u===V.Baseline&&f&&f.types&&(s=(e="x"===(null==f?void 0:f.axis))?new F(n.y,n.w):new F(n.x,n.z),r="x"===(null==f?void 0:f.axis)?"y":"x",m=f.types[r]||(e?this.tys[0]:this.tx),i=s.applyFn(function(t){return Y.convertJSToScalar(m,t)}),r=[Number(i.x),Number(i.y)],s=e?this.getYData(r):this.getXData(r),e?this.buffers[1]=C.createBuffer(p,s):this.buffers[0]=C.createBuffer(p,s),this.useLabels)&&(e?this.yColsData=[[Number(i.y)]]:this.xColData=[Number(i.y)]),this.shaders.forEach(function(r,s){var t=u===V.Line?v:s,e=(void 0!==r&&(p.useProgram(r.Program),u===V.Candlestick||u===V.Line?r.xBinding.apply(p,P.buffers[t]):(e=(u===V.Bar||u===V.Waterfall)&&1<d.length?s:0,(u===V.Bar&&y===z.BAR_HORIZONTAL?r.yBinding:r.xBinding).apply(p,P.buffers[e])),null!=g)&&r.setTexture(p,g),u===V.Candlestick||u===V.Bounds?P.colorBuffers[0]:P.colorBuffers[s]),i=u===V.Candlestick?2:1,t=(u===V.Bar||u===V.Waterfall)&&1<d.length?s+P.buffers.length/2:t+i,l=((u===V.Bar&&y===z.BAR_HORIZONTAL?r.xBinding:r.yBinding).apply(p,P.buffers[t]),e&&r.colorLocation&&r.colorLocation.apply(p,e),P.sizeBuffer&&r.sizeLocation&&r.sizeLocation.apply(p,P.sizeBuffer),y===z.BAR_HORIZONTAL),h=f?"x"===f.axis?1:0:null;_.each([new F(n.x,n.z),new F(n.y,n.w)],function(t,e){var i=0===e?l?1:0:l?0:1,n=0===e?r.xRange:r.yRange,o=0==i?P.tx:P.tys[s],t=(u===V.Baseline&&e===h&&m&&(o=m),t.applyFn(function(t){return Y.convertJSToScalar(o,t)})),a=1===e&&u===V.Bounds,i=0==i?P.xCol:P.yCols[s];Y.isLong(o)&&!a&&h!==e&&i?(a=Y.getRange(i),(e=Y.getMidrange(new F(a[0],a[1]),o))&&(t=new F(Y.toBigInt(t.x)-e,Y.toBigInt(t.y)-e)),i=new F(k.Long.fromString(t.x.toString().split(".")[0]),k.Long.fromString(t.y.toString().split(".")[0])),n.set(p,i.applyFn(Y.toNumber))):n.set(p,t.applyFn(Y.toNumber))}),r.color&&(i=O.hexColorToVec4(o[s%o.length],c),r.color.set(p,i)),r.pointSize&&r.pointSize.set(p,a),P.drawGL(p,x),v+=2})},O.prototype.updatePointSizeOnZoom=function(i,t){var n=[];this.pointSizes&&(_.each(this.pointSizes,function(t){var e=t*i;n.push(e<t?t:e)}),this.sizeBuffer=C.createBuffer(t,new Float32Array(n)))},O.prototype.getTriggerBounds=function(t){return this.triggerData[t].bounds},O.prototype.getTriggerData=function(t){return this.triggerData[t].data},O.prototype.getTriggerIntervals=function(t){return this.triggerData[t].breakIntervals},O.prototype.applyTriggerData=function(t,e,i,n){var o=t,e=tt.getTriggerBreakVals(n,e,o),a=e[0],e=e[1],n=n.breaksToApply;return a&&e?(o=tt.applyTriggerBreak(o,a,e,n),this.triggerData[i].breakIntervals=o[1],a=o[0],this.triggerData[i].bounds=new F(Math.min.apply(Math,a),Math.max.apply(Math,a)),"x"===i?this.triggerData[i].data=a:"y"===i&&(this.triggerData[i].data||(this.triggerData[i].data=[]),this.triggerData[i].data.push(a)),a):t},O.prototype.convertCategoryData=function(t,e,i,n,o){var a,t=Y.getCategoryData(t);return e=t[1],this.useLabels&&(a="x"===i?t[1]:e),"x"===i&&(this.xCategoryData=t),"y"===i&&(this.yCategoryData[0].push(t[0]),this.yCategoryData[1].push(e)),(n&&"y"===i||!n&&"x"===i)&&null!=(n=null==o?void 0:o.stacked)&&n.includes("y")&&(this.stackedXData=t[0]),[e,a]},O.prototype.convertBarsData=function(t,e,i,n,o,a){var r=new Z;if("x"===t||"y"===t&&e){var s=-1!==i.stacked.indexOf(t);if(!i.mergedBounds)throw"Missing merged";if("Fixed Width"===i.barType&&void 0===(null==(h=i.size)?void 0:h.x))throw"Missing width";var l,h=Y.convertVec4ToScalar(i.mergedBounds,e?this.tys[0]:this.tx,e?this.tx:this.tys[0]),p=("y"===t&&(h=new M(h.y,h.x,h.w,h.z)),e&&void 0!==n&&"x"===t?this.tys[n]:this.tx);"y"===t&&e&&s?(l={prevLayerData:n?this.stackedYDataObj:null==(e=null==i?void 0:i.barGrouping)?void 0:e.stacked,xData:this.stackedXData},o=r.getXBarPoints(o,i,h,s,t,p,n,l)):(a&&(e=this.getTriggerBounds(t),h=new M(e.x,h.y,e.y,h.w)),o=r.getXBarPoints(o,i,h,s,t,p,n),"x"===t&&(this.barWidth=r.getBarWidth(),this.maxDistFromX=r.getMaxDist()))}else i.waterfallInfo?(o=(a=r.getWaterfallPoints(o,i.waterfallInfo,n||0))[0],this.waterfallColors.push(a[1])):(l=void 0,null!=(e=null==i?void 0:i.stacked)&&e.includes("y")&&(l={prevLayerData:n?this.stackedYDataObj:null==(h=null==i?void 0:i.barGrouping)?void 0:h.stacked,xData:this.stackedXData}),o=r.getYBarPoints(o,l));return"y"===t&&null!=(s=null==i?void 0:i.stacked)&&s.includes("y")&&(p=this.getStackedXData(),a=r.getStackedYVals(),this.stackedYData.push(a),this.stackedYDataObj=Y.getStackedData(p,a,this.stackedYDataObj)),o},O.prototype.calcBarData=function(t,e,i,n,o){var a=null;return null!==this.cacheData&&(a="x"===n?this.xDataCache[o]:"y"===n?this.yDataCache[o]:null),S.calcBarData(t,e,i,a)},O.prototype.convertData=function(t,e,i,n,o,a,r){var s,l,h,p,u,c=e.qtype,d=(o===V.Bar||o===V.Waterfall)&&void 0!==(null==a?void 0:a.barWidth),y=o===V.Bounds,g=o===V.Line,f=o===V.LineBubble,m=o===V.LineFill,P=o===V.Baseline,x=(g||m||f)&&"Stepped"===(null==a?void 0:a.interpolation),m=(g||m||f)&&(null==a?void 0:a.spanGaps)&&(null==a?void 0:a.xCol),g=(g&&a.spanGaps,("y"===i&&void 0!==n?this.yDataCache:this.xDataCache)[n]),t=(!t&&Y.isInt(c)&&(s=Y.intToFloat(e),c=E.Float),d&&(null==a?void 0:a.orientation)===z.BAR_HORIZONTAL),d=t?"x"===i?"y":"x":i,v=(!r||null!=a&&a.spanGaps||o===V.Line||(r=r[d]),this.axisTypes[d]===X.TYPE_CATEGORY),t=(v&&(s=(b=this.convertCategoryData(e,s,d,t,a))[0],l=b[1]),(null==r?void 0:r.breakVal)&&(null==r?void 0:r.triggerBreak)&&!(null!=a&&a.spanGaps));if(t&&!P&&(u=S.convertBarsOrLineFillData(e,c),p=this.calcBarData(e,u.scalar,u.nullVal,i,n),h=(O=tt.getTriggerBreakVals(r,e.qtype,p))[0],O=O[1],h&&O?(h=this.applyTriggerData(p,c,d,r))&&(l=s=h):t=!1),o!==V.Bubble&&""!==o&&(!f||x||m)||t||v)if(P&&null!=a&&a.baselineInfo){var O=(null==a?void 0:a.baselineInfo).scalarVal,b=[Number(O),Number(O)];s="x"===i?this.getXData(b):this.getYData(b),this.useLabels&&(l=[O])}else{if(y?(s=(p=S.getBoundsData(a))[0],this.xColData=p[1],this.boundsColors=p[2]):m?s=this.convertSpanGapsData(a,e,r,s,o):v||t||(u=S.convertBarsOrLineFillData(e,c),s=l=this.calcBarData(e,u.scalar,u.nullVal,i,n),null!=(h=null==a?void 0:a.stacked)&&h.includes("y")&&"x"===i&&(this.stackedXData=l)),i===V.Candlestick||o===V.Heatmap)return s;this.setDataCache(i,n,e,s),s=(b=this.performGeometryTransformations(e,o,a,s,l,i,n,t,r))[0],l=b[1]}else s=Y.isString(c)?[]:Y.isDouble(c)?Y.floatToEmulateDoubleArray(e,g):Y.isLong(c)?Y.longToEmulateDoubleArray(e,g):s||e.toTypedArray(),this.setDataCache(i,n,e,s,!0);return this.useLabels&&!m&&this.setLabels(l,d,e,o,a,n),s},O.prototype.convertSpanGapsData=function(t,e,i,n,o){var a=null==t?void 0:t.xCol,r=e,a=(this.axisTypes.x===X.TYPE_CATEGORY&&(this.xCategoryData=Y.getCategoryData(a),s=this.xCategoryData[1]),S.getSpanGapsInfo(this.axisTypes.x,a,s)),s=S.getSpanGapsInfo(this.axisTypes.y,r,n),r=K.getSpanGaps(a,s),n=r.x,s=r.y,l=i.x,t=(l&&null!=l&&l.breakVal&&null!=l&&l.triggerBreak&&(t=t.xCol,n=this.applyTriggerData(n,null==t?void 0:t.qtype,"x",l)),i.y);return t&&null!=t&&t.breakVal&&null!=t&&t.triggerBreak&&(s=this.applyTriggerData(s,e.qtype,"y",t)),o===V.Line&&this.useLabels&&(this.xColData=n,this.yColsData.push(s)),K.spanGaps(n,s,r.indices,a)},O.prototype.getDataCache=function(t,e){return("x"===t?this.xDataCache:this.yDataCache)[e]},O.prototype.getMaxDist=function(){return this.maxDistFromX},O.prototype.drawGL=function(t,e){var i=this.count;e===t.TRIANGLES&&(i*=6),t.drawArrays(e,0,i)},O.prototype.getPointSizes=function(i,t,e,n){for(var o=[],a=i.qtype,r=Y.isLong(a)?function(t,e){return Number("bigint"==typeof t?i.getScalar(e):i.getLegacyScalar(e).toString())}:function(t,e){return i.getScalar(e)},s=0;s<i.length;s++){var l=t*(e?1.333:1),h=r(i,s);o.push(h*l),n&&(h=r(i,s+1),o.push(h*l))}return o},O.prototype.getXData=function(t){if(S.isDoubleOrLongTemporal(this.tx)){for(var e=new Float32Array(2*t.length),i=0,n=0;n<e.length;n+=2){var o=t[i++];e[n]=o,e[n+1]=o-Math.fround(o)}return e}return new Float32Array(t)},O.prototype.getYData=function(o){var a=this,r=new Float32Array(0);return _.each(this.tys,function(t){if(S.isDoubleOrLongTemporal(t)&&!a.boundsColors){r=new Float32Array(2*o.length);for(var e=0,i=0;i<r.length;i+=2){var n=o[e++];r[i]=n,r[i+1]=n-Math.fround(n)}}}),r.length?r:new Float32Array(o)},O.prototype.performGeometryTransformations=function(t,e,i,n,o,a,r,s,l){var h,p,u,c=(e===V.Bar||e===V.Waterfall)&&void 0!==(null==i?void 0:i.barWidth),d=e===V.Bounds,y=e===V.Line,g=e===V.LineBubble,f=i.lineFill,m=e===V.LineFill&&(null==f?void 0:f.fill),P=(y||m||g)&&"Stepped"===(null==i?void 0:i.interpolation),x=(y||m||g)&&(null==i?void 0:i.spanGaps)&&(null==i?void 0:i.xCol),v=c&&(null==i?void 0:i.orientation)===z.BAR_HORIZONTAL,O=[];return e===V.LineBubble&&P&&(n=x?{x:h=S.convertSteppedData(n.x,"x",i),y:p=S.convertSteppedData(n.y,"y",i)}:S.convertSteppedData(n,a,i)),m&&(P&&((m=n)||(u=S.convertBarsOrLineFillData(t,t.qtype),m=this.calcBarData(t,u.scalar,u.nullVal,a,r)),n=x?{x:h=S.convertSteppedData(m.x,"x",i),y:p=S.convertSteppedData(m.y,"y",i)}:(o=m,S.convertSteppedData(m,a,i))),u=null==i?void 0:i.steppedLine,n=x?{x:K.getXLineFill(n.x),y:K.getYLineFill(n.y,f,P,u)}:"x"===a?K.getXLineFill(n):K.getYLineFill(n,f,P,u)),e===V.Line&&i.lineThickness?(u=(m=i.x)?m.qtype:null,e=S.convertBarsOrLineFillData(m,u),O=(u="Category"===this.axisTypes.x?this.convertCategoryData(m,n,"x",v,i):null)?u[0]:x?n.x:this.calcBarData(m,e.scalar,e.nullVal,"x",r),u=x?n.y:n,h=Array.from(O),p=Array.from(u),x||((e=l.x)&&null!=e&&e.breakVal&&null!=e&&e.triggerBreak&&(u=i.xCol,h=this.applyTriggerData(h,null==u?void 0:u.qtype,"x",e)),(u=l.y)&&null!=u&&u.breakVal&&null!=u&&u.triggerBreak&&(p=this.applyTriggerData(p,t.qtype,"y",u))),x||(o=[h,p]),P&&(h=S.convertSteppedData(h,"x",i),p=S.convertSteppedData(p,"y",i)),e={zoom:l.zoom,xType:m.qtype,yType:t.qtype,triggerData:this.triggerData},u=K.drawLine(p,h,i.lineThickness,e),this.count=u[0].length,O=u[0],n=u[1],this.bevelIndices=u[2]):c&&(n=this.convertBarsData(a,v,i,r,n,s)),c||null!=f&&f.fill||d||s||g?n=x?[this.getXData(n.x),this.getYData(n.y)]:"x"===a||"y"===a&&(null==i?void 0:i.orientation)===z.BAR_HORIZONTAL?this.getXData(n):this.getYData(n):y&&(n=this.getYData(n),n=[O=this.getXData(O),n]),[n,o]},O.prototype.processCandlesticks=function(t,i,r,e,s){var l=this,n=[],h=(t.forEach(function(t,e){n[e]=l.convertData(i,t,V.Candlestick,0,V.Candlestick)}),Y.convertVec4ToScalar(s.mergedBounds,this.tx,this.tys[0])),t=[n[1],n[2]],o=[n[0],n[3]],p=new Z,u=this.convertData(i,e,V.Candlestick,0,V.Candlestick),c=[],d=s.widthType;[t,o].forEach(function(t,e){var i=0===e,n=i?s.bodyWidth/10:s.bodyWidth,o=i?void 0:s,a=Math.abs(Number(h.w)-Number(h.y))||0,a=p.getCandlesticks(t,a,o),o=(i||(c=a[1]),L(L({},s),{barType:d,barWidth:n})),n=(l.buffers[e]=C.createBuffer(r,l.getXData(p.getXBarPoints(u,o,h,!1,"x",l.tx))),l.buffers[e+2]=C.createBuffer(r,new Float32Array(a[0])),i&&l.useLabels&&(l.xColData=u,l.yColsData.push(t[0])),p.getBarWidth());n>l.barWidth&&(l.barWidth=n)}),c.length&&this.setColorArray(!1,!0,[c],r,!1)},O.prototype.setColorArray=function(c,d,t,i,y,g,f,m){var P=this,x=[];t&&t.length&&(t.forEach(function(t,e){if(d||g||f){for(var i=[],n=d&&!f,o=g?n?12:2:n?6:1,a=0;a<t.length;a++)for(var r=o,s=(-1!==P.bevelIndices.indexOf(a)&&(r+=3),t[a]),l=0;l<r;++l){!s.length&&null!=m&&m.color&&(p=m.color[e],h=m.opacity,s=Vt.convertHighlightColor(p,h));var h,p=s;c&&y&&(h=-1!==[1,2,4,7,8,10].indexOf(l)?0:s[3],p=[s[0],s[1],s[2],h]),i.push(Array.prototype.concat.apply([],p))}n=new Float32Array(Array.prototype.concat.apply([],i))}else var u=Array.prototype.concat.apply([],t),n=new Float32Array(u);x.push(n)}),x.forEach(function(t,e){t=C.createBuffer(i,t);P.colorBuffers[e]=t}))},O.prototype.setDataCache=function(t,e,i,n,o){null!==this.cacheData?("x"===t?this.xDataCache[e]=n:"y"===t&&void 0!==e&&(this.yDataCache[e]=n),i.length===this.maxRows&&(i=this.cacheData+(o?1:0),"x"===t?this.xDataCache[e]=n.slice(i):"y"===t&&(this.yDataCache[e]=n.slice(i)))):this.removeDataCache()},O.prototype.setLabels=function(t,e,i,n,o,a){t||(r=S.convertBarsOrLineFillData(i,i.qtype),t=this.calcBarData(i,r.scalar,r.nullVal,e,a));var r,i=n===V.Bounds;n===V.Line?(n=t[1],this.yColsData.push(n),this.axisTypes.x===X.TYPE_CATEGORY?this.xColData=Array.from(this.getCategoryData("x")[1]):t[0]?this.xColData=t[0]:(r=S.convertBarsOrLineFillData(o.xCol,o.xCol.qtype),this.xColData=this.calcBarData(o.xCol,r.scalar,r.nullVal,e,a))):"x"!==e||i?"y"===e&&this.yColsData.push(t):this.xColData=t};var Mt=O;function O(t,e,i,n,o,a,r,s){var l;this.maxRows=a,this.cacheData=null,this.colLength=0,this.count=0,this.barWidth=0,this.bevelIndices=[],this.buffers=[],this.colorBuffers=[],this.maxDistFromX=0,this.shaders=[],this.stackedYData=[],this.stackedYDataObj={},this.stackedXData=[],this.pointSizes=[],this.waterfallColors=[],this.yCols=[],this.yCategoryData=[[],[]],this.yColsData=[],this.triggerData={x:{},y:{}},this.xDataCache=[],this.yDataCache=[],n===V.Baseline&&o.baselineInfo?(this.tx=E.Float,this.tys=[E.Float],a=o.baselineInfo.axis,(l=o.baselineInfo.type)&&("x"===a?this.tx=l:this.tys=[l])):(this.tx=r.x===X.TYPE_CATEGORY?E.Float:e.qtype,this.tys=i.map(function(t){return r.y===X.TYPE_CATEGORY?E.Float:t.qtype})),this.axisTypes=r,this.useLabels=s,this.yColsData=[],!t&&Y.isInt(this.tx)&&(this.tx=E.Float),t||(this.tys=this.tys.map(function(t){return Y.isInt(t)?E.Float:t})),n===V.Bounds&&(this.tx=o.x1.qtype,this.tys=[o.yType])}Xt.createGradient=function(t){for(var e=new Array(t.length),i=0;i<t.length;i++){var n=(i/t.length*100).toFixed(2);e[i]=t[i]+" "+n+"%"}return"linear-gradient(to right, "+e.join(", ")+")"},Xt.getConditionResult=function(t,e,i){var n,o,a=!1,r=isNaN(parseFloat(t))||_.isObject(t)?(""+t).toLowerCase():parseFloat(t),s=isNaN(parseFloat(e))||_.isObject(e)?(""+e).toLowerCase():parseFloat(e);switch(t&&t.class&&0<=["1212","1213","1214","1215"].indexOf(t.class)?(r=k.Tools.convertKDBTemporalToMoment(t).unix(),"in"===i?(n=[],_.each(e.toString().split(","),function(t){n.push(k.Tools.convertDateStringValueToMoment(t).unix()),s=n.toString()})):s=k.Tools.convertDateStringValueToMoment(e).unix()):t&&t.class&&0<=["1216","1217","1218","1219"].indexOf(t.class)&&(r=k.Tools.convertKDBTemporalToMoment(t).valueOfNano(),"in"===i?(o=[],_.each(e.toString().split(","),function(t){o.push(k.Tools.convertDateStringValueToMoment(t).valueOfNano()),s=o.toString()})):s=k.Tools.convertDateStringValueToMoment(e).valueOfNano()),i){case"contains":a=0<=r.toString().indexOf(s.toString());break;case"starts with":a=0===r.toString().indexOf(s.toString());break;case"ends with":a=-1!==r.toString().indexOf(s.toString(),r.toString().length-s.toString().length);break;case"==":a=r===s;break;case"<":a=r<s;break;case">":a=s<r;break;case"<=":a=r<=s;break;case">=":a=s<=r;break;case"!=":a=r!==s;break;case"in":a=0<=s.toString().split(",").indexOf(r.toString());break;case"search":a=!!r.toString().match(s.toString());break;case"regexp":a=new RegExp(e.toString()).test(t?t.toString():"")}return a},Xt.getScalarResult=function(t,e,i,n,o){var a=t.getScalar(e);if(o&&Y.isNull(a,Y.getNullVal(t.qtype)))return null;switch("bigint"==typeof a&&"bigint"!=typeof i&&(i=Y.toLong(i)),n){case"==":return a===i;case"<":return a<i;case">":return i<a;case"<=":return a<=i;case">=":return i<=a;case"!=":return a!==i}},Xt.interpolateColor=function(t,e,i,n){if(!t.length)return"";for(var i=(i-e)/(t.length-1),n=this.clamp((n-e)/i,0,t.length-1),n=_.isNaN(n)?0:n,e=t[Math.floor(n)],i=t[Math.ceil(n)],o=Y.hex2RGB(e),a=Y.hex2RGB(i),r=n-Math.floor(n),s=o.slice(),l=0;l<3;l++)s[l]=Math.round(s[l]+r*(a[l]-o[l]));return this.RGB2hex(s)},Xt.clamp=function(t,e,i){return i<t?i:t<e?e:t},Xt.RGB2hex=function(t){return"#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+t[2]).toString(16).slice(1)};var Yt=Xt;function Xt(){}zt.computeHighlightRules=function(s,l,t,e,h,i,n,p,u,c,d,o){if(!h)return[""];var y={},g=(_.each(_.keys(h),function(t){y[t]=h[t]}),[]),f=[],m=e.length?e:t;if(s||n){var P=s.map(function(t){return new RegExp((t.RuleTarget||"*").replace(/\*/g,"(.*)$"))}),a=null==o?void 0:o.col,r=null==o?void 0:o.name;if(a&&r){for(var n=Y.getRange(a),x=Number(n[0]),v=Number(n[1]),O=0;O<a.length;O++){var b=Yt.interpolateColor(l,x,v,Number(Y.getColValue(a,O))),T=s.length?zt.computeColorInternal(r,O,s,P,y,u):b;g.push(T||b)}f.push(g)}else{var o=y[m]?[y[m]]:i,A=("*"===e&&delete i[t],0);_.each(o,function(t,e){g=[];for(var i=c?2*t.length:t.length,n=y[m]?m:e,o=0;o<i;o++){var a=(null!=d&&d.length?d:l)[A],r=s.length?zt.computeColorInternal(n,o,s,P,h,u):p[A];g.push(r||a)}A++,f.push(g)})}return f}return[]},zt.convertHighlightColor=function(t,e){var i=Mt.hexColorToVec4(t,e);return Object.keys(i).map(function(t){return i[t]})},zt.getColorArray=function(t,e,i,n){var o,a=[];return _.each(t,function(t){o=[],_.each(t,function(t){t?(t=t?zt.convertHighlightColor(t,i?n:e):[],o.push(t)):o.push([])}),a.push(o)}),a},zt.computeColorInternal=function(s,l,t,h,p,u){var c,d={};return t.forEach(function(t,e){if(h[e].test(s)&&t.RuleSource){var e=p[t.RuleSource],i=null==e?void 0:e.qtype;if((3<i&&i<11||11<i&&i<20)&&{"==":!0,"<":!0,">":!0,"<=":!0,">=":!0,"!=":!0}[t.RuleOperation]&&!Y.isIE11)i=Y.convertStringToScalar(t.RuleValue,Y.ipcTemp(i)),(e=Yt.getScalarResult(e,l,i,t.RuleOperation,u))?c=t.RuleColor:null===e&&(c="");else{_.each(_.keys(p),function(t){d[t]=p[t].getValue(l)});var n,i=t.RuleSource,o=d[i];if(u&&null===o)c="";else{if(o&&"object"==typeof o&&!o.i){for(var a="",r=0;r<o.length;r++)a+=""+o.getValue(r);o=a}"gradient"===t.RuleType?(e=t.RuleMin,i=t.RuleMax,n=t.Palette.map(function(t){return t.type}),c=Yt.interpolateColor(n,e,i,o)):t.RuleOperation&&(n=t.RuleOperation,e=t.RuleValue,Yt.getConditionResult(o,e,n))&&(c=t.RuleColor)}}}}),c};var Vt=zt;function zt(){}Ht.prototype.createRenderer=function(t,e,i,n,o,a,r,s,l,h,p,u){var c=i===V.LineBubble,d=i===V.LineFill,y=c?this.bubbleRenderer:d?this.fillRenderer:this.renderer;return!e&&y||(y=new Mt(n,this.xCol,this.yCols,c?V.Bubble:i,a,this.maxRows,s,l),c?this.bubbleRenderer=y:d?this.fillRenderer=y:this.renderer=y),y.processLayerData(this.xCol,this.yCols,h,i,t,n,o,a,r,this.radiusInfo,p,this.highlightRules,this.lineFillColors,u),y},Ht.prototype.getPoint=function(n,o,t){function i(t,e,i){return o&&o[e]?(void 0!==i?o[e][i]:o[e])[n]:Y.getColValue(t,n)}return[i(t||this.xCol,"x")].concat(this.yCols.map(function(t,e){return i(t,"y",e)}))};var V,Gt=Ht;function Ht(t,e,i,n,o,a,r){this.xCol=t,this.yCols=e,this.yColNames=i,this.maxRows=n,this.radiusInfo=o,this.highlightRules=a,this.lineFillColors=r}(e=V=V||{}).Bubble="Bubble",e.Line="Line",e.LineBubble="LineBubble",e.LineFill="LineFill",e.Bar="Bar",e.Waterfall="Waterfall",e.Bounds="Bounds",e.Candlestick="Candlestick",e.Heatmap="Heatmap",e.Baseline="Baseline";Object.defineProperty(w.prototype,"RenderState",{get:function(){return this.renderState},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"Config",{get:function(){return this.config},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"Renderer",{get:function(){return this.renderer},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"XType",{get:function(){return this.config?this.config.xCol.qtype:null},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"YType",{get:function(){return this.config&&this.config.yCols.length?this.config.yCols[0].qtype:null},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"datasourceError",{get:function(){var t;return null==(t=null==(t=this.datasource)?void 0:t.attributes)?void 0:t.error},enumerable:!1,configurable:!0}),w.prototype.drawLabels=function(t,e,i,n){var o=null==(o=this.renderer)?void 0:o.getCols();o&&this.dataLabels.drawLabels(o,this.index,t,e,i,(null==(o=this.renderer)?void 0:o.getMaxDist())||0,(null==(t=this.renderer)?void 0:t.getBarWidth())||0,(null==(e=null==n?void 0:n.allBarLayers)?void 0:e.indexOf(this))||0,this.isHorizontal(),this.getBaselineAxis(),this.getStackedYData())},w.prototype.getConvertedCategoryData=function(t,e,i){var n=this.getAllCategoryData(e);return n&&n[1]?(n=n[1],("y"===e&&void 0!==i?n[i]:n)[t]):[]},w.prototype.getAllPointsFromRelativeX=function(){return this.points},w.prototype.getAxisId=function(t){return this.api.getProperty(this.indexProp(t.toUpperCase()+"AxisId")).replace(/.*?(\d+)$/,"$1")-1},w.prototype.getAxisType=function(t){var e=this.getAxisId(t),t=t.toUpperCase()+"axes.";return this.api.getProperty(t+e+".Type")},w.prototype.getBarType=function(){return this.api.getProperty(this.indexProp(w.PROP_BARWIDTHTYPE))},w.prototype.getBaselineAxis=function(){return"X-Axis"===this.api.getProperty(this.indexProp(w.PROP_BASELINE_AXIS))?"x":"y"},w.prototype.getBaselineInfo=function(){return this.baselineInfo},w.prototype.getBaselineValue=function(){return this.api.getProperty(this.indexProp(w.PROP_BASELINE_VALUE))},w.prototype.getBoundsCol=function(t){if(this.cols)return this.cols[this.api.getProperty(this.indexProp(t))]},w.prototype.getTriggerData=function(t){var e;return null==(e=this.renderer)?void 0:e.getTriggerData(t)},w.prototype.getClosestPointFromRelativeX=function(n,e,t,o,i,a){var r=this;if(!this.config)return null;function s(t){if(u===X.TYPE_CATEGORY)return d?r.getConvertedCategoryData(0,p)[t]:r.getConvertedCategoryData(t,p);if(r.isTriggerBreakApplied("x")){var e=r.getTriggerData("x");if(e)return e[t]}return Y.getColValue(h,t)}var l=this.config,h=a||l.xCol,p=this.isHorizontal()?"y":"x",u=this.getAxisType(p),c=this.getLayerType(),d=this.isHorizontal(),a=this.getSortedIndices(u,h),y=a[0],g=a[1];if(!y)return null;function f(t){for(var e=l.getPoint(y(t),O),i=1;i<e.length;i++){var n=e[i],n=(r.getAxisType(d?"x":"y")===X.TYPE_CATEGORY&&(n=t/r.workerIndex.length),Y.calculateRelativeValue(n,o.y,o.w));if(0<=(n=c===V.Bounds?1:n)&&n<=1)return 1}}function m(t,e){for(var i=[];e?0<=t:t<g;)v(t)||i.push(t),e?t--:t++;return i.length?r.getClosestXPoint(i,o,l,y,n):t}var P,a=Y.isLong(h.qtype)&&u!==X.TYPE_CATEGORY,x=(P=a?(P=Math.round(n*t),Y.isIE11?(o=o.applyFn(Y.toLong)).x.add(new k.Long(P).mul(o.z.sub(o.x)).div(new k.Long(t))):Y.toBigInt(o.x)+Y.toBigInt(P)*(Y.toBigInt(o.z)-Y.toBigInt(o.x))/Y.toBigInt(t)):Number(o.x)+n*(Number(o.z)-Number(o.x)),0<=(t=u===X.TYPE_LINEAR&&h.hasIndex&&h.hasIndex()?h.findIndex(P):a&&Y.isIE11?k.Tools.binarySearch2(P,this.workerIndex,function(t,e){e=h.getLegacyScalar(e);return t.compare(e)}):k.Tools.binarySearch2(P,this.workerIndex,function(t,e){e=s(e);return e<t?1:t<e?-1:0}))?b=t:(b=-t-2)+1),v=function(t){var t=l.getPoint(y(t),O),e=t[0],t=t.slice(1);return!Y.isString(r.XType)&&isNaN(Number(e))||_.every(t,function(t){return!Y.isString(r.YType)&&isNaN(Number(t))})},O={x:this.getTriggerData("x"),y:this.getTriggerData("y")};if(!Y.isString(this.XType)){var b,t=l.getPoint(y(b),O,h),T=l.getPoint(y(x),O,h),t=isNaN(Number(t[0])),T=isNaN(Number(T[0]));if(t)b=m(b,!0);else if(v(b))for(;0<=b&&v(b);)b--;if(T)x=m(x,!1);else if(v(x))for(;x<g&&v(x);)x++;(t||T)&&(b=x=this.getClosestXPoint([b,x],o,l,y,n))}for(var A=[],L=[],C=l.getPoint(y(b),O,h),E=l.getPoint(y(x),O,h);0<=b&&l.getPoint(y(b),O,h)[0]===C[0];)f(b)&&A.push(b),b--;for(;x<g&&l.getPoint(y(x),O,h)[0]===E[0];)f(x)&&L.push(x),x++;b=A.length?this.getY(A,o,l,y,e,O):b,x=L.length?this.getY(L,o,l,y,e,O):x;var S,R,D,t=_.union(A,L);return this.api.getProperty("Overlay.ShowAllPoints")&&(i!==w.PROP_X2_COORD&&(this.points=[]),S=[],_.each(t,function(t){S.push(c!==V.Bounds&&r.isRegexOrWild()?r.getAllWildcards(t,o,l,y):[r.getClosestPoint(t,o,l,y,e,h,O)])}),this.points=this.points.concat(S)),b<0&&g<=x?null:b<0?this.getClosestPoint(x,o,l,y,e,h,O):g<=x?this.getClosestPoint(b,o,l,y,e,h,O):(T=this.getY(t,o,l,y,e,O),a=Y.isIE11&&a?(R=P.sub(h.getLegacyScalar(y(b))),D=h.getLegacyScalar(y(x)).sub(P),R.equals(D)?T:R.lt(D)?b:x):(i=Number(s(y(b))),t=Number(s(y(x))),(R=Number(P)-i)===(D=t-Number(P))?T:R<D?b:x),this.getClosestPoint(a,o,l,y,e,h,O))},w.prototype.getAllCategoryData=function(t){var e;return(null==(e=this.renderer)?void 0:e.getCategoryData(t))||[]},w.prototype.getColorArr=function(t,e){t=this.colorArr[e=e||0][t];return t||this.getLayerColors(H.Default)[e]},w.prototype.getColorData=function(){return this.colorDataInfo},w.prototype.getAllCols=function(){return this.getLayerType()===V.Baseline||_.get(this.yAxes,"length")||(this.yAxes=this.getYAxesVals()),_.union(this.yAxes,this.disabledColumns)},w.prototype.getAxisStacked=function(t){var e=this.getAxisId(t);return!0===this.api.getProperty(t.toUpperCase()+"axes."+e+".Stacked")},w.prototype.getFillToLayerData=function(t){return this.renderer?this.renderer.convertFillToLayerData(t):[]},w.prototype.getGroupedBarData=function(){var t,e;return this.cols?(t=this.indexProp(w.PROP_XAXIS),t=this.api.getProperty(t),t=this.cols[t],e=null==(e=this.renderer)?void 0:e.getDataCache("x",0),Mt.convertGroupedBarsData(t,t.qtype,e)):[]},w.prototype.getFillType=function(){return this.propertyCache[w.PROP_TYPE]===V.Line?this.propertyCache[w.PROP_FILL]:""},w.prototype.getId=function(){return this.uid},w.prototype.getLayerName=function(){return this.api.getProperty(this.indexProp("Name"))},w.prototype.getLayerType=function(){return this.propertyCache[w.PROP_TYPE]},w.prototype.getLegendGroup=function(){return this.api.getProperty(this.indexProp("LegendGroup"))},w.prototype.getStackedYData=function(){var t;return null==(t=this.renderer)?void 0:t.getStackedYData()},w.prototype.getStackedXData=function(){var t;return null==(t=this.renderer)?void 0:t.getStackedXData()},w.prototype.getTriggerBounds=function(t){if(this.isTriggerBreakApplied(t)&&this.hasData()){var e=null==(e=this.renderer)?void 0:e.getTriggerBounds(t),t="x"===t||"y"===t&&this.isHorizontal()?this.XType:this.YType;if(e&&null!==t)return new F(Y.convertToJsScalar(t,e.x),Y.convertToJsScalar(t,e.y))}return null},w.prototype.getTriggerIntervals=function(t){var e;return null==(e=this.renderer)?void 0:e.getTriggerIntervals(t)},w.prototype.hasColorData=function(){var t=this.api.getProperty(this.indexProp(w.PROP_COLORDATA));return!this.isCandlestick()&&t&&"None"!==t},w.prototype.hasDataLabels=function(){return this.api.getProperty(this.indexProp(w.PROP_LABEL_ENABLED))},w.prototype.hasFixedWidth=function(){var t=this.api.getProperty(this.indexProp(w.PROP_TYPE)),e=this.getBarType();return t===V.Bar&&"Fixed Width"===e},w.prototype.hasPadding=function(){return this.propertyCache[w.PROP_TYPE]!==V.Line},w.prototype.hasTexture=function(){return!(!this.icon||!this.texture)},w.prototype.isBubble=function(){return this.api.getProperty(this.indexProp(w.PROP_TYPE))===V.Bubble},w.prototype.isCandlestick=function(){return this.api.getProperty(this.indexProp(w.PROP_TYPE))===V.Candlestick},w.prototype.isEnabled=function(){return!0===this.api.getProperty(this.indexProp(w.PROP_ENABLED))},w.prototype.isHorizontal=function(){return this.getLayerType()===V.Bar&&this.api.getProperty(this.indexProp(w.PROP_BAR_ORIENTATION))===w.BAR_HORIZONTAL},w.prototype.updateLayerPalette=function(t,e,i){t&&(o=this.api.getProperty(this.indexProp(w.PROP_YAXIS)),n=this.isRegexOrWild()?this.getColumnKeysFromAxisString(o):[o],this.disabledColumns=t.filter(function(t){return-1!==n.indexOf(t)}));var n,o=!1,t=this.getPaletteProperty(),e=(this.palette=e?t:this.getUpdatedPalette(t),this.api.getProperty(this.indexProp(w.PROP_FILL))&&(t=this.getPaletteProperty(!0),this.fillPalette=e?t:this.getUpdatedPalette(t)),this.hasColorData()&&this.cols&&(e=this.propertyCache[w.PROP_COLORDATA],t=this.calculateColorData(e),this.setColorData(t),o=!0),this.propertyCache[w.PROP_HIGHLIGHTRULES]),t=(e&&e.length&&(this.onHighlightRuleChange(e),o=!0),this.propertyCache[w.PROP_FILL]);return t&&"No Fill"!==t&&(o=!0,e&&e.length||this.propertyCache[w.PROP_FADE])&&(t=this.api.getProperty(this.indexProp(w.PROP_FILLCOLOR)),this.isRegexOrWild()||t||this.setLineFillProperties(),this.onLineFillChange(e)),i&&o&&this.configure(),this.palette},w.prototype.getBarOrientation=function(){return this.api.getProperty(this.indexProp(w.PROP_BAR_ORIENTATION))},w.prototype.getRowData=function(e){var i,n;return this.getLayerType()===V.Baseline?{val:this.baselineInfo.jsVal}:this.cols?(i=this.cols,n={},_.each(_.keys(i),function(t){n[t]=i[t].getValue(e),n[t]&&"object"==typeof n[t]&&!k.Tools.isKDBTemporal(n[t])&&(n[t]=Y.getValueFromObject(n[t]))}),n):null},w.prototype.getColumnKeysFromAxisString=function(t){var e,i=/\/[gimsuy]*$/,n="",o=(0===t.indexOf("/")?(e=t.substring(1).replace(i,""),n=(i=t.match(i))?i[0].substring(1):""):e="^"+(t=t.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\*/g,"(.*)")+"$",new RegExp(e,n));return this.columns.filter(function(t){return t.match(o)})},w.prototype.getCurrentTickVals=function(){return this.currentTickVals},w.prototype.getDataRangeX=function(){var t=this.api.getProperty(this.indexProp(w.PROP_TYPE));if(this.cols&&this.hasData()){var e=void 0,i=void 0;if(t===V.Bounds||t===V.Heatmap){var t=t===V.Bounds,n=this.api.getProperty(this.indexProp(t?w.PROP_X1_COORD:w.PROP_HEATMAP_X1)),t=this.api.getProperty(this.indexProp(t?w.PROP_X2_COORD:w.PROP_HEATMAP_X2));if(!n||!t)return new F(0,1);var n=this.cols[n],t=this.cols[t],o=Y.getRange(n),t=Y.getRange(t),e=n.qtype,i=[Math.min(Number(o[0]),Number(t[0])),Math.max(Number(o[1]),Number(t[1]))]}else{n=this.isHorizontal()?"y":"x",o=this.cols[this.api.getProperty(this.indexProp(w.PROP_XAXIS))];if(this.getAxisType(n)===X.TYPE_CATEGORY)return new F(0,1);e=o.qtype,i=Y.getRange(o)}return Y.convertVec2ToJsScalar(new F(i[0],i[1]),e,e)}return new F(0,1)},w.prototype.getDataRangeY=function(){var t,e,i,n=this.getLayerType();return this.cols&&this.hasData()?n===V.Heatmap?(n=this.api.getProperty(this.indexProp(w.PROP_HEATMAP_Y1)),i=this.api.getProperty(this.indexProp(w.PROP_HEATMAP_Y2)),n&&i?(n=this.cols[n],i=this.cols[i],t=Y.getRange(n),i=Y.getRange(i),n=n.qtype,t=[Math.min(Number(t[0]),Number(i[0])),Math.max(Number(t[1]),Number(i[1]))],Y.convertVec2ToJsScalar(new F(t[0],t[1]),n,n)):new F(0,1)):(i=_.difference(this.yAxes,this.disabledColumns),t=this.isHorizontal()?"x":"y",e=this.cols,n=i.map(function(t){return e[t]}).filter(function(t){return t}),this.getAxisType(t)!==X.TYPE_CATEGORY&&(i=n.map(function(t){var e=Y.getRange(t);return Y.convertVec2ToJsScalar(new F(e[0],e[1]),t.qtype,t.qtype)}),Y.mergeRange(i))||new F(0,1)):new F(0,1)},w.prototype.isBar=function(){var t=this.api.getProperty(this.indexProp(w.PROP_TYPE));return t===V.Bar||t===V.Waterfall},w.prototype.getLabelSize=function(t,e,i){var n,o,a=null==(a=this.renderer)?void 0:a.getCols();return a?(n=this.getBaselineInfo(),o=this.getYAxesVals(),this.dataLabels.getMaxLabelSize(a,o,this.index,t,e,i,n)):null},w.prototype.getPaddedRange=function(o,t,e,i){function n(t,e){if(e===E.Timestamp){var i=t?new F(o.x,o.z):new F(o.y,o.w),n=new F(Y.convertJSToScalar(e,i.x),Y.convertJSToScalar(e,i.y)),e=Y.getMidrange(n,e,!0,i);if(t?y=e:g=e,e)return i=Number(Y.toBigInt(n.x)-e),t=Number(Y.toBigInt(n.y)-e),new F(i,t)}return null}var a,r,s,l,h,p=this,u=o.applyFn(A.isMoment),c=o.applyFn(A.isDuration),d=o.applyFn(Y.convertJSToNumber),y=Y.toBigInt(0),g=Y.toBigInt(0),f=n(!0,this.isHorizontal()?this.YType:this.XType),m=n(!1,this.isHorizontal()?this.XType:this.YType),f=(d=new M((f||d).x,m?m.x:d.y,f?f.y:d.z,m?m.y:d.w),this.propertyCache[w.PROP_TYPE]),P=this.isBar(),m=d.x,x=d.z,v=d.y,O=d.w,b=(d.y===d.w&&(O+=b=Math.abs(.01*v),v-=b),d.x===d.z&&(x+=b=Math.abs(.01*m),m-=b),0),T=this.isHorizontal();return P&&i&&(s=this.getBarType(),h=T?O-v:x-m,l=i.allBarLayers.indexOf(this),a=(l=i.layersCommonXAxis[l]).length,b=("Percentage"===s?(s=l.indexOf(this),h/i.dataLengths[s]/(a+1)*(this.api.getProperty(this.indexProp(w.PROP_BARPERCENT))/100)):h*(this.api.getProperty(this.indexProp(w.PROP_BARFIXED))/t.x))*a),P||this.isCandlestick()?(r=b||(null==(l=this.renderer)?void 0:l.getBarWidth())||0,i=T?0:r,s=T?r:0,h=function(t,e){var i=(e-t)*w.BAR_MIN_RELATIVE_SZ,t=P&&0<e&&0<t?Math.max(0,t-i):t,i=P&&e<0?Math.min(0,e+i):e;return new F(t,i)},a=T?new F(v,O):h(v,O),b=T?h(m,x):new F(m,x),d=new M(b.x-i,a.x-s,b.y+i,a.y+s)):this.hasBubbles()?(l=this.propertyCache[w.PROP_RADIUS_DATA],r=T=Number(this.propertyCache[w.PROP_RADIUS_SCALE])/2,b=h=0,l&&"Fixed Size"!==l&&this.cols&&(a=(i=this.cols[l])&&i.length?Y.getRange(i):[0,1],r=T*Number(a[1])),s=r/t.x,l=r/t.y,d=new M(m-(h=s*(x-m)),v-(b=l*(O-v)),x+h,O+b)):f===V.Line&&(d=new M(m,v,x,O)),this.hasDataLabels()&&e&&(i=e.width/t.x,T=e.height/t.y,a=i*(d.z-d.x),r=T*(d.w-d.y),s=this.api.getProperty(this.indexProp(ae.PROP_LABEL_ALIGN)),l=a-Math.abs(d.x-m),h=r-Math.abs(d.y-v),d=new M(d.x-("right"===s?0:l),d.y-("top"===s?0:h),d.z+("left"===s?0:l),d.w+("bottom"===s?0:h))),["x","y","z","w"].forEach(function(t){u[t]?d[t]=y&&"y"!==t&&"w"!==t?p.convertNanos(d,t,y):g&&"x"!==t&&"z"!==t?p.convertNanos(d,t,g):A(d[t]):c[t]&&(d[t]=A.duration(d[t]))}),d},w.prototype.getPaletteProperty=function(t){return null==(t=this.api.getProperty(this.indexProp(t?w.PROP_FILLPALETTE:w.PROP_PALETTE)))?void 0:t.map(function(t){return"object"==typeof t.type&&t.type.attributes?t.type.attributes.value:t.type})},w.prototype.hasData=function(){if(this.getLayerType()===V.Baseline)return!0;if(this.datasource){var t=this.datasource.attributes,e=t.queryStatus;if(t.error)return!1;if(e){if("Loading"===e.type)return!1;if("NoResults"===e.type)return}return!0}},w.prototype.hasNoResults=function(){var t;return!!this.datasource&&"NoResults"===(null==(t=this.datasource.get("queryStatus"))?void 0:t.type)},w.prototype.indexProp=function(t){return w.PROP_PREFIX+this.index+"."+t},w.prototype.isCurrentTickShown=function(){return this.propertyCache[w.PROP_CURRENT_TICK]},w.prototype.isRegexOrWild=function(){var t=this.getLayerType();return t!==V.Baseline&&t!==V.Heatmap&&Y.isRegexOrWild(this.api.getProperty(this.indexProp(w.PROP_YAXIS)))},w.prototype.onData=function(t,i,e){this.renderState=G.Loaded,e&&this.appInvalidate(this.renderState),this.isCachingData()&&document.hidden&&!this.resetCache&&(this.resetCache=!0),this.isCachingData()?this.newDataLength=i.keyCol?i.keyCol.length:0:null!==this.newDataLength&&(this.newDataLength=null);var e=_.find(this.cols,function(t,e){return!i.cols||t!==i.cols[e]}),t=(this.cols=_.clone(i.cols),t.columns.collection.models.map(function(t){return t.id})),n=!_.isEqual(t,this.columns),o=this.getLayerType();if(e||n){this.resetCache=!0,this.columns=t,this.updateYAxesVals(),this.updateWildcardLayers(!1,!0);try{this.setIgnoreSettings(!0),this.api.setProperty(this.indexProp("possibleXColumns"),this.columns),this.api.setProperty(this.indexProp("possibleYColumns"),["*"].concat(this.columns)),this.api.setProperty(this.indexProp("possibleColorColumns"),["None"].concat(this.cols?Object.keys(this.cols):[]));var a,r,s,l=this.api.getProperty(this.indexProp(w.PROP_COLORDATA)),h=(!l||i.cols&&!i.cols[l]?(this.api.setProperty(this.indexProp(w.PROP_COLORDATA),"None"),this.colorData=[],this.colorDataArr=[]):this.hasColorData()&&this.cols&&(a=this.calculateColorData(l),this.setColorData(a)),this.propertyCache[w.PROP_HIGHLIGHTRULES]||this.api.getProperty(this.indexProp(w.PROP_HIGHLIGHTRULES))),p=h&&h.length,u=(p&&(r=this.cols?Object.keys(this.cols):[],this.api.setProperty(this.indexProp("possibleRulesColumns"),r),this.onHighlightRuleChange(h)),this.propertyCache[w.PROP_FILL]),c=this.propertyCache[w.PROP_FADE],d=(u&&"No Fill"!==u&&(this.isRegexOrWild()&&(this.fillPalette=this.getUpdatedPalette(this.getPaletteProperty(!0))),c||p)&&this.onLineFillChange(h),this.indexProp(w.PROP_XAXIS)),y=this.api.getProperty(d),g=(o!==V.Baseline&&(i.cols&&!i.cols[y]||!y)&&this.columns[0]&&(s=this.columns.find(function(t){return!Y.isString(i.cols[t].qtype)})||this.columns[0],this.api.setProperty(d,s)),this.indexProp(w.PROP_YAXIS)),f=this.api.getProperty(g);this.isCandlestick()?(this.setCandlestickProperties(),f&&this.api.setProperty(g,void 0)):o!==V.Baseline&&!f&&this.columns[1]&&(this.api.setProperty(g,"*"),this.setColorProperties())}catch(t){}this.setIgnoreSettings(!1),this.configure()}else this.config?this.onConfigComplete():this.appInvalidate(this.renderState);this.propertyCache[w.PROP_CURRENT_TICK]&&this.calcCurrentTickValues(),this.resetCache=!1},w.prototype.onResize=function(){this.renderState=G.Process},w.prototype.onSettingsChange=function(t){var e=[w.PROP_TYPE,w.PROP_XAXIS,w.PROP_YAXIS,w.PROP_XAXISID,w.PROP_YAXISID,w.PROP_BARWIDTHTYPE,w.PROP_BARPERCENT,w.PROP_BARFIXED,w.PROP_FILL,w.PROP_FADE,w.PROP_RADIUS_DATA,w.PROP_RADIUS_SCALE,w.PROP_SPAN_GAPS,w.PROP_COLORDATA,w.PROP_HIGHLIGHTRULES,w.PROP_X1_COORD,w.PROP_X2_COORD,w.PROP_INTERPOLATION,w.PROP_STEPPED,w.PROP_BASELINE_AXIS,w.PROP_BASELINE_VALUE,w.PROP_BUBBLES_COLOR,w.PROP_BUBBLES_OPACITY,w.PROP_LINETHICKNESS],i=t[w.PROP_DATA],n=t[w.PROP_TYPE],i=(void 0!==i&&i!==this.datasource&&n!==V.Baseline&&(this.propertyCache[w.PROP_DATA]=i,this.onDataSourceChange(i)),t[w.PROP_COLOR]),i=(""!==i&&i||this.setColorProperties(),t[w.PROP_BAR_ORIENTATION]),i=(i!==this.propertyCache[w.PROP_BAR_ORIENTATION]&&(this.propertyCache[w.PROP_BAR_ORIENTATION]=i),t[w.PROP_HIGHLIGHTRULES]),o=i&&i.length,a=(i&&!i.length&&this.highlightRules&&this.highlightRules.length&&(this.highlightRules=void 0),(o&&this.cols||n===V.Heatmap)&&e.push(w.PROP_COLOR,w.PROP_OPACITY),this.hasColorData()&&this.cols?e.push(w.PROP_OPACITY):(this.colorData=[],this.colorDataArr=[]),t[w.PROP_ICON]),a=(void 0!==a&&a!==this.icon&&(this.propertyCache[w.PROP_ICON]=a,this.onIconChange(a)),t[w.PROP_CURRENT_TICK]),a=(a!==this.propertyCache[w.PROP_CURRENT_TICK]&&((this.propertyCache[w.PROP_CURRENT_TICK]=a)?this.calcCurrentTickValues():(this.currentTickVals=[],this.appInvalidate(G.Axis))),this.isCandlestick()&&e.push(w.PROP_OPEN,w.PROP_HIGH,w.PROP_LOW,w.PROP_CLOSE,w.PROP_BEARCOLOR,w.PROP_BULLCOLOR,w.PROP_NEUTRALCOLOR,w.PROP_CANDLEWIDTHTYPE,w.PROP_CANDLEPERCENT,w.PROP_CANDLEFIXED,w.PROP_OPACITY),n===V.Bounds?e.push(w.PROP_PALETTE,w.PROP_OPACITY):n===V.Baseline&&this.setBaselineProperties(t[w.PROP_BASELINE_AXIS],t[w.PROP_BASELINE_VALUE]),t[w.PROP_CACHE_STREAMING]),n=(a!==this.propertyCache[w.PROP_CACHE_STREAMING]&&(this.propertyCache[w.PROP_CACHE_STREAMING]=a),t[w.PROP_ENABLED]),a=(n!==this.propertyCache[w.PROP_ENABLED]&&(this.propertyCache[w.PROP_ENABLED]=n,this.invalidate(G.Process)),t[w.PROP_LABEL_ENABLED]),n=(a&&(a!==this.propertyCache[w.PROP_LABEL_ENABLED]&&e.push(w.PROP_LABEL_ENABLED),this.dataLabels.onSettingsChange(t),this.invalidate(G.Uniforms)),t[w.PROP_FADE]),a=t[w.PROP_FILL];this.cols&&a&&"No Fill"!==a&&this.isEnabled()&&(n||o?this.onLineFillChange(i):this.lineFillColors=void 0,e.push(w.PROP_FILLCOLOR,w.PROP_FILLOPACITY),this.isRegexOrWild())&&e.push(w.PROP_FILLPALETTE),this.configureIfDiff(t,e),this.invalidateIfDiff(t,w.PROP_COLOR,G.Uniforms),this.invalidateIfDiff(t,w.PROP_WICKCOLOR,G.Uniforms),this.invalidateIfDiff(t,w.PROP_OPACITY,G.Uniforms),this.invalidateIfDiff(t,w.PROP_FILLCOLOR,G.Uniforms),this.invalidateIfDiff(t,w.PROP_FILLOPACITY,G.Uniforms)},w.prototype.getHeatmapScore=function(){var t=this.api.getProperty(this.indexProp(w.PROP_HEATMAP_SCORE));return this.cols?this.cols[t]:null},w.prototype.processData=function(t,e,i,n,o,a){var r,s,l,h,p,u,c,d,y,g,f,m;this.renderState===G.Process&&this.config&&(r=(s=this.config).xCol,s=s.yCols,r&&r.length&&(this.renderer&&this.renderer.remove(t),this.rendererFill&&this.rendererFill.remove(t),this.rendererBubble&&this.rendererBubble.remove(t),this.propertyCache[w.PROP_ICON]&&this.image&&this.image.height&&(this.texture=C.createTexture(t,this.image,this.index)),l=this.propertyCache[w.PROP_TYPE]||this.api.getProperty(this.indexProp(w.PROP_TYPE)),h=null!==this.texture,d=this.getAxisId("x"),y=this.getAxisId("y"),p=this.api.getProperty(this.indexProp(w.PROP_OPACITY)),u={},this.cols&&l===V.Bounds&&null!==n?u={x1:this.cols[this.api.getProperty(this.indexProp(w.PROP_X1_COORD))],x2:this.cols[this.api.getProperty(this.indexProp(w.PROP_X2_COORD))],yRange:new F(i.y,i.w),palette:this.getPaletteProperty(),opacity:p,yType:n}:l===V.Heatmap&&this.cols?u={x1:this.cols[this.api.getProperty(this.indexProp(w.PROP_HEATMAP_X1))],x2:this.cols[this.api.getProperty(this.indexProp(w.PROP_HEATMAP_X2))],y1:this.cols[this.api.getProperty(this.indexProp(w.PROP_HEATMAP_Y1))],y2:this.cols[this.api.getProperty(this.indexProp(w.PROP_HEATMAP_Y2))],score:this.cols[this.api.getProperty(this.indexProp(w.PROP_HEATMAP_SCORE))],color:this.getPaletteProperty(),opacity:p}:(this.isBar()||this.isCandlestick())&&i&&null!=e&&e.x?(n=this.api.getProperty(this.indexProp(w.PROP_BARWIDTHTYPE)),g=this.api.getProperty(this.indexProp(w.PROP_BARPERCENT))/100,m=this.api.getProperty(this.indexProp(w.PROP_BARFIXED)),g="Percentage"===n?g:m,m=this.api.getProperty("Xaxes."+d+".Stacked"),d=this.api.getProperty("Yaxes."+y+".Stacked"),y=this.api.getProperty(this.indexProp(w.PROP_INCREASE_COLOR)),f=this.api.getProperty(this.indexProp(w.PROP_DECREASE_COLOR)),c=this.getLayerColors(H.Default),u={barGrouping:o,barWidth:g,barType:n,mergedBounds:i,orientation:this.getBarOrientation()||w.BAR_VERTICAL,size:e,stacked:m&&d?"xy":m?"x":d?"y":"",waterfallInfo:l===V.Waterfall?{increaseColor:y,decreaseColor:f,defaultColor:c,opacity:p}:void 0},this.isCandlestick()&&(o=this.api.getProperty(this.indexProp(w.PROP_BEARCOLOR)),g=this.api.getProperty(this.indexProp(w.PROP_BULLCOLOR)),n=this.api.getProperty(this.indexProp(w.PROP_NEUTRALCOLOR)),m=this.api.getProperty(this.indexProp(w.PROP_CANDLEWIDTHTYPE)),d=this.api.getProperty(this.indexProp(w.PROP_CANDLEPERCENT))/100,y=this.api.getProperty(this.indexProp(w.PROP_CANDLEFIXED)),f="Percentage"===m?d:y,u=L(L({},u),{bearColor:o,bullColor:g,neutralColor:n,bodyWidth:f,opa:p,widthType:m}))):l!==V.Line&&l!==V.Baseline||(c=this.propertyCache[w.PROP_SPAN_GAPS],d=this.propertyCache[w.PROP_INTERPOLATION],y=this.propertyCache[w.PROP_STEPPED],o=this.hasBubbles(),g={lineThickness:this.propertyCache[w.PROP_LINETHICKNESS],bounds:i,size:e,xType:this.XType,yType:this.YType},u={baselineInfo:this.baselineInfo,spanGaps:c,interpolation:d,steppedLine:y,hasBubbles:o,color:this.getLayerColors(H.Default),opacity:p,lineThickness:g}),n={},this.isTriggerBreakApplied("x")&&(n.x=this.getTriggerBreakInfo("x")),this.isTriggerBreakApplied("y")&&(n.y=this.getTriggerBreakInfo("y")),a&&(n[a[1]].breaksToApply=a[0],n.zoom=a[2]),f=!this.isStreaming||this.isStreaming&&this.resetCache,this.renderer=this.config.createRenderer(t,f,this.getLayerType(),this.isWebGL2,h,u,this.colorData,new F(this.getAxisType("x"),this.getAxisType("y")),this.hasDataLabels(),this.isCachingData()?this.newDataLength:null,n),l===V.Line)&&this.hasBubbles()&&(m=this.getLayerColors(H.Bubble),u=L(L({},u),{color:m,opacity:this.propertyCache[w.PROP_BUBBLES_OPACITY]}),this.rendererBubble=this.config.createRenderer(t,f,V.LineBubble,this.isWebGL2,h,u,this.colorData,new F(this.getAxisType("x"),this.getAxisType("y")),this.hasDataLabels(),this.isCachingData()?this.newDataLength:null,n)),i=this.propertyCache[w.PROP_TYPE]===V.Line,e=this.propertyCache[w.PROP_FILL],i&&"No Fill"!==e||(this.renderState=G.Uniforms),this.setupWorker(r,s))},w.prototype.getWildcardColumns=function(){var e=this;return this.yAxes.filter(function(t){return-1===e.disabledColumns.indexOf(t)})},w.prototype.processLineFillData=function(t,e){var i,n,o,a,r;this.config&&(n=this.api.getProperty(this.indexProp(w.PROP_COLORDATA)),i=[],this.hasColorData()&&this.cols&&(n=this.calculateColorData(n),i=this.setColorData(n,!0)),n={},this.isTriggerBreakApplied("x")&&(n.x=this.getTriggerBreakInfo("x")),this.isTriggerBreakApplied("y")&&(n.y=this.getTriggerBreakInfo("y")),o=null!==this.texture,a={spanGaps:this.propertyCache[w.PROP_SPAN_GAPS],interpolation:this.propertyCache[w.PROP_INTERPOLATION],steppedLine:this.propertyCache[w.PROP_STEPPED],color:this.getLayerColors(H.Fill),opacity:this.api.getProperty(this.indexProp(w.PROP_FILLOPACITY))},r=!this.isStreaming||this.isStreaming&&this.resetCache,this.rendererFill=this.config.createRenderer(t,r,V.LineFill,this.isWebGL2,o,a,i,new F(this.getAxisType("x"),this.getAxisType("y")),!1,this.isCachingData()?this.newDataLength:null,n,[e,this.propertyCache[w.PROP_FADE]])),this.renderState=G.Uniforms},w.prototype.remove=function(t){this.cols=void 0,this.columns=[],this.config=null,this.datasource&&(this.datasource.unsubscribe(this.subId),this.datasource.off("change:queryStatus",this.datasourceStatusFn)),this.renderer&&(this.renderer.remove(t),this.renderer=null),this.rendererBubble&&(this.rendererBubble.remove(t),this.rendererBubble=null),this.rendererFill&&(this.rendererFill.remove(t),this.rendererFill=null),this.texture&&(t.deleteTexture(this.texture),this.texture=null),this.worker&&this.worker.terminate()},w.prototype.render=function(t,e,i,n,o){var a=n===H.Fill,n=n===H.Bubble,r=this.propertyCache[a?w.PROP_FILL:w.PROP_TYPE],s=this.propertyCache[w.PROP_WICKCOLOR],l=this.propertyCache[n?w.PROP_BUBBLES_COLOR:a?w.PROP_FILLCOLOR:w.PROP_COLOR],h=this.propertyCache[w.PROP_RADIUS_DATA],p=(this.propertyCache[w.PROP_RADIUS_SCALE],this.propertyCache[n?w.PROP_BUBBLES_OPACITY:a?w.PROP_FILLOPACITY:w.PROP_OPACITY]),u=this.texture?1.333*Number(this.propertyCache[w.PROP_RADIUS_SCALE]):Number(this.propertyCache[w.PROP_RADIUS_SCALE]),c=0<i?1/i:1,d=u*c,y=this.getWildcardColumns(),g=this.propertyCache[w.PROP_SPAN_GAPS],h=(i&&this.hasBubbles()&&"Fixed Size"!==h&&null!=(h=this.renderer)&&h.updatePointSizeOnZoom(c,t),n?this.rendererBubble:a?this.rendererFill:this.renderer),c=a?this.fillPalette:this.palette;o&&(this.baselineInfo.types=o),h&&h.render(t,e,this.isRegexOrWild()||r===V.Bounds?c:this.isCandlestick()?[s]:[l],i&&u<=d?d:u,n?V.Bubble:r,p,g,y,this.getBarOrientation()||w.BAR_VERTICAL,this.texture?this.index:void 0,this.cols?this.cols[this.api.getProperty(this.indexProp(w.PROP_X1_COORD))]:void 0,this.baselineInfo)},w.prototype.removeLabels=function(){this.dataLabels.removeLabels()},w.prototype.updateRenderState=function(){this.renderState=G.Process},w.prototype.getDataSource=function(){return this.getLayerType()===V.Baseline?{}:this.datasource},w.prototype.updateAxisId=function(t,i){i=i.toUpperCase();var n=[],t=(_.each(t,function(t,e){n.push(i+"-Axis "+(e+1))}),this.api.setProperty(this.indexProp("possible"+i+"Axes"),n),this.api.getProperty(this.indexProp(i+"AxisId")));n.length&&-1===n.indexOf(t)&&this.api.setProperty(this.indexProp(i+"AxisId"),i+"-Axis 1")},w.prototype.updateColumns=function(t,e){this.disabledColumns=t,e||this.configure()},w.prototype.updateLayer=function(t,e,i){var n=this;t&&this.api.setProperty(this.indexProp(w.PROP_DATA),t),_.each(e,function(t,e){n.api.setProperty(n.indexProp(i[e]),t)})},w.prototype.wildcardDataChanged=function(t){return this.isRegexOrWild()&&this.propertyCache[w.PROP_DATA]!==t},w.prototype.calcCurrentTickValues=function(){var o,a,r,t,s,l,h,p=this;this.propertyCache[w.PROP_CURRENT_TICK]&&this.cols&&this.config&&(t=this.api.getProperty("Xaxes."+this.getAxisId("x")+".Type"),t=this.getSortedIndices(t,this.config.xCol)[0])&&(o=t(this.cols[Object.keys(this.cols)[0]].length-1),a=this.getRowData(o),r=[],a&&(t=this.getAxisId("y"),s=this.api.getProperty("Yaxes."+t+X.PROP_FORMAT),l=this.api.getProperty("Yaxes."+t+X.PROP_PRECISION),h=this.api.getProperty("Yaxes."+t+X.PROP_HIDETRAIL),this.yAxes.forEach(function(t,e){i=p.getLayerType()===V.Heatmap&&p.cols?(n=p.cols[p.api.getProperty(p.indexProp(w.PROP_HEATMAP_SCORE))],i=Y.getRange(n),Yt.interpolateColor(p.palette,Number(i[0]),Number(i[1]),Number(Y.getColValue(n,o)))):p.isRegexOrWild()?p.palette[e]:p.api.getProperty(p.indexProp(w.PROP_COLOR));var i,n=Y.formatData(a[t],s,l,h);r.push([n,i])})),this.currentTickVals=r,this.appInvalidate(G.Axis))},w.prototype.calculateColorData=function(t,e){var i=[];if(this.cols&&this.cols[t]){for(var n,o=this.cols,a=[],r=[],s=function(t){return null===t?null:k.Tools.isKDBTemporal(t)?k.Tools.convertKDBTemporalToMoment(t).toDashString():Y.getValueFromObject(t)},l=0,h=0;h<o[t].length;h++)"object"==typeof(p=o[t].getValue(h))&&(p=s(p)),-1===a.indexOf(p)&&(a.push(p),n=this.getPaletteProperty(!!e),r.push(n[l%n.length]),l++);e||(this.colorDataInfo=[a,r]);for(var p,h=0;h<o[t].length;h++)"object"==typeof(p=o[t].getValue(h))&&(p=s(p)),i.push(r[a.indexOf(p)])}else this.colorDataInfo=[[],[]],this.colorData=[],this.colorDataArr=[];return i},w.prototype.configure=function(){this.config=null;var e=this.getLayerType();if(this.cols||e===V.Baseline){var i=this.cols,n=(e===V.Heatmap&&i&&(n=this.api.getProperty(this.indexProp(w.PROP_HEATMAP_SCORE)),i=_.omit(i,n)),this.indexProp(w.PROP_YAXIS)),n=this.api.getProperty(n);if(this.isCandlestick()||n||(this.setIgnoreSettings(!0),this.api.setProperty(this.indexProp(w.PROP_YAXIS),"*"),this.setIgnoreSettings(!1)),this.updateYAxesVals(),this.isRegexOrWild()&&-1===(null==n?void 0:n.indexOf("*"))){var n=_.keys(_.groupBy(this.yAxes,function(t){return i[t].qtype})),o=[E.Byte,E.Short,E.Int,E.Long,E.Double,E.Float,E.Char],a=[E.Timestamp,E.Month,E.Date,E.DateTime,E.Timespan,E.Minute,E.Second,E.Time];if(n.some(function(t){return 0<=a.indexOf(Number(t))})&&n.some(function(t){return 0<=o.indexOf(Number(t))}))return void this.api.showErrorMessage({error:t("Can't mix date types with number types on ")+"<b>"+t("Properties > Layer > Y-Axis Data")+"</b>",type:"Error"})}var n=_.difference(this.yAxes,this.disabledColumns),r=(this.setColorProperties(),this.setIgnoreSettings(!0),e===V.Bounds&&this.setBoundsProperties(),this.indexProp(e===V.Bounds?w.PROP_X1_COORD:e===V.Heatmap?w.PROP_HEATMAP_X1:w.PROP_XAXIS)),r=this.api.getProperty(r),r=(r||e===V.Bounds||this.api.setProperty(this.indexProp(w.PROP_XAXIS),this.columns[0]),this.cols?this.cols[r]:null),s=["Fixed Size"].concat(this.columns),l=this.api.getProperty(this.indexProp(w.PROP_POSSIBLE_RADIUS)),l=(e!==V.Bubble&&e!==V.Line||_.isEqual(s,l)||this.api.setProperty(this.indexProp(w.PROP_POSSIBLE_RADIUS),s),e===V.Line&&this.setLineFillProperties(),this.setIgnoreSettings(!1),n.map(function(t){return i[t]}).filter(function(t){return t})),s=this.api.getProperty(this.indexProp(w.PROP_RADIUS_DATA)),h=this.api.getProperty(this.indexProp(w.PROP_RADIUS_SCALE)),s=this.hasBubbles()&&this.cols?"Fixed Size"===s?"":this.cols[s]:null;(r&&l||e===V.Bounds||e===V.Baseline)&&(e===V.Baseline&&(r={qtype:E.Float,length:2},l=[{qtype:E.Float,length:2}]),e=Number(null==(e=null==(e=this.datasource)?void 0:e.attributes)?void 0:e._maxRows),this.config=new Gt(r,l,n,e,[s,h],this.highlightRules,this.lineFillColors),this.onConfigComplete())}},w.prototype.configureIfDiff=function(s,t){var l=this,h=!1,e=this.propertyCache[w.PROP_HIGHLIGHTRULES],p=e&&e.length,u=this.propertyCache[w.PROP_COLORDATA],c=!1,d=!1;t.forEach(function(t){var e,i,n=s.hasOwnProperty(t)&&!l.propertyCache.hasOwnProperty(t)||!_.isEqual(s[t],l.propertyCache[t]),o="Opacity"===t||"Color"===t||"YAxis"===t||"SpanGaps"===t,a="ColorData"===t,r="HighlightRules"===t;t===w.PROP_TYPE&&(e=s[t],(i=l.propertyCache[w.PROP_TYPE])&&i!==V.Line&&e===V.Line?l.api.setProperty(l.indexProp(w.PROP_RADIUS_SCALE),0):i===V.Line&&e===V.Bubble&&l.api.setProperty(l.indexProp(w.PROP_RADIUS_SCALE),4)),n&&(o||a||r)&&(p&&(d=!0),u)&&(c=!0),n&&(h=h||n,l.propertyCache[t]=_.get(s,t))}),c&&(e=this.api.getProperty(this.indexProp(w.PROP_COLORDATA)),this.hasColorData())&&(t=this.calculateColorData(e),this.setColorData(t)),d&&this.onHighlightRuleChange(this.propertyCache[w.PROP_HIGHLIGHTRULES]),h&&this.configure()},w.prototype.convertNanos=function(t,e,i){var t="x"===e||"y"===e?Math.floor(t[e]):Math.ceil(t[e]),n=this.isHorizontal()&&("y"===e||"w"===e),e="x"===e||"z"===e||n?this.XType:this.YType;return k.Tools.convertValueToMoment(Y.convertToJsScalar(e,Y.toBigInt(t)+i))},w.prototype.getAllWildcards=function(t,e,i,n){t=n(t);for(var o=i.getPoint(t),a=[],r=1;r<o.length;r++)a.push([t,Y.calculateRelativePoint(new F(o[0],o[r]),e),i.yColNames[r-1],r-1]);return a},w.prototype.getClosestPoint=function(t,e,i,n,o,a,r){for(var s=1,l=(t=n(t),i.getPoint(t,r,a)),n=this.api.getProperty("Yaxes."+this.getAxisId("y")+".Stacked"),h=this.getStackedYData(),p=n&&h&&this.getLayerType()===V.Bar,r=p?h[0][t]:l[1],u=Math.abs(o-Y.calculateRelativeValue(r,e.y,e.w)),c=2;c<l.length;c++){var d=l[c],d=(p&&(d=h[c-1][t]),Y.calculateRelativeValue(d,e.y,e.w)),d=Math.abs(d-o);(d<u||isNaN(Number(l[s])))&&(u=d,s=c)}a=Y.calculateRelativePoint(new F(l[0],l[s]),e),this.getAxisType("x")===X.TYPE_CATEGORY&&(a=new F(l[0],a.y)),this.getAxisType("y")===X.TYPE_CATEGORY&&(a=new F(a.x,l[s])),n=this.isHorizontal();return n&&(a=Y.calculateRelativePoint(new F(l[s],l[0]),new M(e.y,e.x,e.w,e.z))),p&&(r=h[s-1][t],r=Y.calculateRelativeValue(r,e.y,e.w),a=new F(n?r:a.x,n?a.y:r)),[t,a,i.yColNames[s-1],s-1]},w.prototype.getClosestXPoint=function(i,n,e,o,a){var r=i[0],t=i.map(function(t){return e.getPoint(o(t))[0]}),s=Math.abs(a-Y.calculateRelativeValue(t[0],n.x,n.z));return _.each(t,function(t,e){"number"!=typeof t&&"bigint"!=typeof t||(t=Y.calculateRelativeValue(t,n.x,n.z),(t=Math.abs(t-a))<s&&(s=t,r=i[e]))}),r},w.prototype.getLayerColors=function(t){var e=w.PROP_COLOR;return t===H.Fill?e=w.PROP_FILLCOLOR:t===H.Bubble&&(e=w.PROP_BUBBLES_COLOR),this.isRegexOrWild()||this.getLayerType()===V.Heatmap?this.palette.length?this.palette:this.getUpdatedPalette(this.getPaletteProperty(t===H.Fill)):[this.propertyCache[e]||this.api.getProperty(this.indexProp(e))]},w.prototype.getSortedIndices=function(t,e){var i,n;return[t!==X.TYPE_CATEGORY&&e.hasIndex&&e.hasIndex()?(i=e.length,function(t){return e.getIndexFromSortedIndex(t)}):this.workerIndex.length?(i=this.workerIndex.length,n=this.workerIndex,function(t){return n[t]}):null,i]},w.prototype.getTriggerBreakInfo=function(t){var e=this.getAxisId(t),t=t.toUpperCase()+"axes.";return{breakVal:this.api.getProperty(t+e+X.PROP_BREAK),triggerBreak:this.api.getProperty(t+e+X.PROP_TRIGGER_BREAK)}},w.prototype.getUpdatedPalette=function(t){for(var e=this.getAllCols(),i=0,n=[];n.length<e.length;)n[i]=t[i%t.length],i++;var o=this.disabledColumns;return _.each(o,function(t){return n[e.indexOf(t)]=""}),n.filter(function(t){return 0<t.length})},w.prototype.getY=function(i,n,e,o,a,r){var s,l,h,t,p,u=this,c=i[0],d=[];return _.each(i,function(t){t=o(t),(s=e.getPoint(t,r))&&(2<s.length?d.push(s.slice(1)):d.push(s[1]))}),d.length?(t=(2<s.length?d[0]:d)[0],p=Math.abs(a-Y.calculateRelativeValue(t,n.y,n.w)),_.each(d,function(t,e){2<s.length&&Array.isArray(t)?_.each(t,function(t){l=Y.calculateRelativeValue(t,n.y,n.w),(h=Math.abs(l-a))<p&&(p=h,c=i[e])}):"number"!=typeof t&&"bigint"!=typeof t||(u.getAxisType("y")===X.TYPE_CATEGORY&&(t=i[e]/u.workerIndex.length),l=Y.calculateRelativeValue(t,n.y,n.w),(h=Math.abs(l-a))<p&&(p=h,c=i[e]))}),c):null},w.prototype.getYAxesVals=function(){var t,e,i=this.cols,n=this.getLayerType();return i&&n!==V.Baseline?(e=this.api.getProperty(this.indexProp(w.PROP_XAXIS)),t=n===V.Heatmap?"*":this.api.getProperty(this.indexProp(w.PROP_YAXIS)),n=this.isRegexOrWild()||n===V.Heatmap?this.getColumnKeysFromAxisString(t):[t],t&&-1!==t.indexOf("*")&&(t=_.without(n,e),e=_.maxBy(_.values(_.groupBy(t,function(t){return i[t].qtype})),function(t){return t.length}))?e:n):this.yAxes},w.prototype.hasBubbles=function(){var t=this.getLayerType(),e=this.api.getProperty(this.indexProp(w.PROP_RADIUS_SCALE));return t===V.Bubble||t===V.Line&&0<e},w.prototype.invalidate=function(t){t<this.renderState&&(this.renderState=t),this.appInvalidate(this.renderState)},w.prototype.invalidateIfDiff=function(t,e,i){void 0!==t[e]&&t[e]!==this.propertyCache[e]&&(this.propertyCache[e]=t[e],this.invalidate(i))},w.prototype.isCachingData=function(){return this.propertyCache[w.PROP_CACHE_STREAMING]&&this.isStreaming&&!this.resetCache},w.prototype.isTriggerBreakApplied=function(t){var e=this.getAxisId(t),t=t.toUpperCase()+"axes.",i=this.api.getProperty(t+e+X.PROP_TYPE),t=this.api.getProperty(t+e+X.PROP_DISTRIBUTION);return i===X.TYPE_TIME&&"Smart"===t},w.prototype.onDataSourceChange=function(t){var i=this;this.datasource&&(this.datasource.unsubscribe(this.subId),this.datasource.off("change:queryStatus",this.datasourceStatusFn)),this.datasource=t,this.datasource?(this.cols=void 0,this.columns=[],this.isStreaming="streaming"===this.datasource.attributes._subscriptionType,this.renderState=G.Data,this.datasource.subscribe(this.subId,this,!0),this.datasourceStatusFn=function(t,e){e&&"Loading"===e.type&&i.invalidate(G.Data)},this.datasource.on("change:queryStatus",this.datasourceStatusFn)):(this.renderState=G.Init,this.isStreaming=!1),this.appInvalidate(this.renderState)},w.prototype.onConfigComplete=function(){this.renderState=G.Process,this.appInvalidate(this.renderState)},w.prototype.onLineFillChange=function(t){var e=this,i=this.api.getProperty(this.indexProp(w.PROP_FILL)),n=this.api.getProperty(this.indexProp(w.PROP_FADE)),o=this.api.getProperty(this.indexProp(w.PROP_FILLOPACITY)),a=this.api.getProperty(this.indexProp(w.PROP_YAXIS)),r=this.propertyCache[w.PROP_SPAN_GAPS],s=this.propertyCache[w.PROP_INTERPOLATION],l=this.getLayerColors(H.Fill),h=this.getColumnKeysFromAxisString(a),p={},t=(_.keys(this.cols).forEach(function(t){-1!==h.indexOf(t)&&e.cols&&(p[t]=e.cols[t])}),Vt.computeHighlightRules(t,l,this.propertyCache[w.PROP_XAXIS],a,this.cols,p,n,l,r,"Stepped"===s,this.colorDataArr));this.lineFillColors=Vt.getColorArray(t,0,i&&"No Fill"!==i,o)},w.prototype.onHighlightRuleChange=function(t){var e=this,i=this.propertyCache[w.PROP_TYPE],n=i===V.Heatmap?"*":this.api.getProperty(this.indexProp(w.PROP_YAXIS)),o=this.propertyCache[w.PROP_SPAN_GAPS],a=this.propertyCache[w.PROP_INTERPOLATION],r=this.getLayerColors(H.Default),s=(i!==V.Line||!this.hasBubbles()||(this.isRegexOrWild()||this.propertyCache[w.PROP_COLOR]===this.propertyCache[w.PROP_BUBBLES_COLOR])&&this.propertyCache[w.PROP_OPACITY]===this.propertyCache[w.PROP_BUBBLES_OPACITY]||(r=[]),this.api.getProperty(this.indexProp(w.PROP_OPACITY))),l=this.getColumnKeysFromAxisString(n),h={},p=(_.keys(this.cols).forEach(function(t){-1!==l.indexOf(t)&&e.cols&&(h[t]=e.cols[t])}),this.api.getProperty(this.indexProp(w.PROP_HEATMAP_SCORE))),u=this.cols?this.cols[p]:null,t=Vt.computeHighlightRules(t,r,this.api.getProperty(this.indexProp(w.PROP_XAXIS)),n,this.cols,h,!1,"",i===V.Line&&o,i===V.Line&&"Stepped"===a,this.colorDataArr,i===V.Heatmap?{col:u,name:p}:void 0),r=this.cols?Object.keys(this.cols):[];this.api.setProperty(this.indexProp("possibleRulesColumns"),r),this.colorArr=t,this.highlightRules=Vt.getColorArray(t,s)},w.prototype.onIconChange=function(t){var e,i=this;if(this.icon=t){if(0===t.indexOf("fa-"))e=requirejs.toUrl("QuickBase").replace(/main$/,"")+"images/white/"+t.replace(/^fa-/,"")+".png";else{if(0!==t.indexOf("data:image/"))throw Error("Unsupported icon scheme!");e=t}this.image||(this.image=document.createElement("img")),this.el.append(this.image),this.image.height=1,this.image.style.visibility="hidden",this.image.src=e,this.image.onload=function(){i.image&&i.el.removeChild(i.image),i.invalidate(G.Process)}}else this.texture=null,this.invalidate(G.Process)},w.prototype.setBaselineProperties=function(t,e){!this.api.getProperty(this.indexProp(w.PROP_DATA))&&this.datasource&&(this.datasource.unsubscribe(this.subId),this.datasource.off("change:queryStatus",this.datasourceStatusFn));var t="X-Axis"===t?"x":"y",i=k.Tools.inferKdbTypeFromDashString(e),i=Number(null==i?void 0:i.slice(-2))||E.Float,n=/\S/.test(e)?Y.convertStringToScalar(e,Y.ipcTemp(i)):0,o=n,n=Y.convertToJsScalar(i,n,!0);this.baselineInfo=L(L({},this.baselineInfo),{axis:t,type:i,value:e,scalarVal:o,jsVal:n}),this.baselineInfo.types&&(this.baselineInfo.types[t]=i)},w.prototype.setBoundsProperties=function(){var t=this.api.getProperty(this.indexProp(w.PROP_X1_COORD)),e=this.api.getProperty(this.indexProp(w.PROP_X2_COORD));(!t||this.cols&&!this.cols[t]&&this.columns[0])&&this.api.setProperty(this.indexProp(w.PROP_X1_COORD),this.columns[0]),(!e||this.cols&&!this.cols[e]&&this.columns[1])&&this.api.setProperty(this.indexProp(w.PROP_X2_COORD),this.columns[1]),this.api.setProperty(this.indexProp(w.PROP_XAXIS),void 0),this.api.setProperty(this.indexProp(w.PROP_YAXIS),void 0),this.api.setProperty(this.indexProp(w.PROP_COLOR),void 0),this.api.setProperty(this.indexProp(w.PROP_COLORDATA),void 0),this.api.setProperty(this.indexProp(w.PROP_HIGHLIGHTRULES),void 0)},w.prototype.setCandlestickProperties=function(){var n=this,o=this.columns,a=this.api.getProperty(this.indexProp(w.PROP_XAXIS)),t=[w.PROP_OPEN,w.PROP_HIGH,w.PROP_LOW,w.PROP_CLOSE],r=[w.PROP_YAXIS,w.PROP_COLORDATA,w.PROP_COLOR];this.setIgnoreSettings(!0),t.forEach(function(t,e){var i=n.indexProp(t);n.api.getProperty(i)||n.api.setProperty(i,-1!==o.indexOf(t)?t:a),r[e]&&(i=n.indexProp(r[e]),n.api.getProperty(i))&&n.api.setProperty(i,void 0)}),this.setIgnoreSettings(!1)},w.prototype.setColorData=function(e,t){var i=[],n=t?this.propertyCache[w.PROP_FILLOPACITY]:this.propertyCache[w.PROP_OPACITY],o=(_.each(e,function(t){t=Mt.hexColorToVec4(t,n);i.push(Object.values(t))}),this.api.getProperty(this.indexProp(w.PROP_XAXIS))),o=this.yAxes.length?this.yAxes:_.without(this.columns,o),o=(this.colorDataArr=this.isRegexOrWild()?o.map(function(t){return e}):[e],this.isRegexOrWild()?o.map(function(t){return i}):[i]);return t||(this.colorArr=this.colorDataArr,this.colorData=o),o},w.prototype.setColorProperties=function(){this.setIgnoreSettings(!0);var t=this.indexProp(w.PROP_COLOR),e=this.api.getProperty(t),i=this.indexProp(w.PROP_BUBBLES_COLOR),n=this.getLayerType();this.isRegexOrWild()||this.isCandlestick()||n===V.Bounds||n===V.Heatmap?(void 0!==e&&(this.colorCache=e),this.api.setProperty(t,void 0),this.api.setProperty(i,void 0)):void 0!==e&&""!==e||(n=this.colorCache||I.COLOR_DEFAULT,this.api.setProperty(t,n),this.propertyCache[w.PROP_COLOR]=n,this.api.setProperty(i,n),this.propertyCache[w.PROP_BUBBLES_COLOR]=n),this.setIgnoreSettings(!1)},w.prototype.setLineFillProperties=function(){var t=this.api.getProperty(this.indexProp(w.PROP_FILLCOLOR)),e=this.api.getProperty(this.indexProp(w.PROP_FILLOPACITY)),i=this.api.getProperty(this.indexProp(w.PROP_FADE));"No Fill"===this.api.getProperty(this.indexProp(w.PROP_FILL))?(this.fillCache=[t||this.fillCache[0],e||this.fillCache[1],i||this.fillCache[2]],this.api.setProperty(this.indexProp(w.PROP_FILLCOLOR),void 0),this.api.setProperty(this.indexProp(w.PROP_FILLOPACITY),void 0),this.api.setProperty(this.indexProp(w.PROP_FADE),void 0)):(void 0!==t||this.isRegexOrWild()?void 0!==t&&this.isRegexOrWild()&&(this.fillCache[0]=t,this.api.setProperty(this.indexProp(w.PROP_FILLCOLOR),void 0)):this.api.setProperty(this.indexProp(w.PROP_FILLCOLOR),this.fillCache[0]||this.propertyCache[w.PROP_COLOR]),void 0===e&&this.api.setProperty(this.indexProp(w.PROP_FILLOPACITY),this.fillCache[1]||80),void 0===i&&this.api.setProperty(this.indexProp(w.PROP_FADE),this.fillCache[2]||!1))},w.prototype.setupWorker=function(t,e){var n=this,o=(this.workerIndex=[],this.isHorizontal()?"y":"x"),i=this.getAxisId(o),a=this.api.getProperty(o.toUpperCase()+"axes."+i+".Type");a!==X.TYPE_CATEGORY&&t.hasIndex&&t.hasIndex()||!e.length?this.worker&&(this.worker.terminate(),this.worker=null):(this.worker||(i=requirejs.toUrl("ChartGL").slice(0,-4)+"worker.js",this.worker=new Worker(i),this.worker.onmessage=function(t){"ready"!==t.data||n.workerQueued?(n.workerIndex=t.data,n.propertyCache[w.PROP_CURRENT_TICK]?n.calcCurrentTickValues():n.invalidate(G.Tooltip)):(n.workerQueued=!0,window.requestAnimationFrame(function(){var t,e,i;n.Config&&n.Config.xCol&&(t=n.getLayerType()===V.Bounds,e=n.Config.xCol,i=null==(i=n.renderer)?void 0:i.getCategoryData(o),i=(i=n.isHorizontal()?i&&[i[0][0],i[1][0]]:i)&&a===X.TYPE_CATEGORY?JSON.parse(JSON.stringify(i[0])):e.toTypedArray?e.toTypedArray():{},n.workerQueued=!1,n.worker)&&n.worker.postMessage([e.qtype,i,a,t])}))},this.worker.onerror=function(t){return k.Log.Error(t)}),t&&e.length&&this.worker.postMessage("queue"))},w.prototype.updateYAxesVals=function(){var t,e=this,i=this.getYAxesVals();this.isCandlestick()&&(this.setCandlestickProperties(),i=[w.PROP_OPEN,w.PROP_HIGH,w.PROP_LOW,w.PROP_CLOSE].map(function(t){return e.api.getProperty(e.indexProp(t))})),_.isEqual(this.yAxes,i)||(1===i.length?this.disabledColumns=[]:(t=this.isEnabled()?this.disabledColumns.filter(function(t){return-1!==i.indexOf(t)}):i,this.disabledColumns=t,this.appInvalidate(G.Legend)),this.yAxes=i)},w.BAR_HORIZONTAL="Horizontal",w.BAR_VERTICAL="Vertical",w.PROP_DATA="Data",w.PROP_TYPE="_Type",w.PROP_XAXIS="XAxis",w.PROP_YAXIS="YAxis",w.PROP_COLOR="Color",w.PROP_BARPERCENT="BarWidth",w.PROP_BARFIXED="BarFixedWidth",w.PROP_BAR_ORIENTATION="BarOrientation",w.PROP_BARWIDTHTYPE="BarWidthType",w.PROP_BASELINE_AXIS="Axis",w.PROP_BASELINE_VALUE="Value",w.PROP_BEARCOLOR="CandlestickFormat.BearColor",w.PROP_BUBBLES_COLOR="Bubbles.Color",w.PROP_BUBBLES_OPACITY="Bubbles.Opacity",w.PROP_CANDLEPERCENT="CandlestickFormat.BarWidth",w.PROP_CANDLEFIXED="CandlestickFormat.BarFixedWidth",w.PROP_CANDLEWIDTHTYPE="CandlestickFormat.BarWidthType",w.PROP_CURRENT_TICK="ShowCurrentTick",w.PROP_BULLCOLOR="CandlestickFormat.BullColor",w.PROP_NEUTRALCOLOR="CandlestickFormat.NeutralColor",w.PROP_FADE="Line.FadeToTransparent",w.PROP_FILL="Line.Fill",w.PROP_FILLCOLOR="Line.FillColor",w.PROP_FILLOPACITY="Line.FillOpacity",w.PROP_FILLPALETTE="Line.FillPalette",w.PROP_HEATMAP_X1="HeatmapX1",w.PROP_HEATMAP_X2="HeatmapX2",w.PROP_HEATMAP_Y1="HeatmapY1",w.PROP_HEATMAP_Y2="HeatmapY2",w.PROP_HEATMAP_SCORE="Score",w.PROP_ICON="Bubbles.Icon",w.PROP_INTERPOLATION="Line.Interpolation.Interpolation",w.PROP_STEPPED="Line.Interpolation.SteppedLine",w.PROP_INCREASE_COLOR="IncreaseColor",w.PROP_DECREASE_COLOR="DecreaseColor",w.PROP_LINETHICKNESS="Line.LineThickness",w.PROP_PALETTE="Palette",w.PROP_RADIUS_SCALE="Bubbles.RadiusScaling",w.PROP_SCALE_ZOOM="Bubbles.ScaleOnZoom",w.PROP_SPAN_GAPS="Line.SpanGaps",w.PROP_WICKCOLOR="CandlestickFormat.WickColor",w.PROP_ACTIONS="Actions",w.PROP_HIGHLIGHTRULES="HighlightRules",w.PROP_X1_COORD="x1",w.PROP_X2_COORD="x2",w.PROP_XAXISID="XAxisId",w.PROP_YAXISID="YAxisId",w.BAR_MIN_RELATIVE_SZ=.02,w.PROP_CACHE_STREAMING="CacheStreamingData",w.PROP_COLORDATA="ColorData",w.PROP_ENABLED="Enabled",w.PROP_OPACITY="Opacity",w.PROP_PREFIX="Layers.",w.PROP_RADIUS_DATA="Bubbles.RadiusData",w.PROP_OPEN="Open",w.PROP_HIGH="High",w.PROP_LOW="Low",w.PROP_CLOSE="Close",w.PROP_LABEL_ENABLED="Labels.Enabled",w.PROP_POSSIBLE_RADIUS="possibleRadiusData";var z=w;function w(t,e,i,n,o,a,r){this.index=t,this.uid=e,this.api=i,this.appInvalidate=n,this.setIgnoreSettings=o,this.el=a,this.updateWildcardLayers=r,this.config=null,this.colorArr=[],this.colorCache=null,this.colorData=[],this.colorDataArr=[],this.colorDataInfo=null,this.columns=[],this.currentTickVals=[],this.datasource=null,this.disabledColumns=[],this.fillCache=[],this.icon="",this.image=null,this.isStreaming=!1,this.isWebGL2="undefined"!=typeof WebGL2RenderingContext,this.newDataLength=null,this.palette=[],this.fillPalette=[],this.points=[],this.propertyCache={},this.renderer=null,this.rendererFill=null,this.rendererBubble=null,this.resetCache=!0,this.texture=null,this.subId=_.uniqueId("glLayer"),this.renderState=G.Init,this.workerIndex=[],this.worker=null,this.workerQueued=!1,this.yAxes=[],this.dataLabels=new ae(this.el.getElementsByClassName("data-labels")[0],this.api,this.getRowData.bind(this))}Ut=Backbone.View,x(Zt,Ut),Zt.prototype.remove=function(){return this.lnkCsvExport&&this.lnkCsvExport.removeEventListener("click",_.bind(this.fileExport.bind(this),".csv"),!1),this.lnkExcelExport&&this.lnkExcelExport.removeEventListener("click",_.bind(this.fileExport.bind(this),".xlsx"),!1),this.lnkPngExport&&this.lnkPngExport.removeEventListener("click",_.bind(this.downloadImage.bind(this),".png"),!1),this.stopListening(),Backbone.View.prototype.remove.apply(this)},Zt.prototype.getWidth=function(){var t=this.api.getProperty("FileExport");return t.ShowExportCsvButton||t.ShowExportExcelButton||t.ShowExportPngButton?Zt.LEGEND_WIDTH:0},Zt.prototype.displayChoiceLinkButtons=function(){var t=this.api.getProperty("FileExport");!t||_.keys(t).length<3||(t.ShowExportCsvButton||t.ShowExportExcelButton||t.ShowExportPngButton?this.lnkCsvExport&&this.lnkExcelExport&&this.lnksExport&&this.lnkPngExport&&(this.lnksExport.classList.remove("link-disabled"),this.lnkCsvExport.classList.toggle("link-disabled",!t.ShowExportCsvButton),this.lnkExcelExport.classList.toggle("link-disabled",!t.ShowExportExcelButton),this.lnkPngExport.classList.toggle("link-disabled",!t.ShowExportPngButton)):(this.lnksExport&&this.lnksExport.classList.add("link-disabled"),this.lnkCsvExport&&this.lnkCsvExport.classList.add("link-disabled"),this.lnkExcelExport&&this.lnkExcelExport.classList.add("link-disabled"),this.lnkPngExport&&this.lnkPngExport.classList.add("link-disabled")),this.onResize())},Zt.prototype.initializeEvents=function(){var t=this;this.lnkCsvExport&&this.lnkCsvExport.addEventListener("click",function(){t.fileExport(".csv")}),this.lnkExcelExport&&this.lnkExcelExport.addEventListener("click",function(){t.fileExport(".xlsx")}),this.lnkPngExport&&this.lnkPngExport.addEventListener("click",function(){t.downloadImage(".png")})},Zt.prototype.downloadImage=function(t){var i=this.api,n=this.getExportData(),o=this.getDashboardInfo(),a=k.ExportTools.getExportFileName(this.getFileName(i),"","Screenshot")+t;this.generateImage(function(t,e){k.Tools.fileSave(a,t,e),i.onTransferAction({actions:i.getProperty("FileExport.Actions"),component:"ChartGL",dashboardName:_.get(o,"dashboardName")?o.dashboardName:"",dashboardId:_.get(o,"dashboardId")?o.dashboardId:"",fileLength:_.get(n,"dataset")?n.dataset.length:0},a,_.isNil(n.meta)?"na":n.meta,"success","png",i.humanFileSize(t.size))})},Zt.prototype.generateImage=function(r){var s=this,l=this.el.parentElement,h=l.getElementsByClassName("export-div")[0],p=l.getElementsByClassName("draw-div")[0];_.isNil(h)||h.classList.add("link-hide"),_.isNil(p)||p.classList.add("link-hide"),html2canvas(l,{onrendered:function(t){var e="Light"===s.theme?"#F8F8F8":"#282828",i=l.clientHeight,n=l.clientWidth,o=document.createElement("canvas"),a=(o.width=n,o.height=i,o.getContext("2d"));a.fillStyle=e,a.fillRect(0,0,n,i),a.drawImage(t,0,0),_.isNil(h)||h.classList.remove("link-hide"),_.isNil(p)||p.classList.remove("link-hide"),s.isIE?(e=o.toDataURL("image/png"),r(k.Tools.convertDataUrlToBlob(e),"image/png")):a.canvas.toBlob(function(t){r(t,"application/octet-stream")})}})},Zt.prototype.mergeArray=function(t,e,i){return Object.values(_.merge(_.keyBy(t,i),_.keyBy(e,i)))},Zt.prototype.getFileName=function(i){return _.map(i.getProperty("FileExport.FileName"),function(t,e){return(t=null!==(t=i.getProperty("FileExport.FileName."+e+".FileNamePart"))&&!_.isObject(t)?t:"").toString()}).join("")},Zt.prototype.getExportData=function(){var i=this,y=[],g=this.api,f=[],m=g.getProperty("FileExport.UseChartFormat"),o=[];return _.each(this.layers,function(h,p){if(h.isEnabled()){var e=[],u=_.get(h,"propertyCache.XAxis");if(!_.isNil(u)){var c=_.get(h,"config.yColNames");if(c){var n=[u].concat(c),d=_.get(h,"cols");if(_.get(d,u)){for(var t=0;t<d[u].length;t++)!function(i){var t=Object.assign.apply(Object,B([{}],_.flatMap(n,function(t){var e={};return e[0<=c.indexOf(t)?t+"_"+p:t]=d[t].getValue(i),e}),!1));e.push(t)}(t);o=i.mergeArray(o,e,u)}_.each(n,function(e,t){var i,n,o,a,r,s,l;_.find(y,function(t){return e===t.colId})||(i=(i=u===e?"x":"y").toUpperCase()+"axes."+h.getAxisId(i),n=0<=c.indexOf(e)?e+"_"+p:e,f.indexOf(n)<0&&f.push(n),null!=(o=_.get(d,e))&&o.qtype&&(o="",a="string",r=d[e].qtype,s=g.getProperty(i+".Format.Format"),l=(l=g.getProperty(i+".Format.Precision"))?"."+Array(l+1).join("0"):"",m&&0<=[5,6,7,8,9].indexOf(r)&&("Smart Number"===s?o="SmartNumber":"Formatted Number"===s?o="#,##0":"Number"===s&&(o="#0"),o+=l,a="Number"),y.push({colId:n,colName:1!==t||h.isRegexOrWild()?e:h.getLayerName(),dataFormat:o,dataKdbType:r,dataType:a,hideTrailingZeroes:g.getProperty(i+".Format.HideTrailingZeroes"),prefix:g.getProperty(i+".Format.Prefix"),suffix:g.getProperty(i+".Format.Suffix")})))})}}}}),{meta:y,dataset:o,allCols:f}},Zt.prototype.fileExport=function(t){var e=this.api,i=k.ExportTools,n=this.getExportData(),o=n.meta,a=n.allCols,n=n.dataset,e=(e=this.getFileName(e)).replace(/[^a-z0-9]/gi,"_"),n=(_.each(n,function(e){_.each(_.difference(a,Object.keys(e)),function(t){e[t]=null})}),{actions:this.api.getProperty("FileExport.Actions"),configSets:{chartGLExport:{dataSet:n,metaData:o}},fileFormat:t,fileName:e||"ChartGL_Export",selectedDashboard:this.getDashboardInfo(),workSheetTitle:"ChartGL"});i.openFileExportDialog(n)},Zt.prototype.getDashboardInfo=function(){var t=this.dashboardViewModel.get("selectedDocumentId");return{dashboardId:t,dashboardName:this.api.getDashboardName(t)}},Zt.prototype.renderLinks=function(){this.lnksExport=this.el.querySelectorAll(".lnksExport")[0],this.lnkCsvExport=this.el.querySelectorAll("a.lnkCsvExport")[0],this.lnkExcelExport=this.el.querySelectorAll("a.lnkExcelExport")[0],this.lnkPngExport=this.el.querySelectorAll("a.lnkPngExport")[0]},Zt.LEGEND_WIDTH=120;var Ut,Wt=Zt;function Zt(t){var e=Ut.call(this,t)||this;return e.getCanvas=t.getCanvas,e.api=t.api,e.layers=t.layers,e.onResize=t.onResize,e.el=t.el,e.el.innerHTML=N.fileExporter({}),e.theme=t.theme,e.dashboardViewModel=t.dashboardViewModel,e.isIE=!1,HTMLCanvasElement&&HTMLCanvasElement.prototype&&_.get(HTMLCanvasElement.prototype,"msToBlob")&&(e.isIE=!0),e.render(),e.renderLinks(),e.initializeEvents(),e}jt.prototype.getPixelPosFromAxisDataValue=function(t,e,i){var n=Number(i[0].x),e=(e-n)/(Number(i[0].y)-n-(Number(i[0].x)-n)),i=t?e*this.gl.canvas.width:(1-e)*this.gl.canvas.height;return i},jt.prototype.getChartAxisDataValueFromPixelPos=function(t,e,i){var e=e/(t?this.gl.canvas.width:this.gl.canvas.height),n=Number(i[0].x),i=Number(i[0].y),e=(i-n)*e,t=t?n+e:i-e;return t},jt.prototype.convertPositionDataToPixels=function(t,e,i,n,o,a,r){for(var s=[],l=0;l<t.options.aPositionData.length;l++){var h=void 0;l%2==0?h=this.getPixelPosFromAxisDataValue(!0,t.options.aPositionData[l],e?a:n):l%2==1&&(h=this.getPixelPosFromAxisDataValue(!1,t.options.aPositionData[l],i?r:o)),s.push(h)}return s},jt.prototype.renderBuffers=function(t,e,i,n,o,a,r){for(var s=this.gl,l=s.createBuffer(),h=this.vertexShader.attributes,p=0;p<h.length;p++){var u=h[p].name,c=t.attributes[u],d=s.createBuffer(),d=(s.bindBuffer(s.ARRAY_BUFFER,d),"aPosition"===u?(d=this.convertPositionDataToPixels(t,e,i,n,o,a,r),t.updatePosition(d),s.bufferData(s.ARRAY_BUFFER,new Float32Array(d),s.STATIC_DRAW)):s.bufferData(s.ARRAY_BUFFER,c.bufferData,s.STATIC_DRAW),s.getAttribLocation(this.program,u));s.enableVertexAttribArray(d),s.vertexAttribPointer(d,c.size,s.FLOAT,!1,t.stride,c.offset)}t.indices&&(s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,l),s.bufferData(s.ELEMENT_ARRAY_BUFFER,t.indices,s.STATIC_DRAW));l=s.getUniformLocation(this.program,"u_resolution");s.uniform2f(l,s.canvas.width,s.canvas.height)},jt.getParmsFromShader=function(t,e){for(var i=[],n=t.split("\n"),o=0;o<n.length;o++){var a,r=n[o].trim();r.slice(0,e.length)===e&&(a=(r=r.split(" "))[2].slice(0,r[2].length-1),i.push({type:r[1],name:a}))}return i},jt.getAttributes=function(t){return jt.getParmsFromShader(t,Y.isWebGL2?"in":"attribute")},jt.getVaryings=function(t){return jt.getParmsFromShader(t,Y.isWebGL2?"out":"varying")},jt.getUniforms=function(t){return jt.getParmsFromShader(t,"uniform")};var Jt=jt;function jt(t,e){var i=N.annotateVertex({isWebGL2:e}),n=N.annotateFragment({isWebGL2:e});this.isWebGL2=e,this.gl=t,this.vertexShader={shader:C.createShader(t,t.VERTEX_SHADER,i),attributes:jt.getAttributes(i)},this.fragmentShader={shader:C.createShader(t,t.FRAGMENT_SHADER,n),attributes:jt.getAttributes(n)},this.program=C.createProgram(t,this.vertexShader.shader,this.fragmentShader.shader)}r.prototype.updatePosition=function(t){this.aPosition=t,this.attributes.aPosition.bufferData=new Float32Array(t)},r.prototype.updateColor=function(t){this.options.aColor=t;t=Mt.hexColorToVec4(t,this.annotateType===r.RECTANGLE?50:100),t=[t.x,t.y,t.z,t.w],t=B(B(B(B([],t,!0),t,!0),t,!0),t,!0);this.attributes.aColor.bufferData=new Float32Array(t)},r.prototype.updateColorStyleProperty=function(t,e){this.options[t]=e,this[t]=Y.hex2RGB(e)},r.prototype.updateOpacityStyleProperty=function(t,e){this.options[t]=e,this[t]=e/100},r.prototype.updateStyleProperty=function(t,e){t&&(this.options[t]=e,this[t]=e)},r.prototype.copyTextStyleProperty=function(t){this.text=t.text,this.fontSize=t.fontSize,this.fontBold=t.fontBold,this.textMargin=t.textMargin,this.updateColor(t.options.aColor),this.borderThickness=t.borderThickness,this.updateColorStyleProperty("borderColor",t.options.borderColor),this.updateOpacityStyleProperty("borderOpacity",t.options.borderOpacity),this.updateColorStyleProperty("fillColor",t.options.fillColor),this.updateOpacityStyleProperty("fillOpacity",t.options.fillOpacity),this.anchorPosition=t.anchorPosition},r.prototype.setReadState=function(){this.attributes.aColorBackup=this.attributes.aColor,this.attributes.aColor=this.attributes.aSelColor},r.prototype.setDrawState=function(){this.attributes.aColor=this.attributes.aColorBackup},r.getShapeType=function(t){var e;switch(t){case r.TREND_LINE:e=r.SHAPE_LINE;break;case r.RECTANGLE:case r.HORIZONTAL_LINE:case r.VERTICAL_LINE:case r.TEXT_NOTE:e=r.SHAPE_RECTANGLE;break;default:e=r.SHAPE_POINT}return e},r.getAnnotateTypeText=function(t){var e="";switch(t){case r.TREND_LINE:e="Trend line";break;case r.HORIZONTAL_LINE:e="Horizontal line";break;case r.VERTICAL_LINE:e="Vertical line";break;case r.RECTANGLE:e="Rectangle";break;case r.TEXT_NOTE:e="Text note"}return e},r.getIdFromSelColor=function(t){return t[0]+(t[1]<<8)+(t[2]<<16)+(t[3]<<24)},r.createSelColor=function(t){return[(t>>0&255)/255,(t>>8&255)/255,(t>>16&255)/255,(t>>24&255)/255]},r.DEFAULT_FONT_SIZE=12,r.DEFAULT_TEXT_MARGIN=7,r.DEFAULT_BORDER_THICKNESS=2,r.DEFAULT_BORDER_OPACITY=100,r.DEFAULT_FILL_OPACITY=20,r.DEFAULT_ANCHOR_POSITION="topLeft",r.TREND_LINE="trend-line",r.HORIZONTAL_LINE="horizontal-line",r.VERTICAL_LINE="vertical-line",r.RECTANGLE="rectangle",r.TEXT_NOTE="text-note",r.SHAPE_POINT="point",r.SHAPE_LINE="line",r.SHAPE_RECTANGLE="rectangle";var v=r;function r(t){this.text="",this.options=t||{},this.id=this.options.id,this.stride=0,this.annotateType=this.options.annotateType,this.shapeType=this.options.shapeType||r.getShapeType(this.options.annotateType);var t=Mt.hexColorToVec4(this.options.aColor,this.annotateType===r.RECTANGLE?50:100),t=[t.x,t.y,t.z,t.w],t=B(B(B(B([],t,!0),t,!0),t,!0),t,!0),e=(this.indices=null,this.shapeType===r.SHAPE_RECTANGLE&&(this.indices=this.annotateType===r.TEXT_NOTE?new Uint16Array([0,1,2,2,3,0]):new Uint16Array([0,1,2,1,2,3])),this.text=this.options.text||"",this.fontSize=this.options.fontSize||r.DEFAULT_FONT_SIZE,this.fontBold=this.options.fontBold||!1,this.textMargin=_.isNil(this.options.textMargin)?r.DEFAULT_TEXT_MARGIN:this.options.textMargin,this.borderThickness=this.options.borderThickness||r.DEFAULT_BORDER_THICKNESS,this.options.borderOpacity=_.isNil(this.options.borderOpacity)?r.DEFAULT_BORDER_OPACITY:this.options.borderOpacity,this.borderOpacity=this.options.borderOpacity/100,this.options.borderColor=this.options.borderColor||this.options.aColor,this.borderColor=Y.hex2RGB(this.options.borderColor),this.options.fillOpacity=_.isNil(this.options.fillOpacity)?r.DEFAULT_FILL_OPACITY:this.options.fillOpacity,this.fillOpacity=this.options.fillOpacity/100,this.options.fillColor=this.options.fillColor||this.options.aColor,this.fillColor=Y.hex2RGB(this.options.fillColor),this.anchorPosition=this.options.anchorPosition||r.DEFAULT_ANCHOR_POSITION,r.createSelColor(this.id)),e=B(B(B(B([],e,!0),e,!0),e,!0),e,!0);this.attributes={aPosition:{size:2,offset:0},aColor:{bufferData:new Float32Array(t),size:4,offset:0},aSelColor:{bufferData:new Float32Array(e),size:4,offset:0}}}qt=k.DialogBase,x(s,qt),s.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:this.onSave.bind(this),icons:{primary:"fa fa-check"}},{text:"Cancel",click:function(){t.isCancel=!0,t.dialogClose()},icons:{primary:"fa fa-times"}}]},s.prototype.onClose=function(){var t=this.drawCallback;t&&t()},s.prototype.preRender=function(){this.options.minHeight=300,this.options.width=350,this.options.iconClass="fas fa-edit",this.options.userClass="ChartGL annotations-dialog",this.options.dialogTitle="Annotations",this.options.draggable=!0,this.options.onClose=this.onClose},s.prototype.renderTemplate=function(){return N.annotateDialog({})},s.prototype.postRender=function(){this.annotateTypeSelect=this.el.querySelectorAll(".annotate-type-select")[0],this.annotateTypeColorBtn=this.el.querySelectorAll(".annotate-color-btn")[0],this.annotateTypeColorBtn&&(this.annotateTypeColorBtn.onclick=this.showColorPickerDialog.bind(this)),this.annotateTypeColorIcon=this.el.querySelectorAll(".annotate-color-icon")[0],this.editFieldSet=this.el.querySelectorAll(".options-annotate-edit")[0],this.tableBody=this.el.querySelectorAll(".tbody-annotate-edit")[0],this.deleteAllBtn=this.el.querySelectorAll(".delete-all-btn")[0],this.deleteAllBtn&&(this.deleteAllBtn.onclick=this.onDeleteAll.bind(this))},s.prototype.init=function(){if(this.editFieldSet.style.display=!_.isUndefined(this.settingsJSON.annotations)&&0<this.settingsJSON.annotations.length?"":"none",this.annotateTypeSelect.value=this.settingsJSON.draw.annotateType,this.annotateTypeColorIcon.style.color=this.settingsJSON.draw.color,this.annotateTypeColorBtn.value=this.settingsJSON.draw.color,this.annotateTypeColorBtn.innerHTML=this.settingsJSON.draw.color,!_.isUndefined(this.settingsJSON.annotations)){var t=this.settingsJSON.annotations;this.updatedAnnotations=_.cloneDeep(this.annotations);for(var e=0;e<t.length;e++){var i=this.tableBody.insertRow(),n=(i.classList.add(s.PREFIX_ROW+t[e].id),i.insertCell()),o=document.createTextNode(v.getAnnotateTypeText(t[e].type)),n=(n.appendChild(o),i.insertCell()),o=document.createElement("input"),a=document.createElement("span"),r=(a.className="fa fa-fw watermark fa-tint",a.classList.add(s.PREFIX_COLOR_ICON+t[e].id),o.type="button",o.className="ui-widget ui-state-default ui-corner-all",o.classList.add(s.PREFIX_COLOR_BTN+t[e].id),o.value=t[e].color,document.createTextNode(v.getAnnotateTypeText(t[e].color))),a=(o.appendChild(r),a.style.color=t[e].color,o.onclick=this.showColorPickerDialog.bind(this),n.appendChild(a),n.appendChild(o),t[e].type===v.TEXT_NOTE&&(r=document.createElement("button"),(a=document.createElement("span")).className="edit-icon fa fa-pencil",r.className="ui-widget ui-state-default ui-corner-all annotate-edit-btn",r.classList.add(s.PREFIX_EDIT_BTN+t[e].id),o=document.createTextNode("Edit"),r.setAttribute("title","Edit annotation"),r.appendChild(a),r.onclick=this.showTextAnnotationDialog.bind(this),r.appendChild(o),n.appendChild(r)),i.insertCell()),o=document.createElement("button"),n=document.createElement("span");n.className="fa fa-trash",o.className="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-icon-primary annotate-del-btn",o.classList.add(s.PREFIX_DELETE_BTN+t[e].id),o.setAttribute("title","Delete annotation"),o.appendChild(n),o.onclick=this.onDeleteRow.bind(this),a.appendChild(o)}this.onResize()}},s.prototype.showColorPickerDialog=function(t){var e=this,i=t.target,n=i.value;new k.ColorPickr({values:"false",noColor:"false",target:t.target,editor:this,path:n,selected:n,selectCallback:function(t){n!==t.toUpperCase()&&e.updateColor(t.toUpperCase(),i)}})},s.prototype.updateColor=function(t,e){e.value=t,e.innerHTML=t;var i=this.getAnnotationId(e,s.PREFIX_COLOR_BTN);i?(this.settingsJSON.annotations.find(function(t){return t.id===i}).color=t,this.el.querySelectorAll(".".concat(s.PREFIX_COLOR_ICON).concat(i))[0].style.color=t,(e=this.updatedAnnotations.find(function(t){return t.id===i})).updateColor(t),this.updateChangeStack(e),this.triggerDraw()):this.annotateTypeColorIcon.style.color=t},s.prototype.updateChangeStack=function(t){var e=t.id,i=(_.isNil(this.prev.change)&&(this.prev.change=[]),this.annotations.findIndex(function(t){return t.id===e})),n=this.prev.change.findIndex(function(t){return t.id===e}),i=ie.getAnnotationJsonProperties(_.cloneDeep(this.annotations[i])),i=(n<0&&this.prev.change.push(i),ie.getAnnotationJsonProperties(_.cloneDeep(t))),t=(_.isNil(this.next.change)&&(this.next.change=[]),this.next.change.findIndex(function(t){return t.id===e}));t!==n&&console.log("Warning - stack update - next and previous index do not match!"),0<t?this.next.change[t]=i:this.next.change.push(i)},s.prototype.updateProperties=function(){this.settingsJSON.draw.annotateType!==this.annotateTypeSelect.value&&(this.prev.defaultAnnotateType=this.settingsJSON.draw.annotateType,this.next.defaultAnnotateType=this.annotateTypeSelect.value,this.settingsJSON.draw.annotateType=this.annotateTypeSelect.value),this.settingsJSON.draw.color!==this.annotateTypeColorBtn.value&&(this.prev.defaultColor=this.settingsJSON.draw.color,this.next.defaultColor=this.annotateTypeColorBtn.value,this.settingsJSON.draw.color=this.annotateTypeColorBtn.value),this.settings=JSON.stringify(this.settingsJSON),this.api.setProperty("Annotations.Annotations",this.settings)},s.prototype.onDeleteAll=function(){var t=_.map(this.annotations,function(t){return ie.getAnnotationJsonProperties(_.cloneDeep(t))});delete this.prev.add,delete this.prev.change,delete this.next.delete,delete this.next.change,this.prev.addAll=t,this.next.deleteAll=[],delete this.settingsJSON.annotations,delete this.updatedAnnotations,this.tableBody.style.display="none"},s.prototype.onSave=function(){var t=this.options.drawCallback;this.isCancel=!1,this.updateProperties(),t&&(this.prev.add&&this.prev.add.sort(function(t,e){return t.index-e.index}),t({prev:this.prev,next:this.next})),this.dialogClose()},s.prototype.onDeleteRow=function(t){var t=t.currentTarget,e=this.getAnnotationId(t,s.PREFIX_DELETE_BTN);this.settingsJSON.annotations=this.settingsJSON.annotations.filter(function(t){return t.id!==e});this.el.querySelectorAll(".".concat(s.PREFIX_ROW).concat(e))[0].style.display="none",this.updatedAnnotations=this.updatedAnnotations.filter(function(t){return t.id!==e}),_.isNil(this.prev.add)&&(this.prev.add=[]);t=this.annotations.findIndex(function(t){return t.id===e});this.prev.add.push({annotateJson:ie.getAnnotationJsonProperties(_.cloneDeep(this.annotations[t])),index:t}),_.isNil(this.next.delete)&&(this.next.delete=[]),this.next.delete.push(e),this.prev.change&&(this.prev.change=this.prev.change.filter(function(t){return t.id!==e})),this.next.change&&(this.next.change=this.next.change.filter(function(t){return t.id!==e})),this.triggerDraw()},s.prototype.showTextAnnotationDialog=function(t){var t=t.currentTarget,e=this,i=this.getAnnotationId(t,s.PREFIX_EDIT_BTN);i&&(t=this.settingsJSON.annotations.find(function(t){return t.id===i}),t=new v(ie.getAnnotateElementProps(t)),new $t({api:this.api,annotateEl:t,canvas:this.canvas,bEdit:!0,updateCallback:function(t){e.updateTextAnnotation(t)}}))},s.prototype.updateTextAnnotation=function(e){var t;e&&((t=this.settingsJSON.annotations.find(function(t){return t.id===e.id})).text=e.text,t.fontSize=e.fontSize,t.fontBold=e.fontBold,t.textMargin=e.textMargin,t.borderThickness=e.borderThickness,t.borderColor=e.options.borderColor,t.borderOpacity=e.options.borderOpacity,t.fillColor=e.options.fillColor,t.fillOpacity=e.options.fillOpacity,t.anchorPosition=e.anchorPosition,t=this.el.querySelectorAll(".".concat(s.PREFIX_COLOR_BTN).concat(e.id))[0],this.updateColor(e.options.aColor,t),(t=this.updatedAnnotations.find(function(t){return t.id===e.id})).copyTextStyleProperty(e),this.updateChangeStack(t)),this.triggerDraw()},s.prototype.triggerDraw=function(){var t={detail:this.updatedAnnotations};this.canvas&&this.canvas.dispatchEvent(new CustomEvent("editAnnotationsDrawEvent",t))},s.prototype.getAnnotationId=function(t,e){for(var i,n=t.classList,o=0;o<n.length;o++)if(n[o].startsWith(e)){i=n[o].substr(n[o].indexOf(e)+e.length);break}return parseInt(i,10)},s.PREFIX_ROW="row_",s.PREFIX_COLOR_BTN="color-btn",s.PREFIX_COLOR_ICON="color-icon",s.PREFIX_DELETE_BTN="delete-btn",s.PREFIX_EDIT_BTN="edit-btn",s.DEFAULT_ANNOTATION_TYPE=v.TEXT_NOTE,s.DEFAULT_JSON={draw:{annotateType:s.DEFAULT_ANNOTATION_TYPE,color:s.DEFAULT_ANNOTATION_COLOR="#E8E824"}};var qt,Kt=s;function s(t){var e=qt.call(this,t)||this;return e.isCancel=!1,e.annotations=[],e.next={},e.prev={},e.api=t.api,e.settings=e.api.getProperty("Annotations.Annotations"),""===e.settings?e.settingsJSON=s.DEFAULT_JSON:e.settingsJSON=JSON.parse(e.settings),e.annotations=e.options.annotations,e.canvas=e.options.canvas,e.init(),e}Qt=k.DialogBase,x(l,Qt),l.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:this.onSave.bind(this),icons:{primary:"fa fa-check"}},{text:"Cancel",click:function(){t.isCancel=!0,t.dialogClose()},icons:{primary:"fa fa-times"}}]},l.prototype.onClose=function(){var t=this.updateCallback;t&&t()},l.prototype.preRender=function(){this.options.dialogTitle="Text Note",this.options.minHeight=300,this.options.width=300,this.options.iconClass="fas fa-edit",this.options.userClass="ChartGL edit-text-annotation-dialog",this.options.draggable=!0,this.options.onClose=this.onClose},l.prototype.renderTemplate=function(){return N.textNoteDialog({})},l.prototype.postRender=function(){this.textArea=this.el.querySelectorAll(".annotate-text")[0],this.textArea&&this.textArea.addEventListener("input",this.updateInputValue.bind(this)),this.textColorBtn=this.el.querySelectorAll(".text-color-btn")[0],this.textColorBtn&&(this.textColorBtn.onclick=this.showColorPickerDialog.bind(this)),this.textColorIcon=this.el.querySelectorAll(".text-color-icon")[0],this.textSizeControl=this.el.querySelectorAll(".text-size")[0],this.textSizeControl&&(this.textSizeControl.addEventListener("input",this.updateSpinControlValue.bind(this)),this.textSizeControl.addEventListener("change",this.updateSpinControlValue.bind(this))),this.textBoldChkBox=this.el.querySelectorAll(".text-bold")[0],this.textBoldChkBox&&this.textBoldChkBox.addEventListener("change",this.onCheckBoxChange.bind(this)),this.textMarginControl=this.el.querySelectorAll(".text-margin")[0],this.textMarginControl&&(this.textMarginControl.addEventListener("input",this.updateSpinControlValue.bind(this)),this.textMarginControl.addEventListener("change",this.updateSpinControlValue.bind(this))),this.borderSizeControl=this.el.querySelectorAll(".border-thickness")[0],this.borderSizeControl&&(this.borderSizeControl.addEventListener("input",this.updateSpinControlValue.bind(this)),this.borderSizeControl.addEventListener("change",this.updateSpinControlValue.bind(this))),this.borderColorBtn=this.el.querySelectorAll(".border-color-btn")[0],this.borderColorBtn&&(this.borderColorBtn.onclick=this.showColorPickerDialog.bind(this)),this.borderColorIcon=this.el.querySelectorAll(".border-color-icon")[0],this.borderOpacitySlider=this.el.querySelectorAll(".border-opacity")[0],this.borderOpacitySlider&&(this.borderOpacitySlider.addEventListener("input",this.updateOpacityValue.bind(this)),this.borderOpacitySlider.addEventListener("change",this.updateOpacityValue.bind(this))),this.fillColorBtn=this.el.querySelectorAll(".fill-color-btn")[0],this.fillColorBtn&&(this.fillColorBtn.onclick=this.showColorPickerDialog.bind(this)),this.fillColorIcon=this.el.querySelectorAll(".fill-color-icon")[0],this.fillOpacitySlider=this.el.querySelectorAll(".fill-opacity")[0],this.fillOpacitySlider&&(this.fillOpacitySlider.addEventListener("input",this.updateOpacityValue.bind(this)),this.fillOpacitySlider.addEventListener("change",this.updateOpacityValue.bind(this))),this.anchorPositionSelect=this.el.querySelectorAll(".anchor-position")[0],this.anchorPositionSelect&&this.anchorPositionSelect.addEventListener("change",this.updateInputValue.bind(this)),this.onResize()},l.prototype.init=function(){this.textArea.value=""===this.annotateEl.text?l.DEFAULT_TEXT:this.annotateEl.text,this.annotateEl.text=this.textArea.value,this.bEdit||this.textArea.select(),this.textColorIcon.style.color=this.annotateEl.options.aColor,this.textColorBtn.value=this.annotateEl.options.aColor,this.textColorBtn.innerHTML=this.annotateEl.options.aColor,this.textSizeControl.value=this.annotateEl.fontSize,this.textBoldChkBox.checked=this.annotateEl.fontBold,this.textMarginControl.value=this.annotateEl.textMargin,this.borderSizeControl.value=this.annotateEl.borderThickness,this.borderColorIcon.style.color=this.annotateEl.options.borderColor,this.borderColorBtn.value=this.annotateEl.options.borderColor,this.borderColorBtn.innerHTML=this.annotateEl.options.borderColor,this.borderOpacitySlider.value=this.annotateEl.options.borderOpacity,this.fillColorIcon.style.color=this.annotateEl.options.fillColor,this.fillColorBtn.value=this.annotateEl.options.fillColor,this.fillColorBtn.innerHTML=this.annotateEl.options.fillColor,this.fillOpacitySlider.value=this.annotateEl.options.fillOpacity,this.anchorPositionSelect.value=this.annotateEl.anchorPosition},l.prototype.remove=function(){return this.textArea&&this.textArea.removeEventListener("input",this.updateInputValue.bind(this)),this.textColorBtn&&(this.textColorBtn.onclick=this.showColorPickerDialog.bind(this)),this.textSizeControl&&(this.textSizeControl.removeEventListener("input",this.updateSpinControlValue.bind(this)),this.textSizeControl.removeEventListener("change",this.updateSpinControlValue.bind(this))),this.textBoldChkBox&&this.textBoldChkBox.removeEventListener("change",this.onCheckBoxChange.bind(this)),this.textMarginControl&&(this.textMarginControl.removeEventListener("input",this.updateSpinControlValue.bind(this)),this.textMarginControl.removeEventListener("change",this.updateSpinControlValue.bind(this))),this.borderSizeControl&&(this.borderSizeControl.removeEventListener("input",this.updateSpinControlValue.bind(this)),this.borderSizeControl.removeEventListener("change",this.updateSpinControlValue.bind(this))),this.borderColorBtn&&(this.borderColorBtn.onclick=this.showColorPickerDialog.bind(this)),this.borderOpacitySlider&&(this.borderOpacitySlider.removeEventListener("input",this.updateOpacityValue.bind(this)),this.borderOpacitySlider.removeEventListener("change",this.updateOpacityValue.bind(this))),this.fillColorBtn&&(this.fillColorBtn.onclick=this.showColorPickerDialog.bind(this)),this.fillOpacitySlider&&(this.fillOpacitySlider.removeEventListener("input",this.updateOpacityValue.bind(this)),this.fillOpacitySlider.removeEventListener("change",this.updateOpacityValue.bind(this))),this.anchorPositionSelect&&this.anchorPositionSelect.removeEventListener("change",this.updateInputValue.bind(this)),k.DialogBase.prototype.remove.apply(this)},l.prototype.triggerDraw=function(){var t={detail:this.annotateEl};this.canvas&&this.canvas.dispatchEvent(new CustomEvent("editTextDrawEvent",t))},l.prototype.showColorPickerDialog=function(t){var e=this,i=t.target,n=i.value;new k.ColorPickr({values:"false",noColor:"false",target:t.target,editor:this,path:n,selected:n,selectCallback:function(t){n!==t.toUpperCase()&&e.updateColor(t.toUpperCase(),i)}})},l.prototype.updateColor=function(t,e){e.value=t,e.innerHTML=t;e.previousElementSibling.style.color=t;e=e.dataset.propertyName;e&&("aColor"===e?this.annotateEl.updateColor(t):this.annotateEl.updateColorStyleProperty(e,t),this.triggerDraw())},l.prototype.onSave=function(){var t=this.options.updateCallback;this.isCancel=!1,t&&t(this.annotateEl),this.dialogClose()},l.prototype.updateInputValue=function(t){t=t.target;this.annotateEl.updateStyleProperty(t.dataset.propertyName,t.value),this.triggerDraw()},l.prototype.updateSpinControlValue=function(t){var e=t.target,i=e.dataset.propertyName;!i||"input"===t.type&&""===e.value||(t=parseInt(e.value,10),t=_.isNaN(t)||t<parseInt(e.min,10)||t>parseInt(e.max,10)?this.annotateEl[i]:t,e.value=t.toString(),this.annotateEl.updateStyleProperty(i,t),this.triggerDraw())},l.prototype.updateOpacityValue=function(t){var t=t.target,e=t.dataset.propertyName;e&&(this.annotateEl.updateOpacityStyleProperty(e,parseInt(t.value,10)),this.triggerDraw())},l.prototype.onCheckBoxChange=function(t){t=t.target;this.annotateEl.updateStyleProperty(t.dataset.propertyName,t.checked),this.triggerDraw()},l.DEFAULT_TEXT="Text note";var Qt,$t=l;function l(t){t=Qt.call(this,t)||this;return t.isCancel=!1,t.annotateEl=t.options.annotateEl,t.bEdit=t.options.bEdit,t.canvas=t.options.canvas,t.init(),t.triggerDraw(),t}p.prototype.add=function(t,e){return this.position<this.history.length&&(this.history=this.history.slice(0,this.position)),this.history.push({command:t,data:e}),this.position++,{undo:!0,redo:!1}},p.prototype.undo=function(){0<this.position&&this.position--;var t=this.getCurrentData();return{stackData:{command:p.undoMap[t.command],data:t.data},undo:0<this.position,redo:!0}},p.prototype.redo=function(){var t=this.getCurrentData();return this.position<this.history.length&&this.position++,{stackData:t,undo:!0,redo:this.position!==this.history.length}},p.prototype.getCurrentData=function(){return this.history[this.position]},p.COMMAND_APPEND="append",p.COMMAND_DELETE="delete",p.COMMAND_UPDATE_NEXT="update_next",p.COMMAND_UPDATE_PREV="update_prev",p.COMMAND_BULK_UPDATE_NEXT="bulk_update_next",p.undoMap={append:p.COMMAND_DELETE,delete:p.COMMAND_APPEND,update_next:p.COMMAND_UPDATE_PREV,update_prev:p.COMMAND_UPDATE_NEXT,bulk_update_next:p.COMMAND_BULK_UPDATE_PREV="bulk_update_prev",bulk_update_prev:p.COMMAND_BULK_UPDATE_NEXT};var te=p;function p(){this.position=0,this.history=[]}ee=Backbone.View,x(b,ee),b.prototype.resize=function(t,e,i,n){this.canvas.style.left=t+"px",this.canvas.style.top=e+"px",this.canvas.width=i,this.canvas.height=n,this.canvas2d.style.left=t+"px",this.canvas2d.style.top=e+"px",this.canvas2d.width=i,this.canvas2d.height=n},b.prototype.remove=function(){var t=this;return this.canvas2d.removeEventListener("mousedown",this.onAnnotateMouseDown.bind(this)),this.canvas2d.removeEventListener("mousemove",this.onAnnotateMouseMove.bind(this)),this.canvas2d.removeEventListener("mouseup",this.onAnnotateMouseUp.bind(this)),this.lnkAnnotate&&this.lnkAnnotate.removeEventListener("click",function(){return t.toggleDrawMode()}),this.lnkEditAnnotate&&this.lnkEditAnnotate.removeEventListener("click",function(){return t.toggleDrawMenu()}),this.lnkUndoAnnotate&&this.lnkUndoAnnotate.removeEventListener("click",function(){return t.onUndo()}),this.lnkRedoAnnotate&&this.lnkRedoAnnotate.removeEventListener("click",function(){return t.onRedo()}),this.canvas2d.removeEventListener("editTextDrawEvent",this.onEditTextDraw.bind(this)),this.stopListening(),Backbone.View.prototype.remove.apply(this)},b.prototype.showAnnotateControl=function(){var t=this.api.getProperty(b.PROP_ANNOTATE_CONTROL);this.lnksAnnotate&&(t?(this.el.style.width=b.LEGEND_WIDTH+"px",this.lnksAnnotate.classList.remove("link-disabled")):this.lnksAnnotate.classList.add("link-disabled"))},b.prototype.getWidth=function(){return this.api.getProperty(b.PROP_ANNOTATE_CONTROL)?b.LEGEND_WIDTH:0},b.prototype.onSettingsChange=function(){var t=this.api.getProperty(b.PROP_ANNOTATIONS);if(""===t)this.settingsJSON=Kt.DEFAULT_JSON,this.annotations=[];else{var e=void 0;try{e=JSON.parse(t)}catch(t){console.log("ChartGL: Annotations string is in wrong format - resetting to default..."),e=Kt.DEFAULT_JSON}!_.isUndefined(this.settingsJSON)&&_.isEqual(this.settingsJSON,e)||(this.settingsJSON=e,this.loadAnnotations())}this.updateDrawIcon(),this.isInitialized&&this.draw(this.gl)},b.prototype.loadAnnotations=function(){var e=this;this.annotations=[],_.forEach(this.settingsJSON.annotations,function(t){t=new v(b.getAnnotateElementProps(t));e.annotations.push(t)})},b.prototype.saveAnnotations=function(){var t=_.map(this.annotations,function(t){return b.getAnnotationJsonProperties(t)}),e={annotations:t,draw:this.settingsJSON.draw};this.settingsJSON.annotations=t,this.api.setProperty(b.PROP_ANNOTATIONS,JSON.stringify(e))},b.getAnnotateElementProps=function(t){return{id:t.id,annotateType:t.type,aColor:t.color,aPositionData:t.aPositionData,text:t.text,fontSize:t.fontSize,fontBold:t.fontBold,textMargin:t.textMargin,borderThickness:t.borderThickness,borderColor:t.borderColor,borderOpacity:t.borderOpacity,fillColor:t.fillColor,fillOpacity:t.fillOpacity,anchorPosition:t.anchorPosition}},b.getAnnotationJsonProperties=function(t){return{id:t.id,type:t.annotateType,color:t.options.aColor,aPositionData:t.options.aPositionData,text:t.text,fontSize:t.fontSize,fontBold:t.fontBold,textMargin:t.textMargin,borderThickness:t.borderThickness,borderColor:t.options.borderColor,borderOpacity:t.options.borderOpacity,fillColor:t.options.fillColor,fillOpacity:t.options.fillOpacity,anchorPosition:t.anchorPosition}},b.prototype.addToStack=function(t,e){t=this.annotateStack.add(t,e);this.updateUndoRedo(t)},b.prototype.onUndo=function(){var t=this.annotateStack.undo();this.doCommand(t.stackData),this.updateUndoRedo(t)},b.prototype.onRedo=function(){var t=this.annotateStack.redo();this.doCommand(t.stackData),this.updateUndoRedo(t)},b.prototype.doCommand=function(e){var n=this;switch(e.command){case te.COMMAND_APPEND:var t=new v(b.getAnnotateElementProps(e.data));this.annotations.push(t),this.saveAnnotations();break;case te.COMMAND_DELETE:this.annotations=this.annotations.filter(function(t){return t.id!==e.data.id}),this.saveAnnotations();break;case te.COMMAND_UPDATE_NEXT:case te.COMMAND_UPDATE_PREV:var t=e.command===te.COMMAND_UPDATE_NEXT?e.data.next:e.data.prev,t=new v(b.getAnnotateElementProps(t)),i=this.annotations.findIndex(function(t){return t.id===e.data.next.id});this.annotations[i]=t,this.saveAnnotations();break;case te.COMMAND_BULK_UPDATE_NEXT:case te.COMMAND_BULK_UPDATE_PREV:i=e.command===te.COMMAND_BULK_UPDATE_NEXT?e.data.next:e.data.prev;_.isNil(i.defaultAnnotateType)||(this.settingsJSON.draw.annotateType=i.defaultAnnotateType),_.isNil(i.defaultColor)||(this.settingsJSON.draw.color=i.defaultColor),_.isNil(i.addAll)?_.isNil(i.deleteAll)?_.isNil(i.add)?_.isNil(i.delete)||_.forEach(i.delete,function(e){n.annotations=n.annotations.filter(function(t){return t.id!==e})}):_.forEach(i.add,function(t){var e=new v(b.getAnnotateElementProps(t.annotateJson));n.annotations.splice(t.index,0,e)}):this.annotations=[]:_.forEach(i.addAll,function(t){t=new v(b.getAnnotateElementProps(t));n.annotations.push(t)}),_.isNil(i.change)||_.forEach(i.change,function(e){var t=new v(b.getAnnotateElementProps(e)),i=n.annotations.findIndex(function(t){return t.id===e.id});n.annotations[i]=t}),this.saveAnnotations()}},b.prototype.updateUndoRedo=function(t){var e,i=null==(i=this.lnkUndoAnnotate)?void 0:i.classList.contains("btn-disabled"),n=null==(n=this.lnkRedoAnnotate)?void 0:n.classList.contains("btn-disabled");t.undo?i&&null!=(e=this.lnkUndoAnnotate)&&e.classList.remove("btn-disabled"):i||null!=(e=this.lnkUndoAnnotate)&&e.classList.add("btn-disabled"),t.redo?n&&null!=(i=this.lnkRedoAnnotate)&&i.classList.remove("btn-disabled"):n||null!=(e=this.lnkRedoAnnotate)&&e.classList.add("btn-disabled")},b.prototype.updateZoom=function(t,e,i,n){this.isInitialized||(this.isInitialized=!0),this.xAxisDataBounds=t,this.yAxisDataBounds=i,this.xAxisViewBounds=e,this.yAxisViewBounds=n,this.isXZoom=!_.isEqual(t,e),this.isYZoom=!_.isEqual(i,n),this.isZoom=this.isXZoom||this.isYZoom,this.dialogCurrEl?this.draw(this.gl,!1,!0,this.dialogCurrEl):this.draw(this.gl)},b.prototype.onEditTextDraw=function(t){this.dialogCurrEl=t.detail,this.draw(this.gl,!1,!0,t.detail)},b.prototype.onEditAnnotationsDraw=function(t){this.dialogAllAnnotations=t.detail,this.draw(this.gl,!1,!1,null,t.detail)},b.prototype.draw=function(t,e,i,n,o){for(var a=void 0!==e&&e,r=void 0!==i&&i,s=_.isNil(n)?this.currEl:n,e=this.annotateGL.program,l=(t.useProgram(e),t.clearColor(0,0,0,0),t.viewport(0,0,this.canvas.width,this.canvas.height),t.clear(t.COLOR_BUFFER_BIT),this.ctx.clearRect(0,0,this.canvas2d.width,this.canvas2d.height),_.isNil(o)?this.getAllElements():o),h=0;h<l.length;h++)a||l[h].annotateType!==v.TEXT_NOTE?(this.updateLineEndpoints(l[h]),this.annotateGL.renderBuffers(l[h],this.isXZoom,this.isYZoom,this.xAxisDataBounds,this.yAxisDataBounds,this.xAxisViewBounds,this.yAxisViewBounds),l[h].shapeType===v.SHAPE_RECTANGLE?this.gl.drawElements(t.TRIANGLES,l[h].indices.length,t.UNSIGNED_SHORT,0):l[h].shapeType===v.SHAPE_POINT?this.gl.drawArrays(t.POINTS,0,1):this.gl.drawArrays(l[h].shapeType===v.SHAPE_LINE?t.LINES:t.TRIANGLES,0,l[h].options.aPositionData.length)):this.drawText(t,r&&s.id===l[h].id?s:l[h]);this.action===b.ACTION_DRAW&&s&&(a||s.annotateType!==v.TEXT_NOTE?(this.annotateGL.renderBuffers(s,this.isXZoom,this.isYZoom,this.xAxisDataBounds,this.yAxisDataBounds,this.xAxisViewBounds,this.yAxisViewBounds),s.shapeType===v.SHAPE_RECTANGLE?t.drawElements(t.TRIANGLES,s.indices.length,t.UNSIGNED_SHORT,0):t.drawArrays(s.shapeType===v.SHAPE_LINE?t.LINES:t.TRIANGLES,0,s.options.aPositionData.length)):(r&&this.drawText(t,s),this.drawBoundingRectForText(s)))},b.prototype.drawBoundingRectForText=function(t){var e=v.DEFAULT_FONT_SIZE,e=(this.ctx.font=e+"px "+b.FONT_DEFAULT,this.ctx.strokeStyle="#d3d3d3",this.ctx.setLineDash([15,5]),this.annotateGL.getPixelPosFromAxisDataValue(!0,t.options.aPositionData[0],this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds)),i=this.annotateGL.getPixelPosFromAxisDataValue(!0,t.options.aPositionData[2],this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds),n=this.annotateGL.getPixelPosFromAxisDataValue(!1,t.options.aPositionData[1],this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds),t=this.annotateGL.getPixelPosFromAxisDataValue(!1,t.options.aPositionData[5],this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds);this.ctx.strokeRect(Math.min(e,i),Math.min(n,t),Math.abs(i-e),Math.abs(t-n))},b.prototype.drawText=function(t,e){var i=this.ctx,n=e.fontSize,o=(this.ctx.save(),i.font=(e.fontBold?"bold ":"")+n+"px "+b.FONT_DEFAULT,e.text.split("\n")),a=this.updateTextPosition(e,o);this.ctx.fillStyle="rgba(".concat(e.fillColor[0],", ").concat(e.fillColor[1],", ").concat(e.fillColor[2],", ").concat(e.fillOpacity,")"),this.ctx.strokeStyle="rgba(".concat(e.borderColor[0],", ").concat(e.borderColor[1],", ").concat(e.borderColor[2],", ").concat(e.borderOpacity,")"),this.ctx.lineWidth=e.borderThickness,this.ctx.setLineDash([]),this.ctx.beginPath(),this.ctx.moveTo(a[0],a[1]);for(var r=2;r<a.length;r+=2)this.ctx.lineTo(a[r],a[r+1]);this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),i.fillStyle=e.options.aColor;for(r=0;r<o.length;r++)this.ctx.fillText(o[r],a[0]+e.textMargin,a[1]+e.textMargin+n*(r+1));if(this.currEl===e||this.editElem&&this.editElem.obj===e){this.ctx.setLineDash([5,15]),this.ctx.lineWidth=1,this.ctx.strokeStyle="#D3D3D3",this.ctx.beginPath(),this.ctx.moveTo(a[0],a[1]);for(r=2;r<a.length;r+=2)this.ctx.lineTo(a[r],a[r+1]);this.ctx.closePath(),this.ctx.stroke()}this.ctx.restore()},b.prototype.updateTextPosition=function(t,e){var i=this.ctx,n=_.max(_.map(e,function(t){return i.measureText(t).width})),e=e.length*t.fontSize,o=this.annotateGL.convertPositionDataToPixels(t,this.isXZoom,this.isYZoom,this.xAxisDataBounds,this.yAxisDataBounds,this.xAxisViewBounds,this.yAxisViewBounds),a=t.anchorPosition,n=n+o[0]+2*t.textMargin,e="topLeft"===a?e+o[1]+2*t.textMargin:o[7]-(e+2*t.textMargin),n=(o[2]=n,o[4]=n,this.annotateGL.getChartAxisDataValueFromPixelPos(!0,n,this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds)),n=(t.options.aPositionData[2]=n,t.options.aPositionData[4]=n,"topLeft"===a?(o[5]=e,o[7]=e):(o[1]=e,o[3]=e),this.annotateGL.getChartAxisDataValueFromPixelPos(!1,e,this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds));return"topLeft"===a?(t.options.aPositionData[5]=n,t.options.aPositionData[7]=n):(t.options.aPositionData[1]=n,t.options.aPositionData[3]=n),t.updatePosition(o),o},b.prototype.getAllElements=function(){return this.editElem&&this.editElem.points?this.annotations.concat(this.editElem.points):this.annotations},b.prototype.initializeEvents=function(){var e=this;this.canvas2d.addEventListener("mousedown",this.onAnnotateMouseDown.bind(this)),this.canvas2d.addEventListener("mousemove",this.onAnnotateMouseMove.bind(this)),this.canvas2d.addEventListener("mouseup",this.onAnnotateMouseUp.bind(this)),this.lnkAnnotate&&this.lnkAnnotate.addEventListener("click",function(){e.toggleDrawMode()}),this.lnkEditAnnotate&&this.lnkEditAnnotate.addEventListener("click",function(){e.toggleDrawMenu()}),this.lnkUndoAnnotate&&this.lnkUndoAnnotate.addEventListener("click",function(){var t;null!=(t=e.lnkUndoAnnotate)&&t.classList.contains("btn-disabled")||e.onUndo()}),this.lnkRedoAnnotate&&this.lnkRedoAnnotate.addEventListener("click",function(){var t;null!=(t=e.lnkRedoAnnotate)&&t.classList.contains("btn-disabled")||e.onRedo()}),new Event("editTextDrawEvent"),this.canvas2d.addEventListener("editTextDrawEvent",this.onEditTextDraw.bind(this)),new Event("editAnnotationsDrawEvent");this.canvas2d.addEventListener("editAnnotationsDrawEvent",this.onEditAnnotationsDraw.bind(this))},b.prototype.getUniqueId=function(){return _.random(1,16777216)},b.prototype.renderLinks=function(){this.lnksAnnotate=this.el.querySelectorAll(".lnksAnnotate")[0],this.lnkAnnotate=this.el.querySelectorAll("a.lnkAnnotate")[0],this.lnkEditAnnotate=this.el.querySelectorAll("a.lnkEditAnnotate")[0],this.lnkAnnotateIcon=this.el.querySelectorAll("i.draw-icon")[0],this.lnkUndoAnnotate=this.el.querySelectorAll(".lnkUndoAnnotate")[0],this.lnkRedoAnnotate=this.el.querySelectorAll(".lnkRedoAnnotate")[0]},b.prototype.toggleDrawMode=function(){var t="none"!==(null==(t=null==(t=null==(t=this.getOverlay())?void 0:t.el)?void 0:t.style)?void 0:t.display);this.getOverlay().el.style.display=t?"none":"","none"===(null==(t=null==(t=null==(t=this.getOverlay())?void 0:t.el)?void 0:t.style)?void 0:t.display)?null!=(t=this.lnksAnnotate)&&t.classList.add("ui-draw-mode-on"):null!=(t=this.lnksAnnotate)&&t.classList.remove("ui-draw-mode-on"),this.updateDrawIcon()},b.prototype.toggleDrawMenu=function(){null!=(t=this.lnksAnnotate)&&t.classList.contains("ui-draw-mode-on")||this.toggleDrawMode();var t,e=this;new Kt({api:this.api,canvas:this.canvas2d,annotations:this.annotations,drawCallback:function(t){t&&e.addToStack(te.COMMAND_BULK_UPDATE_NEXT,t),e.dialogAllAnnotations=null,e.draw(e.gl)}})},b.prototype.updateDrawIcon=function(){var t=null==(t=this.lnksAnnotate)?void 0:t.classList.contains("ui-draw-mode-on"),e=this.settingsJSON.draw.annotateType,i=this.settingsJSON.draw.color;if(!0===t){switch(e){case v.TREND_LINE:this.lnkAnnotateIcon.className="fa fa-fw fa-minus fa-rotate--45 draw-icon";break;case v.HORIZONTAL_LINE:this.lnkAnnotateIcon.className="fa fa-fw fa-minus draw-icon";break;case v.VERTICAL_LINE:this.lnkAnnotateIcon.className="fa fa-fw fa-minus fa-rotate-90 draw-icon";break;case v.RECTANGLE:this.lnkAnnotateIcon.className="fa fa-fw fa-stop draw-icon";break;case v.TEXT_NOTE:this.lnkAnnotateIcon.className="fa fa-fw fa-file-text draw-icon"}this.lnkAnnotateIcon.style.color=i,this.lnkAnnotateIcon.style.visibility="visible",this.lnkAnnotate&&this.lnkAnnotate.title&&(this.lnkAnnotate.title="Toggle Annotation mode\nCurrent Annotation type: "+v.getAnnotateTypeText(e))}else this.lnkAnnotateIcon.className="fa fa-fw fa-pencil draw-icon",this.lnkAnnotateIcon.style.removeProperty("color"),this.lnkAnnotateIcon.style.visibility="hidden",this.lnkAnnotate&&this.lnkAnnotate.title&&(this.lnkAnnotate.title="Toggle Annotation mode")},b.prototype.textNote=function(t){var i=this,e=_.cloneDeep(this.currEl);new $t({api:this.api,annotateEl:e,canvas:this.canvas2d,bEdit:!0,updateCallback:function(t){var e;t&&(e={next:b.getAnnotationJsonProperties(t),prev:b.getAnnotationJsonProperties(_.cloneDeep(i.currEl))},i.addToStack(te.COMMAND_UPDATE_NEXT,e),i.updateTextAnnotation(t)),i.currEl=null,i.draw(i.gl),i.updateOnMouseUp()}})},b.prototype.updateTextAnnotation=function(t){t&&(this.currEl.copyTextStyleProperty(t),this.saveAnnotations())},b.prototype.onAnnotateMouseDown=function(t){var e=this.getElementFromMousePos(this.gl,t.offsetX,t.offsetY);2===t.detail?(e&&e.annotateType===v.TEXT_NOTE&&(this.currEl=e,this.textNote(t)),this.action=b.ACTION_NONE):this.action!==b.ACTION_DRAW&&(this.drag=!0,t=this.getVertexPositions(t.offsetX,t.offsetY),this.startX=t.x,this.startY=t.y,e?(this.currEl=e.shapeType===v.SHAPE_POINT?this.editElem.obj:e,this.prevStackEl=b.getAnnotationJsonProperties(_.cloneDeep(this.currEl)),this.action=e.shapeType===v.SHAPE_POINT?b.ACTION_RESIZE:b.ACTION_MOVE,this.action===b.ACTION_MOVE?this.editElem=null:this.editElem.activePosIndex=e.options.aPositionXIndex):this.action=b.ACTION_DRAW)},b.prototype.onAnnotateMouseMove=function(t){this.action;var e=this.currEl;if(this.drag){var i=this.getVertexPositions(t.offsetX,t.offsetY);if(this.action===b.ACTION_MOVE){for(var n=e.annotateType===v.HORIZONTAL_LINE?0:i.x-this.startX,o=e.annotateType===v.VERTICAL_LINE?0:i.y-this.startY,a=(this.startX=i.x,this.startY=i.y,0);a<e.options.aPositionData.length;a++)a%2==0&&0!==n?(e.aPosition[a]+=n,e.options.aPositionData[a]=this.annotateGL.getChartAxisDataValueFromPixelPos(!0,e.aPosition[a],this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds)):a%2==1&&0!==o&&(e.aPosition[a]+=o,e.options.aPositionData[a]=this.annotateGL.getChartAxisDataValueFromPixelPos(!1,e.aPosition[a],this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds));e.updatePosition(e.aPosition),this.draw(this.gl)}else if(this.action===b.ACTION_RESIZE){var r=this.editElem.activePosIndex,n=(this.startX=e.aPosition[r],this.startY=e.aPosition[r+1],i.x-this.startX),o=i.y-this.startY;if(e.shapeType===v.SHAPE_LINE)e.aPosition[r]+=n,e.aPosition[r+1]+=o,e.options.aPositionData[r]=this.annotateGL.getChartAxisDataValueFromPixelPos(!0,e.aPosition[r],this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds),e.options.aPositionData[r+1]=this.annotateGL.getChartAxisDataValueFromPixelPos(!1,e.aPosition[r+1],this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds),e.updatePosition(e.options.aPosition),this.editElem.points=null,this.draw(this.gl);else if(e.shapeType===v.SHAPE_RECTANGLE){for(a=0;a<e.aPosition.length;a+=2)e.aPosition[a]===this.startX&&(e.aPosition[a]+=n,e.options.aPositionData[a]=this.annotateGL.getChartAxisDataValueFromPixelPos(!0,e.aPosition[a],this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds)),e.aPosition[a+1]===this.startY&&(e.aPosition[a+1]+=o,e.options.aPositionData[a+1]=this.annotateGL.getChartAxisDataValueFromPixelPos(!1,e.aPosition[a+1],this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds));e.updatePosition(e.options.aPosition),this.editElem.points=null,this.draw(this.gl)}}else if(this.action===b.ACTION_DRAW){var s,l,h,p,u=this.settingsJSON.draw.annotateType,r=v.getShapeType(u),c=(u===v.VERTICAL_LINE?i.x=this.startX+b.LINE_RECT_WIDTH:u===v.HORIZONTAL_LINE&&(i.y=this.startY+b.LINE_RECT_WIDTH),this.annotateGL.getChartAxisDataValueFromPixelPos(!0,this.startX,this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds)),d=this.annotateGL.getChartAxisDataValueFromPixelPos(!1,this.startY,this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds),y=this.annotateGL.getChartAxisDataValueFromPixelPos(!0,i.x,this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds),g=this.annotateGL.getChartAxisDataValueFromPixelPos(!1,i.y,this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds);switch(r){case v.SHAPE_LINE:e=new v({annotateType:u,aPositionData:[c,d,y,g],aColor:this.settingsJSON.draw.color,id:this.getUniqueId()});break;case v.SHAPE_RECTANGLE:e=u===v.TEXT_NOTE?(s=Math.min(c,y),l=Math.max(c,y),h=Math.min(d,g),p=Math.max(d,g),new v({annotateType:u,aPositionData:[s,p,l,p,l,h,s,h],aColor:this.settingsJSON.draw.color,id:this.getUniqueId()})):new v({annotateType:u,aPositionData:[c,d,c,g,y,d,y,g],aColor:this.settingsJSON.draw.color,id:this.getUniqueId()})}this.currEl=e,this.draw(this.gl)}}else{var f=this.getElementFromMousePos(this.gl,t.offsetX,t.offsetY);if(f){switch(f.annotateType){case v.HORIZONTAL_LINE:document.body.style.cursor="ns-resize";break;case v.VERTICAL_LINE:document.body.style.cursor="ew-resize";break;default:document.body.style.cursor="move"}if((!this.editElem||this.editElem&&this.editElem.obj!=f)&&(this.editElem={obj:f,points:[]}),f.shapeType!==v.SHAPE_POINT){if(f.annotateType!==v.HORIZONTAL_LINE&&f.annotateType!==v.VERTICAL_LINE&&f.annotateType!==v.TEXT_NOTE){for(a=0;a<f.options.aPositionData.length;a+=2){var m=new v({shapeType:v.SHAPE_POINT,aPositionData:[f.options.aPositionData[a],f.options.aPositionData[a+1]],aColor:"#d3d3d3",aPositionXIndex:a,annEl:f,id:this.getUniqueId()});this.editElem.points.push(m)}this.draw(this.gl)}}else if(f.shapeType===v.SHAPE_POINT){var P=f.options.annEl;this.editElem.obj=P;for(a=0;a<P.options.aPositionData.length;a+=2){var x=P.options.aPositionData[a]===f.options.aPositionData[0]&&P.options.aPositionData[a+1]===f.options.aPositionData[1]?"#ff0000":"#d3d3d3",m=new v({shapeType:v.SHAPE_POINT,aPositionData:[P.options.aPositionData[a],P.options.aPositionData[a+1]],aColor:x,aPositionXIndex:a,annEl:P,id:this.getUniqueId()});this.editElem.points.push(m)}this.draw(this.gl)}}else document.body.style.cursor="default",this.editElem=null}},b.prototype.onAnnotateMouseUp=function(t){var e,i;this.drag&&(this.drag=!1,this.action===b.ACTION_DRAW&&this.currEl?this.currEl.annotateType===v.TEXT_NOTE?new $t({api:(e=this).api,annotateEl:this.currEl,canvas:this.canvas2d,bEdit:!1,updateCallback:function(t){e.addAnnotationToList(t)}}):this.addAnnotationToList(this.currEl):(this.action!==b.ACTION_NONE&&this.currEl&&(i=b.getAnnotationJsonProperties(_.cloneDeep(this.currEl)),_.isEqual(this.prevStackEl,i)||(i={next:i,prev:this.prevStackEl},this.addToStack(te.COMMAND_UPDATE_NEXT,i),this.prevStackEl=null)),this.saveAnnotations(),this.updateOnMouseUp())),document.body.style.cursor="default"},b.prototype.addAnnotationToList=function(t){this.action===b.ACTION_DRAW&&(t&&(this.annotations.push(t),this.addToStack(te.COMMAND_APPEND,b.getAnnotationJsonProperties(_.cloneDeep(t)))),this.currEl=null,this.draw(this.gl)),this.saveAnnotations(),this.updateOnMouseUp()},b.prototype.updateOnMouseUp=function(){this.editElem=null,this.currEl=null,this.dialogCurrEl=null,this.action=b.ACTION_NONE},b.prototype.updateLineEndpoints=function(t){t.annotateType===v.VERTICAL_LINE?(t.options.aPositionData[1]=(this.yAxisDataBounds[0].x<this.yAxisViewBounds[0].x?this.yAxisDataBounds:this.yAxisViewBounds)[0].x,t.options.aPositionData[5]=t.options.aPositionData[1],t.options.aPositionData[3]=(this.yAxisDataBounds[0].y>this.yAxisViewBounds[0].y?this.yAxisDataBounds:this.yAxisViewBounds)[0].y,t.options.aPositionData[7]=t.options.aPositionData[3]):t.annotateType===v.HORIZONTAL_LINE&&(t.options.aPositionData[0]=(this.xAxisDataBounds[0].x<this.xAxisViewBounds[0].x?this.xAxisDataBounds:this.xAxisViewBounds)[0].x,t.options.aPositionData[2]=t.options.aPositionData[0],t.options.aPositionData[4]=(this.xAxisDataBounds[0].y>this.xAxisViewBounds[0].y?this.xAxisDataBounds:this.xAxisViewBounds)[0].y,t.options.aPositionData[6]=t.options.aPositionData[4])},b.prototype.getElementFromMousePos=function(t,e,i){var n,o=this.getAllElements();return o&&0<o.length?(o.forEach(function(t){t.setReadState()}),this.draw(t,!0),n=new Uint8Array(4),t.readPixels(e,this.canvas.height-i,1,1,t.RGBA,t.UNSIGNED_BYTE,n),e=this.selectObject(n),o.forEach(function(t){t.setDrawState()}),this.draw(t),e):null},b.prototype.getVertexPositions=function(t,e){return{x:t,y:e}},b.prototype.selectObject=function(t){var e=v.getIdFromSelColor(t);return this.getAllElements().find(function(t){return t.id===e})},b.FONT_DEFAULT="Segoe UI,Helvetica,Arial,sans-serif",b.ACTION_NONE="none",b.ACTION_DRAW="draw",b.ACTION_MOVE="move",b.ACTION_RESIZE="resize",b.PROP_ANNOTATIONS="Annotations.Annotations",b.PROP_ANNOTATE_CONTROL="Annotations.ShowAnnotateControl",b.LINE_RECT_WIDTH=3,b.LEGEND_WIDTH=130;var ee,ie=b;function b(t){var e=ee.call(this,t)||this,i=(e.isInitialized=!1,e.action=b.ACTION_NONE,e.annotations=[],e.drag=!1,e.startX=0,e.startY=0,e.xAxisDataBounds=[],e.yAxisDataBounds=[],e.xAxisViewBounds=[],e.yAxisViewBounds=[],e.isXZoom=!1,e.isYZoom=!1,e.isZoom=!1,e.canvas=t.canvas,e.canvas2d=t.canvas2d,e.canvas2d.getContext("2d"));if(i)return e.ctx=i,e.getOverlay=t.getOverlay,e.gl=t.gl,e.api=t.api,e.drawEl=t.drawEl,e.onResize=t.onResize,e.el=t.el,e.el.innerHTML=N.annotate({}),e.render(),e.renderLinks(),e.annotateGL=new Jt(e.gl,Y.isWebGL2),e.annotateStack=new te,e.initializeEvents(),e;throw new Error("ChartGL: failed to get 2D context")}d.easeInQuad=function(t){return Math.pow(t,2)},d.easeOutQuad=function(t){return-(Math.pow(t-1,2)-1)},d.easeInOutQuad=function(t){return(t/=.5)<1?.5*Math.pow(t,2):-.5*((t-=2)*t-2)},d.easeInCubic=function(t){return Math.pow(t,3)},d.easeOutCubic=function(t){return Math.pow(t-1,3)+1},d.easeInOutCubic=function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},d.easeInQuart=function(t){return Math.pow(t,4)},d.easeOutQuart=function(t){return-(Math.pow(t-1,4)-1)},d.easeInOutQuart=function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},d.easeInQuint=function(t){return Math.pow(t,5)},d.easeOutQuint=function(t){return Math.pow(t-1,5)+1},d.easeInOutQuint=function(t){return(t/=.5)<1?.5*Math.pow(t,5):.5*(Math.pow(t-2,5)+2)},d.easeInSine=function(t){return 1-Math.cos(t*(Math.PI/2))},d.easeOutSine=function(t){return Math.sin(t*(Math.PI/2))},d.easeInOutSine=function(t){return-.5*(Math.cos(Math.PI*t)-1)},d.easeInExpo=function(t){return 0===t?0:Math.pow(2,10*(t-1))},d.easeOutExpo=function(t){return 1===t?1:1-Math.pow(2,-10*t)},d.easeInOutExpo=function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},d.easeInCirc=function(t){return-(Math.sqrt(1-t*t)-1)},d.easeOutCirc=function(t){return Math.sqrt(1-Math.pow(t-1,2))},d.easeInOutCirc=function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},d.easeOutBounce=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},d.easeInBack=function(t){return t*t*(2.70158*t-1.70158)},d.easeOutBack=function(t){return(t-=1)*t*(2.70158*t+1.70158)+1},d.easeInOutBack=function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},d.elastic=function(t){return-1*Math.pow(4,-8*t)*Math.sin((6*t-1)*(2*Math.PI)/2)+1},d.swingFromTo=function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},d.swingFrom=function(t){return t*t*(2.70158*t-1.70158)},d.swingTo=function(t){return--t*t*(2.70158*t+1.70158)+1},d.bounce=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},d.bouncePast=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?2-(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?2-(7.5625*(t-=2.25/2.75)*t+.9375):2-(7.5625*(t-=2.625/2.75)*t+.984375)},d.easeFromTo=function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},d.easeFrom=function(t){return Math.pow(t,4)},d.easeTo=function(t){return Math.pow(t,.25)};var ne=d;function d(){}var G,H,oe={left:"right",right:"left",top:"bottom",bottom:"top",center:"center"},ae=(D.prototype.drawLabels=function(t,e,i,n,o,u,c,d,y,g,f){var m,a,r,P,x,v,O,b,T,A,L,s,_,C,l,h,E,S,R=this;this.propertyCache&&(m=this.propertyCache[D.PROP_LABEL_ALIGN],h=this.propertyCache[D.PROP_LABEL_COLOR],s=this.propertyCache[D.PROP_LABEL_FONT_BOLD],l=this.propertyCache[D.PROP_LABEL_FONT_SIZE],a=this.propertyCache[D.PROP_LABEL_FREQ],r=this.propertyCache[D.PROP_LABEL_MAX_LABELS],P=this.propertyCache[D.PROP_LABEL_OFFSET],x=this.propertyCache[D.PROP_LABEL_ROTATION],this.updateCanvasContext(m,h,s,l),v=new F(i.x,i.z).applyFn(function(t){return Number(Y.convertJSToScalar(n,t))}),O=new F(i.y,i.w).applyFn(function(t){return Number(Y.convertJSToScalar(o,t))}),h=this.api.getProperty("Layers."+e+"."+z.PROP_TYPE),b=h===V.Bounds,T=h===V.Baseline,A=h===V.Bar,L=t[0],s=b?[L]:t[1],_=r>L.length?L.length:r,C=b?2*a:a,l=this.api.getProperty("Layers."+e+".XAxisId"),i=this.api.getProperty("Layers."+e+".YAxisId"),h=l.replace(/.*?(\d+)$/,"$1")-1,t=i.replace(/.*?(\d+)$/,"$1")-1,E=this.api.getProperty("Xaxes."+h+".Stacked"),S=this.api.getProperty("Yaxes."+t+".Stacked"),s.forEach(function(t,e){for(var i=0,n=0;n<_;n+=C){var o,a=R.labelStrings[e][i],r="y"===g,s="x"===g,l=b?(L[n+1]+L[n])/2:L[n],h=(T&&"center"===m&&r&&(l=(l+(v.x<0?0:v.x))/2),Y.normalize(Number(l),v.x,v.y)),p=f&&f[e]?f[e][n]:null,l=(A&&(l=E&&!y?l:l-u+c*(d+.5),y&&(l=S&&null!==p?"center"===m?(p+(p-L[n]))/2:p:(l+(v.x<0?0:v.x))/2),h=Y.normalize(l,v.x,v.y)),h*R.canvas.width),h=(T&&r&&"center"!==m&&(l-=(o=R.ctx.measureText(a)).width/2),b?Number(O.y):t[n]),r=(S&&!y&&null!==p?h="center"===m?(p+(p-t[n]))/2:p:(A&&!y||b||s)&&"center"===m&&(h=(h+(O.x<0?0:O.x))/2),(1-Y.normalize(h,O.x,O.y))*R.canvas.height),p=(T&&s&&"center"!==m&&(r+=((o=R.ctx.measureText(a)).actualBoundingBoxAscent+o.actualBoundingBoxDescent)/2),0),h=0;P&&(p=Number(P.split(",")[0]),s=P.substring(P.indexOf(",")+1),h=Number(s.length?s:p)),R.ctx.save(),R.ctx.translate(l+p+R.xPadding,r+h+R.yPadding),R.ctx.rotate(x*(Math.PI/180)),R.ctx.fillText(a,0,0),R.ctx.restore(),i++}d++}))},D.prototype.getMaxLabelSize=function(t,s,l,e,h,p,u){var c,d,y,g,i,f,n,m,P,x,v,O,b,o,a,T=this;return this.propertyCache&&(o=this.propertyCache[D.PROP_LABEL_FONT_BOLD],i=this.propertyCache[D.PROP_LABEL_FONT_SIZE],c=this.propertyCache[D.PROP_LABEL_FREQ],a=this.propertyCache[D.PROP_LABEL_MAX_LABELS],n=this.propertyCache[D.PROP_LABEL_TEMPLATE],this.ctx.font=(o?"bold ":"")+i+"px "+X.FONTFACE,d=this.api.getTemplateViewStates(n),y=R.compile(n),o=this.api.getProperty("Layers."+l+"."+z.PROP_TYPE),g=o===V.Bounds,i=o===V.Baseline,f=t[0],n=g?[f]:t[1],m=a>(null==f?void 0:f.length)?f.length:a,P=g?2*c:c,x=0,O=new F(e.y,e.w).applyFn(function(t){return Number(Y.convertJSToScalar(p,t))}),b=new F(e.x,e.z).applyFn(function(t){return Number(Y.convertJSToScalar(h,t))}),i&&(n.length||(n=[[O.y]]),f&&f.length||(f=[b.y])),this.labelStrings=[],n.forEach(function(t,e){T.labelStrings[e]=[];for(var i=0;i<m;i+=P){var n=T.getRowData(x),o=T.api.getProperty("Layers."+l+".XAxis"),o=n?n[o]:null,a=n?n[s[e]]:null,r=(u&&("x"===(r=u.axis)?(o=u.jsVal,a=Y.convertToJsScalar(p,O.y,!0)):"y"===r&&(a=u.jsVal,o=Y.convertToJsScalar(h,b.y,!0))),L(L({},d),{x:g?f[i]:o,y:g?Number(O.y):a,data:n})),o=y(r);(!v||v.length<o.length)&&(v=o),x+=c,T.labelStrings[e].push(o)}}),v)?(t=(o=this.ctx.measureText(v)).width,a=o.actualBoundingBoxAscent+o.actualBoundingBoxDescent,e=this.propertyCache[D.PROP_LABEL_ALIGN],-1!==["right","left"].indexOf(e)&&(t*=2),-1!==["top","bottom"].indexOf(e)&&(a*=2),{width:t,height:a}):null},D.prototype.onSettingsChange=function(t){var e=t[D.PROP_LABEL_ALIGN],e=oe[e];this.propertyCache=t,this.xPadding="right"===e?-5:"left"===e?5:0,this.yPadding="bottom"===e?-5:"top"===e?5:0},D.prototype.removeLabels=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},D.prototype.updateCanvasContext=function(t,e,i,n){this.ctx.fillStyle=e,this.ctx.font=(i?"bold ":"")+n+"px "+X.FONTFACE;e=oe[t];"top"===t||"bottom"===t?(this.ctx.textBaseline=e,this.ctx.textAlign="center"):(this.ctx.textAlign=e,this.ctx.textBaseline="middle")},D.PROP_LABEL_ALIGN="Labels.Align",D.PROP_LABEL_COLOR="Labels.Color",D.PROP_LABEL_FONT_BOLD="Labels.Font.Bold",D.PROP_LABEL_FONT_SIZE="Labels.Font.Size",D.PROP_LABEL_FREQ="Labels.Frequency",D.PROP_LABEL_OFFSET="Labels.Offset",D.PROP_LABEL_MAX_LABELS="Labels.MaxLabels",D.PROP_LABEL_ROTATION="Labels.Rotation",D.PROP_LABEL_TEMPLATE="Labels.Template",D);function D(t,e,i){this.canvas=t,this.api=e,this.getRowData=i,this.labelStrings=[],this.xPadding=0,this.yPadding=0;t=this.canvas.getContext("2d");if(!t)throw new Error("ChartGL: failed to get 2D context");this.ctx=t}function U(t){var e=this;this.ignoreSettingsChange=!1,this.layers=[],this.isLoading=!1,this.xAxisLayer={},this.yAxisLayer={},this.layerXAxis={},this.layerYAxis={},this.xAxisDataBounds=[],this.yAxisDataBounds=[],this.xAxisViewBounds=[],this.yAxisViewBounds=[],this.activeZoom=new M(0,0,1,1),this.animateZoom=!1,this.selZoom=!1,this.lastXZoom=[],this.lastYZoom=[],this.xAxisZoom=[],this.yAxisZoom=[],this.onXZoom=!1,this.onYZoom=!1,this.pannedAxis=null,this.zoomTime=0,this.resetZoom=!1,this.zoomedXDataBounds=[],this.zoomedYDataBounds=[],this.activeBounds=[],this.activeXPan=[],this.activeYPan=[],this.closestPoint=new F(0,1),this.expressTime=Date.now()-U.REST_MS,this.overPoint=null,this.size=new F(1,1),this.renderedMargin=new M(0,0,0,0),this.renderedSize=new F(1,1),this.click=!1,this.hover=!1,this.settingsSelected=!1,this.settingsHovered=!1,this.renderState=G.Valid,this.panning=!1,this.zoomEnabled=!0,this.showQueryStatus=!0,this.options=t,this.api=t.api,this.el=t.el,this.el.className+=" ChartGL",this.uid=_.uniqueId("ChartGL"),this.el.innerHTML=N.app({uid:this.uid}),this.tooltips=new Lt(this.api),this.dashboardViewModel=t.dashboardViewModel,this.legend=new wt(this.el,this.api,this.tooltips,this.invalidate.bind(this),this.setIgnoreSettings.bind(this),this.updateWildcardLayers.bind(this),this.getFileExporterWidth.bind(this),this.getAnnotateWidth.bind(this)),this.axis=new Nt(this.api,this.el.getElementsByClassName("axis")[0],this.legend),this.pan=new Bt(this.api,this.axis,this.onPan.bind(this)),this.canvas=this.el.getElementsByTagName("canvas")[1],this.image=document.createElement("img"),this.image.style.opacity="0",this.crosshairHover=new _t(this.el,this.api,this.canvas),this.crosshairSelected=new _t(this.el,this.api,this.canvas),this.overlay=new kt(this.el.getElementsByClassName("overlay")[0],this.onOverlayOver.bind(this),this.onOverlayZoom.bind(this),this.onOverlayReset.bind(this),this.onOverlayClick.bind(this)),Y.isWebGLHWAcclEnabled||k.Log.Warn("ChartGL: Hardware Acceleration not enabled"),this.gl=this.canvas.getContext(Y.glContext,{premultipliedAlpha:Y.isWebGLHWAcclEnabled,preserveDrawingBuffer:!0}),this.gl?(k.Log.Info("webgl works!"),this.annotationsCanvas=this.el.getElementsByClassName("annotations")[0],this.annotationsGl=this.annotationsCanvas.getContext(Y.glContext,{premultipliedAlpha:Y.isWebGLHWAcclEnabled,preserveDrawingBuffer:!0}),this.annotationsGl?(this.setTheme(this.dashboardViewModel.get(U.APP_THEME)),this.onResize(),this.initializeEventListeners(),this.fileExporterView=new Wt({api:this.api,el:this.el.getElementsByClassName("export-div")[0],layers:this.layers,getCanvas:function(){return e.canvas},onResize:this.onResize.bind(this),theme:this.theme,dashboardViewModel:this.dashboardViewModel}),this.annotationsView=new ie({api:this.api,el:this.el.getElementsByClassName("draw-div")[0],gl:this.annotationsGl,canvas:this.annotationsCanvas,canvas2d:this.el.getElementsByClassName("annotations2d")[0],getOverlay:function(){return e.overlay},onResize:this.onResize.bind(this)})):k.Log.Error("ChartGL: Annotations Context Not Initialized")):"undefined"!=typeof WebGL2RenderingContext?console.error("Your browser appears to support WebGL but it might be disabled. Try updating your OS and/or video card drivers"):console.error("Your browser does not support WebGL")}return(i=G=G||{})[i.Init=0]="Init",i[i.Data=1]="Data",i[i.Loaded=2]="Loaded",i[i.Process=3]="Process",i[i.Legend=4]="Legend",i[i.Axis=5]="Axis",i[i.Uniforms=6]="Uniforms",i[i.Tooltip=7]="Tooltip",i[i.Valid=8]="Valid",(e=H=H||{})[e.Default=0]="Default",e[e.Fill=1]="Fill",e[e.Bubble=2]="Bubble",U.getNewLayerId=function(t){for(var e=0;t["L"+e];)e++;return"L"+e},U.prototype.onOverlayOver=function(t){var e;(null==t?void 0:t.x)===(null==(e=this.overPoint)?void 0:e.x)&&(null==t?void 0:t.y)===(null==(e=this.overPoint)?void 0:e.y)||(!t&&this.overPoint&&this.api.setProperty(U.PROP_HOVER,""),this.overPoint=t,this.invalidate(G.Tooltip),t&&(this.hover=!0))},U.prototype.onOverlayZoom=function(t){k.Log.Log("Region: "+t);var t=new M(t.x,1-t.w,t.z,1-t.y),e=new F(this.activeZoom.x,this.activeZoom.z),i=new F(this.activeZoom.y,this.activeZoom.w),n=Y.calculateCroppedJs2(new F(t.x,t.z),e),o=Y.calculateCroppedJs2(new F(t.y,t.w),i),n=(this.onXZoom=!_.isEqual(e,n),this.onYZoom=!_.isEqual(i,o),this.zoomTime=Date.now(),this.zoomEnabled?this.activeZoom:new M(0,0,1,1));this.activeZoom=this.activeZoom?Y.calculateCroppedBounds(t,n):t,this.onZoom(t,!!e,!!i)},U.prototype.onOverlayReset=function(){var i=this;this.zoomTime=Date.now(),this.activeZoom=new M(0,0,1,1),this.resetZoom=!0,this.activeXPan.forEach(function(t,e){return i.activeXPan[e]=new F(0,1)}),this.activeYPan.forEach(function(t,e){return i.activeYPan[e]=new F(0,1)}),this.setIgnoreSettings(!0),this.axis.x.forEach(function(t,e){return t.setRangeViewstate(null,"Xaxes",e)}),this.axis.y.forEach(function(t,e){return t.setRangeViewstate(null,"Yaxes",e)}),this.setIgnoreSettings(!1),this.getSelectionViewstates(),this.zoomedXDataBounds=[],this.zoomedYDataBounds=[],this.processIfFixedBarsOrLine()},U.prototype.onPan=function(t,e,i,n){e&&this.crosshairSelected.onPan(e);e="Right"===n||"Left"===n;e?this.activeXPan[i]=new F(t.x,t.z):this.activeYPan[i]=new F(t.y,t.w),this.pannedAxis={axis:e?"x":"y",index:i},this.invalidate(G.Axis)},U.prototype.getFileExporterWidth=function(){return this.fileExporterView?this.fileExporterView.getWidth():0},U.prototype.getAnnotateWidth=function(){return this.annotationsView?this.annotationsView.getWidth():0},U.prototype.onResize=function(){this.size=new F(this.el.offsetWidth,this.el.offsetHeight),this.legend.onResize(this.el.offsetHeight),this.axis.onResize(),this.processIfFixedBarsOrLine()},U.prototype.onSettingsChange=function(i){var e,n,o,a,r,s,t,l,h,p,u,c,d,y=this;this.ignoreSettingsChange||(c=_.find(_.keys(i),function(t){return 0===t.indexOf(U.PROP_SELECT)}),d=_.find(_.keys(i),function(t){return 0===t.indexOf(U.PROP_HOVER)}),(!c&&d||!d&&c)&&(this.settingsSelected=!(!c||this.click),this.settingsHovered=!(!d||this.hover),this.invalidate(G.Tooltip)),i.hasOwnProperty("Layers")||(c=Y.expandNestedViewStates(i,this.api),d=Y.replaceViewStatesWithValue("",c,this.api),i=d),0<(c=_.filter(_.keys(i),function(t){return-1!==t.indexOf("Layers.")})).length&&(e={},_.each(c,function(t){_.set(e,t,i[t]),delete i[t]}),_.extend(i,e)),d=i[U.PROP_LEGEND_GROUPS],c=this.api.getProperty(U.PROP_LEGEND_GROUPS).filter(function(t){return!!t}),(d||i[U.PROP_LAYERS])&&(u=(t=c.length&&this.api.getProperty("Layers").some(function(t){return t.LegendGroup&&"None"!==t.LegendGroup}))?["Left","Right"]:["Top","Bottom","Left","Right"],this.api.getProperty(U.PROP_POSSIBLEPOSITIONS)!==u)&&(this.api.setProperty(U.PROP_POSSIBLEPOSITIONS,u),!t||"Top"!==(u=this.api.getProperty("Legend.Position"))&&"Bottom"!==u||this.api.setProperty("Legend.Position","Right")),d&&d.length&&(c.forEach(function(t,e){t=t.Name;_.isEmpty(t)&&y.api.setProperty(U.PROP_LEGEND_GROUPS+"."+e+".Name","Legend Group "+(e+1))}),t=this.api.getProperty(U.PROP_POSSIBLELEGENDGROUPS),u=c.map(function(t){return t.Name}),t!==["None"].concat(u)&&this.api.setProperty(U.PROP_POSSIBLELEGENDGROUPS,["None"].concat(u)),this.legend.onSettingsChange(c)),d=i[U.PROP_ZOOM],_.isNil(d)||d===this.zoomEnabled||(this.zoomEnabled=d,t=void 0!==this.api.getProperty(U.PROP_DURATION),u=this.api.getProperty(U.PROP_EASING),!this.zoomEnabled||t&&u?this.zoomEnabled||!t&&!u||(this.api.setProperty(U.PROP_DURATION,void 0),this.api.setProperty(U.PROP_EASING,void 0)):(this.api.setProperty(U.PROP_DURATION,400),this.api.setProperty(U.PROP_EASING,"easeOutQuart")),this.api.getProperty("Yaxes").forEach(function(t,e){var i=void 0===y.api.getProperty("Yaxes."+e+".Range.SelectionMin"),n=void 0===y.api.getProperty("Yaxes."+e+".Range.SelectionMax");i&&n||y.zoomEnabled?(i||n)&&y.zoomEnabled&&(y.api.setProperty("Yaxes."+e+".Range.SelectionMin",""),y.api.setProperty("Yaxes."+e+".Range.SelectionMax","")):(y.api.setProperty("Yaxes."+e+".Range.SelectionMin",void 0),y.api.setProperty("Yaxes."+e+".Range.SelectionMax",void 0))})),i[U.PROP_LAYERS]&&(n=this.api.getProperty(U.PROP_LAYERS),o=!1,a=_.reduce(n,function(t,e){return t[e[U.PROP_LAYER_ID]]=!0,t},{}),_.each(this.layers,function(t){void 0===t||a[t.getId()]||(t.isBar()&&y.updateBars(t.getAxisId("x")),o=!0,t.remove(y.gl),y.layers.splice(y.layers.indexOf(t),1),y.activeBounds.splice(y.layers.indexOf(t),1))}),_.each(this.layers,function(e){var t=_.findIndex(n,function(t){return t._Id===e.getId()});e.index!==t&&(e.index=t)}),(c=this.layers.find(function(t){var e;if(i&&i.Layers)return e=i.Layers[t.index],t.getLayerType()!==e._Type||t.wildcardDataChanged(e[z.PROP_DATA])||y.layers.length!==i[U.PROP_LAYERS].length||e.ShowCurrentTick!==t.isCurrentTickShown()}))||this.updateWildcardLayers(),this.drawLayers(i),this.invalidate(this.layers.length?o||c?G.Process:G.Legend:G.Uniforms)),i[U.PROP_LEGEND_POS]&&_.some(this.layers,function(t){return t.hasData()})&&this.invalidate(G.Legend),r=_.find(_.keys(i),function(t){return 0===t.indexOf("Xaxes")}),s=_.find(_.keys(i),function(t){return 0===t.indexOf("Yaxes")}),d=this.api.getProperty("Xaxes"),t=this.api.getProperty("Yaxes"),l=[],h=[],(r||s)&&(p=X.RANGE_PROPS,r&&_.each(d,function(e,t){var i=y.axis.x[t];i&&p.filter(function(t){return e[t]!==i.propertyCache[t]})&&l.push(Number(t)),y.axis.onSettingsChange(r,t)}),s&&_.each(t,function(e,t){var i=y.axis.y[t];i&&p.filter(function(t){return e[t]!==i.propertyCache[t]})&&h.push(Number(t)),y.axis.onSettingsChange(s,t)}),this.selZoom||this.checkRangeViewstatesChanged(d,"Xaxes"),this.selZoom||this.checkRangeViewstatesChanged(t,"Yaxes"),this.selZoom&&(this.getSelectionViewstates(),this.zoomTime||(this.zoomTime=Date.now())),u=function(t,i){t.forEach(function(e){y.layers.forEach(function(t){t.getAxisId(i)===e&&t.updateRenderState()})})},l.length||h.length?(l.length&&u(l,"x"),h.length&&u(h,"y"),this.invalidate(G.Process)):this.processIfFixedBarsOrLine()),(c=_.find(_.keys(i),function(t){return 0===t.indexOf(U.PROP_CROSSHAIRS)}))&&!i[c]&&this.crosshairHover.hideCrosshair("hide-both"),(d=_.find(_.keys(i),function(t){return 0===t.indexOf(U.PROP_COORDS)}))&&!i[d]&&this.tooltips.hideCoordinates(this.el),_.find(_.keys(i),function(t){return 0===t.indexOf(U.PROP_EXPORT)})&&(this.fileExporterView.displayChoiceLinkButtons(),this.invalidate(G.Legend)),_.find(_.keys(i),function(t){return 0===t.indexOf(U.PROP_ANNOTATE_CONTROL)})&&(this.annotationsView.showAnnotateControl(),this.invalidate(G.Legend)),_.find(_.keys(i),function(t){return 0===t.indexOf(U.PROP_ANNOTATIONS)})&&this.annotationsView.onSettingsChange())},U.prototype.onWheelZoom=function(t){var e,i,n,o,a=this.zoomedPoint||this.overPoint;a&&t.deltaY&&(t.preventDefault(),o=n=1,t.deltaY<(i=e=0)?(this.zoomedPoint=this.closestPoint,t.shiftKey?(i=.1*a.y,o=1-.1*(1-a.y)):(e=.1*a.x,n=1-.1*(1-a.x))):0<t.deltaY&&(t.shiftKey?(i=-.1*a.y,o=1+.1*(1-a.y)):(e=-.1*a.x,n=1+.1*(1-a.x))),a=new M(e,i,n,o),e=Y.calculateCroppedBounds(a,this.activeZoom),i=!t.shiftKey&&1<e.z-e.x,n=t.shiftKey&&1<e.w-e.y,(o=i||n)&&(a=new M(0,0,1,1),i?e=new M(0,e.y,1,e.w):n&&(e=new M(e.x,0,e.z,1))),t.shiftKey?this.onYZoom=!0:this.onXZoom=!0,this.activeZoom=e,this.onZoom(a,!t.shiftKey,t.shiftKey,o))},U.prototype.onZoom=function(n,t,e,o){var a=this;t&&this.axis.x.forEach(function(t,e){var i=a.xAxisZoom[e]||new F(0,1);0===i.x&&1===i.y&&(a.zoomedXDataBounds=a.xAxisDataBounds),a.xAxisZoom[e]=o?new F(0,1):a.xAxisZoom[e]&&a.zoomEnabled?Y.calculateCroppedJs2(new F(n.x,n.z),a.xAxisZoom[e]).applyFn(Y.convertJSToNumber):new F(a.activeZoom.x,a.activeZoom.z)}),e&&this.axis.y.forEach(function(t,e){var i=a.yAxisZoom[e]||new F(0,1);0===i.x&&1===i.y&&(a.zoomedYDataBounds=a.yAxisDataBounds),a.yAxisZoom[e]=o?new F(0,1):a.yAxisZoom[e]?Y.calculateCroppedJs2(new F(n.y,n.w),a.yAxisZoom[e]).applyFn(Y.convertJSToNumber):new F(a.activeZoom.y,a.activeZoom.w)}),this.processIfFixedBarsOrLine()},U.prototype.updateWildcardLayers=function(n,o){var a=this,i=!1,t=_.filter(this.api.getProperty("Layers"),function(t){return Y.isRegexOrWild(t.YAxis)});_.each(this.api.getProperty("Layers"),function(t,e){e=a.layers[e];e&&e.isBar()&&(i=a.updateBars(e.getAxisId("x")))}),_.each(t,function(e){var t=_.findIndex(a.layers,function(t){return t.getId()===e._Id}),i=a.api.getProperty("Layers."+t+".Enabled");i||a.legend.updateWildcards(a.layers[t],t),!0!==i||n||a.legend.updateWildcards(a.layers[t],t,"reset",o)}),this.legend.updatePalette(this.layers),this.legend.getLayers(this.layers),i&&this.invalidate(G.Process)},U.prototype.remove=function(){var e=this;return this.overlay&&this.overlay.remove(),this.layers.forEach(function(t){return t.remove(e.gl)}),this},U.prototype.setTheme=function(t){"Light"===t?this.el.classList.add("Light"):this.el.classList.remove("Light"),this.axis.updateTheme(t),this.axis.renderAxes(),this.legend.updateTheme(t),this.tooltips.updateTheme(t,this.el),this.theme=t,this.invalidate(G.Legend)},U.prototype.calculateLayerAxisMaps=function(){var n=this;this.xAxisLayer={},this.yAxisLayer={},this.layerXAxis={},this.layerYAxis={},this.layers.forEach(function(t,e){var i=n.api.getProperty(t.indexProp(z.PROP_XAXISID)).replace(/.*?(\d+)$/,"$1"),t=n.api.getProperty(t.indexProp(z.PROP_YAXISID)).replace(/.*?(\d+)$/,"$1");i&&(i=Number(i)-1,void 0===n.xAxisLayer[i]?n.xAxisLayer[i]=[e]:n.xAxisLayer[i].push(e),n.layerXAxis[e]=i),t&&(t=Number(t)-1,void 0===n.yAxisLayer[t]?n.yAxisLayer[t]=[e]:n.yAxisLayer[t].push(e),n.layerYAxis[e]=t)})},U.prototype.checkRangeViewstatesChanged=function(t,a){var r=this;_.each(t,function(t,e){var i,n=r.api.getPropertyMeta(a+"."+e+X.PROP_SEL_MIN),o=r.api.getPropertyMeta(a+"."+e+X.PROP_SEL_MAX);(n||o)&&(i=!(e=("Xaxes"===a?r.xAxisViewBounds:r.yAxisViewBounds)[e])&&(n.value||o.value),r.zoomEnabled)&&(n.viewstateType||o.viewstateType)&&(e||i)&&(r.selZoom=!0)})},U.prototype.createDataBounds=function(t,o,a,r,e){var s=this;return e&&(o=this.getStackedBounds(o,r)),t.map(function(t,e){var i=new F(0,1),n=(a[e]&&(n=a[e].map(function(t){return s.layers[t].isEnabled()&&s.layers[t].hasData()&&s.layers[t].getLayerType()!==V.Bounds&&s.layers[t].getLayerType()!==V.Baseline?o[t]:null}).filter(function(t){return t}),i=Y.mergeRange(n)||new F(0,1)),_.max(s.getLayerDataTypes(r?"x":"y",e)));return s.axis.getBounds(i,r?"Xaxes":"Yaxes",e,n)})},U.prototype.createViewBounds=function(l,h,p,u,t){var c=this;return t.map(function(t,e){var i,n,o,a=new F(0,1),r=new F(0,1),s=u?c.xAxisLayer:c.yAxisLayer;return s[e]?(s=s[e].map(function(t){if(l[t])return u?Y.xPart(l[t]):Y.yPart(l[t])}).filter(function(t){return t}),a=Y.mergeRange(s)||new F(0,1),s=_.max(c.getLayerDataTypes(u?"x":"y",e)),c.updateZoomValues(a,e,s,u),i=o=(o=(u?c.xAxisZoom:c.yAxisZoom)[e])?o.applyFn(Y.convertJSToNumber):u?new F(c.activeZoom.x,c.activeZoom.z):new F(c.activeZoom.y,c.activeZoom.w),h?(n=(u?c.lastXZoom:c.lastYZoom)[e])&&(i=Y.scale2(p,n,o)):(c.zoomTime=0,u?c.lastXZoom[e]=_.clone(o):c.lastYZoom[e]=_.clone(o)),r=c.zoomEnabled?i.applyFn(Y.convertJSToNumber):new F(0,1),n=Y.calculateCroppedJs2(r,a,s),!c.zoomEnabled&&u&&0===e&&(o=c.axis.getSelectionZoomBounds(n,"Xaxes",e,_.max(c.getLayerDataTypes("x",e,!0)),c.getAllCategoryData("X",e)),c.overlay.updateRangeSelector(Y.calculateCrop(o,n,s))),[n,r]):[a,r]})},U.prototype.drawCoordinates=function(t,e,i,n){var o="";e&&("x"===(o=this.overlay.getZoomDirection())?this.tooltips.hideCoordinates(this.el,"y"):"y"===o&&this.tooltips.hideCoordinates(this.el,"x"));var a,r,s,l=this.api.getProperty(U.PROP_SNAP)&&!e,h=!l&&this.overPoint?new F(this.overPoint.x,Math.abs(this.overPoint.y)):new F(t.overpoint.x,1-t.overpoint.y),p=e?0:t.layer.index,p=this.activeBounds[p].applyFn(Y.toNumber),u=t.layer,c=u.getLayerType(),d=u.isHorizontal(),y=null,g=null,f=c===V.Baseline,m=u.getBaselineInfo(),i=("y"!==o&&(a=u.getAxisType("x")===X.TYPE_CATEGORY?E.Float:(d?u.YType:u.XType)||0,r=(a=f&&m.types?m.types.x:a)?new F(Number(Y.convertJSToScalar(a,p.x)),Number(Y.convertJSToScalar(a,p.z))):new F(p.x,p.z),s=l&&c!==V.Bounds&&c!==V.Baseline?i:(r.y-r.x)*h.x+r.x,y=this.getCoordinateInfo(t,e,s,i,"x")),"x"!==o&&(a=u.getAxisType("y")===X.TYPE_CATEGORY?E.Float:(d?u.XType:u.YType)||0,r=(a=f&&m.types?m.types.y:a)?new F(Number(Y.convertJSToScalar(a,p.y)),Number(Y.convertJSToScalar(a,p.w))):new F(p.y,p.w),s=l&&c!==V.Bounds&&c!==V.Baseline?n:(r.x-r.y)*h.y+r.y,g=this.getCoordinateInfo(t,e,s,n,"y")),u.isHorizontal()?g:y),o=u.isHorizontal()?y:g;this.tooltips.drawCoordinates(this.canvas,h,this.renderedMargin,this.el,i,o)},U.prototype.drawLayers=function(r){var s=this,l=this.api.getProperty(U.PROP_LAYERS),h=_.reduce(l,function(t,e){return t[e[U.PROP_LAYER_ID]]=!0,t},{}),i=(_.each(l,function(t,e){var i,n=(t=r.Layers[e]?r.Layers[e]:t)[U.PROP_LAYER_ID],o=(_.isEmpty(n)&&(n=t[U.PROP_LAYER_ID]=U.getNewLayerId(h),h[n]=!0,s.api.setProperty(U.PROP_LAYERS+"."+e+"."+U.PROP_LAYER_ID,n,{silent:!0})),t[U.PROP_LAYER_NAME]),o=(_.isEmpty(o)&&s.api.setProperty(U.PROP_LAYERS+"."+e+"."+U.PROP_LAYER_NAME,"Layer "+(e+1)),_.find(s.layers,function(t){return t.getId()===n})),e=_.findIndex(l,function(t){return t._Id===n}),a=!1;o||(a=!0,o=new z(e,n,s.api,s.invalidate.bind(s),s.setIgnoreSettings.bind(s),s.el,s.updateWildcardLayers.bind(s)),s.layers.push(o),0<e&&s.layers[e-1].isBar()&&s.updateBars(s.layers[e-1].getAxisId("x"))),o.onSettingsChange(t),0<e&&!o.getDataSource()&&a&&(i=e-1,t=[z.PROP_COLOR,z.PROP_XAXISID,z.PROP_YAXISID,z.PROP_TYPE,z.PROP_XAXIS,z.PROP_YAXIS,z.PROP_BARPERCENT,z.PROP_BARFIXED,z.PROP_BARWIDTHTYPE,z.PROP_BAR_ORIENTATION,z.PROP_FILL,z.PROP_FILLCOLOR,z.PROP_FILLOPACITY,z.PROP_BEARCOLOR,z.PROP_BULLCOLOR,z.PROP_NEUTRALCOLOR,z.PROP_WICKCOLOR,z.PROP_CANDLEPERCENT,z.PROP_CANDLEFIXED,z.PROP_CANDLEWIDTHTYPE,z.PROP_PALETTE,z.PROP_SPAN_GAPS,z.PROP_FILLPALETTE,z.PROP_FADE,z.PROP_INCREASE_COLOR,z.PROP_DECREASE_COLOR,z.PROP_X1_COORD,z.PROP_X2_COORD,z.PROP_INTERPOLATION,z.PROP_STEPPED,z.PROP_BASELINE_AXIS,z.PROP_BASELINE_VALUE,z.PROP_HEATMAP_SCORE,z.PROP_HEATMAP_X1,z.PROP_HEATMAP_X2,z.PROP_HEATMAP_Y1,z.PROP_HEATMAP_Y2,z.PROP_LINETHICKNESS,z.PROP_BUBBLES_COLOR,z.PROP_BUBBLES_OPACITY,z.PROP_RADIUS_SCALE],a=_.map(t,function(t){return s.api.getProperty("Layers."+i+"."+t)}),o.updateLayer(s.layers[i].getDataSource(),a,t))}),[]),n=(_.each(l,function(e){var t=s.layers[_.findIndex(s.layers,function(t){return t.getId()===e._Id})];t&&i.push(t)}),this.layers=i,this.legend.getLayers(this.layers),this.layers.filter(function(t){return s.api.getProperty(t.indexProp(z.PROP_TYPE))===V.Line}));this.setIgnoreSettings(!0),_.each(n,function(t){var e=s.api.getProperty(t.indexProp(z.PROP_FILL)),i=s.api.getProperty(t.indexProp("possibleLayers"));i&&i.length===n.length+1||(i=_.map(n,function(t){return"Layer "+(t.index+1)}),i=["No Fill","Origin"].concat(_.without(i,"Layer "+(t.index+1))),s.api.setProperty(t.indexProp("possibleLayers"),i),-1===i.indexOf(e)&&s.api.setProperty(t.indexProp(z.PROP_FILL),"No Fill"))}),this.setIgnoreSettings(!1)},U.prototype.doActions=function(t,n,o){var a,e=this.api.getProperty(t.indexProp(z.PROP_ACTIONS));null!=e&&e.length&&(this.setIgnoreSettings(!0),a=[],e.forEach(function(t,e){var i=n.data[t.Current];"mousemove"===o&&"Hover"!==t.Trigger||"mousemove"!==o&&"Hover"===t.Trigger||a.push(L(L({},t),{Value:i,_PropertyIndex:e}))}),this.api.doActions(a,"Layers.".concat(t.index,".Actions")),this.setIgnoreSettings(!1))},U.prototype.getBaselineOverPoint=function(t){var e=t.getBaselineInfo(),i=t.getBaselineAxis(),n="x"===i?"y":"x",o=e.scalarVal,a=t.getAxisId(i),a=("x"===i?this.yAxisViewBounds:this.xAxisViewBounds)[a],n=e.types?e.types[n]:E.Float,n=Y.convertJSToScalar(n,null==a?void 0:a.y),a=new F("x"===i?o:n,"y"===i?o:n),n=Y.convertVec4ToScalar(this.getLayerViewBounds(t.index),(null==(i=e.types)?void 0:i.x)||E.Float,(null==(o=e.types)?void 0:o.y)||E.Float);return Y.calculateRelativePoint(a,n)},U.prototype.getClosestPoint=function(t,n,e,i){var o,a,r=this,s=n.isHorizontal(),l=Y.convertVec4ToScalar(this.getLayerViewBounds(n.index),this.getLayerDataType("x",n.index),this.getLayerDataType("y",n.index)),t=n.getClosestPointFromRelativeX(s?1+t.y:t.x,s?t.x:1+t.y,this.canvas.width,s?new M(l.y,l.x,l.w,l.z):l,e,i);if(null!==t)return o=t[0],s=t[1],l=t[2],a=t[3],i=function(t){var e=n.getConvertedCategoryData(o,t,a),i=n.getAxisId(t),t=("x"===t?r.xAxisViewBounds:r.yAxisViewBounds)[i];return Y.calcCrop(e,t.x,t.y)},t=new F(n.getAxisType("x")===X.TYPE_CATEGORY?i("x"):s.x,n.getAxisType("y")===X.TYPE_CATEGORY?i("y"):s.y),new At(n,o,t,l,a,e)},U.prototype.getAllCategoryData=function(t,e){return this.api.getProperty(t+"axes."+e+".Type")!==X.TYPE_CATEGORY||null==(t=this.layers.filter(function(t){return t.getAxisId("x")===e})[0])?void 0:t.getAllCategoryData("x")},U.prototype.getAxisDataBounds=function(t,e,i,n,o){var a=t,r=(null==(r=this.pannedAxis)?void 0:r.axis)===i&&(null==(r=this.pannedAxis)?void 0:r.index)===n,n=(null==(i=("x"===i?this.xAxisViewBounds:this.yAxisViewBounds)[n])?void 0:i.y)>=t.y;return a=!o&&!r||!e||e.x===t.x&&e.y===t.y?a:new F(e.x,(n?t:e).y)},U.prototype.getDataBounds=function(t,e,i,n){var t=this.getLayerDataBounds(t),o=this.zoomedXDataBounds[i],a=this.zoomedYDataBounds[n],o=this.getAxisDataBounds(Y.xPart(t),o,"x",i,e),i=this.getAxisDataBounds(Y.yPart(t),a,"y",n,e);return new M(o.x,i.x,o.y,i.y)},U.prototype.getLayerDataBounds=function(t){return M.fromVec2(this.xAxisDataBounds[this.layerXAxis[t]],this.yAxisDataBounds[this.layerYAxis[t]])},U.prototype.getLayerViewBounds=function(t){return M.fromVec2(this.xAxisViewBounds[this.layerXAxis[t]],this.yAxisViewBounds[this.layerYAxis[t]])},U.prototype.getCoordinateInfo=function(t,e,i,n,o){var a=t.layer.getAxisId(o),r=o.toUpperCase()+"axes.",e=e?this.api.getProperty(r+"0.Position"):this.api.getProperty(r+a+".Position"),r=i;return!_.isEqual(i,n)&&k.Tools.isKDBTemporal(n)&&(a=t.layer.index,r=Y.convertToJsScalar(this.getLayerDataType(o,a),i,!0)),{position:e,val:r}},U.prototype.getGroupedBars=function(){var a,i,n,o,r=[];if(this.layers.filter(function(t){return t.isBar()&&t.isEnabled()}).forEach(function(e){var t=e.getWildcardColumns();1<t.length?t.forEach(function(t){return r.push(e)}):r.push(e)}),r.length)return a={},this.api.getProperty("Xaxes").forEach(function(t,e){var i=r.filter(function(t){return t.getAxisId("x")===e}),n=i.map(function(t){return t.getGroupedBarData()}),o=[];n.forEach(function(t){return o=o.concat(t)}),a[e]={dataLength:_.uniq(o).length,indices:i.map(function(t,e){return e}),layers:i}}),i=[],n=[],o=[],r.forEach(function(t,e){t=a[t.getAxisId("x")];i[e]=t.indices,n[e]=t.layers,o[e]=t.dataLength}),{barIndices:i,dataLengths:o,layersCommonXAxis:n,allBarLayers:r}},U.prototype.getLayerDataType=function(t,e){var i,n,e=this.layers[e],o=e.getLayerType();return o===V.Baseline?(i=e.getBaselineInfo(),(n=e.getBaselineAxis())===t?i.type:this.getLayerDataTypes(t,e.getAxisId("x"===n?"y":"x"))[0]):"y"===t&&o===V.Bounds?this.getLayerDataTypes(t,e.getAxisId("y"))[0]:!e.hasData()||(i=e.isHorizontal(),n="y"===t&&!i||"x"===t&&i?e.YType:e.XType,e.getAxisType(t)===X.TYPE_CATEGORY)?E.Float:n},U.prototype.getLayerDataTypes=function(o,a,t){var e=o.toUpperCase()+"axes",i=this.api.getProperty(e+"."+a+".Type"),n=this.layers.filter(function(t){var e=t.getLayerType(),i="y"===o&&e===V.Bounds,e=e===V.Baseline,n=t.isEnabled();return t.getAxisId(o)===a&&n&&t.hasData()&&!i&&!e});return n.length&&(i!==X.TYPE_CATEGORY||t)?n.map(function(t){return"x"===o&&!t.isHorizontal()||"y"===o&&t.isHorizontal()?t.XType:t.YType}):this.axis.getAxisType(e,a)},U.prototype.getSelectionViewstates=function(){var a=this;this.axis.x.forEach(function(t,e){var i,n,o=a.xAxisDataBounds[e];o?(i=_.max(a.getLayerDataTypes("x",e,!0)),n=a.axis.getSelectionZoomBounds(o,"Xaxes",e,i,a.getAllCategoryData("X",e)),a.xAxisZoom[e]=Y.calculateCrop(n,o,i)):a.xAxisZoom[e]=new F(0,1)}),this.axis.y.forEach(function(t,e){var i,n,o=a.yAxisDataBounds[e];o?(i=_.max(a.getLayerDataTypes("y",e,!0)),n=a.axis.getSelectionZoomBounds(o,"Yaxes",e,i,a.getAllCategoryData("Y",e)),a.yAxisZoom[e]=Y.calculateCrop(n,o,i)):a.yAxisZoom[e]=new F(0,1)})},U.prototype.getStackedBounds=function(n,o){var a=this;return this.api.getProperty(U.PROP_YAXES).map(function(t,e){return a.layers.filter(function(t){return t.isEnabled()&&t.isBar()&&t.getAxisId("y")===e}).map(function(t){return t.index})}).forEach(function(t,e){var i;a.api.getProperty("Yaxes."+e+".Stacked")&&(t=t.map(function(t){return Array.prototype.concat.apply([],a.layers[t].getStackedYData())}),(t=Array.prototype.concat.apply([],t)).length)&&(i=_.min(a.getLayerDataTypes(o?"x":"y",e))||0,n[e]=new F(Y.convertToJsScalar(i,Math.min.apply(Math,t)),Y.convertToJsScalar(i,Math.max.apply(Math,t))))}),n},U.prototype.initializeEventListeners=function(){var e,i=this;this.el.addEventListener("mousedown",function(t){t.target===i.el.getElementsByClassName("axis")[0]&&(i.panning=!0,e=i.pan.onAxisPan(t,i.el.getBoundingClientRect())[1],i.pan.onPointDown(i.pan.onAxisPan(t,i.el.getBoundingClientRect())[0],e))}),document.addEventListener("mouseup",function(){setTimeout(function(){i.panning=!1,i.pannedAxis=null,document.body.style.cursor="default"},75)}),document.addEventListener("mousemove",function(t){i.panning&&(t=i.pan.onAxisPan(t,i.el.getBoundingClientRect())[0],i.pan.onPanning(t,e,i.xAxisZoom,i.yAxisZoom,i.activeXPan,i.activeYPan,i.el))}),this.el.addEventListener("wheel",function(t){i.onWheelZoom(t)})},U.prototype.invalidate=function(t){if(t<this.renderState){if((this.renderState=t)===G.Process&&this.expressTime<Date.now()-U.REST_MS&&_.every(this.layers,function(t){return t.RenderState===G.Process}))return this.expressTime=Date.now(),this.validate();window.requestAnimationFrame(this.validate.bind(this))}},U.prototype.onOverlayClick=function(){this.click=!0,this.invalidate(G.Tooltip)},U.prototype.processLayerData=function(t,e,i,n){var o=this.xAxisZoom[this.layerXAxis[t.index]],a=this.yAxisZoom[this.layerYAxis[t.index]],o=o&&a?M.fromVec2(o,a):this.activeZoom,a=this.zoomEnabled?o:new M(0,0,1,1),o=this.getLayerDataBounds(t.index),o="Fixed Width"===t.getBarType()||t.getLayerType()===V.Line?Y.calculateCroppedJsBounds(a,o,this.getLayerDataType("x",t.index),this.getLayerDataType("y",t.index)):o;t.processData(this.gl,this.size,o,t.getLayerType()===V.Bounds?this.getLayerDataType("y",t.index):null,e,i?[i,n,a]:null)},U.prototype.processIfFixedBarsOrLine=function(){var t=this.layers.filter(function(t){return t.hasFixedWidth()||t.isCandlestick()||t.getLayerType()===V.Line});_.each(t,function(t){return t.onResize()}),this.invalidate(t.length?G.Process:G.Axis)},U.prototype.resizeLabelsCanvas=function(t,e,i,n){var o=this.el.getElementsByClassName("data-labels")[0];o.style.left=t+"px",o.style.top=e+"px",o.width=i,o.height=n},U.prototype.setIgnoreSettings=function(t){this.ignoreSettingsChange=t},U.prototype.setRange=function(t,e,i,n,o,a){var r=o?new F(this.activeZoom.x,this.activeZoom.z):new F(this.activeZoom.y,this.activeZoom.w),n=n?n.applyFn(Y.convertJSToNumber):r,r=Y.calculateCroppedJs2(n,e,i),n=a[1];n&&n.length&&(i=(e=function(t,i){return t.reduce(function(t,e){return Math.abs(e-i)<Math.abs(t-i)?e:t})})(n,r.x),e=e(n,r.y),i=n.indexOf(i),n=n.indexOf(e),e=a[0],r=new F(e[i],e[n])),this.setIgnoreSettings(!0),o?this.axis.x[t].setRangeViewstate(r,"Xaxes",t):this.axis.y[t].setRangeViewstate(r,"Yaxes",t),this.setIgnoreSettings(!1)},U.prototype.updateBars=function(e){var t=this.layers.filter(function(t){return t.isBar()&&t.isEnabled()&&t.getAxisId("x")===e});return t.forEach(function(t){return t.updateRenderState()}),!!t.length},U.prototype.updateLayerPossibleAxes=function(){var n=this,o=(this.setIgnoreSettings(!0),this.api.getProperty(U.PROP_XAXES)),a=this.api.getProperty(U.PROP_YAXES);_.each(this.layers,function(t,e){var i=n.api.getProperty("Layers."+e+".possibleXAxes"),e=n.api.getProperty("Layers."+e+".possibleYAxes");i.length!==o.length&&t.updateAxisId(o,"x"),e.length!==a.length&&t.updateAxisId(a,"y")}),this.setIgnoreSettings(!1)},U.prototype.updateViewBounds=function(s,l,t,h){var p=this,u="x"===s,c=u?this.xAxisViewBounds:this.yAxisViewBounds,d=u?this.xAxisDataBounds:this.yAxisDataBounds,y=-1;return t.map(function(t,e){var i=t[0],n=(null==(n=p.pannedAxis)?void 0:n.axis)===s&&(null==(n=p.pannedAxis)?void 0:n.index)===e,t=t[1],n=h||n||l,t=0===t.x&&1===t.y,o=void 0!==(null==(o=c[e])?void 0:o.x)?null==(o=c[e])?void 0:o.x:i.x,a=void 0!==(null==(a=c[e])?void 0:a.y)?null==(a=c[e])?void 0:a.y:i.y;(n||t)&&(o=i.x);"Smart"===p.api.getProperty(s.toUpperCase()+"axes."+e+".Format.Distribution")&&(y++,r=null!=(t=u?p.xAxisBreakInfo:p.yAxisBreakInfo)&&t.max?null==t?void 0:t.max[y]:null);var r,t=_.max(p.getLayerDataTypes(u?"x":"y",e)),t=r?Y.convertToJsScalar(t,r):null,t=i.y>=(t||(null==(r=d[e])?void 0:r.y));return(n||t)&&(a=i.y),new F(o,a)})},U.prototype.updateZoomValues=function(t,e,i,n){var o=n?"x":"y",a=this.layers.filter(function(t){return t.getAxisId(n?"x":"y")===e})[0].getAllCategoryData(n?"x":"y"),r=_.max(this.getLayerDataTypes(n?"x":"y",e,!0)),s=(null==(s=this.pannedAxis)?void 0:s.index)===e&&(null==(s=this.pannedAxis)?void 0:s.axis)===o,o=this.axis.getSelectionZoomBounds(t,n?"Xaxes":"Yaxes",e,r,a);n?(this.selZoom&&(this.xAxisZoom[e]=Y.calculateCrop(o,t,r)),(this.onXZoom||s)&&this.setRange(e,t,i,this.xAxisZoom[e],n,a)):(this.selZoom&&(this.yAxisZoom[e]=Y.calculateCrop(o,t,r)),(this.onYZoom||s)&&this.setRange(e,t,i,this.yAxisZoom[e],n,a))},U.prototype.processSmartAxes=function(t,a,l,h){var p=this,u=[],c=[],d=[],t=(t.forEach(function(t,e){var i,n,r,o,s=[];"Smart"===p.api.getProperty(("x"===a?U.PROP_XAXES:U.PROP_YAXES)+"."+e+X.PROP_DISTRIBUTION)&&(n=(o=(i=l.filter(function(t){return t.getAxisId(a)===e&&t.isEnabled()&&t.getLayerType()!==V.Baseline})).map(function(t){return[t.getTriggerData(a),t.getTriggerIntervals(a)]})).map(function(t){return t[0]}),r=o.map(function(t){return t[1]}),o=Array.prototype.concat.apply([],n),(o="y"===a?Array.prototype.concat.apply([],o):o).length&&(c.push(Math.min.apply(Math,o)),d.push(Math.max.apply(Math,o))),r.forEach(function(t,i){null!=t&&t.forEach(function(e){var n=e[0],o=e[1],a=!0,t=(r.filter(function(t,e){return e!==i}).forEach(function(t,e){t.forEach(function(t,e){var i=t[0],t=t[1];i<n&&o<t&&(a=!1)})}),s.filter(function(t){return _.isEqual(t,e)}));a&&!t.length&&s.push(e)})}),i.forEach(function(t){t.updateRenderState(),p.processLayerData(t,h,s,a)})),u.push(s)}),{breakIntervals:u,min:c,max:d});"x"===a?this.xAxisBreakInfo=t:this.yAxisBreakInfo=t},U.prototype.validate=function(){var l=this;if(this.api.getProperty("Layers").length){var s,h,p,u,c,i,e=this.layers.filter(function(t){return t.isEnabled()}),n=e.filter(function(t){return t.Config}),o=(this.renderState<G.Legend&&this.layers.filter(function(t){return!t.isEnabled()}).length&&!n.length&&(this.renderState=G.Legend),_.some(e,function(t){return t.RenderState===G.Data})),e=e.map(function(t){return t.datasourceError}).filter(function(t){return!!t});if(o&&_.isEmpty(e))this.isLoading||this.api.showQueryStatus({error:"",type:"Loading"}),this.isLoading=!0,this.showQueryStatus=!0;else{if(this.layers.every(function(t){return t.isEnabled()&&t.hasNoResults()}))return this.api.showQueryStatus({error:"",type:"NoResults"}),this.showQueryStatus=!0,void(this.renderState=G.Valid);e.length&&e[0]?(this.api.showQueryStatus({error:t(e[0].error),type:"Error"}),this.showQueryStatus=!0,this.renderState=G.Valid):this.showQueryStatus&&(this.api.hideQueryStatus(),this.showQueryStatus=!1),this.isLoading=!1}this.calculateLayerAxisMaps(),this.renderState<=G.Process&&n.length&&(s=this.getGroupedBars(),this.barGroupingInfo=s,0<this.layers.length&&this.layers.some(function(t){return t.getDataSource()})&&this.showQueryStatus&&this.api.hideErrorMessage(),o=this.layers.map(function(t){return t.isHorizontal()?t.getDataRangeY():t.getDataRangeX()}),e=this.layers.map(function(t){return t.isHorizontal()?t.getDataRangeX():t.getDataRangeY()}),B=this.api.getProperty("Xaxes"),I=this.api.getProperty("Yaxes"),N=n.filter(function(t){return t.hasData()}),this.xAxisDataBounds=this.createDataBounds(B,o,this.xAxisLayer,!0),this.yAxisDataBounds=this.createDataBounds(I,e,this.yAxisLayer,!1),this.activeXPan=B.map(function(t,e){return l.activeXPan[e]||new F(0,1)}),this.activeYPan=I.map(function(t,e){return l.activeYPan[e]||new F(0,1)}),b=this.layers.filter(function(t){return t.hasFixedWidth()||t.isCandlestick()}),(this.onXZoom||this.onYZoom||this.selZoom)&&!this.resetZoom||_.each(b,function(t){return t.onResize()}),h=_.some(this.layers.filter(function(t){return t.isEnabled()}),function(t){return!t.Config}),b=this.api.getProperty(U.PROP_YAXES),p=b.map(function(t,e){return l.layers.filter(function(t){return t.isEnabled()&&t.isBar()&&t.getAxisId("y")===e}).map(function(t){return t.index})}),c={},N.forEach(function(t,e){var i,n,o,a,r=t.isBar()&&!h&&s;r&&(i=s.allBarLayers.indexOf(t),n=s.layersCommonXAxis[i].indexOf(t),o=t.getAxisId("y"),l.api.getProperty(U.PROP_YAXES+"."+o+".Stacked")&&void 0!==(o=p[o])[o.indexOf(t.index)-1]&&(o=l.layers[t.index-1].getStackedXData(),a=l.layers[t.index-1].getStackedYData(),o)&&a&&(a=a[a.length-1],c=Y.getStackedData(o,a,c)),u={barIndices:s.barIndices[i],dataLength:s.dataLengths[i],index:n,stacked:c}),!r&&t.isBar()||l.processLayerData(t,u)}),i=function(t,e){return"Smart"===l.api.getProperty(t+"."+e+X.PROP_DISTRIBUTION)},v=(w=this.api.getProperty(U.PROP_XAXES)).filter(function(t,e){return i(U.PROP_XAXES,e)}),O=w.filter(function(t,e){return i(U.PROP_YAXES,e)}),v.length&&this.processSmartAxes(w,"x",N,u),O.length&&this.processSmartAxes(b,"y",N,u),b.some(function(t,e){return!0===l.api.getProperty("Yaxes."+e+".Stacked")})&&(this.layers.some(function(t){return t.isHorizontal()&&t.getAxisStacked("y")})?(v=this.createDataBounds(B,o,this.xAxisLayer,!0,!0),this.xAxisDataBounds=v):(w=this.createDataBounds(I,e,this.yAxisLayer,!1,!0),this.yAxisDataBounds=w)),N.forEach(function(t){var e,i,n,o,a,r=t.getFillType(),s=-1!==r.indexOf("Layer");t.RenderState!==G.Process||!s&&"Origin"!==r||(e=a=null,n=i=void 0,s&&(e=Number(r.replace(/.*?(\d+)$/,"$1")||1)-1,i=l.api.getProperty("Layers."+e+"."+z.PROP_INTERPOLATION),n=l.api.getProperty("Layers."+e+"."+z.PROP_STEPPED),s=l.api.getProperty("Layers."+t.index+"."+z.PROP_INTERPOLATION),o=l.api.getProperty("Layers."+t.index+"."+z.PROP_STEPPED),a=l.layers[e].getFillToLayerData({interpolation:"Linear"===s?"Linear":i,steppedLine:"Linear"===s?o:n})),s={fill:r,cols:a,toBounds:null!==e?Y.calculateCroppedJsBounds(l.activeZoom,l.getLayerDataBounds(e),l.getLayerDataType("x",e),l.getLayerDataType("y",e)):void 0,fromBounds:Y.calculateCroppedJsBounds(l.activeZoom,l.getLayerDataBounds(t.index),l.getLayerDataType("x",t.index),l.getLayerDataType("y",t.index)),interpolation:i,steppedLine:n},t.processLineFillData(l.gl,s))}),!n.filter(function(t){return t.RenderState>=G.Process}).length&&n.length||(O=this.onXZoom||this.onYZoom||this.resetZoom||this.selZoom,this.renderState=O?G.Axis:G.Legend),_.some(n,function(t){return!1===t.hasData()}))&&(this.renderState=G.Process),this.renderState===G.Legend&&(this.legend.render(!1),this.axis.onResize(),this.renderState=G.Axis);var d,a,r,y,g,f=[],m=[];if(this.renderState===G.Axis&&(this.updateLayerPossibleAxes(),d=!1,b=0,this.zoomEnabled&&(this.lastXZoom.length||this.lastYZoom.length)&&(o=Date.now()-this.zoomTime,v=this.api.getProperty(U.PROP_DURATION),b=(0,ne[this.api.getProperty(U.PROP_EASING)])(o/v),d=o<v,this.animateZoom=!!d),e=this.layers.map(function(t){var e,i,n,o,a,r;return t.isEnabled()&&t.Config?(a=t.index,n=t.getAxisId("x"),o=t.getAxisId("y"),e=l.activeXPan[n],i=l.activeYPan[o],e=new M(e.x,i.x,e.y,i.y),i=l.getDataBounds(a,d,n,o),n=t.getTriggerBounds("x")||new F(i.x,i.z),o=t.getTriggerBounds("y")||new F(i.y,i.w),i=new M(n.x,o.x,n.y,o.y),n=l.getLayerDataType("x",a),o=l.getLayerDataType("y",a),a=t.hasDataLabels()?t.getLabelSize(i,n,o):null,r=l.barGroupingInfo,t=t.getPaddedRange(i,l.size,a,r),Y.calculateCroppedJsBounds(e,t,n,o)):null}),w=this.api.getProperty("Xaxes"),O=this.createViewBounds(e,d,b,!0,w),this.xAxisViewBounds=this.updateViewBounds("x",this.onXZoom,O,d),f=O.map(function(t){return t[1]}),o=this.api.getProperty("Yaxes"),v=this.createViewBounds(e,d,b,!1,o),this.yAxisViewBounds=this.updateViewBounds("y",this.onYZoom,v,d),m=v.map(function(t){return t[1]}),this.onXZoom=!1,this.onYZoom=!1,this.selZoom=!1,a=function(e,i,t){var n=l.layers.filter(function(t){return t.getAxisId(e)===i}).map(function(t){return t.getAllCategoryData(e)[0]}),o=[],n=(n.forEach(function(t){return o=o.concat(t)}),"x"===e?o:o[0]),n=_.uniqBy(n,function(t){if(t)return t.i&&t.n?t.i&&t.n:t.i||t});t.updateCategoryData(n)},r=function(t,e,i,n){var o=l.layers.filter(function(t){return t.getAxisId(e)===i}).map(function(t){return t.getTriggerBounds(e)}).filter(function(t){return t}),o=Y.mergeRange(o)||new F(0,1),n=Y.calculateCrop(n,o),o="x"===e?l.xAxisBreakInfo:l.yAxisBreakInfo;o&&t.updateBreakIntervals(o.breakIntervals[i],o.min[i],o.max[i],n)},this.setIgnoreSettings(!0),_.values(this.axis.x).forEach(function(t,e){var i=l.getLayerDataTypes("x",e,!0),n=(l.api.getProperty("Xaxes."+e+".Type")===X.TYPE_CATEGORY&&a("x",e,t),l.xAxisViewBounds[e]||new F(0,1));t.isTriggerBreakApplied()&&r(t,"x",e,n),t.updateBounds(n,i)}),_.values(this.axis.y).forEach(function(t,e){var i=l.getLayerDataTypes("y",e,!0),n=(l.api.getProperty("Yaxes."+e+".Type")===X.TYPE_CATEGORY&&a("y",e,t),l.yAxisViewBounds[e]||new F(0,1));t.isTriggerBreakApplied()&&r(t,"y",e,n),t.updateBounds(n,i)}),this.setIgnoreSettings(!1),_.first(n.map(function(t){return t.Config}).filter(function(t){return!!t}))&&(y={},this.layers.forEach(function(t,e){var i=t.getCurrentTickVals();null!=i&&i.length&&(t=t.getAxisId("y"),y[t]||(y[t]=[]),y[t].push(i))}),w=this.axis.render(this.size.x,this.size.y,this.api.getProperty("Xaxes"),this.api.getProperty("Yaxes"),y),_.isEqual(w,this.renderedMargin)&&this.size===this.renderedSize||(O=Math.max(this.size.x-w.x-w.z,0),e=Math.max(this.size.y-w.y-w.w,0),this.overlay.resize(w.x,w.y,O,e),this.resizeLabelsCanvas(w.x,w.y,O,e),this.canvas.style.left=w.x+"px",this.canvas.style.top=w.y+"px",this.canvas.width=O,this.canvas.height=e,this.annotationsView.resize(w.x,w.y,O,e),this.renderedMargin=_.clone(w),this.renderedSize=this.size),b=f[0]||new F(0,1),this.zoomEnabled?(this.overlay.clearRangeLines(!0),this.crosshairSelected.updateSelected(b,this.animateZoom)):this.overlay.drawRangeLines()),this.renderState=G.Uniforms),this.renderState===G.Uniforms&&_.every(n.filter(function(t){return t.hasData()}),function(t){return t.RenderState>=G.Uniforms})&&(Y.isWebGLHWAcclEnabled||Y.isIE11?this.gl.clearColor(0,0,0,0):"Light"===this.theme?this.gl.clearColor(.973,.973,.973,0):this.gl.clearColor(.157,.157,.157,0),(g=this.gl).clear(g.COLOR_BUFFER_BIT),g.viewport(0,0,g.canvas.width,g.canvas.height),g.enable(g.BLEND),g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA),this.layers.forEach(function(t){return t.removeLabels()}),_.filter(n,function(t){return t&&t.RenderState===G.Uniforms}).forEach(function(t){var e,i,n,o,a;t.hasData()&&(e=0,l.api.getProperty("Layers."+t.index+"."+z.PROP_SCALE_ZOOM)&&l.zoomEnabled&&(n=l.animateZoom?f:l.lastXZoom,i=l.animateZoom?m:l.lastYZoom,n=n[l.layerXAxis[t.index]]||new F(0,1),i=i[l.layerYAxis[t.index]]||new F(0,1),e=((n=M.fromVec2(n,i)).z-n.x+(n.w-n.y))/2),i=l.api.getProperty(t.indexProp("_Type"))===V.Line,n="No Fill"!==l.api.getProperty(t.indexProp("Fill")),o=l.getLayerViewBounds(t.index),a=void 0,t.getLayerType()===V.Baseline&&(a={x:l.getLayerDataType("x",t.index),y:l.getLayerDataType("y",t.index)}),i&&n&&t.render(g,o,e,H.Fill),t.render(g,o,e,H.Default,a),i&&l.api.getProperty(t.indexProp(z.PROP_RADIUS_SCALE))&&t.render(g,o,e,H.Bubble),t.hasDataLabels())&&t.drawLabels(o,l.getLayerDataType("x",t.index),l.getLayerDataType("y",t.index),l.barGroupingInfo)}),this.annotationsView.updateZoom(this.xAxisDataBounds,this.xAxisViewBounds,this.yAxisDataBounds,this.yAxisViewBounds),this.renderState=this.panning||this.zoomEnabled&&this.animateZoom?G.Axis:G.Tooltip),this.renderState===G.Tooltip){if(this.zoomTime=0,this.resetZoom=!1,this.activeBounds=this.layers.map(function(t){return l.getLayerViewBounds(t.index)}),!this.activeBounds.length)return;var P,x,o=this.api.getProperty(U.PROP_HOVER),v=this.api.getProperty(U.PROP_SELECT),O=void 0,b=(null===this.overPoint&&(o||v)&&(P=this.settingsSelected?v:this.settingsHovered?o:"")&&(x=P,e=_.find(this.xAxisViewBounds,function(t,e){e=_.max(l.getLayerDataTypes("x",e));return x=Y.convertJSToNumber(Y.convertStringToJsScalar(P,e)),t=t.applyFn(Y.convertJSToNumber),x>=t.x&&x<=t.y}))&&(w=e.applyFn(Y.convertJSToNumber),O=new F((x-w.x)/(w.y-w.x),0)),this.api.getProperty(U.PROP_COORDS)),v=this.overlay.isDragging(),T=this.overPoint||O;if(!T||v&&!b)return this.renderState=G.Valid,void(o||(this.tooltips.hideTooltip(),this.tooltips.hideCoordinates(this.el),this.crosshairHover.hideCrosshair(""),this.hover=!1));var A=[],L=[],C=((N=n.filter(function(t){return t.hasData()})).forEach(function(n){var t=n.getLayerType(),o=t===V.Bounds,e=t===V.Heatmap;if(n.getLayerType()===V.Baseline){var t=l.getBaselineOverPoint(n),t=new At(n,0,t,"",0,"Value");A.push(t),l.api.getProperty("Overlay.ShowAllPoints")&&L.push(t)}else for(var i=o||e?2:1,a=0;a<i;a++){var r="XAxis",r=(o?r=0===a?"x1":"x2":e&&(r=0===a?"HeatmapX1":"HeatmapX2"),l.getClosestPoint(T,n,r,n.getBoundsCol(r)));r&&A.push(r)}l.api.getProperty("Overlay.ShowAllPoints")&&(t=n.getAllPointsFromRelativeX(),_.each(t,function(t){_.each(t,function(t){if(t)for(var e=o?2:1,i=0;i<e;i++)L.push(new At(n,t[0],t[1],t[2],t[3],o?0===i?"x1":"x2":"XAxis"))})}))}),null),E=null,S=null,R=T.x,D=1+T.y;if(_.each(A,function(t){var e=Number(t.overpoint.x),i=Number(t.overpoint.y);null===E?(E=Math.abs(R-e),S=Math.abs(D-i),C=t):(e=Math.abs(R-e))<E?(E=e,S=Math.abs(D-i),C=t):e===E&&S&&Math.abs(D-i)<S&&(S=Math.abs(D-i),E=e,C=t)}),C){e=C.overpoint;if(1<e.x||e.x<0||1<e.y||e.y<0||isNaN(e.x)||isNaN(e.y))return void(this.renderState=G.Valid);this.closestPoint!==C.overpoint&&(this.closestPoint=C.overpoint);var w=this.tooltips.render(this.canvas,C,L.length?L:A,A),O=this.tooltips.returnPointInfo();if(O&&w){var o=C.layer.getLayerType()===V.Bounds?z.PROP_X1_COORD:z.PROP_XAXIS,B=this.api.getProperty(C.layer.indexProp(o)),I=C.yAxis,n=w[B],N=w[I];if(b&&(C.layer.getLayerType()===V.Baseline&&("x"===(null==(e=C.layer.getBaselineInfo())?void 0:e.axis)?(n=e.jsVal,N=this.getLayerViewBounds(C.layer.index).w):(N=e.jsVal,n=this.getLayerViewBounds(C.layer.index).z)),this.drawCoordinates(C,v,n,N)),v)return this.crosshairHover.hideCrosshair(""),this.tooltips.hideTooltip(),void(this.renderState=G.Valid);this.hover||!this.click&&!this.settingsSelected?(this.doActions(C.layer,O,"mousemove"),o=!this.api.getProperty(U.PROP_SNAP)&&this.overPoint?new F(this.overPoint.x,1+this.overPoint.y):C.overpoint,this.crosshairHover.render(this.renderedMargin,o,"hover",this.dashboardViewModel.get(U.APP_THEME)),this.overPoint&&this.api.getPropertyMeta(U.PROP_HOVER).viewstateType&&(k.Tools.isKDBTemporal(n)&&(n=k.Tools.convertKDBTemporalToMoment(n).toDashString()),this.api.setProperty(U.PROP_HOVER,n))):(this.doActions(C.layer,O,"click"),this.zoomEnabled&&this.crosshairSelected.render(this.renderedMargin,C.overpoint,"click",this.dashboardViewModel.get(U.APP_THEME)),this.click&&this.api.getPropertyMeta(U.PROP_SELECT).viewstateType&&(k.Tools.isKDBTemporal(n)&&(n=k.Tools.convertKDBTemporalToMoment(n).toDashString()),this.api.setProperty(U.PROP_SELECT,n)))}}else this.tooltips.hideTooltip();this.hover=!1,this.click=!1,this.settingsHovered=!1,this.settingsSelected=!1,this.renderState=G.Valid}this.renderState<G.Valid&&window.requestAnimationFrame(this.validate.bind(this))}else this.api.showErrorMessage({error:t("To get started, please add a layer from")+" <b> "+t("Properties-Layers")+" </b> ",type:"Warning"}),this.legend.render()},U.getComponentDefinition=I.getComponentDefinition,U.PROP_COORDS="Overlay.ShowCoordinates",U.PROP_CROSSHAIRS="Overlay.ShowCrosshairs",U.PROP_DURATION="Basics.Duration",U.PROP_HOVER="Basics.Hover",U.PROP_SELECT="Basics.Selected",U.PROP_EASING="Basics.Easing",U.PROP_LAYERS="Layers",U.PROP_LAYER_ID="_Id",U.PROP_LAYER_NAME="Name",U.PROP_LEGEND_GROUPS="Legend.LegendGroups",U.PROP_POSSIBLELEGENDGROUPS="possibleLegendGroups",U.PROP_LEGEND_POS="Legend.Position",U.PROP_POSSIBLEPOSITIONS="possiblePositions",U.PROP_SNAP="Overlay.SnapToPoint",U.APP_THEME="DashboardTheme",U.PROP_XAXES="Xaxes",U.PROP_YAXES="Yaxes",U.PROP_EXPORT="FileExport",U.PROP_ANNOTATE_CONTROL="Annotations.ShowAnnotateControl",U.PROP_ANNOTATIONS="Annotations.Annotations",U.PROP_ZOOM="Basics.Zoom",U.REST_MS=500,U});