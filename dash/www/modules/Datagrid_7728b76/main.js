define(["backbone","Handlebars","moment","QuickBase","Forms","Pager","select2","BasicComponents","DataFilter","xlsx","css!./css/app.css"],function(w,N,L,p,P,A,B,H,G,U){var W,K=this&&this.__extends||(W=function(e,t){return(W=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}W(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),z=(j.ColumnConfigDialog=N.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var a=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,r=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="pnlSource">\n    <span>'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Available Columns",{name:"t",hash:{},data:n,loc:{start:{line:2,column:10},end:{line:2,column:35}}}))+'</span>\n    <div class="pnlGrid"></div>\n</div>\n\n<div class="pnlTarget">\n    <span>'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Visible Columns",{name:"t",hash:{},data:n,loc:{start:{line:7,column:10},end:{line:7,column:33}}}))+'</span>\n    <div class="pnlGrid"></div>\n</div>\n\n<div class="pnlActionButtons">\n    <button class="btnMoveToSource">move to source</button><br><br>\n    <button class="btnMoveToTarget">move to target</button><br><br><br>\n    <button class="btnMoveUp">move up</button><br><br>\n    <button class="btnMoveDown">move down</button><br>\n</div>\n\n<label class="lblRetainColumnWidths">\n    <input type="checkbox" class="chkRetainColumnWidths" checked="checked"/>\n    Retain relative column widths on reload\n</label>'},useData:!0}),j.DateFilter=N.template({1:function(e,t,i,o,n){var a=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <option value="'+a("function"==typeof(i=null!=(i=s(i,"key")||n&&s(n,"key"))?i:e.hooks.helperMissing)?i.call(null!=t?t:e.nullContext||{},{name:"key",hash:{},data:n,loc:{start:{line:6,column:23},end:{line:6,column:31}}}):i)+'">'+a(e.lambda(t,t))+"</option>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="dp1"></div>\n<div class="dp2"></div>\n\n<select class="cmbOperator">\n'+(null!=(i=a(i,"each").call(null!=t?t:e.nullContext||{},null!=t?a(t,"operators"):t,{name:"each",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n,loc:{start:{line:5,column:4},end:{line:7,column:13}}}))?i:"")+"</select>\n\n\n"},useData:!0}),j.app=N.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var a=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,r=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="Datagrid">\n\t<div class="title">\n    </div>\n\n    <div class="datagridFrame">\n\n        \n        <div class="pnlGroupedColumns">\n        </div>\n        <span class="lblDragDropHint" style="display:none">'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Drag a column header and drop it here for grouping",{name:"t",hash:{},data:n,loc:{start:{line:10,column:59},end:{line:10,column:117}}}))+'</span>\n\n        <div class="pnlGrid"></div>\n        <div class="pnlSummaryRow"></div>\n\n        <div class="pnlPager"></div>\n        <input class="txtGlobalFilter" type="text">\n\n        <div class="pnlButtons" style="position:absolute; top:0; right: 0; z-index: 8;">\n            <div class="instantButtons" style="display:none;">\n                <button class="submitInstant"><i class="fa fa-fw fa-upload"></i>Apply Changes</button>\n                <button class="cancelInstant"><i class="fa fa-fw fa-ban"></i>Cancel Editing</button>\n            </div>\n\t\t\t<a class="lnkSubmitChanges" style="display: none;"><i class="fa fa-fw fa-upload"></i>'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Submit Changes",{name:"t",hash:{},data:n,loc:{start:{line:23,column:88},end:{line:23,column:110}}}))+'</a>\n\t\t\t<a class="lnkToggleEditable" style="display:none;"><i class="fa fa-fw fa-edit"></i>'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Edit",{name:"t",hash:{},data:n,loc:{start:{line:24,column:86},end:{line:24,column:98}}}))+'</a>\n            <a class="lnkToggleFilters"><i class="fa fa-fw fa-filter"></i><span>'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Hide Filters",{name:"t",hash:{},data:n,loc:{start:{line:25,column:80},end:{line:25,column:100}}}))+'</span></a>\n            <a class="lnkResetFilters"><i class="fa fa-fw fa-times"></i>'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Reset Filters",{name:"t",hash:{},data:n,loc:{start:{line:26,column:72},end:{line:26,column:93}}}))+'</a>\n            <span class="lnksExport link-disabled">\n                <i class="fa fa-fw fa-download" title="'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Download",{name:"t",hash:{},data:n,loc:{start:{line:28,column:55},end:{line:28,column:71}}}))+'"></i>\n                <a class="lnkExcelExport" title="'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Download the current dataset in Excel format",{name:"t",hash:{},data:n,loc:{start:{line:29,column:49},end:{line:29,column:101}}}))+'">'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Excel",{name:"t",hash:{},data:n,loc:{start:{line:29,column:103},end:{line:29,column:116}}}))+'</a>\n                <a class="lnkCsvExport" title="'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Download the current dataset in CSV format",{name:"t",hash:{},data:n,loc:{start:{line:30,column:47},end:{line:30,column:97}}}))+'">'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"CSV",{name:"t",hash:{},data:n,loc:{start:{line:30,column:99},end:{line:30,column:110}}}))+'</a>\n                <a class="lnkFullExport" title="'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Download the full dataset from the server",{name:"t",hash:{},data:n,loc:{start:{line:31,column:48},end:{line:31,column:97}}}))+'">'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Full",{name:"t",hash:{},data:n,loc:{start:{line:31,column:99},end:{line:31,column:111}}}))+'</a>\n            </span>\n            <a class="lnkConfiguration" style="display:none"><i class="fa fa-fw fa-wrench"></i>'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Configuration",{name:"t",hash:{},data:n,loc:{start:{line:33,column:95},end:{line:33,column:116}}}))+'</a>\n            <button class="btnShowHugeData">&infin;</button>\n        </div>\n\n        <div class="pnlProgressBar">\n            <div class="divProgressBar"></div>\n            <div class="lblProgressBar">'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"Please wait, generating huge dataset",{name:"t",hash:{},data:n,loc:{start:{line:39,column:40},end:{line:39,column:84}}}))+'</div>\n        </div>\n\n        <div style="position:absolute; bottom:60px; left: 0; z-index: 8; display: none; ">\n            <button class="btnTest1">'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"group by",{name:"t",hash:{},data:n,loc:{start:{line:43,column:37},end:{line:43,column:53}}}))+'</button>\n            <button class="btnTest2">'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"remove grouping",{name:"t",hash:{},data:n,loc:{start:{line:44,column:37},end:{line:44,column:60}}}))+'</button>\n            <button class="btnTest3">'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"expand groups",{name:"t",hash:{},data:n,loc:{start:{line:45,column:37},end:{line:45,column:58}}}))+'</button>\n            <button class="btnTest4">'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"collapse groups",{name:"t",hash:{},data:n,loc:{start:{line:46,column:37},end:{line:46,column:60}}}))+'</button>\n            <button class="btnTest5">'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"b1",{name:"t",hash:{},data:n,loc:{start:{line:47,column:37},end:{line:47,column:47}}}))+'</button>\n            <button class="btnTest6">'+r((e(i,"t")||t&&e(t,"t")||s).call(a,"b2",{name:"t",hash:{},data:n,loc:{start:{line:48,column:37},end:{line:48,column:47}}}))+'</button>\n        </div>\n\n    </div>\n\t\n\t<div class="updateStatusFeedback">\n\t\t<i class="successIcon fa fa-fw fa-check"></i>\n\t\t<i class="errorIcon fa fa-fw fa-exclamation-circle"></i>\n\t\t<span class="feedbackText"></span>\n\t</div>\n</div>'},useData:!0}),j);function j(){}Q=w.DeepModel,K(e,Q),e.prototype.isLazyDataLoadingOn=function(){return _.includes(["cached","uncached"],this.get(e.KEY_LAZY_DATA_LOADING))},e.prototype.getDeltaPagingType=function(){return{cached:"OFFSET",uncached:"OFFSET_NOCACHE"}[this.get(e.KEY_LAZY_DATA_LOADING)]},e.KEY_LAZY_DATA_LOADING="Basics.LazyDataLoading";var Q,Y=e;function e(e){return Q.call(this,e)||this}J="^(#([\\da-fA-F]{3}){1,2}|rgba\\(\\s*(0|[1-9]\\d?|1\\d\\d?|2[0-4]\\d|25[0-5])%?\\s*,\\s*(0|[1-9]\\d?|1\\d\\d?|2[0-4]\\d|25[0-5])%?\\s*,\\s*(0|[1-9]\\d?|1\\d\\d?|2[0-4]\\d|25[0-5])%?\\s*,\\s*((0.[1-9])|[01])\\s*\\))$";var X,J,Z={JSON_STRING:'{\n    "type": "line"\n}',JSON_SCHEMA:function(){var e,t,i,o,n,a,s,r;return X||(r={BOOLEAN:{type:"boolean"},INTEGER:{type:"integer"},NUMBER:{type:"number",minimum:0},NUMBER_NULL:{oneOf:[{type:"number"},{type:"null"}]},NUMBER_AUTO:{oneOf:[{type:"number"},{type:"string",enum:["auto"]}]},CSS_NUMBER_AUTO:{oneOf:[{type:"number"},{type:"string",pattern:"^(auto|\\d+px|\\d+%)$"}]},STRING:{type:"string"},COLOR:{pattern:J,type:"string"},COLOR_NULL:{oneOf:[{pattern:J,type:"string"},{type:"null"}]}},e={lineColor:_.defaults({default:"#00f"},r.COLOR),fillColor:_.defaults({default:"#cdf"},r.COLOR),defaultPixelsPerValue:_.defaults({default:3},r.NUMBER),width:_.defaults({default:"auto"},r.CSS_NUMBER_AUTO),height:_.defaults({default:"auto"},r.CSS_NUMBER_AUTO),composite:_.defaults({default:!1},r.BOOLEAN),tagValuesAttribute:_.defaults({default:"values"},r.STRING),tagOptionsPrefix:_.defaults({default:"spark"},r.STRING),enableTagOptions:_.defaults({default:!1},r.BOOLEAN),disableHighlight:_.defaults({default:!1},r.BOOLEAN),highlightLighten:_.defaults({default:1.4},r.NUMBER),tooltipClassname:_.defaults({default:"jqstooltip"},r.STRING),tooltipOffsetX:_.defaults({default:10},r.NUMBER),tooltipOffsetY:_.defaults({default:12},r.NUMBER),tooltipChartTitle:_.defaults({default:""},r.STRING),tooltipSkipNull:_.defaults({default:!0},r.BOOLEAN),tooltipPrefix:_.defaults({default:""},r.STRING),tooltipSuffix:_.defaults({default:""},r.STRING),disableHiddenCheck:_.defaults({default:!1},r.BOOLEAN),numberFormatter:_.defaults({default:!1},r.BOOLEAN),numberDigitGroupCount:_.defaults({default:3},r.INTEGER),numberDigitGroupSep:_.defaults({default:","},r.STRING),numberDecimalMark:_.defaults({default:"."},r.STRING),disableTooltips:_.defaults({default:!1},r.BOOLEAN),disableInteraction:_.defaults({default:!1},r.BOOLEAN),className:_.defaults({default:""},r.STRING)},t={type:_.defaults({default:"line",enum:["line"]},r.STRING),spotColor:_.defaults({default:"#f80"},r.COLOR),highlightSpotColor:_.defaults({default:"#5f5"},r.COLOR),highlightLineColor:_.defaults({default:"#f22"},r.COLOR),spotRadius:_.defaults({default:1.5},r.NUMBER),minSpotColor:_.defaults({default:"#f80"},r.COLOR),maxSpotColor:_.defaults({default:"#f80"},r.COLOR),lineWidth:_.defaults({default:1},r.NUMBER),normalRangeMin:_.defaults({default:null},r.NUMBER_NULL),normalRangeMax:_.defaults({default:null},r.NUMBER_NULL),normalRangeColor:_.defaults({default:"#ccc"},r.COLOR),drawNormalOnTop:_.defaults({default:!1},r.BOOLEAN),chartRangeMin:_.defaults({default:null},r.NUMBER_NULL),chartRangeMax:_.defaults({default:null},r.NUMBER_NULL),chartRangeMinX:_.defaults({default:null},r.NUMBER_NULL),chartRangeMaxX:_.defaults({default:null},r.NUMBER_NULL),tooltipFormat:_.defaults({default:"<span style='color: {{color}}'>&#9679;</span> {{prefix}}{{y}}{{suffix}}"},r.STRING),valueSpots:{oneOf:[{type:"array",default:[],items:r.COLOR},{type:"object",default:{}}]}},i={type:_.defaults({default:"bar",enum:["bar"]},r.STRING),barColor:_.defaults({default:"#3366cc"},r.COLOR),negBarColor:_.defaults({default:"#f44"},r.COLOR),stackedBarColor:{type:"array",default:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],items:r.COLOR},zeroColor:_.defaults({default:null},r.COLOR_NULL),nullColor:_.defaults({default:null},r.COLOR_NULL),zeroAxis:_.defaults({default:!0},r.BOOLEAN),barWidth:_.defaults({default:4},r.NUMBER),barSpacing:_.defaults({default:1},r.NUMBER),chartRangeMax:_.defaults({default:null},r.NUMBER_NULL),chartRangeMin:_.defaults({default:null},r.NUMBER_NULL),chartRangeClip:_.defaults({default:!1},r.BOOLEAN),colorMap:{oneOf:[{type:"array",default:[],items:r.COLOR},{type:"object",default:{}}]},tooltipFormat:_.defaults({default:"<span style='color: {{color}}'>&#9679;</span> {{prefix}}{{value}}{{suffix}}"},r.STRING)},o={type:_.defaults({default:"pie",enum:["pie"]},r.STRING),offset:_.defaults({default:0},r.NUMBER),sliceColors:{type:"array",default:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],items:r.COLOR},borderWidth:_.defaults({default:0},r.NUMBER),borderColor:_.defaults({default:"#000"},r.COLOR),tooltipFormat:_.defaults({default:"<span style='color: {{color}}'>&#9679;</span> {{value}} ({{percent.1}}%)"},r.STRING)},n={type:_.defaults({default:"tristate",enum:["tristate"]},r.STRING),barWidth:_.defaults({default:4},r.NUMBER),barSpacing:_.defaults({default:1},r.NUMBER),posBarColor:_.defaults({default:"#6f6"},r.COLOR),negBarColor:_.defaults({default:"#f44"},r.COLOR),zeroBarColor:_.defaults({default:"#999"},r.COLOR),colorMap:{oneOf:[{type:"array",default:[],items:r.COLOR},{type:"object",default:{}}]},tooltipFormat:_.defaults({default:"<span style='color: {{color}}'>&#9679;</span> {{value:map}}"},r.STRING),tooltipValueLookups:{type:"object",default:{map:{"-1":"Loss",0:"Draw",1:"Win"}}}},a={type:_.defaults({default:"discrete",enum:["discrete"]},r.STRING),lineHeight:_.defaults({default:"auto"},r.NUMBER_AUTO),thresholdColor:_.defaults({default:null},r.COLOR_NULL),thresholdValue:_.defaults({default:0},r.NUMBER),chartRangeMax:_.defaults({default:null},r.NUMBER_NULL),chartRangeMin:_.defaults({default:null},r.NUMBER_NULL),chartRangeClip:_.defaults({default:!1},r.BOOLEAN),tooltipFormat:_.defaults({default:"{{prefix}}{{value}}{{suffix}}"},r.STRING)},s={type:_.defaults({default:"bullet",enum:["bullet"]},r.STRING),targetColor:_.defaults({default:"#f33"},r.COLOR),targetWidth:_.defaults({default:3},r.NUMBER),performanceColor:_.defaults({default:"#f33"},r.COLOR),rangeColors:{type:"array",default:["#d3dafe","#a8b6ff","#7f94ff"],items:r.COLOR},base:_.defaults({default:null},r.NUMBER_NULL),tooltipFormat:_.defaults({default:"{{fieldkey:fields}} - {{value}}"},r.STRING),tooltipValueLookups:{type:"object",default:{fields:{r:"Range",p:"Performance",t:"Target"}}}},r={type:_.defaults({default:"box",enum:["box"]},r.STRING),raw:_.defaults({default:!1},r.BOOLEAN),boxLineColor:_.defaults({default:"#000"},r.COLOR),boxFillColor:_.defaults({default:"#cdf"},r.COLOR),whiskerColor:_.defaults({default:"#000"},r.COLOR),outlierLineColor:_.defaults({default:"#333"},r.COLOR),outlierFillColor:_.defaults({default:"#fff"},r.COLOR),medianColor:_.defaults({default:"#f00"},r.COLOR),showOutliers:_.defaults({default:!0},r.BOOLEAN),outlierIQR:_.defaults({default:1.5},r.NUMBER),spotRadius:_.defaults({default:1.5},r.NUMBER),target:_.defaults({default:null},r.NUMBER_NULL),targetColor:_.defaults({default:"#4a2"},r.COLOR),chartRangeMin:_.defaults({default:null},r.NUMBER_NULL),chartRangeMax:_.defaults({default:null},r.NUMBER_NULL),tooltipFormat:_.defaults({default:"{{field:fields}}: {{value}}"},r.STRING),tooltipFormatFieldlistKey:_.defaults({default:"field"},r.STRING),tooltipValueLookups:{type:"object",default:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}},(X={required:["type"],oneOf:[{type:"object",additionalProperties:!1,properties:_.extend({},e,t)},{type:"object",additionalProperties:!1,properties:_.extend({},e,i)},{type:"object",additionalProperties:!1,properties:_.extend({},e,o)},{type:"object",additionalProperties:!1,properties:_.extend({},e,n)},{type:"object",additionalProperties:!1,properties:_.extend({},e,a)},{type:"object",additionalProperties:!1,properties:_.extend({},e,s)},{type:"object",additionalProperties:!1,properties:_.extend({},e,r)}]}).oneOf.push({type:"array",default:[],items:X})),X}},b=p.Tools,a={UserDefined:{type:"boolean",title:"User Defined",format:"checkbox",default:!1},Field:{title:"Data Field Name",type:"customDropdown",default:"",data:"possible_columns",watch:{possible_columns:"root.datagridPossibleColumns"}},DisplayName:{title:"Display Name",type:"string",default:""},Tooltip:{title:"Header Tooltip",type:"string",default:""},Sortable:{type:"boolean",format:"checkbox",default:!0},Format:{type:"string",enum:["General","Number","Formatted Number","Smart Number","Date","Time","DateTime","Percentage","Boolean","Sparkline"],default:"General"},Precision:{type:"number",title:"Precision",format:"number",minimum:0,maximum:10,default:2},HideTrailingZeroes:{type:"boolean",title:"Hide Trailing Zeroes",format:"checkbox",default:!1},Currency:{title:"Currency Symbol",type:"string",enum:["none","USD","GBP","EUR"],default:"none"},DateFormat:{title:"Date Format",type:"string",enum:b.Formats.Date,default:"YYYY-MM-DD"},TimeFormat:{title:"Time Format",type:"string",enum:b.Formats.Time,default:"HH:mm:ss"},HighlightNegativeColor:{options:{noColor:!0},type:"gradient",title:"Negative Color",default:""},HighlightChanges:{type:"boolean",title:"Highlight Changes",format:"checkbox",default:!1},HighlightChangeDuration:{title:"Highlight Change Duration",minimum:50,maximum:1e3,type:"number",step:10,format:"range",default:200},ShowArrowsOnChange:{type:"boolean",title:"Show arrows on Change",format:"checkbox",default:!1},HighlightMinValueColor:{options:{noColor:!0},type:"gradient",title:"Min Value Color",default:""},HighlightMaxValueColor:{options:{noColor:!0},type:"gradient",title:"Max Value Color",default:""},RangeHighlightColor:{options:{noColor:!0},type:"gradient",title:"Range Color",default:""},IsRangeHighlightColorInverted:{type:"boolean",title:"Invert Range Color",format:"checkbox",default:!1},WidthWeight:{title:"Width (relative)",minimum:0,type:"number",default:1},MinWidthAbsolute:{title:"Min Width (px)",minimum:0,type:"number",default:1},PercentageColorOverride:{options:{noColor:!0},type:"gradient",default:"",title:"Percentage Color"},IsReadonly:{type:"boolean",title:"Read Only",format:"checkbox",default:!1},IsSelectable:{type:"boolean",title:"Selectable",format:"checkbox",default:!0},TextAlign:{title:"Text Align",type:"string",enum:["left","center","right"],default:"center"},Template:{type:"handlebar",data:[],default:"",columnsFieldName:"datagridPossibleColumns",templateItems:{values:{type:"object",items:_.keyBy(["thisField","thisValue","thisRawValue"])}}},SparklineOptions:{type:"json",title:"Sparkline Options",options:{jsonSchema:Z.JSON_SCHEMA},default:Z.JSON_STRING},Hidden:{type:"boolean",format:"checkbox",default:!1},Footer:{type:"string",enum:["None","Average","Count","Sum","WeightedAverage"],default:"None",options:{enum_titles:["None","Average","Count","Sum","Weighted Average"]}},FooterWeights:{title:"Footer Weights",type:"string",enumSource:"possible_columns",watch:{possible_columns:"root.datagridPossibleColumns"},options:{hidden:!1},default:""},Header:{title:"Header",type:"string",enumSource:"possible_columns",watch:{possible_columns:"root.datagridPossibleHeaderColumns"},default:"none"}},n={},ee=(_.each(["UserDefined","Field","DisplayName","Tooltip","WidthWeight","MinWidthAbsolute","TextAlign","Sortable","Format","Precision","HideTrailingZeroes","Currency","DateFormat","TimeFormat","HighlightNegativeColor","HighlightChanges","HighlightChangeDuration","ShowArrowsOnChange","HighlightMinValueColor","HighlightMaxValueColor","RangeHighlightColor","IsRangeHighlightColorInverted","PercentageColorOverride","IsReadonly","IsSelectable","Template","SparklineOptions","Hidden","Footer","FooterWeights","Header"],function(e,t){a[e].propertyOrder=1010+t,n[e]=a[e].default}),{Name:{title:"Name",type:"string",default:""},Enabled:{type:"boolean",format:"checkbox",default:!0,options:{hidden:!0}},Target:{type:"customDropdown",data:"possible_columns",watch:{possible_columns:"root.highlightTargetPossibleValues"},default:"*"},ConditionSource:{title:"Condition Source",type:"string",enumSource:"possible_columns",watch:{possible_columns:"root.datagridPossibleColumnsWithItself"},default:"<this>"},ConditionOperator:{title:"Condition Operator",type:"string",enum:["","search","contains","starts with","ends with","==","<",">","<=",">=","!=","Fill Left-to-Right","Fill Right-to-Left"],default:""},ConditionValue:{title:"Condition Value",type:"string",default:"previous value"},Color:{type:"gradient",options:{noColor:!0},default:""},BackgroundColor:{title:"Background Color",type:"gradient",options:{noColor:!0,gradient:!0},default:""},BorderColor:{title:"Border Color",type:"gradient",options:{noColor:!0},default:""},Icon:{type:"icon",title:"Icon",default:""},IconColor:{title:"Icon Color",type:"gradient",options:{noColor:!0},default:""},RuleType:{type:"string",title:"Rule Type",enum:["gradient","discrete"],default:"discrete",options:{hidden:!0}},RuleMin:{type:"number",title:"Rule Min",format:"number",default:0},RuleMax:{type:"number",title:"Rule Max",format:"number",default:1},RuleLimitEnabled:{type:"boolean",title:"Rule Limit",format:"checkbox",default:!1},TargetElement:{type:"string",title:"Apply Palette To",enum:["background","text","border","icon"],default:"background"},Palette:{type:"array",format:"table",title:"Color Palette",options:{collapsed:!1},uniqueItems:!1,items:{type:"object",title:"Palette Color",properties:{color:{type:"gradient",options:{gradient:!1},title:"color",default:"#ffa500"}}},default:[{color:"#b71c1c"},{color:"#F57F17"},{color:"#33691E"}]}}),te={},ie=(_.each(["RuleType","Name","Enabled","Target","ConditionSource","ConditionOperator","ConditionValue","Color","BackgroundColor","BorderColor","RuleMin","RuleMax","RuleLimitEnabled","TargetElement","Icon","IconColor","Palette"],function(e,t){ee[e].propertyOrder=1010+t,te[e]=ee[e].default}),{type:"object",title:"Highlight Rule",headerTemplate:"Rule {{ i1 }} {{self.Name}}",oneOf:[{title:"Discrete",options:{linked_oneof_property:{property:"RuleType",value:"discrete"}},properties:_.mapValues(ee,function(e,t){e=_.cloneDeep(e);return _.set(e,"options.hidden",["Name","Target","ConditionSource","ConditionOperator","ConditionValue","Color","BackgroundColor","BorderColor","Icon","IconColor"].indexOf(t)<0),e})},{title:"Gradient",options:{additionalProperties:!1,linked_oneof_property:{property:"RuleType",value:"gradient"}},properties:_.mapValues(ee,function(e,t){e=_.cloneDeep(e);return _.set(e,"options.hidden",["Name","Target","ConditionSource","Icon","RuleMin","RuleMax","RuleLimitEnabled","TargetElement","Palette"].indexOf(t)<0),e})}]}),oe={type:"array",title:"Custom Filters",options:{collapsed:!0},items:{type:"object",title:"Filter",uniqueItems:!0,properties:{Name:{type:"customDropdown",default:"",data:"possible_columns",watch:{possible_columns:"root.datagridPossibleColumns"}},Type:{type:"string",default:"Disabled",enum:["Selection","Server Selection","Number","DateTime","Disabled"]},Data:{type:"data",title:"Data Source",default:""}},_transform:function(e,t,i,o){"Type"===i?(_.set(t,"properties.Data.options.hidden","Server Selection"!==e.Type),o(e,t)):o()}}},l=(o.getRegex=function(e){var t,i=/\/[gimsuy]*$/,e=e.Field,o=!1;if(0===e.indexOf("/")){var o=!0,n=e.substring(1).replace(i,""),i=e.match(i),i=i?i[0].substring(1):"";try{t=new RegExp(n,i)}catch(e){p.Log.Error("Datagrid: invalid regex.",e),t=new RegExp("^$")}}else t=new RegExp("^"+e.replace(/\*/g,"(.*)")+"$","i");return{isExact:o,regex:t}},o.isDynamic=function(e){e=e.Field||"";return 0===e.indexOf("/")||0<=e.indexOf("*")},o.isFieldMatched=function(e,t){var i="*"===e||e===t;return i=!i&&o.isDynamic({Field:e})?o.getRegex({Field:e}).regex.test(t):i},o);function o(){}var r={SAMPLE_DATA:"Samples/Sample Grid Data Query",getComponentDefinition:function(e){var t,i,o,n;if(e=e||{websiteUrl:"",settingsModel:new w.Model,dataModel:{getByPath:$.noop}},i={id:21,componentName:"data grid",componentDescription:"See results from your data queries.",appKey:"Datagrid",listViewThumb:e.websiteUrl+"Images/data-table.png",ghostViewThumb:null,buildViewThumb:null,appArgs:{quickStart:[{path:"Basics.Data",message:"populate Data Source"}],json:{version:"4.7.5",notificationEvent:null,datagridPossibleColumns:[],datagridPossibleHeaderColumns:[],datagridPossibleColumnsWithItself:["<this>"],selectedColumnPossibleValues:[""],highlightTargetPossibleValues:[],sortingPossibleValues:[""],Basics:{Data:"",Filtering:"Quick Search",IsFilterVisible:!0,ShowPagingControl:!0,EnableGrouping:!0,GroupingAutoCollapse:!(t={TriggerColumn:{title:"Trigger Column",type:"string",enumSource:"possible_columns",watch:{possible_columns:"root.highlightTargetPossibleValues"},default:"",propertyOrder:1},Trigger:{type:"string",enum:["Click","Double Click","Mouse In","Mouse Out","Right Click"],default:"Click",title:"Trigger Action",propertyOrder:2}}),EnableCustomLayoutConfiguration:!1,ShowSampleGridData:!1,KeepNonExistentColumns:!1,EditMode:"disabled",IsInsertable:!1,SortColumn:"",SortOrder:"ascending",KdbFilterString:"",FilterOnEnterHit:!1,ScrollValueV:0,ExperimentalMode:!1,LazyDataLoading:"disabled",ExpandOnPdf:!1},ColumnsConfiguration:[],Selection:{Mode:"Area",RowSelectionColumn:"",SelectedValue:"",SelectedCellValue:"",SelectedField:"",FollowSelectedValue:!1,DefaultFallbackOnDeselect:!0,CheckboxAlignment:"none",SelectOnCheckOnly:!1,Actions:[]},FileExport:{ShowExportCsvButton:!0,ShowExportExcelButton:!0,ShowFullExportButton:!1,FileName:[],Actions:[],CsvExportDelimiter:"",RawFormat:!1},Tooltip:{Position:"none",Template:ne,UseFormattedCellValue:!1},GroupingConfiguration:[],SummaryRow_Groupings:[],HighlightRules:[],CustomFilters:[],HeaderGroup:[],CustomLayout:{IgnoreCustomLayoutViewstate:!1,IncludeHiddenColumns:!0},Style:{Theme:"Dark",EvenRowBackgroundColorOverride:"#282828",OddRowBackgroundColorOverride:"#303030",SelectedRowBackgroundColor:"",RowHeight:30,HeaderRowHeight:30,HeaderTextTransformation:"none",HeaderFontWeight:"",FontFamily:"",FontSize:"",advanced:""}},schema:{type:"object",title:"Properties",_transform:function(t,e,i,o){var n,a;"Basics.Data"===i?(n=t.Basics.Data)?"disabled"!==t.Basics.LazyDataLoading?(a=_.uniqueId("getMeta_"),n.subscribe(a,{onData:function(e){t.datagridPossibleColumnsWithItself=_.concat("<this>",t.datagridPossibleColumns=e.columns.collection.map("id")),n.unsubscribe(a),o(t)}})):n.getMeta(function(e){t.datagridPossibleColumnsWithItself=_.concat("<this>",t.datagridPossibleColumns=e.columns.collection.map("id")),o(t)}):(t.datagridPossibleColumns=[],t.datagridPossibleColumnsWithItself=["<this>"],o(t)):"Selection.CheckboxAlignment"===i?(_.set(e,"properties.Selection.properties.SelectOnCheckOnly.options.hidden","none"===_.get(t,i)),o(t,e)):o()},properties:{notificationEvent:{type:"array",items:{type:"string"},default:null,options:{collapsed:!0,hidden:!0}},datagridPossibleColumns:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},datagridPossibleHeaderColumns:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},datagridPossibleColumnsWithItself:{type:"readOnlyArray",items:{type:"string"},default:["<this>"],options:{collapsed:!0,hidden:!0}},selectedColumnPossibleValues:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},highlightTargetPossibleValues:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},sortingPossibleValues:{type:"readOnlyArray",items:{type:"string"},default:[""],options:{collapsed:!0,hidden:!0}},Basics:{type:"object",title:"Basics",options:{collapsed:!1},properties:{Data:{propertyOrder:1010,type:"data",title:"Data Source",default:"",format:"data"},Filtering:{propertyOrder:1020,type:"string",title:"Filtering",default:"Quick Search",enum:["Quick Search","Column Filters","Advanced Column Filters","disabled"]},IsFilterVisible:{propertyOrder:1021,type:"boolean",title:"Filter Visible",default:!0,format:"checkbox"},ShowPagingControl:{propertyOrder:1030,type:"boolean",title:"Show Paging Control",default:!0,format:"checkbox"},EnableGrouping:{propertyOrder:1040,type:"boolean",title:"Enable Grouping",default:!0,format:"checkbox"},GroupingAutoCollapse:{propertyOrder:1050,type:"boolean",title:"Auto Collapse Grouping",default:!1,format:"checkbox"},ShowSampleGridData:{propertyOrder:1070,type:"boolean",title:"Show Sample Grid Data",default:!1,format:"checkbox",options:{hidden:!0}},KeepNonExistentColumns:{propertyOrder:1071,type:"boolean",title:"Keep NonExistent Columns",default:!1,format:"checkbox"},EnableCustomLayoutConfiguration:{propertyOrder:1075,type:"boolean",title:"Custom Layout",default:!1,format:"checkbox"},EditMode:{propertyOrder:1095,type:"string",title:"Edit Mode",default:"disabled",enum:["enabled","disabled","instant"]},IsInsertable:{propertyOrder:1096,type:"boolean",title:"Enable Insert/Delete",default:!1,format:"checkbox"},SortColumn:{propertyOrder:1099,type:"string",title:"Sort Column",default:"",enumSource:"sorting_possible_values",watch:{sorting_possible_values:"root.sortingPossibleValues"}},SortOrder:{propertyOrder:1100,type:"string",title:"Sort Order",default:"ascending",enum:["ascending","descending"]},KdbFilterString:{propertyOrder:1110,type:"string",title:"KDB Filter String",default:""},FilterOnEnterHit:{propertyOrder:1120,type:"boolean",title:"Filter On Enter",default:!1,format:"checkbox"},ScrollValueV:{propertyOrder:1140,type:"number",title:"Scroll Row",default:0},ExperimentalMode:{propertyOrder:1200,type:"boolean",title:"Experimental Mode",default:!1,format:"checkbox"},LazyDataLoading:{propertyOrder:1210,type:"string",title:"Virtual Scroll",default:"disabled",enum:["cached","uncached","disabled"]},ExpandOnPdf:{propertyOrder:1220,type:"boolean",title:"Expand When Creating Pdf",default:!1,format:"checkbox"}}},ColumnsConfiguration:{type:"array",format:"object",title:"Columns",options:{collapsed:!0,bulkEditor:!0},items:{type:"object",title:"Column",headerTemplate:"Column {{ i1 }}   {{#if self.DisplayName}}{{ self.DisplayName }}{{else}}{{ self.Field }}{{/if}}",options:{collapsed:!0},properties:a,watch:{DisplayName:"DisplayName",Field:"Field"},_transform:function(e,t,i,o){var n;"Field"===i?(n=e.Field,e.DisplayName=_.isString(n)&&0!==n.indexOf("/")?n:"",o(e)):"Footer"===i?(_.set(t,"properties.FooterWeights.options.hidden","WeightedAverage"!==e.Footer),o(e,t)):o()}}},HeaderGroup:{type:"array",format:"table",title:"Header Groups",options:{collapsed:!0},items:{type:"object",title:"Group",properties:{ColumnProperty:{title:"Header",type:"string"}}}},Selection:{type:"object",title:"Selection & Routing",options:{collapsed:!0},properties:{Mode:{type:"string",title:"Selection Mode",default:"Area",enum:["Single Row","Multi Row","Area","Cell","None"]},RowSelectionColumn:{title:"Row ID Column",type:"string",enumSource:"possible_selected_columns",watch:{possible_selected_columns:"root.selectedColumnPossibleValues"},default:""},SelectedValue:{type:"viewstate",title:"Selected Row",default:""},SelectedField:{type:"viewstate",title:"Selected Column",default:""},SelectedCellValue:{type:"viewstate",title:"Selected Cell Value",default:""},FollowSelectedValue:{type:"boolean",title:"Follow Selected Row",format:"checkbox",default:!1},DefaultFallbackOnDeselect:{type:"boolean",title:"Default Fallback on Deselect",default:!0,format:"checkbox"},CheckboxAlignment:{type:"string",title:"Checkbox Alignment",default:"none",enum:["none","left","right"]},SelectOnCheckOnly:{type:"boolean",title:"Select on checkbox only",default:!1,format:"checkbox"},Actions:{type:"actions",fields:{map:_.extend({Current:{title:"Source Column",type:"string",enumSource:"possible_columns",watch:{possible_columns:"root.highlightTargetPossibleValues"},default:"",propertyOrder:10}},t),nav:t,query:t,url:t}}}},FileExport:{type:"object",title:"File Export",options:{collapsed:!0},properties:{ShowExportCsvButton:{type:"boolean",title:"Show Export Csv Button",default:!0,format:"checkbox"},ShowExportExcelButton:{type:"boolean",title:"Show Export Excel Button",default:!0,format:"checkbox"},ShowFullExportButton:{type:"boolean",title:"Show Full Export Button",default:!1,format:"checkbox"},CsvExportDelimiter:{title:"CSV Export Delimiter",type:"string",format:"delimiter",default:""},RawFormat:{type:"boolean",title:"Export with Raw Format",default:!1,format:"checkbox"},FileName:{type:"array",format:"table",title:"FileName",options:{hidden:!1,collapsed:!0},items:{type:"object",title:"Filename Part",options:{collapsed:!0},properties:{FileNamePart:{title:"FileName Part",type:"string"}}}},Actions:{type:"array",format:"table",title:"Actions",options:{collapsed:!0},items:{type:"object",title:"Action",options:{collapsed:!0},properties:{EventType:{title:"Event Type",type:"string",default:"all",enum:["all","onSuccess","onFail"]},Result:{title:"Last Result",type:"string",default:""}}}}}},Tooltip:{type:"object",title:"Tooltip",options:{collapsed:!0},properties:{Position:{propertyOrder:1,type:"string",title:"Position",default:"none",enum:["none","right","left","cursor"]},Template:{propertyOrder:12,type:"handlebar",title:"Template",data:[],default:"",columnsFieldName:"datagridPossibleColumns",templateItems:{values:{type:"object",items:_.keyBy(["thisField","thisValue","thisRawValue"])}}},UseFormattedCellValue:{propertyOrder:22,type:"boolean",title:"Use Formatted Cell Value",default:"false",format:"checkbox"}}},GroupingConfiguration:{type:"array",format:"table",title:"Grouping Columns",options:{hidden:!1,collapsed:!0},items:{type:"object",title:"Grouping Column",properties:{ColumnProperty:{title:"Column",type:"string",enumSource:"possible_selected_columns",watch:{possible_selected_columns:"root.selectedColumnPossibleValues"}}}}},SummaryRow_Groupings:{type:"array",format:"object",title:"Summary Row for Groupings",options:{hidden:!1,collapsed:!0},items:{type:"object",title:"Summary",options:{collapsed:!0},properties:{Function:{title:"Aggregate Function",type:"string",propertyOrder:1,enum:["SUM","AVG","MIN","MAX","WAVG"],default:""},Column:{type:"string",propertyOrder:2,enumSource:"possible_columns",watch:{possible_columns:"root.selectedColumnPossibleValues"}},Column2:{title:"Column 2",propertyOrder:3,type:"string",enumSource:"possible_columns",watch:{possible_columns:"root.sortingPossibleValues"},default:void 0},Label:{type:"string",propertyOrder:4,default:""},Color:{type:"gradient",propertyOrder:5,options:{noColor:!0},default:""}}}},HighlightRules:{type:"array",format:"object",title:"Highlight Rules",options:{hidden:!1,collapsed:!0},items:ie},CustomFilters:oe,CustomLayout:{type:"object",title:"Custom Configuration Layout",options:{collapsed:!0},properties:{IgnoreCustomLayoutViewstate:{propertyOrder:1076,type:"boolean",title:"Ignore Custom Layout Viewstate",default:!1,format:"checkbox"},IncludeHiddenColumns:{propertyOrder:1077,type:"boolean",title:"Include Hidden Columns",default:!0,format:"checkbox"}}},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{Theme:{type:"string",title:"Theme",default:"Dark",options:{hidden:!0},enum:["Light","Dark"]},DashboardTheme:{options:{hidden:!0}},EvenRowBackgroundColorOverride:{propertyOrder:100,type:"gradient",options:{noColor:!1,gradient:!1},default:"#282828",title:"Even Row Background"},OddRowBackgroundColorOverride:{propertyOrder:102,type:"gradient",options:{noColor:!1,gradient:!1},default:"#303030",title:"Odd Row Background"},SelectedRowBackgroundColor:{propertyOrder:104,type:"gradient",options:{noColor:!0,gradient:!1},default:"",title:"Selected Row Background"},RowHeight:{propertyOrder:110,type:"number",format:"number",title:"Row Height",default:30},HeaderRowHeight:{propertyOrder:115,type:"number",format:"number",title:"Header Row Height",default:30},HeaderTextTransformation:{propertyOrder:120,title:"Header Text Transformation",type:"string",enum:["uppercase","lowercase","capitalize","none"]},HeaderFontWeight:{propertyOrder:125,title:"Header Font Weight",type:"string",enum:["","normal","bold"],default:""},FontFamily:{propertyOrder:140,title:"Font Family",type:"string",enum:["","monospace","fantasy"],default:""},FontSize:{propertyOrder:145,title:"Font Size",type:"string",default:""},advanced:{propertyOrder:160,type:"css",title:"Advanced CSS",default:""}}}}}}},0<_.keys(e.settingsModel.attributes).length)for(o=r.upgrades.indexOf(_.find(r.upgrades,{version:e.settingsModel.get("version")}))+1;o<r.upgrades.length;o+=1)(n=r.upgrades[o]).fn(e.settingsModel),e.settingsModel.set("version",n.version);return e.dataModel.getByPath(r.SAMPLE_DATA)&&(i.appArgs.json.Basics.Data=r.SAMPLE_DATA),_.each(["Basics","ColumnsConfiguration","Selection","FileExport","Tooltip","GroupingConfiguration","SummaryRow_Groupings","HighlightRules","CustomFilters","Style"],function(e,t){i.appArgs.schema.properties[e].propertyOrder=990+t}),i},getColumnSettingsModel:function(e){return _.extend({},n,e)},getSettingsModel:function(e){var t=r.getComponentDefinition().appArgs.json;return $.extend(!0,t,{Basics:{ExperimentalMode:!1}},e),new w.DeepModel(t)},upgrades:[{version:"4.0.0_d14a",fn:function(e){_.each(e.get("Selection.SelectedObjectRouting"),function(e){e.IsSetOnDoubleClick=!1}),e.set({"Basics.SortColumn":"","Basics.SortOrder":"ascending",sortingPossibleValues:[""]}),e.set("FileExport.ShowExportExcelButton",!1)}},{version:"4.0.0p1",fn:function(e){e.set("FileExport.ShowFullExportButton",!1)}},{version:"4.0.0p2",fn:function(e){_.each(e.get("ColumnsConfiguration"),function(e){"#606060"===e.PercentageColorOverride&&(e.PercentageColorOverride="")})}},{version:"4.0.1s1",fn:function(e){_.each(e.get("ColumnsConfiguration"),function(e){e.Tooltip=""})}},{version:"4.0.1s1a",fn:function(e){e.set("FileExport.ShowFullExportButton",!1)}},{version:"4.1.0s3",fn:function(e){e.set("CustomFilters",[])}},{version:"4.1.1s1",fn:function(e){var t=e.get("Selection");e.set("Selection.Mode",t.RowSelectionMode?"Multi Row":"Area"),delete t.RowSelectionMode}},{version:"4.1.1s2",fn:function(e){e.set("Selection.SelectedCellValue",""),e.set("Selection.SelectedField",""),_.each(e.get("ColumnsConfiguration"),function(e){e.IsSelectable=!0})}},{version:"4.1.1s2a",fn:function(e){e.set("Style.HeaderRowHeight",30)}},{version:"4.1.1s2b",fn:function(e){e.set("Tooltip.Position","none"),e.set("Tooltip.Template",ne)}},{version:"4.1.1s2c",fn:function(e){void 0===e.get("FileExport").CsvExportDelimiter&&e.set("FileExport.CsvExportDelimiter",""),e.set("Selection.CheckboxAlignment","none")}},{version:"4.3.0s1",fn:function(e){e.set("Basics.KdbFilterString","")}},{version:"4.3.0s2",fn:function(e){e.set("Basics.FilterOnEnterHit",!1)}},{version:"4.3.0s3",fn:function(e){var t=e.get("Selection.SelectedObjectRouting"),t=_.map(t,function(e){var t={_Type:"map",TriggerColumn:"*"};return t.Trigger=e.IsSetOnDoubleClick?"Double Click":"Click",t.Current=e.ColumnProperty,t.Target=e.ViewstateProperty,t});e.set("Selection.Actions",t),e.unset("Selection.SelectedObjectRouting")}},{version:"4.3.0s4",fn:function(e){e.set("Basics.ScrollValueV",0),_.each(e.get("ColumnsConfiguration"),function(e){e.IsRangeHighlightColorInverted=!1}),e.set("Basics.ExperimentalMode",!1)}},{version:"4.3.0s5",fn:function(e){e.set("Basics.IsFilterVisible",!0)}},{version:"4.3.1",fn:function(e){_.each(e.get("ColumnsConfiguration"),function(e){e.SparklineOptions=Z.JSON_STRING})}},{version:"4.4.1",fn:function(e){e.set("Basics.LazyDataLoading","disabled")}},{version:"4.5.0",fn:function(e){_.each(e.get("Selection.Actions"),function(e){"Hover"===e.Trigger&&(e.Trigger="Mouse In")}),_.each(e.get("HighlightRules"),function(e){_.defaultsDeep(e,te)}),e.set("datagridPossibleColumnsWithItself",_.concat("<this>",e.get("datagridPossibleColumns")||[]))}},{version:"4.5.0a",fn:function(o){var n=p.Tools.getDefaultThemeColors("Light"),a=["Style.EvenRowBackgroundColorOverride","Style.OddRowBackgroundColorOverride"];_.forEach(["#f0f0f0","#e0e0e0"],function(e,t){var i=a[t];o.get(i)===e&&o.set(i,n[t])})}},{version:"4.7.0",fn:function(e){e.set("Basics.EditMode",e.get("Basics.IsEditable")?"enabled":"disabled"),e.unset("Basics.IsEditable"),_.each(e.get("ColumnsConfiguration"),function(e){e.Footer="None",e.FooterWeights=""})}},{version:"4.7.1",fn:function(e){e.set("Tooltip.UseFormattedCellValue",!1)}},{version:"4.7.3",fn:function(e){_.each(e.get("ColumnsConfiguration"),function(e){e.Header=_.isNil(e.Header)?"none":e.Header}),_.isNil(e.get("datagridPossibleHeaderColumns"))&&e.set("datagridPossibleHeaderColumns",[]),_.isNil(e.get("HeaderGroup"))&&e.set("HeaderGroup",[]);e=e.get("Basics");e.IgnoreCustomLayoutViewstate=!_.isNil(e.IgnoreCustomLayoutViewstate)&&e.IgnoreCustomLayoutViewstate}},{version:"4.7.3a",fn:function(e){_.isNil(e.get("Basics.ExpandOnPdf"))&&e.set("Basics.ExpandOnPdf",!1)}},{version:"4.7.4",fn:function(e){_.isNil(e.get("Selection.SelectOnCheckOnly"))&&e.set("Selection.SelectOnCheckOnly",!1)}},{version:"4.7.4.1",fn:function(e){var t=e.get("Basics.IgnoreCustomLayoutViewstate");e.set("CustomLayout.IgnoreCustomLayoutViewstate",t),_.isNil(e.get("CustomLayout.IncludeHiddenColumns"))&&e.set("CustomLayout.IncludeHiddenColumns",!0)}},{version:"4.7.4.4",fn:function(e){e=e.get("FileExport");e.RawFormat=!_.isNil(e.RawFormat)&&e.RawFormat}},{version:"4.7.5",fn:function(e){e=e.get("FileExport");e.Actions=_.isNil(e.Actions)?[]:e.Actions}}],upgradeColumnsConfig:function(e,i){var o=_.keyBy(i,function(e){return e.Field+"."+e.DisplayName});return _.map(e,function(t){var e=o[t.Field+"."+t.DisplayName]||_.find(i,function(e){return l.isFieldMatched(e.Field,t.Field)});return _.extend({},n,t,_.pick(e,"Footer","FooterWeights"))})}},ne='<div style="padding:10px; background: #f0f0f0; color: #101010; font-size:11px; border:1px solid #c0c0c0; border-radius: 2px;">\r\n  {{#each this}}{{#isnt @key "thisValue"}}{{#isnt @key "thisRawValue"}}{{#isnt @key "thisField"}}<b>{{@key}}</b> : {{this}}<br>{{/isnt}}{{/isnt}}{{/isnt}}{{/each}}\r\n</div>';function ae(){var e=!1,t=!1;this.stopPropagation=function(){e=!0},this.isPropagationStopped=function(){return e},this.stopImmediatePropagation=function(){t=!0},this.isImmediatePropagationStopped=function(){return t}}function se(){this.__nonDataRow=!0}function re(){this.__group=!0,this.level=0,this.count=0,this.value=null,this.title=null,this.collapsed=!1,this.totals=null,this.rows=[],this.groups=null,this.groupingKey=null}function le(){this.__groupTotals=!0,this.group=null,this.initialized=!1}function de(){var t=null;this.isActive=function(e){return e?t===e:null!==t},this.activate=function(e){if(e!==t){if(null!==t)throw"SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController";if(!e.commitCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()";if(!e.cancelCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()";t=e}},this.deactivate=function(e){if(t!==e)throw"SlickGrid.EditorLock.deactivate: specified editController is not the currently active one";t=null},this.commitCurrentEdit=function(){return!t||t.commitCurrentEdit()},this.cancelCurrentEdit=function(){return!t||t.cancelCurrentEdit()}}_.extend(r,{getDefaultJSONTemplates:function(){return{Defaults:r.getComponentDefinition().appArgs.json,ColumnsConfiguration:{ColumnsConfiguration:_.cloneDeep(n)}}},mergeWithDefault:function(e){return e&&e.attributes&&(_.defaultsDeep(e.attributes,r.getComponentDefinition().appArgs.json),_.each(e.attributes.ColumnsConfiguration,function(e){_.defaultsDeep(e,n)})),e}}),jQuery.extend(!0,window,{Slick:{Event:function(){var s=[];this.subscribe=function(e){s.push(e)},this.unsubscribe=function(e){for(var t=s.length-1;0<=t;t--)s[t]===e&&s.splice(t,1)},this.notify=function(e,t,i,o){var n;t=t||new ae,i=i||this,o=!!o;for(var a=0;a<s.length&&(o||!t.isPropagationStopped()&&!t.isImmediatePropagationStopped());a++)n=s[a].call(i,t,e);return n}},EventData:ae,EventHandler:function(){var o=[];this.subscribe=function(e,t){return o.push({event:e,handler:t}),e.subscribe(t),this},this.unsubscribe=function(e,t){for(var i=o.length;i--;)if(o[i].event===e&&o[i].handler===t)return o.splice(i,1),void e.unsubscribe(t);return this},this.unsubscribeAll=function(){for(var e=o.length;e--;)o[e].event.unsubscribe(o[e].handler);return o=[],this}},Range:function(e,t,i,o){void 0===i&&void 0===o&&(i=e,o=t);this.fromRow=Math.min(e,i),this.fromCell=Math.min(t,o),this.toRow=Math.max(e,i),this.toCell=Math.max(t,o),this.isSingleRow=function(){return this.fromRow==this.toRow},this.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell},this.contains=function(e,t){return e>=this.fromRow&&e<=this.toRow&&t>=this.fromCell&&t<=this.toCell},this.toString=function(){return this.isSingleCell()?"("+this.fromRow+":"+this.fromCell+")":"("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"}},NonDataRow:se,Group:re,GroupTotals:le,EditorLock:de,GlobalEditorLock:new de}}),(re.prototype=new se).equals=function(e){return this.value===e.value&&this.count===e.count&&this.collapsed===e.collapsed&&this.title===e.title},le.prototype=new se;i.prototype.addItem=function(e){var t=e[this.app.SLICKGRID_ROW_UNIQUE_ID];this.data[t]=e,this.addedPKS.push(t)},i.prototype.clear=function(){for(var e in this.data)delete this.data[e];this.data.length=0},i.prototype.deleteItem=function(e){this.selectionSyncHelper&&this.selectionSyncHelper.isIdSelected(e)||delete this.data[e]},i.prototype.destroy=function(){this.stopListening()},i.prototype.endUpdate=function(){this.grid.invalidateRows(this.addedPKS),this.grid.render(),this.addedPKS=[]},i.prototype.getFilteredItems=function(){for(var e,t=[],i=0;i<this.data.length;i++)(e=this.data[i])&&t.push(e);return t},i.prototype.getInternalMap_idxById=function(){var e=_.mapValues(this.data,function(e,t){return t});return delete e.length,e},i.prototype.getItem=function(e){e=this.data[e]||void 0;return e=e&&this.config.populateItem?this.config.populateItem(e):e},i.prototype.getItemById=function(e){return this.getItem(e)},i.prototype.getItemByIdx=function(e){return this.getItem(e)},i.prototype.getItems=function(){return{length:0}},i.prototype.getLength=function(){return this.data.length},i.prototype.initEvents=function(){var e=this;this.grid=this.app.grid,this.grid.onViewportChanged.subscribe(this.onViewportChanged.bind(this)),this.listenTo(this.app,"data-loaded",function(){e.isLoadingMissingData=!1})},i.prototype.mapIdsToRows=function(e){return _.map(e,function(e){return Number(e)})},i.prototype.mapRowsToIds=function(e){var i=this,o=this.app.SLICKGRID_ROW_UNIQUE_ID;return _.map(e,function(e){var t;return(i.data[e]||((t={})[o]=e,t))[o]})},i.prototype.onViewportChanged=function(){var e,t=this.grid.getViewport(),i=0;if(!this.isLoadingMissingData&&((t=_.pick(t,"top","bottom")).bottom=Math.min(this.data.length-1,t.bottom),this.lastVisibleTop!==t.top||this.lastVisibleBottom!==t.bottom)){t.top>this.lastVisibleTop&&t.bottom>this.lastVisibleBottom?i=1:t.top<this.lastVisibleTop&&t.bottom<this.lastVisibleBottom&&(i=-1);for(var o=t.top;o<=t.bottom;o++)if(!this.data[o]&&void 0===e){e=o;break}if(void 0!==e){var n,a=this.viewModel.get("Style"),s=Math.max(1,Math.ceil((this.app.$pnlGrid.height()-a.HeaderRowHeight)/a.RowHeight)),r=Math.ceil(3*s);switch(i){case-1:n=Math.max(0,t.bottom-r);break;case 1:n=Math.min(this.data.length-r,t.top);break;default:n=Math.max(0,t.top-Math.ceil(2*s))}this.isLoadingMissingData=!0,this.api.page(this.model,{_pagingNum:n,_pageSize:r})}this.lastVisibleTop=t.top,this.lastVisibleBottom=t.bottom}},i.prototype.refresh=function(){},i.prototype.reSort=function(){},i.prototype.setItems=function(e,t){this.updateLength(),this.updateScrollbar();for(var i=this.app.SLICKGRID_ROW_UNIQUE_ID,o=0;o<e.length;o++){var n=e[o];this.data[n[i]]=n}this.grid=this.app.grid;var a=this.app.viewModel.get("Basics.ScrollValueV")||0,a=(this.app.grid.scrollRowToTop(a),this.grid.getViewport());this.lastVisibleTop=a.top,this.lastVisibleBottom=a.bottom,this.initEvents_once()},i.prototype.syncGridSelection=function(i){var o,t=new Slick.Event,n=[],a={},s=this;function r(e){n.join(",")!=e.join(",")&&(n=e,a=_.reduce(n,function(e,t){return e[t]=!0,e},{}),t.notify({grid:i,ids:n},new Slick.EventData,s))}function l(){o=!0;var e=s.mapIdsToRows(n);i.setSelectedRows(e),o=!1}return i.onSelectedRowsChanged.subscribe(function(e,t){o||r(s.mapRowsToIds(i.getSelectedRows()))}),this.onRowsChanged.subscribe(l),this.onRowCountChanged.subscribe(l),this.selectionSyncHelper={getSelectedIds:function(){return n},isIdSelected:function(e){return!!a[e]},onSelectedRowIdsChanged:t,setSelectedIds:function(e){r(e),l()}},t},i.prototype.updateItem_unchecked_noRefresh=function(e,t){this.addItem(t)},i.prototype.updateLength=function(){this.app.currentPagingInfo&&(this.data.length=Number(this.app.currentPagingInfo.totalNumRows))},i.prototype.updateScrollbar=function(){this.app.currentPagingInfo&&this.app.grid.updateRowCount()};var h,g,s,f,ue,Di,xi,Fi,q,ce,C,y,m,D,pe,d,he=i;function i(e,t){this.data={},this.isLoadingMissingData=!1,this.lastVisibleTop=0,this.lastVisibleBottom=0,this.onPagingInfoChanged=new Slick.Event,this.onRowCountChanged=new Slick.Event,this.onRowsChanged=new Slick.Event,this.addedPKS=[],this.data={},this.app=e,this.model=e.model,this.viewModel=e.viewModel,this.api=e.api,this.config=t,_.each(["beginUpdate","collapseAllGroups","expandAllGroups","reactivateIndexing","setFilter","setFilterArgs","setGrouping","suspendIndexing"],function(e){this[e]=function(){}}.bind(this)),_.extend(this,w.Events),this.initEvents_once=_.once(this.initEvents)}if((h=jQuery).fn.drag=function(e,t,i){var o="string"==typeof e?e:"",n=h.isFunction(e)?e:h.isFunction(t)?t:null;return 0!==o.indexOf("drag")&&(o="drag"+o),i=(e==n?t:i)||{},n?this.on(o,i,n):this.trigger(o)},g=h.event,s=g.special,(f=s.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(e){var i=h.data(this,f.datakey),o=e.data||{};i.related+=1,h.each(f.defaults,function(e,t){void 0!==o[e]&&(i[e]=o[e])})},remove:function(){--h.data(this,f.datakey).related},setup:function(){var e;h.data(this,f.datakey)||(e=h.extend({related:0},f.defaults),h.data(this,f.datakey,e),g.add(this,"touchstart mousedown",f.init,e),this.attachEvent&&this.attachEvent("ondragstart",f.dontstart))},teardown:function(){(h.data(this,f.datakey)||{}).related||(h.removeData(this,f.datakey),g.remove(this,"touchstart mousedown",f.init),f.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",f.dontstart))},init:function(e){if(!f.touched){var t,i=e.data;if(!(0!=e.which&&0<i.which&&e.which!=i.which)&&!h(e.target).is(i.not)&&(!i.handle||h(e.target).closest(i.handle,e.currentTarget).length)&&(f.touched="touchstart"==e.type?this:null,i.propagates=1,i.mousedown=this,i.interactions=[f.interaction(this,i)],i.target=e.target,i.pageX=e.pageX,i.pageY=e.pageY,i.dragging=null,t=f.hijack(e,"draginit",i),i.propagates))return(t=f.flatten(t))&&t.length&&(i.interactions=[],h.each(t,function(){i.interactions.push(f.interaction(this,i))})),i.propagates=i.interactions.length,!1!==i.drop&&s.drop&&s.drop.handler(e,i),f.textselect(!1),f.touched?g.add(f.touched,"touchmove touchend",f.handler,i):g.add(document,"mousemove mouseup",f.handler,i),!(!f.touched||i.live)&&void 0}},interaction:function(e,t){t=h(e)[t.relative?"position":"offset"]()||{top:0,left:0};return{drag:e,callback:new f.callback,droppable:[],offset:t}},handler:function(e){var t=e.data;switch(e.type){case!t.dragging&&"touchmove":e.preventDefault();case!t.dragging&&"mousemove":if(Math.pow(e.pageX-t.pageX,2)+Math.pow(e.pageY-t.pageY,2)<Math.pow(t.distance,2))break;e.target=t.target,f.hijack(e,"dragstart",t),t.propagates&&(t.dragging=!0);case"touchmove":e.preventDefault();case"mousemove":if(t.dragging){if(f.hijack(e,"drag",t),t.propagates){!1!==t.drop&&s.drop&&s.drop.handler(e,t);break}e.type="mouseup"}default:f.touched?g.remove(f.touched,"touchmove touchend",f.handler):g.remove(document,"mousemove mouseup",f.handler),t.dragging&&(!1!==t.drop&&s.drop&&s.drop.handler(e,t),f.hijack(e,"dragend",t)),f.textselect(!0),!1===t.click&&t.dragging&&h.data(t.mousedown,"suppress.click",(new Date).getTime()+5),t.dragging=f.touched=!1}},hijack:function(i,o,n,e,t){if(n){function a(){}var s,r,l,d={event:i.originalEvent,type:i.type},u=o.indexOf("drop")?"drag":"drop",c=e||0,p=isNaN(e)?n.interactions.length:e;i.type=o;i.originalEvent=new jQuery.Event(d.event,{preventDefault:a,stopPropagation:a,stopImmediatePropagation:a}),n.results=[];do{if(r=n.interactions[c]){if("dragend"!==o&&r.cancelled)continue;l=f.properties(i,n,r),r.results=[],h(t||r[u]||n.droppable).each(function(e,t){if(l.target=t,!(i.isPropagationStopped=function(){return!1})===(s=t?g.dispatch.call(t,i,l):null)?("drag"==u&&(r.cancelled=!0,--n.propagates),"drop"==o&&(r[u][e]=null)):"dropinit"==o&&r.droppable.push(f.element(s)||t),"dragstart"==o&&(r.proxy=h(f.element(s)||r.drag)[0]),r.results.push(s),delete i.result,"dropinit"!==o)return s}),n.results[c]=f.flatten(r.results),"dropinit"==o&&(r.droppable=f.flatten(r.droppable)),"dragstart"!=o||r.cancelled||l.update()}}while(++c<p);return i.type=d.type,i.originalEvent=d.event,f.flatten(n.results)}},properties:function(e,t,i){var o=i.callback;return o.drag=i.drag,o.proxy=i.proxy||i.drag,o.startX=t.pageX,o.startY=t.pageY,o.deltaX=e.pageX-t.pageX,o.deltaY=e.pageY-t.pageY,o.originalX=i.offset.left,o.originalY=i.offset.top,o.offsetX=o.originalX+o.deltaX,o.offsetY=o.originalY+o.deltaY,o.drop=f.flatten((i.drop||[]).slice()),o.available=f.flatten((i.droppable||[]).slice()),o},element:function(e){if(e&&(e.jquery||1==e.nodeType))return e},flatten:function(e){return h.map(e,function(e){return e&&e.jquery?h.makeArray(e):e&&e.length?f.flatten(e):e})},textselect:function(e){h(document)[e?"off":"on"]("selectstart",f.dontstart).css("MozUserSelect",e?"":"none"),document.unselectable=e?"off":"on"},dontstart:function(){return!1},callback:function(){}}).callback.prototype={update:function(){s.drop&&this.available.length&&h.each(this.available,function(e){s.drop.locate(this,e)})}},ue=g.dispatch,g.dispatch=function(e){if(!(0<h.data(this,"suppress."+e.type)-(new Date).getTime()))return ue.apply(this,arguments);h.removeData(this,"suppress."+e.type)},"undefined"==typeof jQuery)throw"SlickGrid requires jquery module to be loaded";if("undefined"==typeof Slick)throw"slick.core.js not loaded";(Di=jQuery).extend(!0,window,{Slick:{GridModifiedByIK:function(H,R,M,y){var a,s,G,$,U,r,W,K,z,h,j,Q,q,Y,X,l,S,J,Z,ee,te,ie,d,u,n,oe,ne,ae,k,I,se,re,le,o,i,de,ue={explicitInitialization:!1,rowHeight:25,defaultColumnWidth:80,enableAddRow:!1,leaveSpaceForNewRows:!1,editable:!1,autoEdit:!0,enableCellNavigation:!0,enableColumnReorder:!0,asyncEditorLoading:!1,asyncEditorLoadDelay:100,forceFitColumns:!1,autoExpandColumns:!1,enableAsyncPostRender:!1,asyncPostRenderDelay:50,autoHeight:!1,editorLock:Slick.GlobalEditorLock,showHeaderRow:!1,isHeaderRowVisible:!0,headerRowHeight:25,showTopPanel:!1,topPanelHeight:25,formatterFactory:null,editorFactory:null,cellFlashingCssClass:"flashing",selectedCellCssClass:"selected",multiSelect:!0,enableTextSelectionOnCells:!1,dataItemColumnValueExtractor:null,fullWidthRows:!1,multiColumnSort:!1,defaultFormatter:function(e,t,i,o,n){return document.createTextNode(null==i?"":i)},forceSyncScrolling:!1,addNewRowCssClass:"new-row"},ce={name:"",resizable:!0,sortable:!1,minWidth:30,rerenderOnResize:!1,headerCssClass:null,defaultSortAsc:!0,focusable:!0,selectable:!0},pe=0,c=0,p=!1,g="slickgrid_"+_.uniqueId(),f=this,he=0,ge=0,fe=0,me=25,t=1,T=null,m=null,D={},Ce=0,C=0,ve=0,we=0,be=0,v=0,ye=[],_e=[],w={},Se={},b=[],Re=[],Me=[],ke=[],Ie=null,Te=null,De={},xe=null,Fe=null,Ee=!1,x=[];function Oe(){if(!p){p=!0,u=parseFloat(Di.css(r[0],"width",!0));for(var i,e,t=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],o=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],n=(i=Di("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo(h),he=0,"border-box"!=i.css("box-sizing")&&"border-box"!=i.css("-moz-box-sizing")&&"border-box"!=i.css("-webkit-box-sizing")&&(Di.each(t,function(e,t){he+=parseFloat(i.css(t))||0}),Di.each(o,function(e,t){parseFloat(i.css(t))})),i.remove(),Di("<div class='slick-row' />").appendTo(S)),a=(i=Di("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(n),ge=fe=0,"border-box"!=i.css("box-sizing")&&"border-box"!=i.css("-moz-box-sizing")&&"border-box"!=i.css("-webkit-box-sizing")&&(Di.each(t,function(e,t){ge+=parseFloat(i.css(t))||0}),Di.each(o,function(e,t){fe+=parseFloat(i.css(t))||0})),n.remove(),me=Math.max(he,ge)+5,(t=h)&&t.jquery&&t.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return!1}),y.enableTextSelectionOnCells||l.bind("selectstart.ui",function(e){return Di(e.target).is("input,textarea")}),je(),Ae(),h.click(function(e){if(e.metaKey=e.metaKey||e.ctrlKey,!Di(e.target).hasClass("slick-resizable-handle")){var t=Di(e.target).closest(".slick-header-column");if(t.length){var i=t.data("column");if(i.sortable&&O().commitCurrentEdit()){for(var o=null,n=0;n<b.length;n++)if(b[n].columnId==i.id){(o=b[n]).sortAsc=!o.sortAsc;break}e.metaKey&&y.multiColumnSort?o&&b.splice(n,1):((e.shiftKey||e.metaKey)&&y.multiColumnSort||(b=[]),o?0==b.length&&b.push(o):(o={columnId:i.id,sortAsc:i.defaultSortAsc},b.push(o))),_.isEqual(b,Re)||(Ke(b),t=y.multiColumnSort?{multiColumnSort:!0,sortCols:Di.map(b,function(e){return{sortCol:M[V(e.columnId)],sortAsc:e.sortAsc}})}:{multiColumnSort:!1,sortCol:i,sortAsc:o.sortAsc},E(f.onSort,t,e))}}}}),He(),ht(),_.isNumber(y.scrollLeft)&&(l[0].scrollLeft=y.scrollLeft,St()),S[0]);(a=a.parentNode)!=document.body&&null!=a;)a!=l[0]&&a.scrollWidth==a.clientWidth&&a.scrollHeight==a.clientHeight||(e=Di(a),Z=Z?Z.add(e):e,e.bind("scroll."+g,oi));r.bind("resize.slickgrid",ht),l.bind("scroll",St),z.bind("contextmenu",Bt).bind("click",Ht).delegate(".slick-header-column","mouseenter",Pt).delegate(".slick-header-column","mouseleave",At),Q.bind("scroll",_t),W.add(K).bind("keydown",Ft),S.bind("keydown",Ft).bind("mousedown",Et).bind("mouseup",Ot).bind("dblclick",Lt).bind("contextmenu",Nt).bind("draginit",It).bind("dragstart",{distance:3},Tt).bind("drag",Dt).bind("dragend",xt).delegate(".slick-cell","mouseenter",Gt).delegate(".slick-cell","mouseleave",$t),navigator.userAgent.toLowerCase().match(/webkit/)&&navigator.userAgent.toLowerCase().match(/macintosh/)&&S.bind("mousewheel",kt)}}function Ve(e){for(var t=_e.length;0<=t;t--)if(_e[t]===e){_e[t].destroy&&_e[t].destroy(),_e.splice(t,1);break}}function Ne(){for(var e=0,t=0,i=M.length;t<i;t++)e+=M[t].width;return e+=xi.width,Math.max(e,u)+1e3}function Le(){for(var e=ne?u-xi.width:u,t=0,i=M.length;i--;)t+=M[i].width;return y.fullWidthRows?Math.max(t,e):t}function Pe(e){var t=n;(n=Le())!=t&&(S.width(n),j.width(n),h.width(Ne()),oe=n>u-xi.width),q.width(n+(ne?xi.width:0)),n==t&&!e||We()}function Ae(){function e(){Di(this).addClass("ui-state-hover")}function t(){Di(this).removeClass("ui-state-hover")}h.find(".slick-header-column").each(function(){var e=Di(this).data("column");e&&E(f.onBeforeHeaderCellDestroy,{node:this,column:e})}),h.empty(),h.width(Ne()),j.find(".slick-headerrow-column").each(function(){var e=Di(this).data("column");e&&E(f.onBeforeHeaderRowCellDestroy,{node:this,column:e})}),j.empty();for(var i="",o="<div class='ui-state-default slick-header-column' style='"+(i=y.headerFontWeight?"font-weight:"+y.headerFontWeight+";":i)+"'/>",n=0;n<M.length;n++){var a=M[n],s=a.field?a.field+" ":"",s=((a.headerCssClass||s)&&(s+=a.headerCssClass||""),Di(o).html("<span class='slick-column-name'>"+a.name+"</span>").width(a.width-he).attr("id",""+g+a.id).attr("title",a.toolTip||"").data("column",a).addClass(s).appendTo(h));(y.enableColumnReorder||a.sortable)&&s.on("mouseenter",e).on("mouseleave",t),a.sortable&&(s.addClass("slick-header-sortable"),s.append("<span class='slick-sort-indicator' />")),E(f.onHeaderCellRendered,{node:s[0],column:a}),y.showHeaderRow&&(s=Di("<div class='ui-state-default slick-headerrow-column l"+n+" r"+n+"'></div>").data("column",a).appendTo(j),E(f.onHeaderRowCellRendered,{node:s[0],column:a}))}Ke(b),Be(),y.enableColumnReorder&&(h.filter(":ui-sortable").sortable("destroy"),h.sortable({distance:3,cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",appendTo:r,start:function(e,t){t.placeholder.width(t.helper.outerWidth()-he),Di(t.helper).addClass("slick-header-column-active"),E(f.onColumnsReorderStart,t)},beforeStop:function(e,t){Di(t.helper).removeClass("slick-header-column-active"),E(f.onBeforeColumnsReordered,t)},stop:function(e){if(!O().commitCurrentEdit()||e.originalEvent.isPropagationStopped())Di(this).is(":ui-sortable")&&Di(this).sortable("cancel");else if(h.is(":ui-sortable")){var t=h.sortable("toArray"),i=[],o=[];Ee=!0,x=_.map(x,function(e,t){return 0!=e?M[t].width:M[t].minWidth});for(var n=0;n<t.length;n++){var a=V(t[n].replace(g,""));i.push(M[a]),o.push(x[a])}x=o,Qe(i),E(f.onColumnsReordered,{}),e.stopPropagation(),Be()}}}))}function Be(){var r,l,d,u,c,i,o,p=h.children();p.find(".slick-resizable-handle").remove(),p.each(function(e,t){M[e].resizable&&(void 0===i&&(i=e),o=e)}),void 0!==i&&p.each(function(s,e){s<i||y.forceFitColumns&&o<=s||(Di(e),Di("<div class='slick-resizable-handle' />").appendTo(e).bind("dragstart",function(e,t){if(!O().commitCurrentEdit())return!1;d=e.pageX,Di(this).parent().addClass("slick-header-column-active");var i=null,o=null;if(p.each(function(e,t){M[e].previousWidth=Di(t).outerWidth()}),y.forceFitColumns)for(o=i=0,r=s+1;r<p.length;r++)(l=M[r]).resizable&&(null!==o&&(l.maxWidth?o+=l.maxWidth-l.previousWidth:o=null),i+=l.previousWidth-Math.max(0,me));var n=0,a=0;for(r=0;r<=s;r++)(l=M[r]).resizable&&(null!==a&&(l.maxWidth?a+=l.maxWidth-l.previousWidth:a=null),n+=l.previousWidth-Math.max(0,me));null===i&&(i=1e5),null===n&&(n=1e5),null===o&&(o=1e5),null===a&&(a=1e5),c=d+Math.min(i,a),u=d-Math.min(n,o)}).bind("drag",function(e,t){var i,o,e=Math.min(c,Math.max(u,e.pageX))-d;if(e<0){for(o=e,r=s;0<=r;r--)(l=M[r]).resizable&&(i=Math.max(0,me),o&&l.previousWidth+o<i?(o+=l.previousWidth-i,l.width=i):(l.width=l.previousWidth+o,o=0));if(y.forceFitColumns)for(o=-e,r=s+1;r<p.length;r++)(l=M[r]).resizable&&(o&&l.maxWidth&&l.maxWidth-l.previousWidth<o?(o-=l.maxWidth-l.previousWidth,l.width=l.maxWidth):(l.width=l.previousWidth+o,o=0))}else{for(o=e,r=s;0<=r;r--)(l=M[r]).resizable&&(o&&l.maxWidth&&l.maxWidth-l.previousWidth<o?(o-=l.maxWidth-l.previousWidth,l.width=l.maxWidth):(l.width=l.previousWidth+o,o=0));if(y.forceFitColumns)for(o=-e,r=s+1;r<p.length;r++)(l=M[r]).resizable&&(i=Math.max(0,me),o&&l.previousWidth+o<i?(o+=l.previousWidth-i,l.width=i):(l.width=l.previousWidth+o,o=0))}Ue(),y.syncColumnCellResize&&We()}).bind("dragend",function(e,t){var i;for(Di(this).parent().removeClass("slick-header-column-active"),Ee=!0,r=0;r<p.length;r++)l=M[r],i=Di(p[r]).outerWidth(),l.previousWidth!==i&&l.rerenderOnResize&&lt();Pe(!0),L(),E(f.onColumnsResized,{})}))})}function e(i){var o=0;return Di.each(["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],function(e,t){o+=parseFloat(i.css(t))||0}),o}function He(){J=Di("<style type='text/css' rel='stylesheet' />").appendTo(Di("head"));var e=y.rowHeight-fe,t=(J[0].styleSheet?J[0].styleSheet.cssText="":J[0].appendChild(document.createTextNode("")),J[0].sheet),i=0;F(t,"."+g+" .slick-header-column","left: 1000px;",i++),F(t,"."+g+" .slick-top-panel","height:"+y.topPanelHeight+"px;",i++),F(t,"."+g+" .slick-header-column","height:"+y.headerRowHeight+"px;",i++),F(t,"."+g+" .slick-headerrow-columns","height:"+y.headerRowHeight+"px;",i++),F(t,"."+g+" .slick-cell","height:"+e+"px;",i++),F(t,"."+g+" .slick-row","height:"+y.rowHeight+"px;",i++),F(t,"."+g+" .slick-cell","line-height:"+e+"px;",i++),F(t,"."+g+" .slick-row","line-height:"+y.rowHeight+"px;",i++),F(t,"."+g+" .slick-header-column","line-height:"+y.headerRowHeight+"px;",i++);for(var o=0;o<M.length;o++)F(t,"."+g+" .l"+o,"",i++),F(t,"."+g+" .r"+o,"",i++)}function F(e,t,i,o){e.insertRule?e.insertRule(t+"{"+i+"}",o):e.addRule(t,i,o)}function Ge(){J.remove(),ee=null}function E(e,t,i,o){return i=i||new Slick.EventData,(t=t||{}).grid=f,e.notify(t,i,f,o)}function O(){return y.editorLock}function V(e){return Se[e]}function $e(){var e,t,i,o,n={},a=!1,s=_.every(M,function(e){return _.get(e,"_dashboardConfig._RetainWidth",!1)}),r=ne?u-xi.width:u,l=_.reduce(x,function(e,t){return e+t},0);if(s){if(a=!0,l<r)for(e=0;e<M.length;e++)M[e].width=r*x[e]/l}else{for(e=0;e<M.length;e++)t=M[e],o=l?r*x[e]/l:0,!Ee&&t.minWidth>o&&!n[e]&&(o=t.minWidth,r=Math.max(0,r-o),l=Math.max(0,l-x[e]),n[e]=!0,e=-1);for(e=0;e<M.length;e++)i=n[e]?M[e].minWidth:Ee?M[e].width:r*x[e]/l,M[e].rerenderOnResize&&M[e].width!=i&&(a=!0),M[e].width=i}Ue(),Pe(!0),a&&(lt(),L())}function Ue(){if(p){for(var e,t=0,i=h.children(":not(.slick-sortable-placeholder):not(.ui-sortable-helper)"),o=i.length;t<o;t++)(e=Di(i[t])).width()!==M[t].width-he&&e.width(M[t].width-he);je()}}function We(){for(var e,t,i=0,o=0;o<M.length;o++)e=M[o].width,(t=function(e){if(!ee){for(var t=document.styleSheets,i=0;i<t.length;i++)if((t[i].ownerNode||t[i].owningElement)==J[0]){ee=t[i];break}if(ee){te=[],ie=[];for(var o,n,a=ee.cssRules||ee.rules,i=0;i<a.length;i++){var s=a[i].selectorText;(o=/\.l\d+/.exec(s))?(n=parseInt(o[0].substr(2,o[0].length-2),10),te[n]=a[i]):(o=/\.r\d+/.exec(s))&&(n=parseInt(o[0].substr(2,o[0].length-2),10),ie[n]=a[i])}}else console.log("ERROR: Slickgrid -  Cannot find stylesheet."),ie=[],(te=[])[e]={style:{left:0}},ie[e]={style:{right:0}}}return{left:te[e],right:ie[e]}}(o)).left.style.left=i+"px",t.right.style.right=n-i-e+"px",i+=M[o].width}function Ke(e){b=e,Re=_.cloneDeep(b);var o=h.children();o.removeClass("slick-header-column-sorted").find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc"),Di.each(b,function(e,t){null==t.sortAsc&&(t.sortAsc=!0);var i=V(t.columnId);null!=i&&o.eq(i).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(t.sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc")})}function ze(e,t){ye=[];for(var i={},o=0;o<t.length;o++)for(var n=t[o].fromRow;n<=t[o].toRow;n++){i[n]||(ye.push(n),i[n]={});for(var a=t[o].fromCell;a<=t[o].toCell;a++)Ri(n,a)&&(i[n][M[a].id]=y.selectedCellCssClass)}Mt(y.selectedCellCssClass,i),E(f.onSelectedRowsChanged,{rows:Ti()},e)}function je(){Me=[],ke=[];for(var e=0,t=0,i=M.length;t<i;t++)Me[t]=e,ke[t]=e+M[t].width,e+=M[t].width}function Qe(e){M=e,Se={};for(var t=0;t<M.length;t++){var i=M[t]=Di.extend({},ce,M[t]);Se[i.id]=t,i.minWidth&&i.width<i.minWidth&&(i.width=i.minWidth),i.maxWidth&&i.width>i.maxWidth&&(i.width=i.maxWidth)}je(),p&&(lt(),Ae(),Ge(),He(),ht(),We(),St())}function qe(){y.autoHeight&&(y.leaveSpaceForNewRows=!1)}function N(){return R.getLength?R.getLength():R.length}function Ye(){return N()+(y.enableAddRow?1:0)}function Xe(e){return R.getItem?R.getItem(e):R[e]}function Je(e){return y.rowHeight*e-c}function Ze(e){return Math.floor((e+c)/y.rowHeight)}function et(e){e=Math.max(e,0),e=Math.min(e,a-d+(oe?xi.height:0));var t,i=c,e=(pe=Math.min($-1,Math.floor(e/G)),e-(c=Math.round(pe*U)));if(c!=i)for(t in rt(ft(e)),D)D[t].rowNode.style.top=Je(t)+"px";Ce!=e&&(l[0].scrollTop=ve=C=Ce=e,E(f.onViewportChanged,{}))}function tt(e,t){var e=R.getItemMetadata&&R.getItemMetadata(e),i=e&&e.columns&&(e.columns[t.id]||e.columns[V(t.id)]);return i&&i.formatter||e&&e.formatter||t.formatter||y.formatterFactory&&y.formatterFactory.getFormatter(t)||y.defaultFormatter}function it(e,t){var i=M[t],e=R.getItemMetadata&&R.getItemMetadata(e),e=e&&e.columns;return e&&e[i.id]&&void 0!==e[i.id].editor?e[i.id].editor:e&&e[t]&&void 0!==e[t].editor?e[t].editor:i.editor||y.editorFactory&&y.editorFactory.getEditor(i)}function ot(e,t){return y.dataItemColumnValueExtractor?y.dataItemColumnValueExtractor(e,t):e[t.field]}function nt(e,t){var i=document.createDocumentFragment();t.forEach(function(e){i.appendChild(e)}),e.appendChild(i)}function at(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function st(e,t,i,o,n){var a,s=M[i],r="slick-cell l"+i+" r"+Math.min(M.length-1,i+o-1)+(s.cssClass?" "+s.cssClass:"");for(a in t===k&&i===I&&(r+=" active"),w)w[a][t]&&w[a][t][s.id]&&(r+=" "+w[a][t][s.id]);var l,d=document.createElement("div");d.className=r,e.push(d),n&&(e=void 0,(l=n instanceof Slick.NonDataRow)||(e=ot(n,s)),e=tt(t,s)(t,i,e,s,n),l?d.innerHTML=e:d.appendChild(e)),D[t].cellRenderQueue.push(i),D[t].cellColSpans[i]=o}function rt(e){for(var t in D)(t=parseInt(t,10))!==k&&(t<e.top||t>e.bottom)&&dt(t)}function lt(){for(var e in m&&P(),D)dt(e)}function dt(e){var t=D[e];t&&(i==t.rowNode?(t.rowNode.style.display="none",de=i):S[0].removeChild(t.rowNode),delete D[e],delete De[e],0)}function ut(e){var t,i;if(e&&e.length)for(t=0,i=e.length;t<i;t++)m&&k===e[t]&&P(),D[e[t]]&&dt(e[t])}function ct(e){ut([e])}function pt(e){var t=D[e];if(t){Ct(e);var i,o,n,a=Xe(e);for(i in t.cellNodesByColumnIdx)t.cellNodesByColumnIdx.hasOwnProperty(i)&&(o=M[i|=0],n=t.cellNodesByColumnIdx[i],e===k&&i===I&&m?m.loadValue(a):(at(n),a&&n.appendChild(tt(e,o)(e,i,ot(a,o),o,a))));yt(e)}}function ht(){p&&(d=y.autoHeight?y.rowHeight*Ye():parseFloat(Di.css(r[0],"height",!0))-parseFloat(Di.css(r[0],"paddingTop",!0))-parseFloat(Di.css(r[0],"paddingBottom",!0))-parseFloat(Di.css(z[0],"height"))-e(z)-(y.showTopPanel?y.topPanelHeight+e(Y):0)-(y.showHeaderRow&&y.isHeaderRowVisible?y.headerRowHeight+e(Q):0),le=Math.ceil(d/y.rowHeight),u=parseFloat(Di.css(r[0],"width",!0)),y.autoHeight||l.height(d),(y.forceFitColumns||y.autoExpandColumns)&&$e(),gt(),St(),we=-1,L())}function gt(){if(p){var e,t=Ye()+(y.leaveSpaceForNewRows?le-1:0),i=ne,o=(ne=!y.autoHeight&&t*y.rowHeight>d,P(),N());for(e in D)o<=e&&dt(e);T&&o<k&&jt();var n=s,t=(a=Math.max(y.rowHeight*t,d-xi.height),U=a<Fi?(s=G=a,$=1,0):(G=(s=Fi)/100,$=Math.floor(a/G),(a-s)/($-1)),s!==n&&(S.css("height",s),C=l[0].scrollTop),C+c<=a-d);0==a||0==C?pe=c=0:et(t?C+c:a-d),s!=n&&y.autoHeight&&ht(),(y.forceFitColumns||y.autoExpandColumns)&&i!=ne&&$e(),Pe(!1)}}function ft(e,t){return null==t&&(t=v),{top:Ze(e=null==e?C:e),bottom:Ze(e+d)+1,leftPx:t,rightPx:t+u}}function mt(e,t){e=ft(e,t);return--e.top,e.bottom+=1,e.top=Math.max(0,e.top),e.bottom=Math.min(Ye()-1,e.bottom),e.leftPx=Math.max(0,e.leftPx),e.rightPx=Math.min(n,e.rightPx),e}function Ct(e){var t=D[e];if(t&&t.cellRenderQueue.length)for(var i=t.rowNode.lastChild;t.cellRenderQueue.length;)var o=t.cellRenderQueue.pop(),i=(t.cellNodesByColumnIdx[o]=i).previousSibling}function vt(e){for(var t=[],i=[],o=e.top,n=e.bottom;o<=n;o++)if(S=D[o]){Ct(o),r=s=a=c=u=d=l=void 0;var a,s,r,l=e,d=o,u=D[d],c=[];for(a in u.cellNodesByColumnIdx)u.cellNodesByColumnIdx.hasOwnProperty(a)&&(a|=0,s=u.cellColSpans[a],!(Me[a]>l.rightPx||ke[Math.min(M.length-1,a+s-1)]<l.leftPx)||d==k&&a==I||c.push(a));for(;null!=(r=c.pop());)u.rowNode.removeChild(u.cellNodesByColumnIdx[r]),delete u.cellColSpans[r],delete u.cellNodesByColumnIdx[r],De[d]&&delete De[d][r],0;for(var p,h,g=0,f=(f=R.getItemMetadata&&R.getItemMetadata(o))&&f.columns,m=Xe(o),C=0,v=M.length;C<v&&!(Me[C]>e.rightPx);C++)null==(h=S.cellColSpans[C])&&(h=1,f&&"*"===(h=(p=f[M[C].id]||f[C])&&p.colspan||1)&&(h=v-C),ke[Math.min(v-1,C+h-1)]>e.leftPx)&&(st(t,o,C,h,m),g++),C+=1<h?h-1:0;g&&i.push(o)}if(t.length){var w,b,y=document.createElement("div");for(nt(y,t);null!=(w=i.pop());)for(var _,S=D[w];null!=(_=S.cellRenderQueue.pop());)b=y.lastChild,S.rowNode.appendChild(b),S.cellNodesByColumnIdx[_]=b}}function wt(e){for(var t=S[0],i=[],o=[],n=!1,a=N(),s=e.top,r=e.bottom;s<=r;s++)if(!D[s]){o.push(s),D[s]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]},C=m=f=w=v=g=h=p=c=u=d=l=void 0;for(var l=i,d=s,u=e,c=a,p=Xe(d),c="slick-row"+(d<c&&!p?" loading":"")+(d===k?" active":"")+(d%2==1?" odd":" even"),h=(p||(c+=" "+y.addNewRowCssClass),R.getItemMetadata&&R.getItemMetadata(d)),g=(h&&h.cssClasses&&(c+=" "+h.cssClasses),document.createElement("div")),f=(g.className=c,g.style.position="absolute",g.style.border=0,g.style.width="100%",g.style.top=Je(d)+"px",d%2==1?y.oddRowBackgroundColorOverride&&(g.style.backgroundColor=y.oddRowBackgroundColorOverride):y.evenRowBackgroundColorOverride&&(g.style.backgroundColor=y.evenRowBackgroundColorOverride),l.push(g),[]),m=0,C=M.length;m<C;m++){var v,w=M[m];if(v=1,h&&h.columns&&"*"===(v=(w=h.columns[w.id]||h.columns[m])&&w.colspan||1)&&(v=C-m),ke[Math.min(C-1,m+v-1)]>u.leftPx){if(Me[m]>u.rightPx)break;st(f,d,m,v,p)}1<v&&(m+=v-1)}nt(g,f),T&&k===s&&(n=!0),0}if(o.length){var b=document.createElement("div");nt(b,i);for(s=0,r=o.length;s<r;s++)D[o[s]].rowNode=t.appendChild(b.firstChild);n&&(T=A(k,I))}}function bt(){y.enableAsyncPostRender}function yt(e){delete De[e],Fe=Math.min(Fe,e),xe=Math.max(xe,e),bt()}function L(){var e,t;p&&(e=ft(),rt(t=mt()),we!=v&&vt(t),wt(t),Fe=e.top,xe=Math.min(Ye()-1,e.bottom),bt(),ve=C,we=v,Te=null)}function _t(){var e=Q[0].scrollLeft;e!=l[0].scrollLeft&&(l[0].scrollLeft=e)}function St(){C=l[0].scrollTop,v=l[0].scrollLeft;var e,t=Math.abs(C-Ce),i=Math.abs(v-be);i&&(be=v,z[0].scrollLeft=v,Y[0].scrollLeft=v,Q[0].scrollLeft=v),t&&(Ce=C,t<d?et(C+c):(e=c,pe=s==d?0:Math.min($-1,Math.floor(C*((a-d)/(s-d))*(1/G))),e!=(c=Math.round(pe*U))&&lt())),(i||t)&&(Te&&clearTimeout(Te),20<Math.abs(ve-C)||20<Math.abs(we-v))&&(y.forceSyncScrolling||Math.abs(ve-C)<d&&Math.abs(we-v)<u?L():Te=setTimeout(L,50),E(f.onViewportChanged,{})),E(f.onScroll,{scrollLeft:v,scrollTop:C})}function Rt(e,t){var i,o,n,a,s;for(s in D){if(a=t&&t[s],n=e&&e[s],a)for(o in a)n&&a[o]==n[o]||(i=A(s,V(o)))&&Di(i).removeClass(a[o]);if(n)for(o in n)a&&a[o]==n[o]||(i=A(s,V(o)))&&Di(i).addClass(n[o])}}function Mt(e,t){var i=w[e];Rt(w[e]=t,i),E(f.onCellCssStylesChanged,{key:e,hash:t})}function kt(e){e=Di(e.target).closest(".slick-row")[0];e!=i&&(de&&de!=e&&(S[0].removeChild(de),de=null),i=e)}function It(e,t){var i=zt(e);return!(!i||!Ut(i.row,i.cell)||(i=E(f.onDragInit,t,e),!e.isImmediatePropagationStopped()))&&i}function Tt(e,t){var i=zt(e);return!(!i||!Ut(i.row,i.cell)||(i=E(f.onDragStart,t,e),!e.isImmediatePropagationStopped()))&&i}function Dt(e,t){return E(f.onDrag,t,e)}function xt(e,t){E(f.onDragEnd,t,e)}function Ft(e){E(f.onKeyDown,{row:k,cell:I},e);var t=e.isImmediatePropagationStopped();if(!t)if(e.shiftKey||e.altKey||e.ctrlKey)9!=e.which||!e.shiftKey||e.ctrlKey||e.altKey||(t=_i());else if(27==e.which){if(!O().isActive())return;ei()}else if(34==e.which)ri(),t=!0;else if(33==e.which)li(),t=!0;else if(35==e.which){if(O().isActive())return;si(1e10),t=!0}else if(36==e.which){if(O().isActive())return;si(-1e10),t=!0}else 37==e.which?t=vi():39==e.which?t=Ci():38==e.which?t=bi():40==e.which?t=wi():9==e.which?t=yi():13==e.which&&(y.editable&&(m?(k===N()?wi:Zt)():O().commitCurrentEdit()&&Jt()),t=!0);if(E(f.onKeyDownDone,{row:k,cell:I},e,!0),t){e.stopPropagation(),e.preventDefault();try{e.originalEvent.keyCode=0}catch(e){}}}function Et(e){Vt(e);var t=zt(e);!t||null!==m&&k==t.row&&I==t.cell||(E(f.onClick,{row:t.row,cell:t.cell},e),e.isImmediatePropagationStopped()||!B(t.row,t.cell)||O().isActive()&&!O().commitCurrentEdit()||(ai(t.row,!1),Yt(A(t.row,t.cell))),E(f.onClickDone,{row:t.row,cell:t.cell},e,!0))}function Ot(e){Vt(e)}function Vt(e){m||e.target==document.activeElement&&!Di(e.target).hasClass("slick-cell")||Qt()}function Nt(e){var t=Di(e.target).closest(".slick-cell",S);0===t.length||T===t[0]&&null!==m||E(f.onContextMenu,{},e)}function Lt(e){var t=zt(e);!t||null!==m&&k==t.row&&I==t.cell||(E(f.onDblClick,{row:t.row,cell:t.cell},e),e.isImmediatePropagationStopped())||y.editable&&Mi(t.row,t.cell,!0)}function Pt(e){E(f.onHeaderMouseEnter,{column:Di(this).data("column")},e)}function At(e){E(f.onHeaderMouseLeave,{column:Di(this).data("column")},e)}function Bt(e){var t=Di(e.target).closest(".slick-header-column",".slick-header-columns"),t=t&&t.data("column");E(f.onHeaderContextMenu,{column:t},e)}function Ht(e){var t=Di(e.target).closest(".slick-header-column",".slick-header-columns"),t=t&&t.data("column");t&&E(f.onHeaderClick,{column:t},e)}function Gt(e){E(f.onMouseEnter,{},e)}function $t(e){E(f.onMouseLeave,{},e)}function Ut(e,t){return!(e<0||e>=N()||t<0||t>=M.length)}function Wt(e){var t=/l\d+/.exec(e.className);if(t)return parseInt(t[0].substr(1,t[0].length-1),10);throw"getCellFromNode: cannot get cell - "+e.className}function Kt(e){for(var t in D)if(D[t].rowNode===e)return 0|t;return null}function zt(e){var t,e=Di(e.target).closest(".slick-cell",S);return!e.length||(t=Kt(e[0].parentNode),e=Wt(e[0]),null==t)||null==e?null:{row:t,cell:e}}function jt(){Yt(null,!1)}function Qt(){(-1==t?W:K)[0].focus()}function qt(e,t,i){ai(e,i);i=di(e,t),e=Me[t],t=ke[t+(1<i?i-1:0)],i=v+u;e<v?(l.scrollLeft(e),St(),L()):i<t&&(l.scrollLeft(Math.min(e,t-l[0].clientWidth)),St(),L())}function Yt(e,t){null!==T&&(P(),Di(T).removeClass("active"),D[k])&&Di(D[k].rowNode).removeClass("active");var i=T!==e;null!=(T=e)?(k=Kt(T.parentNode),I=ae=Wt(T),null==t&&(t=k==N()||y.autoEdit),Di(T).addClass("active"),Di(D[k].rowNode).addClass("active"),y.editable&&t&&Xt(k,I)&&(clearTimeout(Ie),y.asyncEditorLoading?Ie=setTimeout(function(){Jt()},y.asyncEditorLoadDelay):Jt())):k=I=null,i&&E(f.onActiveCellChanged,ni())}function Xt(e,t){var i=N();return!(e<i&&!Xe(e)||M[t].cannotTriggerInsert&&i<=e||!it(e,t))}function P(){if(m){var e,t,i;if(E(f.onBeforeCellEditorDestroy,{editor:m}),m.destroy(),m=null,T&&(e=Xe(k),Di(T).removeClass("editable invalid"),e)&&(t=M[I],i=tt(k,t),at(T),T.appendChild(i(k,I,ot(e,t),t,e)),yt(k)),navigator.userAgent.toLowerCase().match(/msie/))if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(e){}else window.getSelection&&(i=window.getSelection())&&i.removeAllRanges&&i.removeAllRanges();O().deactivate(re)}}function Jt(e){if(T){if(!y.editable)throw"Grid : makeActiveCellEditable : should never get called when options.editable is false";var t,i;clearTimeout(Ie),Xt(k,I)&&(t=M[I],i=Xe(k),!1===E(f.onBeforeEditCell,{row:k,cell:I,item:i,column:t})?Qt():(O().activate(re),Di(T).addClass("editable"),e||at(T),m=new(e||it(k,I))({grid:f,gridPosition:ti(r[0]),position:ti(T),container:T,column:t,item:i||{},commitChanges:Zt,cancelChanges:ei}),i&&m.loadValue(i),se=m.serializeValue(),m.position&&oi()))}}function Zt(){O().commitCurrentEdit()&&(Qt(),y.autoEdit)&&Ci()}function ei(){O().cancelCurrentEdit()&&Qt()}function ti(e){for(var t={top:e.offsetTop,left:e.offsetLeft,bottom:0,right:0,width:Di(e).outerWidth(),height:Di(e).outerHeight(),visible:!0},i=(t.bottom=t.top+t.height,t.right=t.left+t.width,e.offsetParent);(e=e.parentNode)!=document.body;)t.visible&&e.scrollHeight!=e.offsetHeight&&"visible"!=Di(e).css("overflowY")&&(t.visible=t.bottom>e.scrollTop&&t.top<e.scrollTop+e.clientHeight),t.visible&&e.scrollWidth!=e.offsetWidth&&"visible"!=Di(e).css("overflowX")&&(t.visible=t.right>e.scrollLeft&&t.left<e.scrollLeft+e.clientWidth),t.left-=e.scrollLeft,t.top-=e.scrollTop,e===i&&(t.left+=e.offsetLeft,t.top+=e.offsetTop,i=e.offsetParent),t.bottom=t.top+t.height,t.right=t.left+t.width;return t}function ii(){return ti(T)}function oi(){var e;T&&(E(f.onActiveCellPositionChanged,{}),m)&&(e=ii(),m.show&&m.hide&&(e.visible?m.show():m.hide()),m.position)&&m.position(e)}function ni(){return T?{row:k,cell:I}:null}function ai(e,t){var i=e*y.rowHeight,o=(e+1)*y.rowHeight-d+(oe?xi.height:0);(e+1)*y.rowHeight>C+d+c?(et(t?i:o),L()):e*y.rowHeight<C+c&&(et(t?o:i),L())}function si(e){e*=le;if(et((Ze(C)+e)*y.rowHeight),L(),y.enableCellNavigation&&null!=k){for(var t=k+e,e=Ye(),i=((t=e<=t?e-1:t)<0&&(t=0),0),o=null,e=ae;i<=ae;)B(t,i)&&(o=i),i+=di(t,i);null!==o?(Yt(A(t,o)),ae=e):jt()}}function ri(){si(1)}function li(){si(-1)}function di(e,t){var e=R.getItemMetadata&&R.getItemMetadata(e);return e&&e.columns?"*"===(e=(e=e.columns[M[t].id]||e.columns[t])&&e.colspan)?M.length-t:e||1:1}function ui(e){for(var t=0;t<M.length;){if(B(e,t))return t;t+=di(e,t)}return null}function ci(e,t,i){if(t>=M.length)return null;for(;(t+=di(e,t))<M.length&&!B(e,t););return t<M.length?{row:e,cell:t,posX:t}:null}function pi(e,t,i){if(t<=0)return null;var o=ui(e);if(null===o||t<=o)return null;for(var n,a={row:e,cell:o,posX:o};;){if(!(n=ci(a.row,a.cell,a.posX)))return null;if(n.cell>=t)return a;a=n}}function hi(e,t,i){for(var o,n=Ye();;){if(++e>=n)return null;for(o=t=0;t<=i;)t+=di(e,o=t);if(B(e,o))return{row:e,cell:o,posX:i}}}function gi(e,t,i){for(var o;;){if(--e<0)return null;for(o=t=0;t<=i;)t+=di(e,o=t);if(B(e,o))return{row:e,cell:o,posX:i}}}function fi(e,t,i){if(null==e&&null==t&&B(e=t=0,t))return{row:e,cell:t,posX:t};t=ci(e,t);if(t)return t;for(var o,n=Ye();++e<n;)if(null!==(o=ui(e)))return{row:e,cell:o,posX:o};return null}function mi(e,t,i){if(null==e&&null==t&&B(e=Ye()-1,t=M.length-1))return{row:e,cell:t,posX:t};for(var o,n;!o&&!(o=pi(e,t));){if(--e<0)return null;t=0,null!==(n=function(e){for(var t=0,i=null;t<M.length;)B(e,t)&&(i=t),t+=di(e,t);return i}(e))&&(o={row:e,cell:n,posX:n})}return o}function Ci(){return Si("right")}function vi(){return Si("left")}function wi(){return Si("down")}function bi(){return Si("up")}function yi(){return Si("next")}function _i(){return Si("prev")}function Si(e){if(!y.enableCellNavigation)return!1;if(!T&&"prev"!=e&&"next"!=e)return!1;if(!O().commitCurrentEdit())return!0;if(null===k||null===I)return!1;Qt();t={up:-1,down:1,left:-1,right:1,prev:-1,next:1}[e];e=(0,{up:gi,down:hi,left:pi,right:ci,prev:mi,next:fi}[e])(k,I,ae);return e?(qt(e.row,e.cell,!1),Yt(A(e.row,e.cell)),ae=e.posX,!0):(Yt(A(k,I)),!1)}function A(e,t){return D[e]?(Ct(e),D[e].cellNodesByColumnIdx[t]):null}function B(e,t){return!(!y.enableCellNavigation||e>=Ye()||e<0||t>=M.length||t<0)&&((e=R.getItemMetadata&&R.getItemMetadata(e))&&"boolean"==typeof e.focusable?e:(e=e&&e.columns)&&e[M[t].id]&&"boolean"==typeof e[M[t].id].focusable?e[M[t].id]:(e&&e[t]&&"boolean"==typeof e[t].focusable?e:M)[t]).focusable}function Ri(e,t){return!(e>=N()||e<0||t>=M.length||t<0)&&((e=R.getItemMetadata&&R.getItemMetadata(e))&&"boolean"==typeof e.selectable?e:(e=e&&e.columns&&(e.columns[M[t].id]||e.columns[t]))&&"boolean"==typeof e.selectable?e:M[t]).selectable}function Mi(e,t,i){p&&B(e,t)&&O().commitCurrentEdit()&&(qt(e,t,!1),Yt(A(e,t),i||e===N()||y.autoEdit),m||Qt())}function ki(){var e,t,i=Xe(k),o=M[I];if(m){if(m.isValueChanged())return(e=m.validate()).valid?(k<N()?(t={row:k,cell:I,editor:m,serializedValue:m.serializeValue(),prevSerializedValue:se,execute:function(){this.editor.applyValue(i,this.serializedValue),pt(this.row),E(f.onCellChange,{row:k,cell:I,item:i})},undo:function(){this.editor.applyValue(i,this.prevSerializedValue),pt(this.row),E(f.onCellChange,{row:k,cell:I,item:i})}},y.editCommandHandler?(P(),y.editCommandHandler(i,o,t)):(t.execute(),P())):(m.applyValue(t={},m.serializeValue()),P(),E(f.onAddNewRow,{item:t,column:o})),!O().isActive()):(Di(T).removeClass("invalid"),Di(T).width(),Di(T).addClass("invalid"),E(f.onValidationError,{editor:m,cellNode:T,validationResults:e,row:k,cell:I,column:o}),m.focus(),!1);P()}return!0}function Ii(){return P(),!0}function Ti(){if(o)return ye;throw"Selection model is not set"}Di.extend(this,{slickGridVersion:"2.1",onScroll:new Slick.Event,onSort:new Slick.Event,onHeaderMouseEnter:new Slick.Event,onHeaderMouseLeave:new Slick.Event,onHeaderContextMenu:new Slick.Event,onHeaderClick:new Slick.Event,onHeaderCellRendered:new Slick.Event,onBeforeHeaderCellDestroy:new Slick.Event,onHeaderRowCellRendered:new Slick.Event,onBeforeHeaderRowCellDestroy:new Slick.Event,onMouseEnter:new Slick.Event,onMouseLeave:new Slick.Event,onClick:new Slick.Event,onClickDone:new Slick.Event,onDblClick:new Slick.Event,onContextMenu:new Slick.Event,onKeyDown:new Slick.Event,onKeyDownDone:new Slick.Event,onAddNewRow:new Slick.Event,onValidationError:new Slick.Event,onViewportChanged:new Slick.Event,onColumnsReorderStart:new Slick.Event,onBeforeColumnsReordered:new Slick.Event,onColumnsReordered:new Slick.Event,onColumnsResized:new Slick.Event,onCellChange:new Slick.Event,onBeforeEditCell:new Slick.Event,onBeforeCellEditorDestroy:new Slick.Event,onBeforeDestroy:new Slick.Event,onActiveCellChanged:new Slick.Event,onActiveCellPositionChanged:new Slick.Event,onDragInit:new Slick.Event,onDragStart:new Slick.Event,onDrag:new Slick.Event,onDragEnd:new Slick.Event,onSelectedRowsChanged:new Slick.Event,onCellCssStylesChanged:new Slick.Event,registerPlugin:function(e){_e.unshift(e),e.init(f)},unregisterPlugin:Ve,getColumns:function(){return M},setColumns:Qe,getColumnIndex:V,updateColumnHeader:function(e,t,i){var o,n;p&&null!=(e=V(e))&&(o=M[e],n=h.children(":not(.slick-sortable-placeholder):not(.ui-sortable-helper)").eq(e))&&(void 0!==t&&(M[e].name=t),void 0!==i&&(M[e].toolTip=i),E(f.onBeforeHeaderCellDestroy,{node:n[0],column:o}),n.attr("title",i||"").children().eq(0).html(t),E(f.onHeaderCellRendered,{node:n[0],column:o}))},setSortColumn:function(e,t){Ke([{columnId:e,sortAsc:t}])},setSortColumns:Ke,getSortColumns:function(){return b},autosizeColumns:$e,getOptions:function(){return y},setOptions:function(e){O().commitCurrentEdit()&&(P(),y.enableAddRow!==e.enableAddRow&&ct(N()),y=Di.extend(y,e),qe(),l.css("overflow-y",y.autoHeight?"hidden":"auto"),L())},getData:function(){return R},getDataLength:N,getDataItem:Xe,setData:function(e,t){R=e,lt(),gt(),t&&et(0)},getSelectionModel:function(){return o},setSelectionModel:function(e){o&&(o.onSelectedRangesChanged.unsubscribe(ze),o.destroy)&&o.destroy(),(o=e)&&(o.init(f),o.onSelectedRangesChanged.subscribe(ze))},getSelectedRows:Ti,setSelectedRows:function(e,t,i){if(!o)throw"Selection model is not set";o.setSelectedRanges(function(e,t){for(var i=[],o=0,n=M.length-1,a=0;a<e.length;a++)t&&t.length&&(o=n=t[a]),i.push(new Slick.Range(e[a],o,e[a],n));return i}(e,t),i)},getContainerNode:function(){return r.get(0)},reset_prevScrollLeft:function(){be=-1},render:L,invalidate:function(){gt(),lt(),L()},invalidateRow:ct,invalidateRows:ut,invalidateAllRows:lt,updateCell:function(e,t){var i,o,n=A(e,t);n&&(i=M[t],o=Xe(e),m&&k===e&&I===t?m.loadValue(o):o instanceof Slick.NonDataRow||(at(n),o&&n.appendChild(tt(e,i)(e,t,ot(o,i),i,o)),yt(e)))},updateRow:pt,getViewport:ft,getRenderedRange:mt,resizeCanvas:ht,updateRowCount:gt,scrollRowIntoView:ai,scrollRowToTop:function(e){et(e*y.rowHeight),L()},scrollCellIntoView:qt,getCanvasNode:function(){return S[0]},focus:Qt,getCellFromPoint:function(e,t){for(var t=Ze(t),i=0,o=0,n=0;n<M.length&&o<e;n++)o+=M[n].width,i++;return{row:t,cell:(i=i<0?0:i)-1}},getCellFromEvent:zt,getActiveCell:ni,setActiveCell:function(e,t){!p||e>N()||e<0||t>=M.length||t<0||y.enableCellNavigation&&(qt(e,t,!1),Yt(A(e,t),!1))},getActiveCellNode:function(){return T},getActiveCellPosition:ii,resetActiveCell:jt,editActiveCell:Jt,getCellEditor:function(){return m},getCellNode:A,getCellNodeBox:function(e,t){if(!Ut(e,t))return null;for(var i=(e=Je(e))+y.rowHeight-1,o=0,n=0;n<t;n++)o+=M[n].width;return{top:e,left:o,bottom:i,right:o+M[t].width}},canCellBeSelected:Ri,canCellBeActive:B,navigatePrev:_i,navigateNext:yi,navigateUp:bi,navigateDown:wi,navigateLeft:vi,navigateRight:Ci,navigatePageUp:li,navigatePageDown:ri,gotoCell:Mi,getTopPanel:function(){return X[0]},getHeaderRow:function(){return j[0]},getHeaderRowColumn:function(e){return e=V(e),(e=j.children().eq(e))&&e[0]},getGridPosition:function(){return ti(r[0])},addCellCssStyles:function(e,t){if(w[e])throw"addCellCssStyles: cell CSS hash with key '"+e+"' already exists.";Rt(w[e]=t,null),E(f.onCellCssStylesChanged,{key:e,hash:t})},setCellCssStyles:Mt,removeCellCssStyles:function(e){w[e]&&(Rt(null,w[e]),delete w[e],E(f.onCellCssStylesChanged,{key:e,hash:null}))},getCellCssStyles:function(e){return w[e]},getUID:function(){return g},getNumVisibleRows:function(){return le},init:Oe,destroy:function(){O().cancelCurrentEdit(),E(f.onBeforeDestroy,{});for(var e=_e.length;e--;)Ve(_e[e]);y.enableColumnReorder&&h.filter(":ui-sortable").sortable("destroy"),Z&&(Z.unbind("scroll."+g),Z=null),r.unbind(".slickgrid"),Ge(),S.unbind("draginit dragstart dragend drag"),r.empty().removeClass(g)},getEditorLock:O,getEditController:function(){return re}}),function(){if((r=Di(H)).length<1)throw new Error("SlickGrid requires a valid container, "+H+" does not exist in the DOM.");var e,t;Fi=Fi||function(){var e=1e6,t=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,i=Di("<div style='display:none' />").appendTo(document.body);for(;;){var o=2*e;if(i.css("height",o),t<o||i.height()!==o)break;e=o}return i.remove(),e}(),xi=xi||(e=Di("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo(r),t={width:e.width()-e[0].clientWidth,height:e.height()-e[0].clientHeight},e.remove(),t),y=Di.extend({},ue,y),qe(),ce.width=y.defaultColumnWidth,Se={};for(var i=0;i<M.length;i++){var o=M[i]=Di.extend({},ce,M[i]);Se[o.id]=i,x.push(o.width),o.maxWidth&&o.width>o.maxWidth&&(o.width=o.maxWidth)}if(y.enableColumnReorder&&!Di.fn.sortable)throw new Error("SlickGrid's 'enableColumnReorder = true' option requires jquery-ui.sortable module to be loaded");re={commitCurrentEdit:ki,cancelCurrentEdit:Ii},r.empty().css("overflow","hidden").css("outline",0).addClass(g).addClass("ui-widget"),y.fontFamily?r.css("font-family",y.fontFamily):r.css("font-family",""),y.fontSize?r.css("font-size",y.fontSize):r.css("font-size",""),/relative|absolute|fixed/.test(r.css("position"))||r.css("position","relative"),W=Di("<div tabIndex='0' hideFocus style='position:fixed;width:0;height:0;top:0;left:0;outline:0;'></div>").appendTo(r),z=Di("<div class='slick-header ui-state-default' style='overflow:hidden;position:relative;' />").appendTo(r),(h=Di("<div class='slick-header-columns' style='left:-1000px' />").appendTo(z)).width(Ne()),Q=Di("<div class='slick-headerrow ui-state-default' style='overflow:hidden;position:relative;' />").appendTo(r),j=Di("<div class='slick-headerrow-columns' />").appendTo(Q),q=Di("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").css("width",Le()+xi.width+"px").appendTo(Q),Y=Di("<div class='slick-top-panel-scroller ui-state-default' style='overflow:hidden;position:relative;' />").appendTo(r),X=Di("<div class='slick-top-panel' style='width:10000px' />").appendTo(Y),y.showTopPanel||Y.hide(),y.showHeaderRow&&(!y.showHeaderRow||y.isHeaderRowVisible)||Q.hide(),(l=Di("<div class='slick-viewport' style='width:100%;overflow:auto;outline:0;position:relative;;'>").appendTo(r)).css("overflow-y",y.autoHeight?"hidden":"auto"),S=Di("<div class='grid-canvas' />").appendTo(l),K=W.clone().appendTo(r),y.explicitInitialization||Oe()}()}}}),(q=jQuery).extend(!0,window,{Slick:{Data:{DataView:function(n){var o,a,s,B,H,r=this,u="id",l=[],d=[],c={},p=null,h=null,g=null,f=!1,m=!1,C=!0,v={},w={},b=[],y=[],i=null,G={getter:null,formatter:null,comparer:function(e,t){return e.value-t.value},predefinedValues:[],aggregators:[],aggregateEmpty:!1,aggregateCollapsed:!1,aggregateChildGroups:!1,collapsed:!1,displayTotalsRow:!0,lazyTotalsCalculation:!1},S=[],R=[],M=[],k=":|:",I=0,T=0,D=0,x=new Slick.Event,F=new Slick.Event,E=new Slick.Event,O=(n=q.extend(!0,{},{groupItemMetadataProvider:null,inlineFilters:!1},n)).atomizeTemporal||_.identity;function V(e){if(!m)for(var t,i=e=e||0,o=l.length;i<o;i++){if(void 0===(t=l[i][u]))throw"Each data element must implement a unique 'id' property";c[O(t)]=i}}function N(){var e=I?Math.max(1,Math.ceil(D/I)):1;return{pageSize:I,pageNum:T,totalRows:D,totalPages:e}}function e(e,t,i){C=t,a=e,o=null,i||(!1===t&&l.reverse(),l.sort(e),!1===t&&l.reverse(),c={},V(),A())}function t(e,t){C=t,o=e,a=null;var i=Object.prototype.toString;Object.prototype.toString="function"==typeof e?e:function(){return this[e]},!1===t&&l.reverse(),l.sort(),Object.prototype.toString=i,!1===t&&l.reverse(),c={},V(),A()}function $(){if(!p){p={};for(var e=0,t=d.length;e<t;e++)p[d[e][u]]=e}}function U(e,t){if(null==e)for(var i=0;i<S.length;i++)M[i]={},S[i].collapsed=t;else M[e]={},S[e].collapsed=t;A()}function L(e,t,i){M[e][t]=S[e].collapsed^i,A()}function P(e){var t,i=e.group,o=S[i.level],n=i.level==S.length,a=o.aggregators.length;if(!n&&o.aggregateChildGroups)for(var s=i.groups.length;s--;)i.groups[s].initialized||P(i.groups[s]);for(;a--;)(t=o.aggregators[a]).init(),!n&&o.aggregateChildGroups?o.compiledAccumulators[a].call(t,i.groups):o.compiledAccumulators[a].call(t,i.rows),t.storeResult(e);e.initialized=!0}function W(e,t){for(var i,o,n,a,s=S[t=t||0],r=s.collapsed,l=M[t],d=e.length;d--;)(i=e[d]).collapsed&&!s.aggregateCollapsed||(i.groups&&W(i.groups,t+1),s.aggregators.length&&(s.aggregateEmpty||i.rows.length||i.groups&&i.groups.length)&&(a=n=void 0,n=S[(o=i).level],((a=new Slick.GroupTotals).group=o).totals=a,n.lazyTotalsCalculation||P(a)),i.collapsed=r^l[i.groupingKey],i.title=s.formatter?s.formatter(i):i.value)}function K(e,t){for(var i=[],o=0,n=0,a=e.length;n<a;n++)h(e[n],t)&&(i[o++]=e[n]);return i}function z(e,t,i){for(var o,n=[],a=0,s=0,r=e.length;s<r;s++)o=e[s],i[s]?n[a++]=o:h(o,t)&&(n[a++]=o,i[s]=!0);return n}function j(e,t){var i,o;return h?(i=n.inlineFilters?B:K,o=n.inlineFilters?H:z,v.isFilterNarrowing?b=i(b,s):v.isFilterExpanding?b=o(e,s,y):v.isFilterUnchanged||(b=i(e,s))):b=I?e:e.concat(),o=!t&&I?(b.length<T*I&&(T=Math.floor(b.length/I)),b.slice(I*T,I*T+I)):b,{totalRows:b.length,rows:o}}function Q(e){p=null,v.isFilterNarrowing==w.isFilterNarrowing&&v.isFilterExpanding==w.isFilterExpanding||(y=[]);var e=j(e),e=(D=e.totalRows,e.rows),t=(R=[],S.length&&(R=function e(t,i){for(var o,n,a,s=[],r={},l=i?i.level+1:0,d=S[l],u=0,c=d.predefinedValues.length;u<c;u++)(o=r[n=d.predefinedValues[u]])||((o=new Slick.Group).value=n,o.level=l,o.groupingKey=(i?i.groupingKey+k:"")+n,s[s.length]=o,r[n]=o);for(u=0,c=t.length;u<c;u++)a=t[u],(o=r[n=d.getterIsAFn?d.getter(a):a[d.getter]])||((o=new Slick.Group).value=n,o.level=l,o.groupingKey=(i?i.groupingKey+k:"")+n,s[s.length]=o,r[n]=o),o.rows[o.count++]=a;if(l<S.length-1)for(u=0;u<s.length;u++)(o=s[u]).groups=e(o.rows,o);return s.sort(S[l].comparer),s}(e)).length&&(W(R),e=function e(t,i){for(var o,n=S[i=i||0],a=[],s=0,r=0,l=t.length;r<l;r++){if(o=t[r],!(a[s++]=o).collapsed)for(var d,u=0,c=(d=o.groups?e(o.groups,i+1):o.rows).length;u<c;u++)a[s++]=d[u];o.totals&&n.displayTotalsRow&&(!o.collapsed||n.aggregateCollapsed)&&(a[s++]=o.totals)}return a}(R)),function(e,t){var i,o,n,a=[],s=0,r=t.length;q.grep(t,function(e){return!e.__group}).length,v&&v.ignoreDiffsBefore&&(s=Math.max(0,Math.min(t.length,v.ignoreDiffsBefore))),v&&v.ignoreDiffsAfter&&(r=Math.min(t.length,Math.max(0,v.ignoreDiffsAfter)));for(var l=s,d=e.length;l<r;l++)(d<=l||(i=t[l],o=e[l],S.length&&(n=i.__nonDataRow||o.__nonDataRow)&&i.__group!==o.__group)||i.__group&&!i.equals(o)||n&&(i.__groupTotals||o.__groupTotals)||i[u]!=o[u]||g&&g[i[u]])&&(a[a.length]=l);return a}(d,e));return d=e,t}function A(){var e,t,i;!f&&(e=d.length,t=D,i=Q(l),I&&D<T*I&&(T=Math.max(0,Math.ceil(D/I)-1),i=Q(l)),g=null,w=v,v={},t!=D&&E.notify(N(),null,r),e!=d.length&&x.notify({previous:e,current:d.length},null,r),0<i.length||t!=D||e!=d.length)&&F.notify({rows:i},null,r)}q.extend(this,{beginUpdate:function(){f=!0},endUpdate:function(){f=!1,A()},suspendIndexing:function(){m=!0,i={}},reactivateIndexing:function(e){m=!1,_.isEmpty(i)||(l=_.reject(l,function(e,t){return i[t]}),i=null),e||V()},setPagingOptions:function(e){null!=e.pageSize&&(I=e.pageSize,T=I?Math.min(T,Math.max(0,Math.ceil(D/I)-1)):0),null!=e.pageNum&&(T=Math.min(e.pageNum,Math.max(0,Math.ceil(D/I)-1))),E.notify(N(),null,r),A()},getPagingInfo:N,getItems:function(){return l},setItems:function(e,t){void 0!==t&&(u=t),l=b=e,c={},V();for(var i,o=0,n=l.length;o<n;o++)if(i=l[o][u],void 0===(i=O(i))||c[i]!==o)throw"Each data element must implement a unique 'id' property";A()},setFilter:function(e){h=e,A()},sort:e,fastSort:t,reSort:function(){a?e(a,C):o&&t(o,C)},setGrouping:function(e){n.groupItemMetadataProvider||(n.groupItemMetadataProvider=new Slick.Data.GroupItemMetadataProvider),R=[],M=[],S=(e=e||[])instanceof Array?e:[e];for(var t=0;t<S.length;t++){for(var i=S[t]=q.extend(!0,{},G,S[t]),o=(i.getterIsAFn="function"==typeof i.getter,i.compiledAccumulators=[],i.aggregators.length);o--;)i.compiledAccumulators[o]=function(e){e=function(e){e=e.toString().match(/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/);return{params:e[1].split(","),body:e[2]}}(e.accumulate),e=new Function("_items","for (var "+e.params[0]+", _i=0, _il=_items.length; _i<_il; _i++) {"+e.params[0]+" = _items[_i]; "+e.body+"}");return e.displayName=e.name="compiledAccumulatorLoop",e}(i.aggregators[o]);M[t]={}}A()},getGrouping:function(){return S},collapseAllGroups:function(e){U(e,!0)},expandAllGroups:function(e){U(e,!1)},collapseGroup:function(e){var t=Array.prototype.slice.call(arguments),i=t[0];1==t.length&&-1!=i.indexOf(k)?L(i.split(k).length-1,i,!0):L(t.length-1,t.join(k),!0)},expandGroup:function(e){var t=Array.prototype.slice.call(arguments),i=t[0];1==t.length&&-1!=i.indexOf(k)?L(i.split(k).length-1,i,!1):L(t.length-1,t.join(k),!1)},filterRows:function(e){return j(e,!0).rows},getFilteredItems:function(){return b},getGroups:function(){return R},getIdxById:function(e){return c[O(e)]},getInternalMap_idxById:function(){return c},getRowById:function(e){return $(),p[e]},getItemById:function(e){return l[c[O(e)]]},getItemByIdx:function(e){return l[e]},extractIds:function(e){for(var t=[],i=0,o=e.length;i<o;i++)t[t.length]=e[i][u];return t},getOptions:function(){return n},mapRowsToIds:function(e){for(var t=[],i=0,o=e.length;i<o;i++)e[i]<d.length&&(t[t.length]=d[e[i]][u]);return t},mapIdsToRows:function(e){var t=[];$();for(var i=0,o=e.length;i<o;i++){var n=p[e[i]];null!=n&&(t[t.length]=n)}return t},setRefreshHints:function(e){v=e},setFilterArgs:function(e){s=e},refresh:A,updateItem:function(e,t){var i=O(e);if(void 0===c[i]||i!==O(t[u]))throw"Invalid or non-matching id";l[c[i]]=t,(g=g||{})[e]=!0,A()},updateItem_unchecked_noRefresh:function(e,t){var i;t&&(i=O(e),l[c[i]]=t),(g=g||{})[e]=!0},insertItem:function(e,t){l.splice(e,0,t),V(e),A()},addItem:function(e){l.push(e),V(l.length-1),A()},deleteItem:function(e){e=O(e);var t=c[e];void 0===t?console.log("slickgrid.deleteItem: Invalid id, item does not exist",e):(delete c[e],m?i[t]=!0:l.splice(t,1),V(t),A())},syncGridSelection:function(o,t,n){var a,s=this,r=[],i=new Slick.Event;function l(e){r.join(",")!=e.join(",")&&(r=e,i.notify({grid:o,ids:r},new Slick.EventData,s))}function d(){a=!0;var e=s.mapIdsToRows(r);t||l(s.mapRowsToIds(e)),o.setSelectedRows(e),a=!1}return o.onSelectedRowsChanged.subscribe(function(e,t){var i;a||(i=s.mapRowsToIds(o.getSelectedRows()),_.pull(i,void 0),n&&o.getOptions().multiSelect&&e.rememberHidden?l(q.grep(r,function(e){return void 0===s.getRowById(e)}).concat(i)):l(i))}),this.onRowsChanged.subscribe(d),this.onRowCountChanged.subscribe(d),this.selectionSyncHelper={addSelectedIds:function(e){l(_.union(r,e)),d()},getSelectedIds:function(){return r},onSelectedRowIdsChanged:i,removeSelectedIds:function(e){l(_.difference(r,e)),d()},setSelectedIds:function(e){l(e),d()}},i},getLength:function(){return d.length},getItem:function(e){var t;return(e=d[e])&&e.__group&&e.totals&&!e.totals.initialized?(t=S[e.level]).displayTotalsRow||(P(e.totals),e.title=t.formatter?t.formatter(e):e.value):e&&e.__groupTotals&&!e.initialized?P(e):!n.populateItem||e instanceof Slick.NonDataRow||(e=n.populateItem(e)),e},getItemMetadata:function(e){return void 0===(e=d[e])?null:e.__group?n.groupItemMetadataProvider.getGroupRowMetadata(e):e.__groupTotals?n.groupItemMetadataProvider.getTotalsRowMetadata(e):null},onRowCountChanged:x,onRowsChanged:F,onPagingInfoChanged:E})},Aggregators:{}}}}),(ce=jQuery).extend(!0,window,{Slick:{CellRangeDecorator:function(i,o){var n;o=ce.extend(!0,{},{selectionCssClass:"slick-range-decorator",selectionCss:{zIndex:"9999",border:"2px dashed red"}},o),ce.extend(this,{show:function(e){n=n||ce("<div></div>",{css:o.selectionCss}).addClass(o.selectionCssClass).css("position","absolute").appendTo(i.getCanvasNode());var t=i.getCellNodeBox(e.fromRow,e.fromCell),e=i.getCellNodeBox(e.toRow,e.toCell);return n.css({top:t.top,left:t.left,height:e.bottom-t.top+1,width:e.right-t.left}),n},hide:function(){n&&(n.remove(),n=null)}})}}}),(C=jQuery).extend(!0,window,{Slick:{CellRangeSelector:function(t){var o,n,a,s,r,l,d=this,i=new Slick.EventHandler,u={selectionCss:{border:"2px dashed blue"}};function c(e){return o.getCellFromPoint(r?1e10:e.pageX-C(n).offset().left,e.pageY-C(n).offset().top)}function p(e,t){var i=o.getActiveCell();e.shiftKey?(e.stopImmediatePropagation(),e={start:l||i,end:i},d.onCellRangeSelected.notify({range:new Slick.Range(e.start.row,e.start.cell,e.end.row,e.end.cell),desc:e.end.row<e.start.row})):l=i}function h(e,t){e.stopImmediatePropagation()}function g(e,t){var i=o.getCellFromEvent(e);if(!1!==d.onBeforeCellRangeSelected.notify(i)&&o.canCellBeSelected(i.row,i.cell)&&(a=!0,e.stopImmediatePropagation()),a)return o.focus(),i=o.getCellFromPoint(r?1:t.startX-C(n).offset().left,t.startY-C(n).offset().top),t.range={start:i,end:{}},t=c(e),s.show(new Slick.Range(i.row,i.cell,t.row,t.cell))}function f(e,t){a&&(e.stopImmediatePropagation(),e=c(e),o.canCellBeSelected(e.row,e.cell))&&(t.range.end=e,s.show(new Slick.Range(t.range.start.row,t.range.start.cell,e.row,e.cell)))}function m(e,t){a&&(a=!1,e.stopImmediatePropagation(),s.hide(),void 0===t.range.end.row&&(t.range.end=c(e)),d.onCellRangeSelected.notify({range:new Slick.Range(t.range.start.row,t.range.start.cell,t.range.end.row,t.range.end.cell),desc:t.range.end.row<t.range.start.row}))}C.extend(this,{init:function(e){t=C.extend(!0,{},u,t),s=new Slick.CellRangeDecorator(e,t),n=(o=e).getCanvasNode(),i.subscribe(o.onDragInit,h).subscribe(o.onDragStart,g).subscribe(o.onDrag,f).subscribe(o.onDragEnd,m),(r=!!t.rowMode)||i.subscribe(o.onClickDone,p)},destroy:function(){i.unsubscribeAll()},onBeforeCellRangeSelected:new Slick.Event,onCellRangeSelected:new Slick.Event})}}}),(y=jQuery).extend(!0,window,{Slick:{RowSelectionModel:function(t){var l,i,o,n,a,d=[],s=this,r=new Slick.EventHandler,u={selectActiveRow:!0};function c(e){return function(){i||(i=!0,e.apply(this,arguments),i=!1)}}function p(e){for(var t=[],i=0;i<e.length;i++)for(var o=e[i].fromRow;o<=e[i].toRow;o++)t.push(o);return t}function h(e){for(var t=[],i=l.getColumns().length-1,o=0;o<e.length;o++)t.push(new Slick.Range(e[o],0,e[o],i));return t}function g(){return p(d)}function f(e,t){d=e,t&&void 0===t.rememberHidden&&(t.rememberHidden=!!(t.ctrlKey||t.shiftKey||t.metaKey)),s.onSelectedRangesChanged.notify(d,t)}function m(e,t){o.selectActiveRow&&null!=t.row&&t.grid.canCellBeSelected(t.row,t.cell)&&f([new Slick.Range(t.row,0,t.row,l.getColumns().length-1)])}function C(e){if(l.getEditorLock().isActive())return e.stopPropagation(),!1}function v(e,t){var i=[t.range];f(i=t.desc?h(p(i).reverse()):i)}function w(e){var t,i,o=l.getActiveCell();!l.getOptions().multiSelect&&e.shiftKey||!o||!e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||38!=e.which&&40!=e.which||((i=g()).sort(function(e,t){return e-t}),t=(i=i.length?i:[o.row])[0],i=i[i.length-1],0<=(o=40==e.which?o.row<i||t==i?++i:++t:o.row<i?--i:--t)&&o<l.getDataLength()&&(l.scrollRowIntoView(o),f(d=h(function(e,t){for(var i=[],o=e;o<=t;o++)i.push(o);for(o=t;o<e;o++)i.push(o);return i}(t,i)))),e.preventDefault(),e.stopPropagation())}function b(e){var i=l.getCellFromEvent(e),t=l.getOptions().multiSelect;if(!i||!l.canCellBeActive(i.row,i.cell))return!1;if(!e.ctrlKey&&!e.shiftKey&&!e.metaKey)return!1;var o=p(d),n=y.inArray(i.row,o);if(-1===n&&(e.ctrlKey||e.metaKey))(o=t?o:[]).push(i.row),l.setActiveCell(i.row,i.cell);else if(-1!==n&&(e.ctrlKey||e.metaKey)){n=o.length;(o=y.grep(o,function(e,t){return e!==i.row})).length<n?l.resetActiveCell():l.setActiveCell(i.row,i.cell)}else if(o.length&&e.shiftKey){if(!t)return;var n=o[0],a=i.row,s=_.reduce(o,function(e,t){return e[t]=!0,e},{});if(n<=a)for(var r=n;r<=a;r++)s[r]||o.push(r);else for(r=n;a<=r;r--)s[r]||o.push(r);l.setActiveCell(i.row,i.cell)}return f(d=h(o),e),e.stopImmediatePropagation(),!0}y.extend(this,{getSelectedRows:g,setSelectedRows:function(e){f(h(e))},getSelectedRanges:function(){return d},setSelectedRanges:f,init:function(e){o=y.extend(!0,{},u,t),n=(l=e).getOptions().multiSelect,r.subscribe(l.onActiveCellChanged,c(m)),r.subscribe(l.onKeyDown,c(w)),r.subscribe(l.onClick,c(b)),n&&(a=new Slick.CellRangeSelector({rowMode:!0}),l.registerPlugin(a),a.onCellRangeSelected.subscribe(v),a.onBeforeCellRangeSelected.subscribe(C))},destroy:function(){r.unsubscribeAll(),n&&(a.onCellRangeSelected.unsubscribe(v),a.onBeforeCellRangeSelected.unsubscribe(C),l.unregisterPlugin(a))},onSelectedRangesChanged:new Slick.Event})}}}),(m=jQuery).extend(!0,window,{Slick:{ColumnGroup:function(){var r,l,d,o=this,n=!1,t=new Slick.EventHandler;function i(){d&&d.remove(),n=!0,e()}function e(){var e,t,i,o,n=l.find(".slick-header-columns"),a=l.find(".groupedHeaderColumn"),n=((d=m('<div class="groupedHeaderColumn slick-group-header-columns ui-state-default"> </div>')).css({width:n.width()+"px",left:n.position().left+"px"}),r.getColumns()),s=h(n);e=n,t=Object.keys(h(e)),e.forEach(function(e){e._groupIndex=t.indexOf(e.groupName),e._groupIndex=-1===e._groupIndex?t.length:e._groupIndex}),u(n),a.remove(),d.append((o=!(i=""),m.each(s,function(e,t){t=t.reduce(function(e,t){return e+t.width},0);i+='<div class="ui-state-default slick-header-column" data-group-name="'+e+'"style="width:'+(t-9-(o?1:0))+'px"> <div class="slick-column-name">'+("-"===e?" ":e)+"</div></div>",o=!1}),i)),l.find(".slick-header").prepend(d),d.sortable({containment:"parent",distance:3,axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",update:c}),n.sort(p),r.setColumns(n),r.resizeCanvas()}function u(e){e.forEach(function(e,t){e._index=t})}function a(){var e=r.getColumns();n&&m.each(h(e),function(e,t){t=t.reduce(function(e,t){return e+t.width},0);d.find("[data-group-name='"+e+"']").css("width",t-9)}),o.onColumnsResized.notify(e)}function c(){var e,i,t=r.getColumns();u(t),n&&(e=m(".slick-group-header-columns .slick-header-column"),i=h(t),e.each(function(t,e){e=i[m(e).data("group-name")];_.isNil(e)||e.forEach(function(e){e._groupIndex=t})}),t.sort(p),r.setColumns(t),u(t)),o.onColumnsReordered.notify(t)}function p(e,t){return e._groupIndex-t._groupIndex||e._index-t._index}function h(e){var i={};return e.forEach(function(e){var t=e.groupName||"-";i[t]=i[t]||[],i[t].push(e)}),i}return this.onColumnsReordered=new Slick.Event,this.onColumnsResized=new Slick.Event,{init:function(e){l=m((r=e).getContainerNode()),t.subscribe(r.onColumnsResized,a),t.subscribe(r.onColumnsReordered,c),_.debounce(i,300)()},destroy:function(){t.unsubscribeAll()},onColumnsReordered:this.onColumnsReordered,onColumnsResized:this.onColumnsResized,enableColumnGrouping:function(){n||(n=!0,e())},forceColumnGrouping:i,removeColumnGrouping:function(){n&&(n=!1,d.remove(),r.resizeCanvas())}}}}}),(D=jQuery).extend(!0,window,{Slick:{CellExternalCopyManager:function(e){var v,w,b=this,y=e||{},s=y.copiedCellStyleLayerKey||"copy-manager",r=y.copiedCellStyle||"copied",l=0,S=y.bodyElement||document.body,R=y.onCopyInit||null,M=y.onCopySuccess||null,k={C:67,V:86,ESC:27,INSERT:45};function t(e,t){var i;if(!v.getEditorLock().isActive()||v.getOptions().autoEdit){if(e.which==k.ESC&&w&&(e.preventDefault(),T(),b.onCopyCancelled.notify({ranges:w}),w=null),(e.which===k.C||e.which===k.INSERT)&&(e.ctrlKey||e.metaKey)&&!e.shiftKey&&(R&&R.call(),0!=(s=v.getSelectionModel().getSelectedRanges()).length)){I(w=s),b.onCopyCells.notify({ranges:s});for(var o=v.getColumns(),n="",a=!1,s=_.sortBy(s,["fromRow","toRow"]),r=0;r<s.length;r++){for(var l=s[r],d=[],u=l.fromRow;u<l.toRow+1;u++){var c=[],p=v.getDataItem(u);if(""==d&&y.includeHeaderWhenCopying&&!a&&e.altKey){for(var a=!0,h=[],g=l.fromCell;g<l.toCell+1;g++)0<o[g].name.length&&"_checkbox_selector"!==o[g].id&&h.push(o[g].name);d.push(h.join("\t"))}for(g=l.fromCell;g<l.toCell+1;g++)"_checkbox_selector"!==o[g].id&&c.push(function(e,t){if(y.dataItemColumnValueExtractor){var i=y.dataItemColumnValueExtractor(e,t);if(i)return i}return i=e[t.field],D(t.formatter(null,null,i,t,e)).text()}(p,o[g]));d.push(c.join("\t"))}n+=d.join("\r\n")+"\r\n"}if(window.clipboardData)return window.clipboardData.setData("Text",n),!0;var f,m=D(v.getActiveCellNode()),C=(f=n,(i=document.createElement("textarea")).style.position="absolute",i.style.left="-10000px",i.style.top=document.body.scrollTop+"px",i.value=f,0<(f=D(".ui-dialog.ui-widget-content:visible")).length?D(i).appendTo(f.last()):S.appendChild(i),i.select(),i);if(C.focus(),a&&document.queryCommandSupported&&document.queryCommandSupported("copy"))try{document.execCommand("copy")}catch(e){return console.warn("Copy to clipboard failed.",e),!1}return setTimeout(function(){D(C).remove(),m&&0<m.length&&(m.attr("tabIndex","-1"),m.focus(),m.removeAttr("tabIndex"))},100),M&&(f=0,f=1===s.length?s[0].toRow+1-s[0].fromRow:s.length,M.call(this,f)),!1}e.which===k.V&&(e.ctrlKey||e.metaKey)&&!e.shiftKey||e.which===k.INSERT&&e.shiftKey&&e.ctrlKey}}function I(e){T();for(var t=v.getColumns(),i={},o=0;o<e.length;o++)for(var n=e[o].fromRow;n<=e[o].toRow;n++){i[n]={};for(var a=e[o].fromCell;a<=e[o].toCell&&a<t.length;a++)i[n][t[a].id]=r}v.setCellCssStyles(s,i),clearTimeout(l),l=setTimeout(function(){b.clearCopySelection()},2e3)}function T(){v.removeCellCssStyles(s)}D.extend(this,{init:function(e){if((v=e).onKeyDown.subscribe(t),!(e=e.getSelectionModel()))throw new Error("Selection model is mandatory for this plugin. Please set a selection model on the grid before adding this plugin: grid.setSelectionModel(new Slick.CellSelectionModel())");e.onSelectedRangesChanged.subscribe(function(e,t){})},destroy:function(){v.onKeyDown.unsubscribe(t)},clearCopySelection:T,handleKeyDown:t,onCopyCells:new Slick.Event,onCopyCancelled:new Slick.Event,onPasteCells:new Slick.Event})}}}),(pe=jQuery).extend(!0,window,{Slick:{CellSelectionModel:function(t){var l,i,o,d=[],n=this,a={selectActiveCell:!0,singleCellMode:!1};function u(e){for(var t=[],i=0;i<e.length;i++){var o=e[i];l.canCellBeSelected(o.fromRow,o.fromCell)&&l.canCellBeSelected(o.toRow,o.toCell)&&t.push(o)}return t}function c(e){d=u(e),n.onSelectedRangesChanged.notify(d)}function e(){return d}function s(e,t){e=l.getCellFromEvent(e);e&&l.canCellBeSelected(e.row,e.cell)?(d=[new Slick.Range(e.row,e.cell,e.row,e.cell)],n.onSelectedRangesChanged.notify(d)):d=[]}function r(e,t){if(l.getEditorLock().isActive())return e.stopPropagation(),!1}function p(e,t){var i=[t.range];c(i=t.desc?_.map(_.range(t.range.toRow,t.range.fromRow-1),function(e){return new Slick.Range(e,t.range.fromCell,e,t.range.toCell)}):i)}function h(e,t){o.selectActiveCell&&null!=t.row&&null!=t.cell&&c([new Slick.Range(t.row,t.cell)])}function g(e){var t,i,o=l.getActiveCell();if(o&&e.shiftKey&&!e.ctrlKey&&!e.altKey&&33<=e.which&&e.which<=40){(t=d).length||t.push(new Slick.Range(o.row,o.cell));var n=(i=(i=t.pop()).contains(o.row,o.cell)?i:new Slick.Range(o.row,o.cell)).toRow-i.fromRow,a=i.toCell-i.fromCell,s=o.row==i.fromRow?1:-1,r=o.cell==i.fromCell?1:-1;if(37==e.which)a-=r;else if(39==e.which)a+=r;else if(38==e.which)n-=s;else if(40==e.which)n+=s;else if(35==e.which){if(this.getEditorLock().isActive())return;n+=1e10*s}else if(36==e.which){if(this.getEditorLock().isActive())return;n-=1e10*s}else 34==e.which?n+=s*l.getNumVisibleRows():33==e.which&&(n-=s*l.getNumVisibleRows());n=new Slick.Range(o.row,o.cell,o.row+s*n,o.cell+r*a);n.toRow>=l.getDataLength()?n.toRow=l.getDataLength()-1:n.fromRow<0&&(n.fromRow=0),u([n]).length?(t.push(n),o=0<s?n.toRow:n.fromRow,a=0<r?n.toCell:n.fromCell,l.scrollRowIntoView(o),l.scrollCellIntoView(o,a)):t.push(i),c(t),e.preventDefault(),e.stopPropagation()}}pe.extend(this,{getSelectedRanges:e,setSelectedRanges:c,init:function(e){o=pe.extend(!0,{},a,t),(l=e).onActiveCellChanged.subscribe(h),o.singleCellMode?l.onClick.subscribe(s):(i=new Slick.CellRangeSelector({selectionCss:{border:"2px solid black"}}),l.onKeyDown.subscribe(g),l.registerPlugin(i),i.onCellRangeSelected.subscribe(p),i.onBeforeCellRangeSelected.subscribe(r))},destroy:function(){l.onActiveCellChanged.unsubscribe(h),o.singleCellMode?l.onClick.unsubscribe(s):(l.onKeyDown.unsubscribe(g),i.onCellRangeSelected.unsubscribe(p),i.onBeforeCellRangeSelected.unsubscribe(r),l.unregisterPlugin(i))},onSelectedRangesChanged:new Slick.Event})}}}),(d=jQuery).extend(!0,window,{Slick:{AutoTooltips:function(i){var o,t={enableForCells:!0,enableForHeaderCells:!1,maxToolTipLength:null};function n(e){var t,e=o.getCellFromEvent(e);e&&((e=d(o.getCellNode(e.row,e.cell))).innerWidth()<e[0].scrollWidth?(t=d.trim(e.text()),i.maxToolTipLength&&t.length>i.maxToolTipLength&&(t=t.substr(0,i.maxToolTipLength-3)+"...")):t="",e.attr("title",t))}function a(e,t){t=t.column,e=d(e.target).closest(".slick-header-column");void 0===t||t.toolTip||e.attr("title",e.innerWidth()<e[0].scrollWidth?t.name:"")}d.extend(this,{init:function(e){i=d.extend(!0,{},t,i),o=e,i.enableForCells&&o.onMouseEnter.subscribe(n),i.enableForHeaderCells&&o.onHeaderMouseEnter.subscribe(a)},destroy:function(){i.enableForCells&&o.onMouseEnter.unsubscribe(n),i.enableForHeaderCells&&o.onHeaderMouseEnter.unsubscribe(a)}})}}});var ge,u={contains:function(e,t){return 0<=t.indexOf(e)},escapeRegexCharacters:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")},isMatch:function(e,t){var i,o,n=!1,a=e.split(/ +and +| +/);for(_.includes(a,"or")&&(a=_.without(a,"or"),n=!0),i=0;i<a.length;i++)0!==a[i].indexOf("-")&&a[i].indexOf("*")<0&&(a[i]="*"+a[i]+"*");return o=n||_.every(a,function(e){return 0===e.indexOf("-")}),_[n?"some":"every"](a,function(e){return u.isSimpleMatch(e,t,o)})},isSimpleMatch:function(e,t,i){var o=!1;if(i||0!==e.indexOf("-")||(e=e.replace("-",""),o=!0),""===t){if("null"===e||"*null*"===e)return!o}else if("-null"===e)return!0;return i=0<=e.indexOf("**")?u.contains(e,t):new RegExp("^"+u.escapeRegexCharacters(e).replace(/\*/g,".*")+"$","m").test(t),o?!i:i}},O={CURRENCY_SYMBOL_MAP:{GBP:"&pound;",EUR:"&euro;",USD:"$"},_convertKdbValueforComparison:function(e){var t=b.convertKDBToViewstateValue(e);return t="1216"===e.class?t.replace(/(.*T)(\d+)(.*)/,function(e,t,i,o){return t+(i=99<parseInt(i,10)?":"+i:i)+o}):t},_OPERATORS_FOR_CONVERTION:_.reduce(["contains","starts with","ends with","search"],function(e,t){return e[t]=!0,e},{}),_getConditionResult:function(e,t,i){var o,n,a=!1;if(O._OPERATORS_FOR_CONVERTION[i]&&(o=(""+e).toLowerCase(),n=(""+t).toLowerCase()),""!==n)switch(i){case"contains":a=0<=o.indexOf(n);break;case"starts with":a=0===o.indexOf(n);break;case"ends with":a=-1!==o.indexOf(n,o.length-n.length);break;case"==":a=e==t;break;case"<":a=e<t;break;case">":a=t<e;break;case"<=":a=e<=t;break;case">=":a=t<=e;break;case"!=":a=e!=t;break;case"search":a=u.isMatch(n,o);break;default:console.log("GRID: highlight rule with unknown operator: ",i)}return a},getStyledCell:function(e,b,y,S,R){var t,M,k,I,T,D,x,F=document.createElement("div"),E=[],i=S.highlightingModule.getHighlightRuleChain(R);return b&&(D=b[S.SLICKGRID_ROW_UNIQUE_ID],D=S.atomizeTemporal(D),S.previousValuesMap&&(x=S.previousValuesMap[D]),_.each(i,function(e){var t,i=e.BorderColor,o=e.BackgroundColor,n=e.Color,a=e.Icon,s=e.IconColor,r=e.ConditionSource,l=e.ConditionOperator,d=e.ConditionValue,u=!1,c=_.includes(["Fill Left-to-Right","Fill Right-to-Left"],l),p="gradient"===e.RuleType,h=b[r="<this>"===r?R:r];if((t=(t=S.columnInfo.get(r))&&7===t.get("kdbType"))&&_.isString(h)&&(h=parseInt(h,10)),p){if(u=!0,o=s=n=i=null,_.isFinite(h)){var g,p=e.Palette||[],f=e.RuleMin,m=e.RuleMax,C=e.RuleLimitEnabled,v=!1,w=null;if(m<f&&(g=f,f=m,m=g,v=!0),!C||f<=h&&h<=m)switch(w=1===(p=0===p.length?[{color:"#888888"}]:p).length?(g=m===f?1:(h-f)/(m-f),g=_.clamp(Math.round(9*g),0,9),V.getColor(p[0].color,g=v?9-g:g)):(v&&(p=_.clone(p)).reverse(),V.interpolateColor(p,f,m,h)),e.TargetElement){case"text":n=w;break;case"border":i=w;break;case"icon":s=w;break;default:o=w}}}else c?_.isNumber(h)&&(M=l,I=o,k=i,T=Math.max(0,Math.min(100,h))):"previous value"===d?x&&(C=x[r],t&&_.isString(C)&&(C=parseInt(C,10)),"=="!==l&&_.isEqual(h,C)&&S.diffValuesMap&&S.diffValuesMap[D]&&void 0!==S.diffValuesMap[D][r]&&(C=S.diffValuesMap[D][r],t)&&_.isString(C)&&(C=parseInt(C,10)),h&&h.class&&(h=O._convertKdbValueforComparison(h)),C&&C.class&&(C=O._convertKdbValueforComparison(C)),u=O._getConditionResult(h,C,l)):u=h&&h.class?O._getConditionResult(O._convertKdbValueforComparison(h),d,l):O._getConditionResult(h,d,l);!y&&u&&(i&&(F.style.border="1px solid "+i),o&&(F.style.backgroundColor=o),n&&(F.style.color=n),a)&&s&&(g=0===a.indexOf("mi-")?"mi":"fa",E.push('<i class="'+g+" "+a+'" style="color: '+s+'" ></i>'))}),M&&(I||k)&&((t=document.createElement("div")).className=M.replace(" ","_"),t.style.width=T+"%",I&&(t.style.backgroundColor=I),k&&(t.style.border="1px solid "+k),F.appendChild(t)),E.length)&&(E.reverse(),(t=document.createElement("div")).className="cellIcons",t.innerHTML=E.join(""),F.appendChild(t)),F},getFormatter:function(h,g){var s,r,f=this,m=h.Field,c=!1,e=g.columnInfo.get(m),C=(e&&(c=7===e.get("kdbType")),function(t,i,o,e,n){e.onclick=function(e){g.editorModule.updatePendingChanges(i,o,!t),g.editorModule.refreshGrid()},e.className=n;n=g.editorModule.pendingRows[o[g.primaryKey].toString()];n&&_.includes(_.keys(n),i.field)&&(e.className+=" pendingChange")});if($.trim(h.Template))var v=N.compile(h.Template),t=function(i,o,e,n,t,a){var s,r,l,d,u,c,p=e;if(t){try{c=_.includes(["General","Percentage","Boolean"],h.Format)?t:(r=O.getFormatter($.extend({},h,{Template:"",HighlightNegativeColor:""}),{SLICKGRID_ROW_UNIQUE_ID:g.SLICKGRID_ROW_UNIQUE_ID,highlightingModule:{changedObjectCacheDictionary:{},getHighlightRuleChain:_.noop},viewModel:new w.Model({HighlightRules:[]}),columnInfo:g.columnInfo,atomizeTemporal:g.atomizeTemporal}),l=_.extend({thisValue:t[m]},t),d=h.Template.match(/\{\{(.*?)\}\}/g).join(" "),(u=_.union(Object.keys(l).filter(function(e){return d.match(new RegExp(e))}),["thisValue"])).unshift(l),c=_.pick.apply(_,u),_.mapValues(c,function(e,t){return r(i,o,e,n,l,a).innerHTML})),c=_.extend({},t,{thisField:m,thisValue:c[m],thisRawValue:e},c,g.api.getTemplateViewStates(h.Template)),s=v(c)}catch(e){s=""}(u=f.getStyledCell(e,t,a,g,m)).innerHTML+=s,g.columnIsInstantEditable(n)&&C(e,n,t,u,"boolean-custom-toggle"),p=u}return p};else if(_.includes(["Number","Formatted Number","Smart Number","Currency","SmartCurrency"],h.Format))t=function(e,t,i,o,n,a){var s=i,r=!1,s=null==i?"":"Smart Number"===h.Format?b.smartFormatNumber(i,h.Precision,!0):"Formatted Number"===h.Format?b.formatNumber(i,h.Precision):b.toFixedNumber(i,h.Precision);return s=_.escape(s),s=f.hideTralingZeroes(s,h.HideTrailingZeroes),h.Currency&&"none"!==h.Currency&&""!==s&&(s=O.CURRENCY_SYMBOL_MAP[h.Currency]+" "+s,r=!0),n&&(n=f.getStyledCell(i,n,a,g,m),h.HighlightNegativeColor&&_.isNumber(i)&&i<0&&(n.style.color=h.HighlightNegativeColor),r?n.innerHTML+=s:n.appendChild(document.createTextNode(s)),s=n),s};else if(_.includes(["Date","Time","DateTime"],h.Format))t=function(e,t,i,o,n,a){var s="Time"===h.Format,r="DateTime"===h.Format,l=b.convertKDBTemporalToMoment(i),s=_.isNull(i)||_.isUndefined(i)||_.isFunction(l.isValid)&&!l.isValid()?_.escape(i):s?l.formatNano(h.TimeFormat,{trim:!1,trimNano:!1}):r?l.formatNano(h.DateFormat+" "+h.TimeFormat,{trim:!1,trimNano:!1}):l.formatNano(h.DateFormat);return n&&((r=f.getStyledCell(i,n,a,g,m)).appendChild(document.createTextNode(s)),s=r),s};else if("Percentage"===h.Format)t=function(e,t,i,o,n,a){var s,r,l;if(c&&_.isString(i)&&(i=parseInt(i,10)),!_.isNumber(i))return l=null==i?"":i,n?((r=f.getStyledCell(l,n,a,g,m)).innerHTML=l,r):document.createTextNode(l);l=i,i*=100,s="",d=Math.max(0,i);var d=Math.min(100,d),u=h.PercentageColorOverride;return u&&(s="background-color:"+u+";"),i=i.toFixed(h.Precision),u='<div class="percentageFormatter"><p style="'+s+"width:"+d+'%"></p><span>'+(i=f.hideTralingZeroes(i,h.HideTrailingZeroes))+"%</span></div>",n?((r=f.getStyledCell(l,n,a,g,m)).innerHTML+=u,r):u};else if("CustomFormatter"===h.Format)t=function(e,t,i,o,n,a){var s,e=n?(s=f.getStyledCell(i,n,a,g,m),null!=i&&(s.innerHTML+=h.CustomFormatter(e,t,i,o,n,a)),s):document.createTextNode(i);return e};else if(_.includes(["General","Boolean"],h.Format))t=function(e,t,i,o,n,a){var s;return n?(a=f.getStyledCell(i,n,a,g,m),g.columnIsInstantEditable(o)?((s=document.createElement("input")).type="checkbox",s.checked=i,C(i,o,n,s,"boolean-toggle"),a.appendChild(s)):null!=i&&a.appendChild(document.createTextNode(i.toString())),a):document.createTextNode(i)};else if("Sparkline"===h.Format){try{s=JSON.parse(h.SparklineOptions)}catch(e){console.warn("Datagrid > SparklineOptions parsing error",e),s={}}r=_.compact(["sparklinesRoot",s.className]).join(" "),t=function(e,t,i,o,n,a){n=f.getStyledCell(i,n,a,g,m);return n.className=r,g.sparklinesManager.storeInitObjects(n,i,s),n}}return t},hideTralingZeroes:function(e,t){var i=e.toString();if(t&&0<=i.indexOf(".")){for(e="",(t=i[i.length-1]).match(/[kmbtpe]/i)&&(e=t,i=i.slice(0,-1));"0"===i[i.length-1];)i=i.slice(0,-1);"."===i[i.length-1]&&(i=i.slice(0,-1)),i+=e}return i},getSummaryRowHtml:function(m,e,C,v){var w="";return e&&e.length&&_.each(e,function(e){var t,i,o,n,a="",s="";function r(e){return _.isNumber(e)&&!_.isNaN(e)}function l(e,t){e=_.map(e,t),t=v.columnInfo.get(t);return e=t&&7===t.get("kdbType")?_.map(e,function(e){return _.isString(e)?parseInt(e,10):e}):e}if(!_.isEmpty(e)){if(n=e.Label,"WAVG"===e.Function){for(var d,u,c=l(m.rows,e.Column),p=l(m.rows,e.Column2),h=0,g=0,f=0;f<c.length;f++)d=c[f],u=p[f],r(d)&&r(u)&&(h+=d*u,g+=d);0!==g&&(a=h/g,(o=_.find(C,{field:e.Column2})).formatter)&&(a=o.formatter(void 0,void 0,a))}else if(t=l(m.rows,e.Column),(i=_.filter(t,function(e){return!_.isNull(e)&&!_.isUndefined(e)&&(_.isNumber(e)||_.has(e,"i"))})).length){if(_.has(i[0],"i"))switch(i.sort(function(e,t){return e.i===t.i?e.n-t.n:e.i-t.i}),e.Function){case"MIN":a=i[0];break;case"MAX":a=_.last(i)}else{switch(e.Function){case"MIN":a=_.min(i);break;case"MAX":a=_.max(i);break;case"AVG":case"SUM":a=_.reduce(i,function(e,t){return e+t},0)}"AVG"===e.Function&&(a/=i.length)}(o=_.find(C,{field:e.Column})).formatter&&(a=o.formatter(void 0,void 0,a))}n=n||e.Function+("WAVG"===e.Function?"":" "+e.Column),e.Color&&(s=" style='color:"+e.Color+"' "),w+="<span class='lblGroupSummary' "+s+"><i>"+n+":</i><b>"+a+"</b></span>"}}),w},isFormattersValueDifferentToRawValue:function(e){var t=!1;switch(e.Format){case"General":case"Boolean":t=!!e.Template;break;default:t=!0}return t}},c=w.View.extend({initialize:function(e){this.app=e.app,this.kdbClass=e.kdbClass,this.$elActivator=e.$elActivator,this.dashboardType=b.Types.kdbToDashboard[this.kdbClass],this.$el.html(z.DateFilter({operators:c.COMBO_2_OPERATOR_MAP})),this.$cmbOperator=this.$(".cmbOperator"),this.$dp1=this.$(".dp1"),this.$dp2=this.$(".dp2"),this.initEvents(),this.renderDialog(),this.expressionsToVisualize=c._parseExpressions(e.filterValue),this.renderOperators(),this.renderDatepickers()},initEvents:function(){this.$cmbOperator.on("select2:select",this.onOperatorChanged.bind(this))},onApplyButtonClick:function(){var e,t,i=this.$cmbOperator.val(),o=this.dpSelection1.get("value"),n=c.COMBO_2_OPERATOR_MAP[i]+o;_.includes(["b","o"],i)&&(t=this.dpSelection2.get("value"),dt1=c.convertToKdbLikeObject(o,this.kdbClass),dt2=c.convertToKdbLikeObject(t,this.kdbClass),0<c._getComparisonResult(dt1,dt2)&&(e=o,o=t,t=e),n="b"===i?">="+o+" <="+t:"<"+o+" >"+t),this.trigger("filterApplied",n)},onClose:function(){this.$el.dialog("close")},onOperatorChanged:function(){var e=this.$cmbOperator.val();_.includes(["b","o"],e)?this.$dp2.show():this.$dp2.hide()},remove:function(){this.$cmbOperator.select2("destroy"),this.dpApp1&&this.dpApp1.remove(),this.dpApp2&&this.dpApp2.remove(),w.View.prototype.remove.apply(this,arguments),this.trigger("removed",this)},renderDialog:function(){var e=this;this.$dialog=this.$el.dialog(_.extend({dialogClass:"Datagrid date-filter-dialog",title:t("Configure Filter"),resizable:!1,width:"350",height:"170",modal:!1,position:{of:this.$elActivator,my:"left top",at:"left top"},autoOpen:!0,draggable:!0,buttons:[{text:t("Apply"),click:$.proxy(e.onApplyButtonClick,e),icons:{primary:"fa fa-check"}},{text:t("Close"),click:$.proxy(e.onClose,e),icons:{primary:"fa fa-times"}}],resizeStop:function(){},close:function(){e.$dialog.dialog("destroy"),e.remove()}},this.options))},renderOperators:function(){var e=this.expressionsToVisualize;this.$cmbOperator.select2({minimumResultsForSearch:10,theme:"dashboards"}),e.length&&(e=1===e.length?c.OPERATOR_2_COMBO_MAP[e[0].operator]:0===e[0].operator.indexOf(">")?"b":"o",this.$cmbOperator.val(e).trigger("change")),this.onOperatorChanged()},renderDatepicker:function(t,e,i){var o,n=this,a=H.getComponentDefinition({componentId:15,settingsModel:new w.DeepModel});i=i||p.Helpers.convertRollingToDate("NOW",this.dashboardType),o=new p.DocumentViewModel({_default:i,_viewType:!0,_type:this.dashboardType}),(i=new w.DeepModel(a.appArgs.json)).set("Basics.Data",{}),i.set("Basics.Label",""),i.set("Basics.labelWidth",0),i.set("Basics.width",200),i.set("Basics.SelectedDate",o),this.app.api.loadApp("BasicComponents",e,i,{},function(e){n["dpApp"+t]=e,n["dpSelection"+t]=o})},renderDatepickers:function(){var e,t,i=this.expressionsToVisualize;i.length&&(e=i[0].date,1<i.length)&&(t=i[1].date),this.renderDatepicker(1,this.$dp1,e),this.renderDatepicker(2,this.$dp2,t)}},{COMBO_2_OPERATOR_MAP:{lt:"<",lte:"<=",gt:">",gte:">=",e:"==",ne:"!=",b:"between",o:"outside of"},generateFilterFunction:function(e,t){var i,o,n,e=c._parseExpressions(e),a=c.convertToKdbLikeObject(e[0].date,t),t=1<e.length?(o=c.convertToKdbLikeObject(e[1].date,t),0==e[0].operator.indexOf(">")?function(e){return null!==e&&0<=c._getComparisonResult(e,a)&&c._getComparisonResult(e,o)<=0}:function(e){return null===e||c._getComparisonResult(e,a)<0||0<c._getComparisonResult(e,o)}):(i=c._getOperatorFn(e[0].operator),n="!="===e[0].operator,function(e){return null===e?n:(e=c._getComparisonResult(e,a),i(e))});return t},_convertToKdb_FORMAT_MAP:{1214:"YYYY-MM-DD"},convertToKdbLikeObject:function(e,t){return(_.includes(["1214"],t)?b.convertUserInputToMoment(e,c._convertToKdb_FORMAT_MAP[t]):b.convertValueToMoment(e,t)).toKdbObject()},_getComparisonResult:function(e,t){var i=e.i-t.i;return i=0===i&&void 0!==e.n&&void 0!==t.n?e.n-t.n:i},_getOperatorFn:function(e){switch(e){case"<":return function(e){return e<0};case"<=":return function(e){return e<=0};case">":return function(e){return 0<e};case">=":return function(e){return 0<=e};case"==":return function(e){return 0===e};case"!=":return function(e){return 0!==e}}},_parseExpressions:function(e){for(var t,i=/(==|!=|<=|>=|>|<)(\S+)/g,o=[];t=i.exec(e);)o.push({operator:t[1],date:t[2]});return o}}),fe=(c.OPERATOR_2_COMBO_MAP=_.invert(c.COMBO_2_OPERATOR_MAP),ge={is_null:"is_blank",is_not_null:"is_not_blank",">":"greater","<":"less","==":"equal","!=":"not_equal",">=":"greater_or_equal","<=":"less_or_equal"},{generateColumnGroupRule:function(e,t,i,o){var n=ye;switch(i){case 0:n=ve;break;case 1:n=me;break;case 2:n=Ce;break;case 10:case 11:n=ve;break;case 4:case 5:case 6:case 7:case 8:case 9:n=we;break;case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:n=be}return n(e,t,i,o)}});function v(e,t){return e.length?{active:!0,operator:t,children:e}:void 0}function me(t,e,i){var o=[],e=e.split(/ +or +| +/);return e=_.without(e,""),_.each(e,function(e){e="true"===e||"false"!==e&&void 0;void 0!==e&&o.push({active:!0,propertyName:t,propertyType:i,operator:"equal",value:e})}),v(o,"OR")}function Ce(o,e,n){var a=[],e=e.split(/ +or +| +/);return e=_.without(e,""),_.each(e,function(e){var t=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)?e:void 0,i="equal";if(void 0===t){if(/[^a-f\d-]/gi.test(e))return;t="*"+e+"*",i="like"}void 0!==t&&a.push({active:!0,propertyName:o,propertyType:n,operator:i,value:t})}),v(a,"OR")}function ve(a,e,s,t){var i,r=[],o="AND",l=!1;return t?(o="OR",l=!0,i=e.split("|")):(i=e.split(/ +and +| +/),_.includes(i,"or")&&(i=_.without(i,"or"),o="OR")),i=_.without(i,""),_.each(i,function(e){var t,i,o="like",n=!1;0!==(e=e.replace(/\[/g,"")).length&&(0===e.indexOf("-")&&1!==e.length&&(o="not_like",e=e.substr(1),n=!0),e.toLowerCase()===R.NULL_EMPTY_VALUE.toLowerCase()?o=n?"is_not_blank":"is_blank":l?o="equal":e=e.indexOf("*")<0?"*"+e+"*":(t=((n=e).match(/\*/g)||[]).length,i=!1,toReturn=n,toReturn=2<t||2===t&&(2===n.length||"*"!==_.first(n)||"*"!==_.last(n))?n.replace(/\*/g,function(){return i?"":(i=!0,"*")}):toReturn),10===s&&(e=e.replace(/\*/g,""),o="equal"),r.push({active:!0,propertyName:a,propertyType:s,operator:o,value:e}))}),v(r,o)}function we(t,e,i){e=R._getNumberFilterParts(e);return v(_.map(e.expressions,function(e){return{active:!0,propertyName:t,propertyType:i,operator:ge[e.operator],value:e.number}}),e.isAndCondition?"AND":"OR")}function be(t,e,i){e=c._parseExpressions(e);return v(_.map(e,function(e){return{active:!0,propertyName:t,propertyType:i,operator:ge[e.operator],value:e.date}}),1<e.length&&0==e[1].operator.indexOf(">")?"OR":"AND")}function ye(){}var _e,Se,Re,S,Me,R=function(e){this.app=e,this.api=e.api,this.cachedDropdownItems=null,this.FILTER_SETTINGS_KEY="Grid.Basics.Filtering",this.BASICS_FILTERING="Basics.Filtering",this.BASICS_IS_FILTER_VISIBLE="Basics.IsFilterVisible",this.BASICS_KDB_FILTER_STRING="Basics.KdbFilterString",this.BASICS_FILTER_ON_ENTER_HIT="Basics.FilterOnEnterHit",this.CUSTOM_FILTERS_KEY="CustomFilters",this.initialize()};function ke(e){var t=parseFloat(e);return t*=Se[e[e.length-1]]||1}function Ie(e){var t,i,o,n,a,s=[],r=!1,l=!1,d=!1;for(e=e.toLowerCase().replace(/ /g,"");t=_e.exec(e);)i=t[1],i=Re[i]||i||"==",0<=t[2].indexOf("null")?"=="===i&&"null"===t[2]?l=!0:d=!0:s.push({operator:i,number:ke(t[2])});return s=_.sortBy(s,"number"),1<(o=_.map(s,"operator")).length&&(r=_.some(o,function(e){return"!="===e})||(o=o,n=!1,a=_.findIndex(o,function(e){return 0===e.indexOf(">")}),n=0<=a?a<_.findLastIndex(o,function(e){return 0===e.indexOf("<")}):n)),l&&s.push({operator:"is_null",number:null}),d&&s.push({operator:"is_not_null",number:null}),{expressions:s,isAndCondition:r}}function Te(i){var t,o;this.init=function(){(t=S("<INPUT type=text class='editor-text' />")).bind("keydown.nav",function(e){e.keyCode!==S.ui.keyCode.LEFT&&e.keyCode!==S.ui.keyCode.RIGHT||e.stopImmediatePropagation()}),t.appendTo(i.container),t.focus().select()},this.destroy=function(){t.remove()},this.focus=function(){t.focus()},this.loadValue=function(e){o=e[i.column.field],t.val(o),t[0].defaultValue=o,t.select()},this.serializeValue=function(){return 0<t.val().length?parseFloat(t.val(),10)||0:null},this.applyValue=function(e,t){e[i.column.field]=t},this.isValueChanged=function(){return!(""==t.val()&&null==o)&&t.val()!=o},this.validate=function(){var e=t.val().toLowerCase(),e=R.convertSmartNumberToNumber(e);return isNaN(e)?{valid:!1,msg:"Please enter a valid float"}:(t.val(e),{valid:!0,msg:null})},this.init()}function De(i){var e,o,t,n,a,s={val:{title:""}},r=function(e){var t,i,o,n=e,a=void 0;if(t=n.column.field,i=n.item[t],_.isObject(i)&&i.class)a=i.class;else{for(o=0;o<n.grid.getDataLength();o++)if(i=n.grid.getDataItem(o)[t],_.isObject(i)&&i.class){a=i.class;break}void 0===a&&(a=""+(1200+n.grid.getOptions().kdbTypesColumnInfo.get(t).get("kdbType")))}return a}(i),l=b.Types.kdbToDashboard[r],l=P.RTTI.getByName(l).editor;_.extend(s.val,Me.extend(!0,{},l)),(n=new w.Model({})).schema=s,this.init=function(){t=n.schema.val.isReplacementForCheckbox,a=new P({model:n}).render(),e=a.$el.appendTo(i.container).bind("keydown.nav",function(e){e.keyCode!==Me.ui.keyCode.LEFT&&e.keyCode!==Me.ui.keyCode.RIGHT||e.stopImmediatePropagation()}).dblclick(function(e){e.stopPropagation()}),_.defer(function(){e&&e.is(":visible")&&e.find("input[type='text']").focus().select()}),"Select"===n.schema.val.type&&e.bind("keydown",function(e){13==e.which&&a.fields.val.editor.$el.select2("close")})},this.destroy=function(){e&&(e.off(),e.remove()),a&&a.remove()},this.loadValue=function(e){var t,e=e[i.column.field];e=e,b.Types.kdbToDashboard[r]?t=b.convertKDBTemporalToMoment(e).toDashString():(t=e,p.Log.Log("unknown type in CustomSlickEditor.js > convertToEditor()")),o=t,n.set("val",o)},this.serializeValue=function(){return n.get("val")},this.applyValue=function(e,t){e[i.column.field]=(e=t,t=r,b.Types.kdbToDashboard[t]?b.convertValueToMoment(e,t).toKdbObject():e)},this.isValueChanged=function(){var e;return a&&a.commit(),e=this.serializeValue(),t&&(e="true"===e),!_.isEqual(e,o)},this.validate=function(){var e;return i.column.validator&&(e=this.serializeValue(),!(e=i.column.validator(e)).valid)?e:{valid:!0,msg:null}},this.init()}_.extend(R.prototype,w.Events,{initialize:function(){this.$txtGlobalFilter=this.app.$(".txtGlobalFilter"),this.$lnkResetFilters=this.app.$(".lnkResetFilters").hide(),this.$lnkToggleFilters=this.app.$(".lnkToggleFilters"),this.onHeaderRowCellRenderedScoped=_.bind(this.onHeaderRowCellRendered,this),this.debounced_searchboxChanged=_.debounce(this.searchboxChanged,500),this.debounced_refreshDataView=_.debounce(this.refreshDataView,500),this.listenTo(this.app.viewModel,"change:"+this.BASICS_IS_FILTER_VISIBLE,this.onChange_isFilterVisible),this.listenTo(this.app.viewModel,"change:"+this.BASICS_FILTERING,this.onChange_Filtering),this.listenTo(this.app.viewModel,"change:CustomFilters",this.onChange_CustomFilters),this.$txtGlobalFilter.on("change keyup",_.bind(this.debounced_searchboxChanged,this)),this.$lnkResetFilters.click(_.bind(this.resetFilters,this)),this.listenToOnce(this.app.viewModel,"change:"+this.BASICS_FILTERING,this.loadFilterSettings),this.listenTo(this.app.viewModel,"change:"+this.BASICS_KDB_FILTER_STRING,this.onChange_KdbFilterString),this.listenTo(this.app.viewModel,"change:"+this.BASICS_FILTER_ON_ENTER_HIT,this.onChange_FilterOnEnterHit),this.$lnkToggleFilters.on(b.clickEvent(),this.onClick_lnkToggleFilters.bind(this)),this.showingFilters=!0,this.isProcessedServerSide=!1,this.filterOnEnterHit=!1,this.wasEnterHit=!1,this.dateFilterViewInstances=[],this.listenTo(_.get(this.app,"dashboardAppModel.attributes.router"),"route",this.removeDateFilters)},applyFilterSettingsIfReady:function(){var e,i=this.filterSettingsToApply,t=!1,o=this;i&&(i.type===this.getValueOfViewState(this.app.viewModel.get(this.BASICS_FILTERING))?"Quick Search"===i.type?(this.$txtGlobalFilter.val(i.value),this.$txtGlobalFilter.trigger("change"),this.filterSettingsToApply=null):_.includes(["Column Filters","Advanced Column Filters"],i.type)&&this.app.grid&&((e=_.keys(i.value||{})).length&&_.every(e,function(e){return o.app.grid.getHeaderRowColumn(e)})?_.each(e,function(e){var t=$(o.app.grid.getHeaderRowColumn(e)).find("input");t.val(i.value[e]),t.trigger("change")}):t=!0,this.filterSettingsToApply=null):t=!0,t)&&this.app.api.saveSetting(this.FILTER_SETTINGS_KEY,null)},checkResetFiltersState:function(){var e=_.some(this.columnFilters);this.app.grid&&this.app.grid.resetActiveCell(),this.$lnkResetFilters[e?"show":"hide"]()},encodeInputFromArray:function(e){return 0===e.length?"":1===e.length?e[0]:e.length+" selected"},encodeInputValue:function(e){return e&&this.encodeInputFromArray(e.split("|"))},generateKdbFilterString:function(e){var t="";if("Advanced Column Filters"===e){var i,o,n,a,s=[],r=this.app.grid;for(i in this.columnFilters)void 0!==i&&""!==this.columnFilters[i]&&(columnIndex=r.getColumnIndex(i),colCfg=r.getColumns()[columnIndex])&&(o=colCfg.field,a=!!_.find(this.app.viewModel.get("CustomFilters"),{Name:o,Type:"Server Selection"}),n=this.app.columnInfo.get(o).get("kdbType"),columnGroupRule=fe.generateColumnGroupRule(o,this.columnFilters[i],n,a))&&s.push(columnGroupRule);e=1===s.length?s[0]:{active:!0,children:s,operator:"AND"},console.log("server side filter ipc message:",JSON.stringify(e)),t=G.generateIpcHexMessage(e)}return t},getDropdownItems:function(e,i){var e=this.app.grid.getColumnIndex(e),o=this.app.grid.getColumns()[e],e=o._dashboardConfig,n=!1,a=_.includes(["Number","Formatted Number","Smart Number","Percentage"],e.Format),s={},r=[],l={},t=this.cachedDropdownItems||this.app.dataView.getItems(),d=O.isFormattersValueDifferentToRawValue(e),e=this.app.columnInfo.get(i),e=e&&e.get("kdbType")||11;return t.forEach(function(e){var e=e[i],t=a?null===e?R.NULL_EMPTY_VALUE:e:(null===e?"":""+e)||R.NULL_EMPTY_VALUE;void 0!==e&&(t===R.NULL_EMPTY_VALUE&&(n=!0),void 0===l[t])&&(l[t]=e,t!==R.NULL_EMPTY_VALUE)&&r.push(t)}),t=r.sort(b.isKDBTemporal({class:"12"+_.padStart(e,2,"0")})?void 0:b.getComparator(e,_.identity)),n&&t.unshift(R.NULL_EMPTY_VALUE),t=_.map(t,function(e){var t;return d&&(s[i]=t=l[e],t=$(o.formatter(null,null,t,o,s)).text()),{Value:a?""+e:e,Text:t||e}})},getValueOfViewState:function(e){return e instanceof w.Model?e.get("value"):e},hideActiveDropdownPopup:function(){this.$selectionInputs&&this.$selectionInputs.each(function(){$(this).siblings("div").css("position","relative")})},loadFilterSettings:function(){this.filterSettingsToApply=this.app.api.loadSetting(this.FILTER_SETTINGS_KEY)},modifyGridConfig:function(e){(this.showColumnFilters||this.showAdvancedColumnFilters)&&(e.showHeaderRow=!0,e.isHeaderRowVisible=this.isFilterVisible,e.explicitInitialization=!0)},onChange_CustomFilters:function(){var e,i=this;this.app.skipGridGeneration||(e=this.app.viewModel.get(this.CUSTOM_FILTERS_KEY),_.each(e,function(e,t){t=i.CUSTOM_FILTERS_KEY+"."+t+".Data";_.isEqual(e.Data,i.app.model)&&(p.ErrorDialog.ShowError("You must select a data source that is different from the one being used by the data grid."),e.Data=i.app.viewModel.previous(t),i.api.setProperty(t,i.app.viewModel.previous(t)))}),this.resetFilters(),this.app.generateDataGridFromReceivedData())},onChange_FilterOnEnterHit:function(){this.filterOnEnterHit=this.app.api.getProperty(this.BASICS_FILTER_ON_ENTER_HIT)},onChange_Filtering:function(e,t){this.filteringMode=this.getValueOfViewState(t),this.showColumnFilters="Column Filters"===this.filteringMode,this.showAdvancedColumnFilters="Advanced Column Filters"===this.filteringMode,this.showQuickSearch="Quick Search"===this.filteringMode,this.showColumnFilters&&this.checkResetFiltersState(),this.showingFilters&&(this.showColumnFilters||this.showAdvancedColumnFilters||this.showQuickSearch)?this.$lnkToggleFilters.show():this.$lnkToggleFilters.hide(),this.app.sortingModule.storeSortingSpec(),this.app.generateDataGridFromReceivedData()},onChange_isFilterVisible:function(){var e=this.app.viewModel.get(this.BASICS_FILTERING);switch(this.isFilterVisible=this.app.viewModel.get(this.BASICS_IS_FILTER_VISIBLE),this.$lnkToggleFilters.find("span").text((this.isFilterVisible?"Hide":"Show")+" Filters"),e){case"Column Filters":case"Advanced Column Filters":!this.skipGridGeneration&&this.app.grid&&(this.app.grid.getOptions().isHeaderRowVisible=this.isFilterVisible,this.app.$(".slick-headerrow")[this.isFilterVisible?"show":"hide"](),this.app.grid.reset_prevScrollLeft(),this.app.grid.resizeCanvas())}},onChange_KdbFilterString:function(){var e,t=!1;this.app.api.getPropertyMeta&&(t=!(!(e=this.app.api.getPropertyMeta(this.BASICS_KDB_FILTER_STRING))||"viewstate"!==e.type)),this.isProcessedServerSide=t},onClick_lnkToggleFilters:function(){var e,t=!this.app.viewModel.get(this.BASICS_IS_FILTER_VISIBLE);this.app.api.getPropertyMeta&&!(!(e=this.app.api.getPropertyMeta(this.BASICS_IS_FILTER_VISIBLE))||"viewstate"!==e.type)?this.app.api.setProperty(this.BASICS_IS_FILTER_VISIBLE,t):this.app.viewModel.set(this.BASICS_IS_FILTER_VISIBLE,t)},onHeaderRowCellRendered:function(e,t){var i,o,n,a=$(t.node),s=this.app.viewModel.get("CustomFilters");if(a.empty(),o=t.column.field,!(s=_.find(s,function(e){return l.isFieldMatched(e.Name,o)}))||"Disabled"!==s.Type){if(n=this.encodeInputValue(this.columnFilters[t.column.id]),i=$("<input type='text'></input>").data("columnId",t.column.id).data("field",o).val(n).appendTo(a),s)switch(this.customFilter$ElementsMap[t.column.id]=a,s.Type){case"DateTime":i.addClass("customFilterDateTime").prop("readonly",!0);break;case"Number":i.addClass("customFilterNumber");break;case"Selection":case"Server Selection":i.addClass("customFilterSelection"),this.$selectionInputs=this.$selectionInputs.add(i)}n&&i.after('<i class="fa fa-times" />')}},reapplyColumnFilters:function(){_.some(this.columnFilters)&&(this.app.dataView.setFilter(this.dataViewFilterFn),this.app.grid.invalidate())},refreshDataView:function(){if(this.filterOnEnterHit){if(!this.wasEnterHit)return;this.wasEnterHit=!1}this.app.viewModel.isLazyDataLoadingOn()&&this.app.model&&this.app.model.get("_lazyLoading")&&this.app.grid&&this.app.grid.scrollRowToTop(0),this.saveFilterSettings(),this.isProcessedServerSide&&this.showAdvancedColumnFilters?this.app.api.setProperty(this.BASICS_KDB_FILTER_STRING,this.generateKdbFilterString(this.filteringMode)):(this.app.RAW_MODE&&this.app.rawModeModule.populateFilterFields(),this.app.refreshDataView())},refreshDataviewIfFilterNotEmpty:function(){this.lastSearchValue&&this.refreshDataView()},registerColumnFilters:function(){var s=this;this.unsubscribeFromEvents(),this.$headerRow=$(s.app.grid.getHeaderRow()),this.customFilter$ElementsMap={},this.customFilterFunctions_Number=this.customFilterFunctions_Number||{},this.customFilterFunctions_Selection=this.customFilterFunctions_Selection||{},this.customFilterFunctions_DateTime=this.customFilterFunctions_DateTime||{},s.columnFilters||(s.columnFilters={}),this.$headerRow.on("blur",":input",function(){s.filterOnEnterHit&&(s.wasEnterHit=!0,$(this).trigger("change"))}),this.$headerRow.on("change keyup",":input",function(e){var t,i,o=$(this),n=o.val();!s.filterOnEnterHit||13!==e.which&&9!==e.which||(s.wasEnterHit=!0),null!=(i=o.data("columnId"))&&(n!==s.encodeInputValue(s.columnFilters[i])&&(s.columnFilters[i]=n,o.hasClass("customFilterDateTime")?n&&(t=o.data("field"),i="12"+s.app.columnInfo.get(t).get("kdbType"),s.customFilterFunctions_DateTime[t]=c.generateFilterFunction(n,i)):o.hasClass("customFilterNumber")?(t=o.data("field"),s.customFilterFunctions_Number[t]=R._generateNumberFilterFunction(n)):o.hasClass("customFilterSelection")&&(n&&"change"===e.type?(t=o.data("field"),o.val(s.encodeInputValue(n)),s.customFilterFunctions_Selection[t]=R._generateSelectionFilterFunction(n.split("|"))):n&&"keyup"===e.type&&(t=o.data("field"),o.val(n),s.customFilterFunctions_Selection[t]=R._generateSelectionFilterFunction(n.split("|"))))),s.refreshClearButton(o,n),s.checkResetFiltersState(),s.debounced_refreshDataView())}),this.$headerRow.on("click",".fa-times",function(e){var t=$(this),i=t.prev();t.remove(),s.filterOnEnterHit&&(s.wasEnterHit=!0),i.val("").trigger("change"),s.removeCustomFilterDropdowns()}),this.$headerRow.on("select2:close",function(e){s.hideActiveDropdownPopup()}),this.$headerRow.on("click",".customFilterSelection",function(e){var i,e=$(e.currentTarget),o=e.data("columnId"),n=e.data("field"),a=s.customFilter$ElementsMap[o];return s.removeCustomFilterDropdowns(),(i=_.find(s.app.viewModel.get("CustomFilters"),function(e){return"Server Selection"===e.Type&&l.isFieldMatched(e.Name,n)}))&&i.Data?s.api.subscribe(i.Data,function(e,t){s.cachedDropdownItems=t.collection.models.map(function(e){return e.attributes}),a.serverSelectionDataSource||s.renderDropdown(a,o,n),s.cachedDropdownItems=null,a.serverSelectionDataSource?s.removeCustomFilterDropdowns():a.serverSelectionDataSource=i.Data}):(s.cachedDropdownItems=null,s.app.RAW_MODE&&s.app.rawModeModule.populateFilterFields([n]),s.renderDropdown(a,o,n)),!1}),this.$headerRow.on("click",".customFilterDateTime",function(e){var e=$(e.currentTarget),t=e.data("columnId"),i=e.data("field");s.customFilter$ElementsMap[t];s.showDateFilter(e,t,i)}),this.app.grid.onHeaderRowCellRendered.subscribe(this.onHeaderRowCellRenderedScoped),this.$selectionInputs=$()},registerDataViewFilter:function(){var r=this;r.columnId2field={},r.columnId2formatter={},_.each(this.app.grid.getColumns(),function(i){var e=i.id,t=i._dashboardConfig;t&&(r.columnId2field[e]=i.field,r.columnId2formatter[e]=t.Template||!_.includes(["Boolean","General"],t.Format)?function(e,t){return $(i.formatter(null,null,e,i,t)).text()}:function(e){return(null==e?"":e).toString()})}),r.dataViewFilterFn=r.dataViewFilterFn||function(i,e){var o,t,n,a,s;if(r.isProcessedServerSide)return!0;if(_.isFunction(r.app.dataViewFilter))return r.app.dataViewFilter.apply(r,[i,e]);if(r.showAdvancedColumnFilters||r.showColumnFilters){for(t in s=r.showAdvancedColumnFilters?u.isMatch:u.contains,r.columnFilters)if(void 0!==t&&""!==r.columnFilters[t]){if(a=r.columnId2field[t],n=i[a],r.app.RAW_MODE&&void 0===n)return!0;if(r.customFilterFunctions_DateTime[a]){if(!r.customFilterFunctions_DateTime[a](n))return!1}else if(r.customFilterFunctions_Number[a]){if(!r.customFilterFunctions_Number[a](n))return!1}else if(r.customFilterFunctions_Selection[a]){if(!r.customFilterFunctions_Selection[a](n))return!1}else if(n=(a=r.columnId2formatter[t])?a(n,i).toLowerCase():"",!s(r.columnFilters[t].toLowerCase(),n))return!1}return!0}return!r.showQuickSearch||""===(o=(e._globalSearchString||"").toLowerCase())||_.some(r.app.grid.getColumns(),function(e){var t=i[e.field];return null!=t&&0<=$(e.formatter(null,null,i[e.field],e,i)).text().toLowerCase().indexOf(o)})},r.app.dataView.setFilterArgs({}),r.app.dataView.setFilter(r.dataViewFilterFn),r.applyFilterSettingsIfReady(),r.app.RAW_MODE&&r.app.rawModeModule.populateFilterFields()},remove:function(){this.removeDateFilters(),this.unsubscribeFromEvents(),this.$txtGlobalFilter.off(),this.$lnkResetFilters.off(),this.stopListening()},removeCustomFilterDropdowns:function(){_.each(this.instantiatedCustomFilterDropdowns,function(e){e.remove()}),this.instantiatedCustomFilterDropdowns=[],_.each(this.customFilterSelectionModels,function(e){e.destroy({wait:!1})}),this.customFilterSelectionModels=[],_.forOwn(this.customFilter$ElementsMap,_.bind(function(e){this.unsubscribeFromFilterSource(e)},this)),this.dropdownId&&($("#"+this.dropdownId).closest(".select2-container").remove(),this.dropdownId=null)},removeDateFilters:function(){_.eachRight(this.dateFilterViewInstances,function(e){e.onClose()})},renderDropdown:function(n,a,s){for(var t,e,r=this,i=H.getComponentDefinition({componentId:16,settingsModel:new w.DeepModel}),i=new w.DeepModel(i.appArgs.json),o=(r.columnFilters[a]||"").split("|"),l=0;l<o.length;l++)if(""===o[l]){o.splice(l,1);break}e=new p.DocumentViewModel({_default:o,_viewType:!0,_type:"list"}),this.customFilterSelectionModels.push(e),this.listenTo(e,"change:value",function(e,t){var i=r.encodeInputFromArray(t),o=n.find("input");o.val(i),r.columnFilters[a]=0===t.length?"":t.join("|"),r.checkResetFiltersState(),r.debounced_refreshDataView(),this.customFilterFunctions_Selection[s]=R._generateSelectionFilterFunction(t),r.refreshClearButton(o,t)}),i.set({"Basics.AcceptEmptyValues":!0,"Basics.ShowSearch":!0,"Basics.MultiSelect":!0,"Basics.SelectedValue":e,"Basics.Items":this.getDropdownItems(a,s),"Basics.FieldSummaryThreshold":0}),(t=$("<div>")).appendTo(n),this.app.api.loadApp("BasicComponents",t,i,{onReadyCallback:function(e){t.find(".select2-selection").click(),r.dropdownId=e}},function(e){r.instantiatedCustomFilterDropdowns.push(e)})},resetColumnFiltersMap:function(){this.columnFilters={}},resetCustomFilters:function(){this.customFilterFunctions_Number={},this.customFilterFunctions_Selection={},this.customFilterFunctions_DateTime={}},resetFilters:function(){var e,t;_.isNil(this.app.grid)||(e=this,(t=$(e.app.grid.getHeaderRow())).find("input").val(""),t.find(".slick-headerrow-column>i").remove(),_.each(this.customFilterSelectionModels,function(e){e.set("value",[])}),e.resetColumnFiltersMap(),e.resetCustomFilters(),e.checkResetFiltersState(),e.filterOnEnterHit&&(e.wasEnterHit=!0),e.refreshDataView())},resetGlobalFilter:function(){this.lastSearchValue="",this.searchboxChanged(this.filterOnEnterHit?{which:13}:null)},saveFilterSettings:function(){var e,t=this.getValueOfViewState(this.app.viewModel.get(this.BASICS_FILTERING));switch(t){case"Column Filters":case"Advanced Column Filters":e=$.extend(!0,{},this.columnFilters);break;case"Quick Search":e=this.lastSearchValue;break;default:e=null}this.app.api.saveSetting(this.FILTER_SETTINGS_KEY,{version:1,type:t,value:e})},searchboxChanged:function(e){if(this.filterOnEnterHit&&e){if(13!==e.which&&9!==e.which)return;this.wasEnterHit=!0}this.app.dataView&&(e=$.trim(this.$txtGlobalFilter.val()),this.lastSearchValue!==e)&&(this.lastSearchValue=e,this.$txtGlobalFilter.addClass("busy"),this.app.dataView.setFilterArgs({_globalSearchString:e}),this.refreshDataView(),this.$txtGlobalFilter.removeClass("busy"))},setupKdbFilterIfServerside:function(){this.isProcessedServerSide&&this.showAdvancedColumnFilters&&this.filterSettingsToApply&&this.app.setProperty(this.BASICS_KDB_FILTER_STRING,this.generateKdbFilterString(this.filteringMode))},showDateFilter:function(i,e,t){var o=this,t="12"+this.app.columnInfo.get(t).get("kdbType");this.removeDateFilters(),t=new c({filterValue:i.val(),app:this.app,$elActivator:i,kdbClass:t}),this.dateFilterViewInstances.push(t),this.listenTo(t,"removed",function(e){_.pull(this.dateFilterViewInstances,e)}),this.listenTo(t,"filterApplied",function(e,t){o.filterOnEnterHit&&(o.wasEnterHit=!0),i.val(e).trigger("change")})},unsubscribeFromEvents:function(){this.removeCustomFilterDropdowns(),this.app.grid&&this.onHeaderRowCellRenderedScoped&&this.app.grid.onHeaderRowCellRendered.unsubscribe(this.onHeaderRowCellRenderedScoped),this.$headerRow&&this.$headerRow.off()},unsubscribeFromFilterSource:function(e){e.serverSelectionDataSource&&(this.api.unsubscribe(e.serverSelectionDataSource),e.serverSelectionDataSource=null)},refreshClearButton:function(e,t){0<t.length?0===e.next("i").length&&e.after('<i class="fa fa-times" style="z-index: 1"/>'):e.next("i").remove()}}),_.extend(R,(_e=/(==|=>|=<|!=|<>|<=|>=|=|>|<|)((-?\d+(\.\d+)?[kmbtpe]?)|(-?null))/g,Se={e:1e18,p:1e15,t:1e12,b:1e9,m:1e6,k:1e3},Re={"=":"==","<>":"!=","=>":">=","=<":"<="},{NULL_EMPTY_VALUE:"NULL",convertSmartNumberToNumber:ke,_getNumberFilterParts:Ie,_generateNumberFilterFunction:function(e){var t=(e=Ie(e)).expressions,e=e.isAndCondition,i=_.map(t,function(t){switch(t.operator){case"is_null":return function(e){return null===e};case"is_not_null":return function(e){return null!==e};case"==":return function(e){return null!==e&&e==t.number};case"<":return function(e){return null!==e&&e<t.number};case">":return function(e){return null!==e&&e>t.number};case"<=":return function(e){return null!==e&&e<=t.number};case">=":return function(e){return null!==e&&e>=t.number};case"!=":return function(e){return null!==e&&e!=t.number}}});return 0===i.length?function(){return!0}:e?function(t){return!_.some(i,function(e){return!e(t)})}:function(t){return _.some(i,function(e){return e(t)})}},_generateSelectionFilterFunction:function(t){t=t.slice();for(var e=0;e<t.length;e++)if(t[e]===R.NULL_EMPTY_VALUE){t[e]="";break}return 0===t.length?function(){return!0}:function(e){return e=null===e?"":""+e,_.includes(t,e)}}})),(S=jQuery).extend(!0,window,{Slick:{Editors:{Text:function(i){var t,o;this.init=function(){t=S("<INPUT type=text class='editor-text' />").appendTo(i.container).bind("keydown.nav",function(e){e.keyCode!==S.ui.keyCode.LEFT&&e.keyCode!==S.ui.keyCode.RIGHT||e.stopImmediatePropagation()}).focus().select()},this.destroy=function(){t.remove()},this.focus=function(){t.focus()},this.getValue=function(){return t.val()},this.setValue=function(e){t.val(e)},this.loadValue=function(e){o=e[i.column.field]||"",t.val(o),t[0].defaultValue=o,t.select()},this.serializeValue=function(){return t.val()},this.applyValue=function(e,t){e[i.column.field]=t},this.isValueChanged=function(){return!(""==t.val()&&null==o)&&t.val()!=o},this.validate=function(){if(i.column.validator){var e=i.column.validator(t.val());if(!e.valid)return e}return{valid:!0,msg:null}},this.init()},Integer:function(i){var t,o;this.init=function(){(t=S("<INPUT type=text class='editor-text' />")).bind("keydown.nav",function(e){e.keyCode!==S.ui.keyCode.LEFT&&e.keyCode!==S.ui.keyCode.RIGHT||e.stopImmediatePropagation()}),t.appendTo(i.container),t.focus().select()},this.destroy=function(){t.remove()},this.focus=function(){t.focus()},this.loadValue=function(e){o=e[i.column.field],t.val(o),t[0].defaultValue=o,t.select()},this.serializeValue=function(){return 0<t.val().length?parseInt(t.val(),10)||0:null},this.applyValue=function(e,t){e[i.column.field]=t},this.isValueChanged=function(){return!(""==t.val()&&null==o)&&t.val()!=o},this.validate=function(){return isNaN(t.val())?{valid:!1,msg:"Please enter a valid integer"}:{valid:!0,msg:null}},this.init()},Number:Te,Float:Te,Date:function(i){var t,o,n=!1;this.init=function(){(t=S("<INPUT type=text class='editor-text' />")).appendTo(i.container),t.focus().select(),t.datepicker({showOn:"button",buttonText:"",buttonImageOnly:!0,dateFormat:"yy.mm.dd",beforeShow:function(){n=!0},onClose:function(){n=!1}}),t.width(t.width()-18)},this.destroy=function(){S.datepicker.dpDiv.stop(!0,!0),t.datepicker("hide"),t.datepicker("destroy"),t.remove()},this.show=function(){n&&S.datepicker.dpDiv.stop(!0,!0).show()},this.hide=function(){n&&S.datepicker.dpDiv.stop(!0,!0).hide()},this.position=function(e){n&&S.datepicker.dpDiv.css("top",e.top+30).css("left",e.left)},this.focus=function(){t.focus()},this.loadValue=function(e){null!==(o=e[i.column.field])&&(t.val(o),t[0].defaultValue=o,t.select())},this.serializeValue=function(){return t.val()},this.applyValue=function(e,t){e[i.column.field]=t},this.isValueChanged=function(){return!(""==t.val()&&null==o)&&t.val()!=o},this.validate=function(){return{valid:!0,msg:null}},this.init()},DateTime:function(i){var t,o,n=!1;this.init=function(){(t=S("<INPUT type=text class='editor-text' />")).appendTo(i.container),t.focus().select(),t.datetimepicker({showOn:"button",buttonImageOnly:!0,dateFormat:"yy-mm-dd",beforeShow:function(){n=!0},onClose:function(){n=!1}}),t.width(t.width()-18)},this.destroy=function(){S.datepicker.dpDiv.stop(!0,!0),t.datepicker("hide"),t.datepicker("destroy"),t.remove()},this.show=function(){n&&S.datepicker.dpDiv.stop(!0,!0).show()},this.hide=function(){n&&S.datepicker.dpDiv.stop(!0,!0).hide()},this.position=function(e){n&&S.datepicker.dpDiv.css("top",e.top+30).css("left",e.left)},this.focus=function(){t.focus()},this.loadValue=function(e){null!==o&&(o=e[i.column.field],t.val(o),t[0].defaultValue=o,t.select())},this.serializeValue=function(){return t.val()},this.applyValue=function(e,t){e[i.column.field]=t},this.isValueChanged=function(){return!(""==t.val()&&null==o)&&t.val()!=o},this.validate=function(){return{valid:!0,msg:null}},this.init()},Checkbox:function(i){var t,o;this.init=function(){(t=S("<INPUT type=checkbox value='true' class='editor-checkbox' hideFocus>")).appendTo(i.container),t.focus()},this.destroy=function(){t.remove()},this.focus=function(){t.focus()},this.loadValue=function(e){(o="string"==typeof e[i.column.field]?"true"===e[i.column.field]:!!e[i.column.field])?t.prop("checked",!0):t.prop("checked",!1)},this.serializeValue=function(){return t.prop("checked")},this.applyValue=function(e,t){e[i.column.field]=t},this.isValueChanged=function(){return this.serializeValue()!==o},this.validate=function(){return{valid:!0,msg:null}},this.init()},Time:function(i){var t,o,n=!1;this.init=function(){(t=S("<INPUT type=text class='editor-text' />")).appendTo(i.container),t.focus().select(),t.timepicker({showOn:"button",buttonImageOnly:!0,dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.000",beforeShow:function(){n=!0},onClose:function(){n=!1}}),t.width(t.width()-18)},this.destroy=function(){S.datepicker.dpDiv.stop(!0,!0),t.datepicker("hide"),t.datepicker("destroy"),t.remove()},this.show=function(){n&&S.datepicker.dpDiv.stop(!0,!0).show()},this.hide=function(){n&&S.datepicker.dpDiv.stop(!0,!0).hide()},this.position=function(e){n&&S.datepicker.dpDiv.css("top",e.top+30).css("left",e.left)},this.focus=function(){t.focus()},this.loadValue=function(e){null!==(o=e[i.column.field])&&(t.val(o),t[0].defaultValue=o,t.select())},this.serializeValue=function(){return t.val()},this.applyValue=function(e,t){e[i.column.field]=t},this.isValueChanged=function(){return!(""==t.val()&&null==o)&&t.val()!=o},this.validate=function(){return{valid:!0,msg:null}},this.init()}}}}),(Me=jQuery).extend(!0,window,{Slick:{Editors:{Date:De,Time:De,DateTime:De}}});function xe(e){this.app=e,this.pendingRows={},this.originalValues={},this.initialize()}var Fe={generate:function(e,t,i){var o="General",n="center",a=100,s=Fe.generateDefaultColumnObject();switch(t){case 1:o="Boolean",a=40;break;case 2:a=280;break;case 4:o="Number",s.Precision=0,a=35,n="right";break;case 5:o="Number",s.Precision=0,a=50,n="right";break;case 6:o="Number",s.Precision=0,a=85,n="right";break;case 7:o="Formatted Number",s.Precision=0,a=165,n="right";break;case 8:o="Formatted Number",s.Precision=4,a=80,n="right";break;case 9:o="Formatted Number",s.Precision=4,a=140,n="right";break;case 12:o="DateTime",s.TimeFormat="HH:mm:ss.SSSSSSSSS",a=200,n="right";break;case 13:o="Date",a=60,s.DateFormat="YYYY-MM",n="right";break;case 14:o="Date",a=80,n="right";break;case 15:o="DateTime",a=130,n="right";break;case 16:o="Time",s.TimeFormat="HH:mm:ss.SSSSSSSSS",a=120,n="right";break;case 17:o="Time",s.TimeFormat="HH:mm",a=40,n="right";break;case 18:o="Time",a=60,n="right";break;case 19:o="Time",s.TimeFormat="HH:mm:ss.SSS",a=80,n="right";break;case 11:case 1001:n="left"}return i&&"percentage"===e&&(o="Percentage",a=100),s.Field=e,s.DisplayName=e,s.Format=o,s.MinWidthAbsolute=a,s.TextAlign=n,s.WidthWeight=s.MinWidthAbsolute,s},generateDefaultColumnObject:function(){return this.DEFAULT_COLUMN_OBJECT||(this.DEFAULT_COLUMN_OBJECT=_.chain(_.keys(a)).map(function(e){return[e,a[e].default]}).fromPairs().value()),_.clone(this.DEFAULT_COLUMN_OBJECT)}};_.extend(xe,{KDB_2_SLICKGRID_EDITOR_MAP:{Boolean:"Checkbox",Date:"Date",DateTime:"DateTime","Formatted Number":"Float",General:"Text",Number:"Float",Percentage:"Float","Smart Number":"Float",Time:"Time"}}),_.extend(xe.prototype,w.Events,{initialize:function(){this.$feedbackPanel=this.app.$(".updateStatusFeedback"),this.$lnkToggleEdit=this.app.$(".lnkToggleEditable"),this.$lnkSubmitChanges=this.app.$(".lnkSubmitChanges"),this.$instantButtons=this.app.$(".instantButtons"),this.$lnkToggleEdit.click(function(){this.toggleEditMode(!1)}.bind(this)),this.$lnkSubmitChanges.click(this.submitTableChanges.bind(this)),this.$instantButtons.find(".submitInstant").on("click",this.submitTableChanges.bind(this)),this.$instantButtons.find(".cancelInstant").on("click",this.onCancelInstant.bind(this)),this.app.$pnlGrid.on("click",".deleteIcon",_.bind(this.deleteGridRow,this)),this.listenTo(this.app.viewModel,"change:Basics.EditMode",this.onEditModeChange.bind(this))},addDeleteColumnIfNecessary:function(e){this.isEditable&&"enabled"===this.app.viewModel.get("Basics.EditMode")&&this.app.viewModel.get("Basics.IsInsertable")&&e.push({DisplayName:"Delete",Field:"DeleteIcon",Format:"DeleteIcon",Hidden:!1,WidthWeight:0,MinWidthAbsolute:60})},refreshSelectAllState:function(e){var o=this,n=this.app.$el.find(".slick-header-columns > .slick-header-column").not(".slick-sortable-placeholder");_.each(this.app.columnsConfig,function(t){var e,i;o.app.columnIsInstantEditable(t)&&((e=(i=n.filter(function(e){return e===o.app.grid.getColumnIndex(t.id)})).find(".column-toggle-all")).length||(e=$("<input type='checkbox' class='column-toggle-all'>"),i.prepend(e),e.on("click",function(e){e.stopPropagation(),o.updateBooleanColumn(t,e.target.checked)})),i=o.app.dataView.getFilteredItems(),e.prop("checked",_.every(i,function(e){return e[t.field]})))}),e&&this.app.dataView.onRowsChanged.subscribe(function(){o.refreshSelectAllState()})},checkUpdateQueryExists:function(){var e=this.app.viewModel.get("Basics.Data");return e&&_.isFunction(e.get)&&e.get("_hasUpdateQuery")&&e.get("_updateQueryString")&&0<e.get("_updateQueryString").length},checkIfEditable:function(){this.resetUnmodifiedData(),"enabled"===this.app.viewModel.get("Basics.EditMode")&&this.checkUpdateQueryExists()?this.$lnkToggleEdit.show():(this.$lnkToggleEdit.hide(),this.$lnkSubmitChanges&&this.$lnkSubmitChanges.hide()),this.app.layoutModule&&this.app.positionPanelWithDatagrid(),"instant"===this.app.viewModel.get("Basics.EditMode")&&this.$instantButtons.hide()},convertRowsToColumns:function(e){var i={};return _.each(e,function(e){_.each(e,function(e,t){_.has(i,t)||(i[t]=[]),e&&"string"==typeof e&&0===e.length&&(e=null),i[t].push(e)})}),i},deleteGridRow:function(e){var t,i=this,e=$(e.currentTarget).data("rownumber"),e=i.app.dataView.getItem(e);e&&(t=e[i.app.SLICKGRID_ROW_UNIQUE_ID],i.app.dataView.deleteItem(t),0<=(t=_.indexOf(i.addedRows,e))?i.addedRows.splice(t,1):i.deletedRows.push(e),i.$lnkSubmitChanges)&&i.$lnkSubmitChanges.show()},hasUnmodifiedData:function(){return!!this.unmodifiedData},initializeGridListeners:function(){var n=this;n.app.grid.onCellChange.subscribe(function(e,t){var i,o={};n.app.customEditors?((i=n.app.model.dataSet.collection.get(t.item[n.app.SLICKGRID_ROW_UNIQUE_ID])).set(_.omit(t.item,"_rowIndex","idProperty")),n.app.model.trigger("rowObjectChanged",i,t)):(o[n.app.SLICKGRID_ROW_UNIQUE_ID]=t.item[n.app.SLICKGRID_ROW_UNIQUE_ID],n.editedRows.items=_.without(n.editedRows.items,_.find(n.editedRows.items,o)),((i=_.find(n.addedRows,o))?(n.addedRows=_.without(n.addedRows,i),n.addedRows):n.editedRows.items).push(t.item),n.$lnkSubmitChanges&&n.$lnkSubmitChanges.show())}),n.app.grid.onAddNewRow.subscribe(function(e,t){var i=t.item;_.each(n.app.columnInfo.pluck("id"),function(e){_.has(i,e)||(i[e]=null)}),null!==i[n.app.SLICKGRID_ROW_UNIQUE_ID]&&void 0!==i[n.app.SLICKGRID_ROW_UNIQUE_ID]||(i[n.app.SLICKGRID_ROW_UNIQUE_ID]=p.Helpers.getGUID()),t.grid.getData().addItem(i),n.addedRows.push(i),n.$lnkSubmitChanges&&n.$lnkSubmitChanges.show()})},isDataviewsLengthAffectedByDeletedRows:function(){var e=!1;return this.rowsDeleted&&(this.rowsDeleted=!(e=!0)),e},onCancelInstant:function(){this.pendingRows={},this.refreshGrid(),this.originalValues={},this.$instantButtons.hide()},onEditModeChange:function(){this.checkIfEditable(),this.app.generateDataGridFromReceivedData()},refreshGrid:function(){var e,t,o=this;this.app.RAW_MODE||(t=(e=this.app.model).dataSet,e.onExecuteBegin(),e.onExecuteSuccess({rows:_.reduce(t.collection.toJSON(),function(e,t){var i=t[o.app.primaryKey];return t=_.clone(o.originalValues[i])||t,o.pendingRows[i]&&_.extend(t,o.pendingRows[i]),e.concat(t)},[]),columns:_.keys(t.columnDict),meta:_.transform(t.columnDict,function(e,t,i){e[i]=t.kdbType})},!0))},remove:function(){this.$lnkToggleEdit.off(),this.$lnkSubmitChanges.off(),this.app.$pnlGrid.off("click",".deleteIcon"),this.stopListening()},resetLists:function(){this.editedRows={typeConfig:{},items:[]},this.addedRows=[],this.deletedRows=[]},resetUnmodifiedData:function(){this.unmodifiedData=null},setUpdateTypeConfig:function(e){this.updateTypeConfig={},e.each(_.bind(function(e){this.updateTypeConfig[e.get("id")]=e.get("kdbType")},this))},showMessageSubmitError:function(e){var t=this.$feedbackPanel;t.removeClass("success"),t.find(".feedbackText").text("An error occurred executing the update query. Error text: "+e),t.addClass("show error"),_.delay(function(){t.removeClass("show")},5e3)},showMessageSubmitSuccess:function(){var e=this.$feedbackPanel;e.removeClass("error"),e.find(".feedbackText").text(t("Update query executed successfully")),e.addClass("show success"),_.delay(function(){e.removeClass("show")},3e3)},startListeningToCurrentDataModel:function(){this.listenTo(this.app.model,"change:_updateQueryString change:_hasUpdateQuery",this.checkIfEditable)},stopListeningToCurrentDataModel:function(){this.app.model&&this.stopListening(this.app.model)},submitTableChanges:function(){function e(e){return _.map(e,function(e){return _.omit(e,"_rowIndex","idProperty")})}var t,i,o=this,n="instant"===this.app.viewModel.get("Basics.EditMode"),a=this.app.viewModel.get("Basics.Data"),s=function(){this.addedRows&&this.addedRows.length&&(this.app.dataView.suspendIndexing(),this.app.removeItemsFromDataview(this.addedRows),this.app.dataView.reactivateIndexing()),this.deletedRows&&this.deletedRows.length&&(this.rowsDeleted=!0),this.resetLists(),this.resetUnmodifiedData(),n||(this.toggleEditMode(!0),this.showMessageSubmitSuccess())}.bind(this),r=function(e){this.showMessageSubmitError(e[0])}.bind(this);Slick.GlobalEditorLock.commitCurrentEdit(),n&&(i=_.reduce(this.originalValues,function(e,t,i){return o.pendingRows[i]&&e.push(_.extend(t,o.pendingRows[i])),e},[]),(t=this.editedRows.items).push.apply(t,i)),t={typeConfig:this.updateTypeConfig,addedDict:{items:this.convertRowsToColumns(e(this.addedRows))},updatedDict:{items:this.convertRowsToColumns(e(this.editedRows.items))},deletedDict:{items:this.convertRowsToColumns(e(this.deletedRows))}},this.app.api.updateTable(a,t,s,r),n&&(this.pendingRows={},this.originalValues={},this.$instantButtons.hide(),this.app.$el.find(".pendingChange").removeClass("pendingChange"))},toggleEditMode:function(e){var t="enabled"===this.app.viewModel.get("Basics.EditMode")&&this.app.viewModel.get("Basics.IsInsertable");this.isEditable=!this.isEditable,t?this.app.viewModel.trigger("change:ColumnsConfiguration"):(this.app.grid.setOptions({editable:this.isEditable}),this.app.grid.invalidate()),this.isEditable?(this.$lnkToggleEdit.html('<i class="fa fa-fw fa-ban"></i>Cancel Editing'),this.unmodifiedData=$.extend(!0,[],this.app.dataView.getItems()),this.app.RAW_MODE&&(this.app.rawModeModule.populateFields(_.keys(this.app.dataColsMap),"editMode"),this.app.rawModeModule.removePopulateItemFn())):(this.resetLists(),this.$lnkToggleEdit.html('<i class="fa fa-fw fa-edit"></i>Edit'),this.$lnkSubmitChanges&&this.$lnkSubmitChanges.hide(),e||!this.hasUnmodifiedData()||t||(e=this.useUnmodifiedData(),this.app.dataView.beginUpdate(),this.app.dataView.setItems(e),this.app.dataView.endUpdate(),this.app.grid.invalidate()),this.app.RAW_MODE&&this.app.rawModeModule.restorePopulateItemFn())},updateBooleanColumn:function(t,i){var o=this;_.each(this.app.dataView.getFilteredItems(),function(e){e[t.field]!==i&&o.updatePendingChanges(t,e,i)}),this.refreshGrid()},updatePendingChanges:function(e,t,i){var o=t[this.app.primaryKey],e=e.field,n=this.pendingRows[o]||{},a=_.includes(_.keys(n),e);this.pendingRows[o]=a?_.omit(n,e):_.extend(n,((a={})[e]=i,a)),_.isEmpty(this.pendingRows[o])&&(this.pendingRows=_.omit(this.pendingRows,o)),_.isEmpty(this.originalValues[o])&&(this.originalValues[o]=_.clone(t)),this.$instantButtons.toggle(!_.isEmpty(this.pendingRows))},useUnmodifiedData:function(){var e=this.unmodifiedData;return this.resetUnmodifiedData(),e}});function M(){this.isActive=!1,this.instances=[],this.pendingInitObjects=[],this._refreshInternalDebounced=_.debounce(this._refreshInternal,50,{leading:!0})}function Ee(e){this.app=e,this.initialize(),this.setTheme()}function Oe(e){this.app=e,this.initialize()}function Ve(e){this.app=e,this.initialize()}function Ne(e){this.app=e,this.initialize()}function Le(e){this.app=e,this.depopulateDelay=1e4,this.initialize()}function Pe(e){this.app=e,this.initialize()}function Ae(e){this.app=e,this.initialize()}function Be(e){this.app=e,this.hasActions=!1,this.initialize()}function He(e){this.app=e,this.initialize()}function k(e){this.app=e,this.initialize()}function Ge(e){this.app=e,this.api=e.api,this.initialize()}var $e,Ue,We,Ke,ze,I,je,T,Qe=function(e,t,i){var o,n,a,s=1;return _.isNumber(e.WidthWeight)&&0<=e.WidthWeight&&(s=e.WidthWeight),n=O.getFormatter(e,i),o=Slick.Editors[xe.KDB_2_SLICKGRID_EDITOR_MAP[e.Format]],i.customEditors&&_.has(i.customEditors,e.Field)&&(o=i.customEditors[e.Field],e.IsReadonly=!1),"DeleteIcon"===e.Field&&(o=null,n=function(e,t,i,o,n){var a=document.createElement("i");return a.className="fa fa-remove deleteIcon",a.setAttribute("data-rownumber",e),a}),i=e.DisplayName||e.Field,a=((a=e.Tooltip||i)||"").replace(/(?:\\r\\n|\\r|\\n)/g,"\r\n"),t={id:e.Field+t,name:i,toolTip:a,field:e.Field,formatter:n,width:s,sortable:e.Sortable,selectable:e.IsSelectable,focusable:e.IsSelectable,editor:e.IsReadonly?null:o,cssClass:e.TextAlign,headerCssClass:e.TextAlign,_dashboardConfig:e},1<=e.MinWidthAbsolute&&(t.minWidth=e.MinWidthAbsolute),t},qe=(_.extend(M.prototype,{_addInstance:function(e){this.instances.push(e)},storeInitObjects:function(){M.loadSparklinesLib(this),M.prototype.storeInitObjects=M.prototype._storeInitObjects_AfterLibraryStartedToLoad,this.storeInitObjects.apply(this,arguments)},_storeInitObjects_AfterLibraryStartedToLoad:function(e,t,i){this.pendingInitObjects.push({el:e,values:t,cfg:i}),this.isActive=!0},remove:function(){this._removeAllInstances(),this.pendingInitObjects=[]},_removeAllInstances:function(){_.each(this.instances,function(e){e.remove()}),this.instances=[]},_removeHiddenInstances:function(){this.instances=_.filter(this.instances,function(e){if(e.is(":visible"))return!0;e.remove()})},_renderPendingInstances:function(){for(var i,o;i=this.pendingInitObjects.shift();)(o=$(i.el))&&o.is(":visible")&&(_.isArray(i.cfg)?_.each(i.cfg,function(e,t){this._addInstance(o.sparkline(i.values[t],e))}.bind(this)):this._addInstance(o.sparkline(i.values,i.cfg)))},refresh:function(){this.isActive&&(M.isLibReady?this._refreshInternalDebounced():M.isLoadingLib&&M.addPendingManager(this))},_refreshInternal:function(){this._removeHiddenInstances(),this._renderPendingInstances()}}),_.extend(M,{isLoadingLib:!1,isLibReady:!1,_pendingManagers:[],addPendingManager:function(e){M._pendingManagers.indexOf(e)<0&&M._pendingManagers.push(e)},loadSparklinesLib:function(e){e&&M.addPendingManager(e),$.fn.sparkline?M._ready():M.isLoadingLib||(M.isLoadingLib=!0,require(["sparkline"],function(){M.isLoadingLib=!1,M._ready()}))},_ready:function(){M.isLibReady=!0,M._refreshPendingManagers()},_refreshPendingManagers:function(){_.each(M._pendingManagers,function(e){e.refresh()}),M._pendingManagers=[]}}),_.extend(Ee.prototype,w.Events,{initialize:function(){this.$root=this.app.$(">.Datagrid"),this.$pnlGrid=this.app.$(".pnlGrid"),this.listenTo(this.app.viewModel,"change:Style.EvenRowBackgroundColorOverride change:Style.OddRowBackgroundColorOverride change:Style.HeaderFontWeight change:Style.FontFamily",_.bind(this.app.generateDataGridFromReceivedData,this.app)),this.listenTo(this.app.viewModel,"change:Style.FontSize",_.bind(this.app.generateDataGridFromReceivedData,this.app)),this.listenTo(this.app.viewModel,"change:Style.RowHeight change:Style.HeaderRowHeight",_.bind(this.app.generateDataGridFromReceivedData,this.app)),this.listenTo(this.app.viewModel,"change:Style.Theme",this.onChange_Theme),this.listenTo(this.app.viewModel,"change:Style.SelectedRowBackgroundColor",this.onChange_SelectedRowBackgroundColor),this.listenTo(this.app.viewModel,"change:Style.HeaderTextTransformation",this.onChange_HeaderTextTransformation)},getFontSize:function(){var e=this.app.viewModel.get("Style.FontSize");return parseFloat(e).toString()==e&&(e+="px"),e},onChange_HeaderTextTransformation:function(e,t){this.$pnlGrid.removeClass("header-uppercase header-lowercase header-capitalize"),"none"===t?this.app.generateDataGridFromReceivedData():this.$pnlGrid.addClass("header-"+t)},onChange_SelectedRowBackgroundColor:function(e,t){t?(this.$SelectedRowBackgroundColorCss=this.$SelectedRowBackgroundColorCss||$("<style />",{type:"text/css"}).appendTo(document.head),t='[data-widgetid="'+this.app.widgetId+'"]  div.Datagrid .slick-row > .slick-cell.selected { background-color: '+t+"; }",this.$SelectedRowBackgroundColorCss.html(t)):this.remove_SelectedRowBackgroundColorCss()},onChange_Theme:function(){var e,o=this,n=this.app.viewModel.get("Style.Theme"),t=(this.currentTheme&&this.$root.removeClass(this.currentTheme),this.currentTheme=n,this.$root.addClass(this.currentTheme),this.app.api&&(t=this.app.api.getProperty("Style.EvenRowBackgroundColorOverride"),e=this.app.api.getProperty("Style.OddRowBackgroundColorOverride")),[t,e]),a=["Style.EvenRowBackgroundColorOverride","Style.OddRowBackgroundColorOverride"],s=p.Tools.getDefaultThemeColors("Light"),r=p.Tools.getDefaultThemeColors("Dark");_.forEach(t,function(e,t){var i;"Light"!==n||e&&e!==r[t]?"Dark"!==n||e&&e!==s[t]||(i=r[t]):i=s[t],i&&o.app.api.setProperty(a[t],i)})},remove:function(){this.stopListening(),this.remove_SelectedRowBackgroundColorCss()},remove_SelectedRowBackgroundColorCss:function(){this.$SelectedRowBackgroundColorCss&&(this.$SelectedRowBackgroundColorCss.remove(),this.$SelectedRowBackgroundColorCss=null)},setTheme:function(){var e=this.app.dashboardViewModel.get("DashboardTheme")||"Dark";this.app.viewModel.set("Style.Theme",e)}}),{getExportMetaData:function(u){var c=this,p=[],h={GBP:"£ ",USD:"$ ",EUR:"€ ",none:""},g=c.getConfigs_datagridConfig_layoutConfig(u);return _.each(g.datagridConfig,function(e,t){var t=g.layoutConfig[t],i={},o=t.Format,n=t.DateFormat,a=t.TimeFormat,s="Percentage"===o?"%":"",r=void 0!==h[t.Currency]?h[t.Currency]:t.Currency,l=u.columnInfo.findWhere({id:e.field}),d=l?l.get("kdbType"):"",o=c.resolveColumnFormat(o,d,n,a,t.Precision,u.isRawFormat);l||console.log("Datagrid column kdbType reverted to empty, col model not foud in columnInfo"),i.colId=e.field,i.colName=e.name,i.dataType=o.dataType,i.dataKdbType=o.dataKdbType,i.dataFormat=o.dataFormat,i.hideTrailingZeroes=t.HideTrailingZeroes,i.prefix=r,i.suffix=s,p.push(i)}),p},resolveColumnFormat:function(e,t,i,o,n,a){var s="",i=p.ExportTools.DATE_FORMAT_MAP[i],o=p.ExportTools.TIME_FORMAT_MAP[o],r=11<t&&t<20,l=2<t&&t<12,d=_.includes(["Number","Formatted Number","Smart Number","Percentage"],e),u=_.includes(["Date","Time","DateTime"],e),c=(n=this.getValidPrecission(Number(n)))?"."+Array(n+1).join("0"):"";switch((t<1||19<t||a)&&(t=11,s="TO_STRING",e="String"),(!l&&d||!r&&u)&&(e="String",console.log("!!exportConverterTools value kdbType, col type, format mismatch: "+t+", "+e+", "+s)),e){case"Number":l&&(s="#0"+c);break;case"Formatted Number":e="Number",s="#,##0"+c;break;case"Smart Number":e="String",s="SmartNumber"+c;break;case"Date":s=i||(console.log("Invalid date format: "+i+". Reverting to defaut format"),"");break;case"Time":s=o||(console.log("Invalid date format: "+o+". Reverting to defaut format"),"");break;case"DateTime":s=o&&i?o:(console.log("Invalid date or time formats: "+i+", "+o+". Reverting to defaut format"),""),s=i+" "+o;break;case"Percentage":e="Number",s="#0";break;case"Boolean":e=1===t?"Boolean":"String";break;default:e="String",s="TO_STRING"}return{dataType:e=1===t?"Boolean":e,dataFormat:s,dataKdbType:t}},getValidPrecission:function(e){var t=void 0!==e?e:0;return t<0?(t=0,console.info("Invalid precission, should be between in range of 0 and 10, got: ",e)):10<t&&(t=10,console.info("Invalid precission, should be between in range of 0 and 10, got: ",e)),t},getConfigs_datagridConfig_layoutConfig:function(e){for(var i=[],o=[],n=_.clone(e.columnsConfig),a=_.clone(e.unpackedColumnsConfiguration),t=a.length-1;0<=t;t--)a[t].Hidden&&(n.splice(t,1),a.splice(t,1));return _.each(e.gridColumns,function(t){var e=_.findIndex(n,function(e){return t.id===e.id});0<=e&&(i.push(n[e]),o.push(a[e]))}),{datagridConfig:i,layoutConfig:o}},getConfig:function(e){var t={},i={".csv":"Csv",".xlsx":"Excel"}[e.fileFormat];try{if(_.some(_.values(e),function(e){return void 0===e}))throw"Missing config generator options.";t.dataSet=e.dataSet,t.metaData=this.getExportMetaData(e.columnsConfig),t.fileName=p.ExportTools.getExportFileName(e.fileName,e.altFileName,i),t.fileFormat=e.fileFormat,t.workSheetTitle=e.workSheetTitle,t.csvExportDelimiter=e.csvExportDelimiter,t.actions=e.actions,t.selectedDashboard=e.selectedDashboard}catch(e){console.error("Datagrid config generator error: ",e)}return t},getFullExportConfig:function(e){var n={},a=this.getExportMetaData(e);return a.length&&(n.columnLabel="",n.dateFormat="",_.each(a,function(e,t){var t=t<a.length-1?" && ":"",i=e.dataKdbType,o=e.colId+"#"+e.colName+t;n.columnLabel+=o,12<=i&&i<=19&&"TO_STRING"!==e.dataFormat&&(o=e.dataFormat,"DateTime"===e.dataType&&(o=o.replace(/\s([^\s]+)$/,"_$1")),i=e.colId+"#"+o+t,n.dateFormat+=i)}),new RegExp("&& $").test(n.dateFormat))&&(n.dateFormat=n.dateFormat.slice(0,-4)),n}}),x=w.View.extend({initialize:function(e){var i=this;this.options=e,this.options.theme=this.options.app.viewModel.get("Style.Theme"),this.app=this.options.app,this.$el.html(z.ColumnConfigDialog()),this.$chkRetainColumnWidths=this.$(".chkRetainColumnWidths"),this.initLayout(),this.$dialog=this.$el.dialog(_.extend({dialogClass:"Datagrid column-config-dialog",title:t("Configure Column Layout"),resizable:!1,width:"850",height:"600",modal:!0,autoOpen:!0,draggable:!0,buttons:[{text:t("Reset"),click:function(){i.wasResetHit=!0,i.initDataRows()},icons:{primary:"fa fa-refresh"}},{text:t("Ok"),click:$.proxy(i.onOkButtonClick,i),icons:{primary:"fa fa-check"}},{text:t("Cancel"),click:$.proxy(i.onClose,i),icons:{primary:"fa fa-times"}}],resizeStop:function(){i.dgSource.onResize(),i.dgTarget.onResize()},close:function(){i.trigger("closing"),i.$dialog.dialog("destroy"),i.remove()}},this.options))},filterColumnConfig:function(e,t){var i=e;switch(t){case"deepClone":i=_.cloneDeep(e);break;case"clone":i=_.clone(e)}return this.app.api.getProperty("CustomLayout.IncludeHiddenColumns")?i:_.filter(i,function(e){return _.isNil(e.Hidden)||!e.Hidden})},initDataRows:function(){var o,t,n=[],e=this.wasResetHit?(t=this.filterColumnConfig(this.options.resetColumnsConfiguration,"deepClone"),n=_.filter(t,{Hidden:!1}),_.filter(t,{Hidden:!0})):(t=this.filterColumnConfig(this.options.columnsConfiguration,"clone"),e=this.filterColumnConfig(this.options.resetColumnsConfiguration,"none"),_.each(e,function(e){_.find(t,{Field:e.Field,Format:e.Format,DisplayName:e.DisplayName})||t.push(_.cloneDeep(e))}),o=_.clone(t),visibleFields=_.map(this.options.currentColumnlayout,"field"),_.each(visibleFields,function(t){var e,i=_.filter(o,{Field:t});0===i.length?(e=_.find(o,function(e){return"*"===e.Field||0<=t.indexOf(e.Field.replace("*",""))}))&&(n.push(e),o=_.without(o,e)):(e=i[0],n.push(e),o=_.without(o,e))}),_.difference(t,n));this.populateDatagrid(this.dgSourceModel,e),this.populateDatagrid(this.dgTargetModel,n)},initLayout:function(){var e=x.generateDatagridConfig();e.set("theme",this.options.theme),this.dgSourceModel=e.get("data"),this.dgSource=new E.Master({el:this.$(".pnlSource > .pnlGrid"),model:e}),this.dgSource.$el.on("dblclick",".slick-row",$.proxy(this.onClick_moveToTarget,this)),(e=x.generateDatagridConfig()).set("theme",this.options.theme),this.selectedColumns=new p.DocumentViewModel({_default:[],_viewType:!0,_type:"list",value:[]}),e.get("datagridConfig").Selection.SelectedValue=this.selectedColumns,this.dgTargetModel=e.get("data"),this.dgTarget=new E.Master({el:this.$(".pnlTarget > .pnlGrid"),model:e}),this.dgTarget.$el.on("dblclick",".slick-row",$.proxy(this.onClick_moveToSource,this)),this.listenTo(this.dgSource,"selectedRowsChanged",this.updateButtonStates),this.listenTo(this.dgTarget,"selectedRowsChanged",this.updateButtonStates),this.initDataRows(),this.dgSource.isDialogueGrid=!0,this.dgTarget.isDialogueGrid=!0,this.$btnMoveToSource=this.$(".btnMoveToSource"),this.$btnMoveToTarget=this.$(".btnMoveToTarget"),this.$btnMoveUp=this.$(".btnMoveUp"),this.$btnMoveDown=this.$(".btnMoveDown"),this.$btnMoveToSource.button({icons:{primary:"fa fa-arrow-left"},disabled:!0,text:!1}).click($.proxy(this.onClick_moveToSource,this)),this.$btnMoveToTarget.button({icons:{primary:"fa fa-arrow-right"},disabled:!0,text:!1}).click($.proxy(this.onClick_moveToTarget,this)),this.$btnMoveUp.button({icons:{primary:"fa fa-arrow-up"},disabled:!0,text:!1}).click($.proxy(this.onClick_moveUp,this)),this.$btnMoveDown.button({icons:{primary:"fa fa-arrow-down"},disabled:!0,text:!1}).click($.proxy(this.onClick_moveDown,this))},moveSelectedColumns:function(e){var i,o,t=this.selectedColumns.get("value"),n=[];0===t.length||(i=this.dgTargetModel.dataSet.collection.toJSON(),o=i.length-1,!e&&_.max(t)===o)||e&&0===_.min(t)||(e&&(i=i.reverse(),t=_.map(t,function(e){return i.length-e-1})),t=_.sortBy(t).reverse(),_.each(t,function(e){var t;e+1<=o?(t=i[e+1],i[e+1]=i[e],i[e]=t,o=e,n.push(e+1)):(o=e-1,n.push(e))}),e&&(i=i.reverse(),n=_.map(n,function(e){return i.length-e-1})),this.populateDatagrid(this.dgTargetModel,_.map(i,"columnConfig")),this.selectedColumns.set("value",n),this.dgTarget.onSettingsChange({"Selection.SelectedValue":n}),this.dgTarget.grid.scrollRowIntoView(_.first(n)))},onClick_moveDown:function(){this.wasResetHit=!1,this.moveSelectedColumns(!1)},onClick_moveToTarget:function(){var e,t,i=this.dgSource.selectionModule.getSelectedRowObjects()||[],o=_.map(i,"pk");i.length&&(this.wasResetHit=!1,e=this.dgSourceModel.dataSet.collection.toJSON(),i=_.filter(e,function(e){return _.includes(o,e.pk)}),e=_.difference(e,i),i=_.map(i,"columnConfig"),e=_.map(e,"columnConfig"),this.populateDatagrid(this.dgSourceModel,e),this.populateDatagrid(this.dgTargetModel,this.dgTargetModel.dataSet.collection.pluck("columnConfig").concat(i)),this.dgSource.grid)&&(e=_.extend({},this.dgSource.grid.getActiveCell()),this.dgSource.grid.setSelectedRows([]),i=this.dgSource.grid.getDataLength()-1,t=this.dgTarget.grid.getDataLength()-1,this.dgSource.grid.resetActiveCell(),i>=e.row?this.dgSource.grid.setActiveCell(e.row,0):null==e.row&&0<=i&&this.dgSource.grid.setActiveCell(i,0),this.dgTarget.grid.setActiveCell(t,0))},onClick_moveToSource:function(){var e,t,i=this.dgTarget.selectionModule.getSelectedRowObjects()||[];selectedObjectPKs=_.map(i,"pk"),i.length&&(this.wasResetHit=!1,t=(t=this.dgSourceModel.dataSet.collection.toJSON()).concat(i),e=this.dgTargetModel.dataSet.collection.toJSON(),i=_.filter(e,function(e){return!_.includes(selectedObjectPKs,e.pk)}),i=_.map(i,"columnConfig"),t=_.map(t,"columnConfig"),this.populateDatagrid(this.dgSourceModel,t),this.populateDatagrid(this.dgTargetModel,i),this.dgTarget.grid)&&(e=_.extend({},this.dgTarget.grid.getActiveCell()),this.dgTarget.grid.setSelectedRows([]),t=this.dgSource.grid.getDataLength()-1,i=this.dgTarget.grid.getDataLength()-1,this.dgTarget.grid.resetActiveCell(),i>=e.row?this.dgTarget.grid.setActiveCell(e.row,0):null==e.row&&0<=i&&this.dgTarget.grid.setActiveCell(i,0),this.dgSource.grid.setActiveCell(t,0))},onClick_moveUp:function(){this.wasResetHit=!1,this.moveSelectedColumns(!0)},onClose:function(){this.$el.dialog("close")},onOkButtonClick:function(){var t,i,o,n,e,a=null,s=this;this.wasResetHit?(e=this.app.cloneDeep_processViewStates(this.app.api.getProperty("ColumnsConfiguration")),this.app.viewModel.set("ColumnsConfiguration",e,{silent:!0})):(a=[],n=this.dgTargetModel.dataSet.collection.toJSON(),e=this.dgSourceModel.dataSet.collection.toJSON(),n=_.map(n,"columnConfig"),e=_.map(e,"columnConfig"),_.each(n,function(e){e.Hidden=!1}),_.each(e,function(e){e.Hidden=!0}),this.$chkRetainColumnWidths.is(":checked")?(i=this.options.currentColumnlayout,o=1,0<i.length&&(o=_.minBy(i,"width").width),_.each(n,function(e,t){e=_.find(i,{field:e.Field})||{width:o};n[t].WidthWeight=e.width,n[t]._RetainWidth=!0})):_.each(n,function(e){t=_.find(s.options.resetColumnsConfiguration,{Field:e.Field}),e.WidthWeight=t.WidthWeight,e.MinWidthAbsolute=t.MinWidthAbsolute}),a=a.concat(n).concat(e)),this.trigger("okClick",a),this.onClose()},populateDatagrid:function(e,t){dataRows=_.map(t,function(e,t){return{pk:t,name:e.DisplayName,columnConfig:e}}),e.onExecuteBegin(),(t=x.dummyKdbResponse()).rows=dataRows,e.onExecuteSuccess(t,!0)},remove:function(){_.each([this.dgSource,this.dgTarget],function(e){e.$el.off(),e.remove()}),_.each([this.$btnMoveToSource,this.$btnMoveToTarget,this.$btnMoveUp,this.$btnMoveDown],function(e){e.off(),e.button("destroy")}),w.View.prototype.remove.apply(this,arguments)},updateButtonStates:function(){var e=0===(this.dgSource.selectionModule.getSelectedRowObjects()||[]).length,t=0===(this.dgTarget.selectionModule.getSelectedRowObjects()||[]).length;this.$btnMoveToSource.button("option","disabled",t),this.$btnMoveToTarget.button("option","disabled",e),this.$btnMoveUp.button("option","disabled",t),this.$btnMoveDown.button("option","disabled",t)}},($e=["pk","name","columnConfig"],Ue=[6,11,0],We=["pk","Name","columnConfig"],Ke=["pk","columnConfig"],{generateDatagridConfig:function(){var e=new p.DocumentDataModel({_subscriptionKey:"pk",_dataType:"copy",_maxRows:1e6});return e.apply(),e.onExecuteSuccess(x.dummyKdbResponse(),!0),new w.Model({data:e,columnsConfig:x.getColumnsConfiguration(),datagridConfig:x.datagridConfiguration(),sortColumns:x.sortColumns,theme:"Dark"})},datagridConfiguration:function(){return{Selection:{Mode:"Multi Row"}}},columnsConfiguration:function(){return _.map($e,function(e,t){return{Field:e,DisplayName:We[t],Sortable:!1,Hidden:_.includes(Ke,$e[t])}})},dummyKdbResponse:function(){return{rows:[],columns:$e,meta:_.zipObject($e,Ue)}},getColumnsConfiguration:function(){var e=x.columnsConfiguration();return _.map(e,function(e){return _.extend({},E.getColumnSettingsModel(),{DisplayName:e.Field,TextAlign:"left",IsReadonly:!0},e)})},sortColumns:[{sortCol:"pk",sortAsc:!0}]})),Ye=(_.extend(Oe.prototype,w.Events,{initialize:function(){var i=this;_.extend(this.app,Ye),this.$lnkCsvExport=this.app.$("a.lnkCsvExport"),this.$lnkExcelExport=this.app.$("a.lnkExcelExport"),this.$lnkFullExport=this.app.$("a.lnkFullExport"),this.$lnksExport=this.app.$(".lnksExport"),this.$lnkResetFilters=this.app.$(".lnkResetFilters").hide(),this.$pnlGroupedColumns=this.app.$(".pnlGroupedColumns"),this.$lblDragDropHint=this.app.$(".lblDragDropHint"),this.$pnlPager=this.app.$(".pnlPager"),this.$txtGlobalFilter=this.app.$(".txtGlobalFilter"),this.$lnkConfiguration=this.app.$(".lnkConfiguration"),this.$lnkCsvExport.click(_.bind(this.showDialog,this,".csv")),this.$lnkExcelExport.click(_.bind(this.showDialog,this,".xlsx")),this.$lnkFullExport.click(_.bind(this.apiExport,this)),this.displayChoiceLinkButtons(),this.$lnkConfiguration.click(_.bind(this.showCustomLayoutConfig,this)),this.listenTo(this.app.viewModel,"change:FileExport.ShowExportCsvButton change:FileExport.ShowExportExcelButton change:FileExport.ShowFullExportButton",_.bind(this.displayChoiceLinkButtons,this)),this.listenTo(this.app.viewModel,"change:Basics.EnableGrouping",this.onChange_EnableGrouping),this.listenTo(this.app.viewModel,"change:Basics.Filtering change:Basics.EditMode",_.bind(this.app.positionPanelWithDatagrid,this.app)),this.listenTo(this.app.viewModel,"change:Basics.ShowPagingControl change:Basics.Filtering change:Basics.IsFilterVisible",this.onChange_ShowPagingControl_Filtering_IsFilterVisible),this.listenTo(this.app.viewModel,"change:Basics.EnableCustomLayoutConfiguration",this.onChange_EnableCustomLayoutConfiguration),this.listenTo(this.app.viewModel,"change:Basics.Data",function(e,t){p.ExportTools.onQueryChange(t,i.$lnkFullExport)})},showDialog:function(e){var t=this.app.dashboardViewModel.get("selectedDocumentId"),i=this.app.api.getDashboardName(t),o=_.get(this.app,"model.path")&&0<=this.app.model.path.indexOf("AT_internal"),n=p.ExportTools,e=qe.getConfig({actions:this.app.api.getProperty("FileExport.Actions"),altFileName:this.getAltFileName(),columnsConfig:{columnInfo:this.app.columnInfo,columnsConfig:this.app.columnsConfig,unpackedColumnsConfiguration:this.app.unpackedColumnsConfiguration,gridColumns:this.app.grid.getColumns(),isRawFormat:this.app.api.getProperty("FileExport.RawFormat")},csvExportDelimiter:this.getCsvDelimiter(),dataSet:this.app.getAllFilteredItems(),fileFormat:e,fileName:this.getFileName(),selectedDashboard:{dashboardId:t,dashboardName:i},workSheetTitle:o?"ActionTracker":"Datagrid"});n.openFileExportDialog(e)},getFileName:function(){return this.app.viewModel.get("FileExport.FileName")},getCsvDelimiter:function(){return this.app.viewModel.get("FileExport.CsvExportDelimiter")},getAltFileName:function(){return this.app.viewModel.get("format.widgetTitle")||""},onChange_EnableCustomLayoutConfiguration:function(e,t){this.$lnkConfiguration[t?"show":"hide"](),this.positionPanelWithDatagrid()},onChange_EnableGrouping:function(e,t){this.$pnlGroupedColumns[t?"show":"hide"](),this.$lblDragDropHint[t?"show":"hide"](),this.positionPanelWithDatagrid()},apiExport:function(){var e,i,o,n,a,s;this.$lnkFullExport.hasClass("events-disabled")||(e=this.app.dashboardViewModel.get("selectedDocumentId"),i=this.app.api.getDashboardName(e),n={columnInfo:(o=this).app.columnInfo,columnsConfig:this.app.columnsConfig,unpackedColumnsConfiguration:this.app.unpackedColumnsConfiguration,gridColumns:this.app.grid.getColumns()},n=qe.getFullExportConfig(n),a=p.ExportTools.getExportFileName(this.getFileName(),this.getAltFileName(),"DatagridExport"),s=$("<span />").addClass("export-spinner fa fa-spinner fa-pulse").attr("title",t("Download in progress")).appendTo(this.$lnkFullExport),this.$lnkFullExport.addClass("export-in-progress"),this.app.api.exportData(this.app.viewModel.get("Basics.Data"),function(){s.remove(),o.$lnkFullExport.removeClass("export-in-progress")},{exportName:a,exportParams:n},{actions:this.app.api.getProperty("FileExport.Actions"),component:"Datagrid",dashboardId:e,dashboardName:i}))},displayChoiceLinkButtons:function(){var e=this.app.viewModel.get("FileExport");e&&(e.ShowExportCsvButton||e.ShowExportExcelButton||e.ShowFullExportButton?(this.$lnksExport.removeClass("link-disabled"),this.$lnkCsvExport.toggleClass("link-disabled",!e.ShowExportCsvButton),this.$lnkExcelExport.toggleClass("link-disabled",!e.ShowExportExcelButton),this.$lnkFullExport.toggleClass("link-disabled",!e.ShowFullExportButton)):this.$lnksExport.addClass("link-disabled"),this.positionPanelWithDatagrid())},omitColumnDefaults:function(e){return _.map(e,function(e){return p.Tools.getDeepDiff(e,n)})},onChange_ShowPagingControl_Filtering_IsFilterVisible:function(){var e=this.app.viewModel.get("Basics.ShowPagingControl"),t="Quick Search"===this.app.viewModel.get("Basics.Filtering")&&this.app.viewModel.get("Basics.IsFilterVisible");this.$pnlPager.css("display",e?"block":"none").css("right",t?"220px":"0px"),this.$txtGlobalFilter.css("display",t?"block":"none"),this.positionPanelWithDatagrid()},positionPanelWithDatagrid:function(){this.app.positionPanelWithDatagrid()},recoverColumnDefaults:function(e){return _.map(e,function(e){return _.extend({},n,e)})},remove:function(){this.$lnkCsvExport.off(),this.$lnkExcelExport.off(),this.$lnkFullExport.off(),this.$lnkConfiguration.off(),this.stopListening()},saveCurrentColumnLayout:function(){var o,n,e=this.app.grid.getColumns();this.app.summaryRowModule.updateSummmaryRow(),this.app.viewModel.get("Basics.EnableCustomLayoutConfiguration")&&e.length&&(o=$.extend(!0,[],this.app.unpackedColumnsConfiguration),n=[],_.each(e,function(e){var t=e.field,i=_.findIndex(o,function(e){return e.Field===t});0<=i&&((i=o.splice(i,1)[0]).WidthWeight=e.width,i._RetainWidth=!0,n.push(i))}),n.length)&&(n=this.omitColumnDefaults(n),this.app.api.saveSetting("UsersColumnsConfiguration",n))},showCustomLayoutConfig:function(){var t=this,e=this.app.unpackColumnConfiguration(this.app.cloneDeep_processViewStates(this.app.api.getProperty("ColumnsConfiguration")),this.app.columnInfo),i=new x({app:this.app,currentColumnlayout:t.app.grid.getColumns(),columnsConfiguration:t.app.unpackedColumnsConfiguration,resetColumnsConfiguration:e});t.listenTo(i,"closing",function(){t.stopListening(i)}),t.listenTo(i,"okClick",function(e){e=t.omitColumnDefaults(e),t.app.api.saveSetting("UsersColumnsConfiguration",e),t.app.sortingModule.storeSortColumns(),t.app.filteringModule.resetFilters(),t.app.generateDataGridFromReceivedData()})},subscribeToColumnsResizeEvent:function(){this.app.grid.onColumnsResized.subscribe(this.saveCurrentColumnLayout.bind(this))}}),{onResize:function(){var e=this;this.onResizeDebounced||(this.onResizeDebounced=_.debounce(function(){e.resizeConditional(),_.get(e.layoutModule,"app.grouping")&&e.layoutModule.app.grouping.forceColumnGrouping()},400)),this.ignoreResize||this.onResizeDebounced()},onResizeStart:function(){this.ignoreResize=!0},onResizeStop:function(){this.ignoreResize=!1,this.resizeConditional(),this.onResize()},positionPanelWithDatagrid:function(){var e=this.viewModel.get("Basics.Filtering"),t=this.viewModel.get("Basics.EnableGrouping"),i=this.viewModel.get("FileExport.ShowExportCsvButton"),o=this.viewModel.get("FileExport.ShowExportExcelButton"),n=this.viewModel.get("FileExport.ShowFullExportButton"),a=this.viewModel.get("Basics.EnableCustomLayoutConfiguration"),s="enabled"===this.viewModel.get("Basics.EditMode"),r=this.isDialogueGrid,l=!(!this.$(".lnkToggleEditable")||"none"===this.$(".lnkToggleEditable").css("display")),d="Quick Search"===e&&this.viewModel.get("Basics.IsFilterVisible"),d=this.viewModel.get("Basics.ShowPagingControl")||d;this.summaryRowModule.positionSummaryRowHeight(d),this.$pnlGrid.css("bottom",this.summaryRowModule.getSummaryRowHeight()+(d?30:0)+"px"),this.$pnlGrid.css("top",(t||i||o||n||"disabled"!==e||a||s&&l)&&!r?"36px":"0px"),this.resizeConditional()},resizeConditional:function(){this.grid&&this.$el.is(":visible")&&(this.printModule.render()||(this.grid.resizeCanvas(),this.viewModel.isLazyDataLoadingOn()&&this.grid.onViewportChanged.notify(),this.sparklinesManager.refresh(),this.summaryRowModule.updateSummaryRowScrollPosition()))},setTheme:function(){this.themeModule&&this.themeModule.setTheme()}}),V=(_.extend(Ve.prototype,w.Events,{initialize:function(){this.hideQueryStatus=this.app.api.hideQueryStatus,this.showQueryStatus=this.app.api.showQueryStatus},initializeQueryStatusHandler:function(e){this.stopListening(),e&&(this.updateQueryStatus(e,e.get("queryStatus")),this.listenTo(e,"change:queryStatus",this.updateQueryStatus))},remove:function(){this.stopListening()},updateQueryStatus:function(e,t){t?this.showQueryStatus(t):this.hideQueryStatus()}}),(ze=jQuery).extend(!0,window,{Slick:{Data:{GroupItemMetadataProvider:function(s){var n,e={groupCssClass:"slick-group",groupTitleCssClass:"slick-group-title",totalsCssClass:"slick-group-totals",groupFocusable:!0,totalsFocusable:!1,toggleCssClass:"slick-group-toggle",toggleExpandedCssClass:"expanded",toggleCollapsedCssClass:"collapsed",enableExpandCollapse:!0,groupFormatter:function(e,t,i,o,n){var a;return s.enableExpandCollapse?(a=15*n.level+"px","<span class='"+s.toggleCssClass+" "+(n.collapsed?s.toggleCollapsedCssClass:s.toggleExpandedCssClass)+"' style='margin-left:"+a+"'></span><span class='"+s.groupTitleCssClass+"' level='"+n.level+"'>"+n.title+"</span>"):n.title},totalsFormatter:function(e,t,i,o,n){return o.groupTotalsFormatter&&o.groupTotalsFormatter(n,o)||""}};function t(e,t){var i,t=this.getDataItem(t.row);t&&t instanceof Slick.Group&&ze(e.target).hasClass(s.toggleCssClass)&&(i=n.getRenderedRange(),this.getData().setRefreshHints({ignoreDiffsBefore:i.top,ignoreDiffsAfter:i.bottom+1}),t.collapsed?this.getData().expandGroup(t.groupingKey):this.getData().collapseGroup(t.groupingKey),e.stopImmediatePropagation(),e.preventDefault())}function i(e,t){var i,o;s.enableExpandCollapse&&e.which==ze.ui.keyCode.SPACE&&(i=this.getActiveCell())&&(i=this.getDataItem(i.row))&&i instanceof Slick.Group&&(o=n.getRenderedRange(),this.getData().setRefreshHints({ignoreDiffsBefore:o.top,ignoreDiffsAfter:o.bottom+1}),i.collapsed?this.getData().expandGroup(i.groupingKey):this.getData().collapseGroup(i.groupingKey),e.stopImmediatePropagation(),e.preventDefault())}return s=ze.extend(!0,{},e,s),{init:function(e){(n=e).onClick.subscribe(t),n.onKeyDown.subscribe(i)},destroy:function(){n&&(n.onClick.unsubscribe(t),n.onKeyDown.unsubscribe(i))},getGroupRowMetadata:function(e){return{selectable:!1,focusable:s.groupFocusable,cssClasses:s.groupCssClass,columns:{0:{colspan:"*",formatter:s.groupFormatter,editor:null}}}},getTotalsRowMetadata:function(e){return{selectable:!1,focusable:s.totalsFocusable,cssClasses:s.totalsCssClass,formatter:s.totalsFormatter,editor:null}}}}}}}),_.extend(Ne.prototype,w.Events,{initialize:function(){this.$pnlGroupedColumns=this.app.$(".pnlGroupedColumns"),this.$lblDragDropHint=this.app.$(".lblDragDropHint"),this.$pnlGrid=this.app.$(".pnlGrid"),this.$frame=this.app.$(".datagridFrame"),this.groupedColumns=[],this.initGrouping(),this.listenTo(this.app.viewModel,"change:Basics.GroupingAutoCollapse",this.applyGroupingAutoCollapse),this.listenTo(this.app.viewModel,"change:Basics.EnableGrouping",this.onChange_EnableGrouping),this.listenTo(this.app.viewModel,"change:GroupingConfiguration",this.onChange_GroupingConfiguration),this.listenTo(this.app.viewModel,"change:SummaryRow_Groupings",this.onChange_SummaryRow_Groupings)},appendGroupingItem:function(e){var t,i=this;i.groupedColumns.push(e.id),e=$('<div class="groupedItem">'+e.name+"</div>").data("column",e),(t=$('<i class="btnClose fa fa-close"></i>')).click(function(){var e=$(this).parent(),t=e.data("column").id;i.groupedColumns=_.without(i.groupedColumns,t),e.fadeOut(function(){e.remove(),i.groupingChanged()})}),e.append(t).hide().appendTo(i.$pnlGroupedColumns).fadeIn(),i.groupingChanged()},applyGrouping:function(e){e=_.find(this.app.columnsConfig,{field:e});e&&(this.$lblDragDropHint.hide(),this.appendGroupingItem(e),this.applyGroupingAutoCollapse())},applyGroupingAutoCollapse:function(){this.app.dataView&&(this.app.viewModel.get("Basics.GroupingAutoCollapse")?this.app.dataView.collapseAllGroups():this.app.dataView.expandAllGroups())},clearGrouping:function(){this.$pnlGroupedColumns.find(".btnClose").off(),this.$pnlGroupedColumns.find(">.groupedItem").remove()},fixColumnReorderingLayoutIssue:function(){var i=this;this.app.grid.onBeforeColumnsReordered.subscribe(function(e,t){i.$pnlGrid.removeClass("tempGroupingFix")}),this.app.grid.onColumnsReordered.subscribe(function(e,t){i.app.resizeConditional(),i.app.layoutModule&&i.app.layoutModule.saveCurrentColumnLayout()}),this.app.grid.onColumnsReorderStart.subscribe(function(e,t){i.$pnlGrid.addClass("tempGroupingFix")})},groupingChanged:function(){var e,t,n=this,a=[],s=n.app.viewModel.get("SummaryRow_Groupings"),r=[];n.app.dataView&&!n.avoidLoopback&&(0===n.groupedColumns.length&&n.app.viewModel.get("Basics.EnableGrouping")&&n.$lblDragDropHint.show(),_.each(n.$pnlGroupedColumns.children(".groupedItem"),function(e,t){var o=$(e).data("column"),e=o.field,i={};a.push(i.getter=e),n.app.groupingsOrder&&t<=n.app.groupingsOrder.length&&(_.isFunction(n.app.groupingsOrder[t])?i.comparer=n.app.groupingsOrder[t]:"asc"===n.app.groupingsOrder[t]?i.comparer=function(e,t){return e.value-t.value}:i.comparer=function(e,t){return t.value-e.value}),i.formatter=function(e){var t=void 0,i=e.value;return _.isArray(e.rows)&&(t=e.rows[0]),o.formatter&&(i=(i=o.formatter(void 0,void 0,i,void 0,t,!0)).outerHTML),t=O.getSummaryRowHtml(e,s,n.app.columnsConfig,n.app),i+' <span class="lblGropRowCount">('+e.count+" items)</span>"+t},r.push(i)}),n.app.RAW_MODE&&(n.app.rawModeModule.populateFields(a,"group"),t=[],a.length&&(_.each(s,function(e){t.push(e.Column),t.push(e.Column2)}),t=_.uniq(_.compact(t))),n.app.rawModeModule.populateFields(t,"groupSummary")),n.app.dataView.setGrouping(r),n.applyGroupingAutoCollapse(),n.defaultGroupingLoaded)&&!_.some(n.app.api.getProperty("GroupingConfiguration"),{ColumnProperty:""})&&(e=_.map(r,function(e){return{ColumnProperty:e.getter}}),n.avoidLoopback=!0,n.app.api.saveSetting("GroupingConfiguration",e),n.app.api.setProperty("GroupingConfiguration",e),n.avoidLoopback=!1)},initGrouping:function(){var o=this;o.groupedColumns=[],o.$pnlGroupedColumns.droppable({accept:function(e){return $(e).parents(".datagridFrame").get(0)===o.$frame.get(0)},hoverClass:"ui-state-hover",drop:function(e,t){var i=$(t.draggable).data("column");i&&(o.$lblDragDropHint.hide(),_.includes(o.groupedColumns,i.id)?(0<=$(e.toElement||e.originalEvent.target).attr("class").indexOf("slick")&&(t=_.find(o.$pnlGroupedColumns.children(".groupedItem"),function(e){return $(e).data("column").id===i.id}))&&$(t).appendTo(o.$pnlGroupedColumns),_.defer(_.bind(o.groupingChanged,o))):o.appendGroupingItem(i))}}),o.$pnlGroupedColumns.sortable({cancel:""}).disableSelection()},loadAndApplyGroupingSettings:function(){var t=this,e=(this.groupedColumns=[],this.clearGrouping(),t.app.api.loadSetting("GroupingConfiguration")||t.app.viewModel.get("GroupingConfiguration"));_.each(e,function(e){t.applyGrouping(e.ColumnProperty)}),t.defaultGroupingLoaded=!0},modifyDataViewConfig:function(e){this.groupItemMetadataProvider=new Slick.Data.GroupItemMetadataProvider,_.extend(e,{groupItemMetadataProvider:this.groupItemMetadataProvider})},onChange_EnableGrouping:function(e,t){var i=this;!t&&i.app.dataView&&_.defer(function(){i.groupedColumns=[],i.resetGrouping(),i.app.api.setProperty("GroupingConfiguration",[])})},onChange_GroupingConfiguration:function(){var t,e;this.app.skipGridGeneration||this.avoidLoopback||(e=(t=this).app.viewModel.get("GroupingConfiguration"),this.groupedColumns=[],this.clearGrouping(),e&&e.length&&_.each(e,function(e){t.applyGrouping(e.ColumnProperty)}),this.groupingChanged())},onChange_SummaryRow_Groupings:function(){_.each(_.compact(this.app.viewModel.get("SummaryRow_Groupings")),function(e,t){t="SummaryRow_Groupings.".concat(t,".Column2");"WAVG"===e.Function?void 0===e.Column2&&(this.app.viewModel.set(t,"",{silent:!0}),this.app.api.setProperty(t,"")):void 0!==e.Column2&&(this.app.viewModel.set(t,void 0,{silent:!0}),this.app.api.setProperty(t,void 0))}.bind(this)),this.app.generateDataGridFromReceivedData()},remove:function(){this.$pnlGroupedColumns.data("uiDroppable")&&this.$pnlGroupedColumns.droppable("destroy"),this.$pnlGroupedColumns.data("uiSortable")&&this.$pnlGroupedColumns.sortable("destroy"),this.clearGrouping(),this.stopListening()},resetGrouping:function(){var e=this.app.viewModel.get("Basics.EnableGrouping"),t=this.app.dataView;t&&t.setGrouping([]),this.groupedColumns=[],this.clearGrouping(),e&&this.$lblDragDropHint.show()},saveGroupingState:function(){var i=this;i.dataRefresh?i.setSavedGroupingState():(i.collapsedGroups=[],i.expandedGroups=[],_.each(i.$pnlGrid.find(".slick-group-toggle"),function(e,t){($(e).hasClass("collapsed")?i.collapsedGroups:i.expandedGroups).push({groupTitle:$(e).siblings(".slick-group-title")[0].childNodes[0].textContent,groupIndex:t})}))},setDataRefresh:function(e){this.dataRefresh=e},setSavedGroupingState:function(){var i=this.$pnlGrid.find(".slick-group-toggle");this.app.viewModel.get("Basics.GroupingAutoCollapse")?_.each(this.expandedGroups,function(t){var e=_.filter(i,function(e){return $(e).siblings(".slick-group-title")[0].childNodes[0].textContent===t.groupTitle});e[0]&&$(e[0]).hasClass("collapsed")&&$(e[0]).mousedown()}):_.each(this.collapsedGroups,function(t){var e=_.filter(i,function(e){return $(e).siblings(".slick-group-title")[0].childNodes[0].textContent===t.groupTitle});e[0]&&$(e[0]).hasClass("expanded")&&$(e[0]).mousedown()})}}),(I=jQuery).extend(!0,window,{Slick:{Controls:{Pager:function(o,i,n){var a,e,t,s,r;function l(){var e=!Slick.GlobalEditorLock.commitCurrentEdit(),t=o.getPagingInfo(),i=t.totalPages-1;return{canGotoFirst:!e&&0!=t.pageSize&&0<t.pageNum,canGotoLast:!e&&0!=t.pageSize&&t.pageNum!=i,canGotoPrev:!e&&0!=t.pageSize&&0<t.pageNum,canGotoNext:!e&&0!=t.pageSize&&t.pageNum<i,pagingInfo:t}}function d(e){o.setRefreshHints({isFilterUnchanged:!0}),o.setPagingOptions({pageSize:e})}function u(){l().canGotoFirst&&o.setPagingOptions({pageNum:0})}function c(){var e=l();e.canGotoLast&&o.setPagingOptions({pageNum:e.pagingInfo.totalPages-1})}function p(){var e=l();e.canGotoPrev&&o.setPagingOptions({pageNum:e.pagingInfo.pageNum-1})}function h(){var e=l();e.canGotoNext&&o.setPagingOptions({pageNum:e.pagingInfo.pageNum+1})}function g(e){var t,i=l();n.find(".slick-pager-nav span").removeClass("ui-state-disabled"),i.canGotoFirst||n.find(".ui-icon-seek-first").addClass("ui-state-disabled"),i.canGotoLast||n.find(".ui-icon-seek-end").addClass("ui-state-disabled"),i.canGotoNext||n.find(".ui-icon-seek-next").addClass("ui-state-disabled"),i.canGotoPrev||n.find(".ui-icon-seek-prev").addClass("ui-state-disabled"),0==e.pageSize?(i=o.getItems().length,(t=e.totalRows)<i?a.text("Showing "+t+" of "+i+" rows"):a.text("Showing all "+i+" rows"),a.text("Showing all "+e.totalRows+" rows")):a.text("Showing page "+(e.pageNum+1)+" of "+e.totalPages)}o.onPagingInfoChanged.subscribe(function(e,t){g(t)}),n.empty(),e=I("<span class='slick-pager-nav' />").appendTo(n),t=I("<span class='slick-pager-settings' />").appendTo(n),a=I("<span class='slick-pager-status' />").appendTo(n),t.append("<span class='slick-pager-settings-expanded' style='display:none'>Show: <a data=0>All</a><a data='-1'>Auto</a><a data=25>25</a><a data=50>50</a><a data=100>100</a></span>"),t.find("a[data]").click(function(e){var t,e=I(e.target).attr("data");null!=e&&d(-1==e?(t=i.getViewport()).bottom-t.top:parseInt(e))}),I((s="<span class='ui-state-default ui-corner-all ui-icon-container'><span class='ui-icon ")+"ui-icon-lightbulb"+(r="' /></span>")).click(function(){t.find(".slick-pager-settings-expanded").toggle()}).appendTo(t),I(s+"ui-icon-seek-first"+r).click(u).appendTo(e),I(s+"ui-icon-seek-prev"+r).click(p).appendTo(e),I(s+"ui-icon-seek-next"+r).click(h).appendTo(e),I(s+"ui-icon-seek-end"+r).click(c).appendTo(e),n.find(".ui-icon-container").hover(function(){I(this).toggleClass("ui-state-hover")}),n.children().wrapAll("<div class='slick-pager' />"),g(o.getPagingInfo())}}}}),je=function(e){this.app=e,this.$moduleEl=this.app.$(".pnlPager")},_.extend(je.prototype,{afterInitialize:function(e){this.restoreCurrentState(),_.isFunction(e)&&e()},initPager:function(e,t){this.removePager(),this.app.viewModel.isLazyDataLoadingOn()||(this.$pager=$("<div />").addClass("pager").appendTo(this.$moduleEl),e?(this.pager=new A({api:this.app.api,el:this.$pager[0],skipDataSourceSubscription:!0}),_.extend(this,this.pager),this.listenTo(this.app.viewModel,"change:Basics.Data",this.onChange_Data),this.onChange_Data(),this.pendingOnData&&(this.onData.apply(this,this.pendingOnData),delete this.pendingOnData),this.listenTo(this.pager,"paged",function(){this.trigger("paged")})):(this.pager=new Slick.Controls.Pager(this.app.dataView,this.app.grid,this.$pager),_.extend(je.prototype,w.Events))),this.afterInitialize(t)},onChange_Data:function(){this.onSettingsChange({"Basics.Data":this.app.viewModel.get("Basics.Data")})},onData:function(){this.pendingOnData=arguments},onSettingsChange:$.noop,remove:function(){this.removePager(),this.stopListening()},removePager:function(){this.pager&&_.isFunction(this.pager.remove)&&this.pager.remove(),this.$pager&&this.$pager.remove(),this.pager=null},restoreCurrentState:function(){this.pagerState&&this.$pager&&this.$pager.find(".slick-pager-settings-expanded").css("display",this.pagerState)},setSortConfig:$.noop,storeCurrentState:function(){this.$pager&&(this.pagerState=this.$pager.find(".slick-pager-settings-expanded").css("display"))},listenTo:$.noop,listenToOnce:$.noop,off:$.noop,on:$.noop,once:$.noop,stopListening:$.noop,trigger:$.noop}),_.extend(Le.prototype,w.Events,{initialize:function(){this._debouncedDepopulateFields=_.debounce(this.depopulateFields,this.depopulateDelay,{trailing:!0})},cacheScrollValues:function(e,t,i){this.lastdisplayedDataTop=e,this.lastdisplayedDataIdTop=t,this.scrollLeft=i},createRowFromColumns:function(i,e,o){return _.each(e,function(e,t){i[t]=e.toLegacy(o)}),i},depopulateFields:function(){var i=this,o=i.app.dataView.getItems();_.each(i.getFieldsToDepopulate(i.app.populatedFields),function(e,t){delete i.app.populatedFields[t],_.each(o,function(e){delete e[t]})})},getAllFilteredItems:function(){for(var e=[],t=this.app.dataView.getItems(),i=this.app.SLICKGRID_ROW_UNIQUE_ID,o=0;o<this.app.pks.length;o++){var n=this.app.pkOffsetMap[t[o][i]],n=this.createRowFromColumns({},this.app.dataColsMap,n);n[this.app.primaryKey]||(n[this.app.primaryKey]=o),e.push(n)}return this.app.dataView.filterRows(e)},getFieldsToDepopulate:function(e){return _.pickBy(e,function(t){return _.every(_.keys(t),function(e){return!t[e]})})},getRowData:function(i,t){for(var o=this.app.columnInfo.get(this.app.SLICKGRID_ROW_UNIQUE_ID)?i.cols[this.app.SLICKGRID_ROW_UNIQUE_ID]:{length:this.app.columnInfo.at(0)?i.cols[this.app.columnInfo.at(0).id].length:0,toLegacy:_.identity},e=o.length,n=[],a=(i.reset=[],{}),s=_.isFinite(t)?function(e){return t+Number(o.toLegacy(e))}:function(e){return o.toLegacy(e)},r=0;r<e;r++){var l={},d=s(r);n.push(d),l[this.app.SLICKGRID_ROW_UNIQUE_ID]=d,i.reset.push(l),a[d]=r}return{pks:n,pkOffsetMap:a,dataColsMap:dataColsMap=_.reduce(this.app.columnInfo.map("id"),function(e,t){return e[t]=i.cols[t],e},{})}},modifyDataViewConfig:function(e){_.extend(e,{populateItem:_.bind(this.populateItem,this)})},populateFields:function(o,i,e){var n=this,a={},s=(this.app.populatedFields=this.app.populatedFields||{},o=_.without(_.uniq(_.compact(o)),n.app.SLICKGRID_ROW_UNIQUE_ID),_.reduce(o,function(e,t){return e[t]=!0,e},{}));_.each(this.app.populatedFields,function(e,t){s[t]?(o=_.without(o,t),this.app.populatedFields[t][i]=!0):this.app.populatedFields[t][i]&&(this.app.populatedFields[t][i]=!1,a[t]=this.app.populatedFields[t])}.bind(this)),o=_.filter(o,function(e){return n.app.dataColsMap[e]}),_.each(o,function(e,t){n.app.populatedFields[e]=n.app.populatedFields[e]||{},n.app.populatedFields[e][i]=!0}),o.length&&(e=e?_.map(n.app.dataView.mapRowsToIds(e),function(e){return n.app.dataView.getItemById(e)}):n.app.dataView.getItems(),_.each(e,function(t){var i=n.app.pkOffsetMap[t[n.app.SLICKGRID_ROW_UNIQUE_ID]];_.each(o,function(e){t[e]=n.app.dataColsMap[e].toLegacy(i)})})),_.isEmpty(this.getFieldsToDepopulate(a))||this._debouncedDepopulateFields()},populateFilterFields:function(e){var i,o;this.app.grid&&(this.app.filteringModule.showAdvancedColumnFilters||this.app.filteringModule.showColumnFilters?(i=[],o=this,_.each(this.app.filteringModule.columnFilters,function(e,t){e&&(e=o.app.grid.getColumnIndex(t),t=o.app.grid.getColumns()[e])&&i.push(t.field)}),_.isArray(e)&&(i=_.union(i,e)),this.populateFields(i,"filter")):this.app.filteringModule.showQuickSearch&&!_.isEmpty(this.app.filteringModule.lastSearchValue)&&this.populateFields(_.keys(this.app.dataColsMap),"search"))},populateItem:function(e){var t,i=this;if(e)return t=i.app.pkOffsetMap[e[i.app.SLICKGRID_ROW_UNIQUE_ID]],i.createRowFromColumns(_.extend({},_.pick(e,i.app.SLICKGRID_ROW_UNIQUE_ID)),i.app.dataColsMap,t)},remove:function(){this.reset()},removePopulateItemFn:function(){this.replacePopulateItemFn(_.identity)},replacePopulateItemFn:function(e){this.app.dataView&&(this.app.dataView.getOptions().populateItem=e)},reset:function(){this._debouncedDepopulateFields.flush(),this._debouncedDepopulateFields.cancel(),this.app.populatedFields=null},resetVerticalScrollValues:function(){this.lastdisplayedDataTop&&(this.app.scrollingModule.lastdisplayedDataTop=this.lastdisplayedDataTop),this.lastdisplayedDataIdTop&&(this.app.scrollingModule.lastdisplayedDataIdTop=this.lastdisplayedDataIdTop)},restorePopulateItemFn:function(){this.replacePopulateItemFn(_.bind(this.populateItem,this))},switchDataviewGetters:function(){var e=this.app.dataView;e&&e instanceof Slick.Data.DataView&&(e.getItemById_orig=e.getItemById_orig||e.getItemById,this.app.RAW_MODE?e.getItemById=function(e){e=this.dataView.getItemById_orig(e);return this.rawModeModule.populateItem.call(this.rawModeModule,e)}.bind(this.app):e.getItemById=e.getItemById_orig)}}),_.extend(Pe.prototype,w.Events,{hasNaturalOrder:!0,initialize:function(){this.listenTo(this.app.viewModel,"change:Basics.SortColumn change:Basics.SortOrder change:ColumnsConfiguration",_.after(3,this.onSortingConfigChanged))},generateSortFunctions:function(d){var u=this.app.columnInfo,c=this.app.sortFunctions,p=this.app.sortColumnsForCaseInsensitiveSort||[],h=this;return _.map(d,function(e,t){var n,i,o,a=d.length,s=e.sortAsc?1:-1,r=e.sortCol.field,e=t===a-1,l=_.includes(p,r)?function(e){return(e[r]||"").toLowerCase()}:function(e){return e[r]},t=c&&_.isFunction(c[t])?_.wrap(c[t],function(e,t,i){return e(l(t),l(i),s)}):(a=u.get(r))?(i=b.getComparator(a.get("kdbType"),l),function(e,t){return i(l(e),t)*s}):function(){return 0};return e&&(o=h.app.SLICKGRID_ROW_UNIQUE_ID,n=function(e){return e[o]},t=_.wrap(t,function(e,t,i){var o,e=e(t,i);return e=0===e&&(o=h.app.dataView,t=n(t),i=n(i),null!=t)&&null!=i?o.getIdxById(t)>o.getIdxById(i)?1:-1:e})),t})},initDefaultSortings:function(){var o=this,e=this.app.sortColumns;e&&(this.app.sortColumns=null,this.sortingSpec=_.compact(_.map(e,function(t){var e=null,i=_.find(o.app.columnsConfig,function(e){return e.field===t.sortCol});return e=i&&_.find(o.app.viewModel.get("ColumnsConfiguration"),{Field:t.sortCol})?{columnId:i.id,sortAsc:t.sortAsc}:e})))},isInNaturalOrder:function(){return this.hasNaturalOrder},isSortingSpecEmpty:function(){return!(this.sortingSpec&&this.sortingSpec.length)},modifyViewStates:function(e){var t=this.app.api.getPropertyMeta("Basics.SortColumn"),i=this.app.api.getPropertyMeta("Basics.SortOrder"),o="";t&&"viewstate"===t.type&&i&&"viewstate"===i.type&&(e&&e[0]&&(o=e[0].sortCol.field,t=e[0].sortAsc?"ascending":"descending",this.app.viewModel.set("Basics.SortOrder",t,{silent:!0}),this.app.api.setProperty("Basics.SortOrder",t)),this.app.viewModel.set("Basics.SortColumn",o,{silent:!0}),this.app.api.setProperty("Basics.SortColumn",o))},onSortingConfigChanged:function(){this.app.sortColumns||(this.app.viewModel.get("Basics.SortColumn")?(this.app.sortColumns=[{sortCol:this.app.viewModel.get("Basics.SortColumn"),sortAsc:"ascending"===this.app.viewModel.get("Basics.SortOrder").toLocaleLowerCase()}],this.app.grid&&(this.initDefaultSortings(),this.triggerSorting())):this.app.grid&&(this.sortingSpec=[{columnId:"nonexistentColumn123"}],this.triggerSorting()))},onData:function(){this.pendingSortConfig&&(this.sortSlickgrid(this.pendingSortConfig),this.pendingSortConfig=null)},remove:function(){this.stopListening(),this.dataChangeSet=null},resetSortingSpec:function(){this.sortingSpec=null},setDataChangeSet:function(e){this.dataChangeSet=e,this.positionMap=null},sortSlickgrid:function(a,e){var s,o=this;a&&0===(a=_.filter(a,"sortCol")).length&&o.dataChangeSet?(o.positionMap=o.positionMap||_.reduce(o.dataChangeSet.items(),function(e,t,i){return e[t[o.app.SLICKGRID_ROW_UNIQUE_ID]]=i,e},{}),_.isEmpty(o.positionMap)||(o.app.dataView.sort(function(e,t){return o.positionMap[e[o.app.SLICKGRID_ROW_UNIQUE_ID]]-o.positionMap[t[o.app.SLICKGRID_ROW_UNIQUE_ID]]}),o.hasNaturalOrder=!0)):(s=this.generateSortFunctions(a),o.hasNaturalOrder=!1,o.app.dataView.sort(function(e,t){for(var i,o=0,n=a.length;o<n;o++)if(0!==(i=s[o](e,t)))return i;return 0},void 0,e))},storeSortColumns:function(){var i,o=this.app.grid;o&&(i=o.getColumns(),this.app.sortColumns=_.compact(_.map(o.getSortColumns(),function(e){var t=o.getColumnIndex(e.columnId);return void 0===t?null:{sortCol:i[t].field,sortAsc:e.sortAsc}})))},storeSortingSpec:function(){this.app.grid&&this.app.api.getPropertyMeta&&(this.sortingSpec=this.app.grid.getSortColumns())},subscribeToSortEvent:function(e,t){var n=this;n.app.grid.onSort.subscribe(function(e,t){var i,o=t.multiColumnSort?t.sortCols:[{sortAsc:t.sortAsc,sortCol:t.sortCol}];n.app.pagerModule&&_.isFunction(n.app.pagerModule.setSortConfig)&&n.app.model&&n.app.model.get("_serverPaging")?(i={},_.each(t.sortCols,function(e){i[e.sortCol.field]=e.sortAsc}),n.app.viewModel.isLazyDataLoadingOn()?n.app.api.page(n.app.model,{_pageSort:i}):(n.pendingSortConfig=o,n.app.pagerModule.setSortConfig(i),n.app.highlightingModule.processMinMaxHighlighting())):n.app.filteringModule.isProcessedServerSide&&!n.forceResort?n.sortSlickgrid(o,!0):(n.app.RAW_MODE&&n.app.rawModeModule.populateFields(_.map(o,function(e){return e.sortCol.field}),"sort"),n.sortSlickgrid(o),n.app.highlightingModule.processMinMaxHighlighting()),n.app.api.getPropertyMeta&&n.modifyViewStates(o)})},triggerSorting:function(){var i=this,o=!1;i.sortingSpec&&i.sortingSpec.length&&(i.app.grid.setSortColumns(i.sortingSpec),i.sortingSpec=_.map(i.sortingSpec,function(t){var e=_.find(i.app.columnsConfig,function(e){return e.id===t.columnId});return void 0===e?o=!0:t.sortCol={field:e.field},t}),o&&(i.sortingSpec=[]),i.app.grid.onSort.notify({multiColumnSort:!0,sortCols:i.sortingSpec},null,i.grid),i.sortingSpec=null)}}),_.extend(Ae.prototype,w.Events,{initialize:function(){this.listenTo(this.app.viewModel,"change:Basics.ScrollValueV",this.onScrollValueChanged),this.listenTo(this.app,"model-unset",this.onModelUnset),this.listenToOnce(this.app,"data-processed",this.onDataProcessed)},handleScrollInfo:function(e){var t,i,o=0,n=this;n.lastRowDisplayed=!1,0===e.scrollTop?(n.lastdisplayedDataTop=void 0,n.lastdisplayedDataIdTop=void 0):(i=n.app.grid.getViewport(),t=n.app.grid.getData(),n.lastdisplayedDataTop=void 0,_.find(_.range(i.top,i.bottom+1),function(e){e=t.getItem(e);if(!(e instanceof Slick.NonDataRow))return n.lastdisplayedDataTop=e,!0}),n.lastdisplayedDataTop&&(n.lastdisplayedDataIdTop=n.lastdisplayedDataTop[n.app.SLICKGRID_ROW_UNIQUE_ID]),i.bottom>t.getLength()&&(n.lastRowDisplayed=!0),o=i.top),this.isViewState_ScrollValueV()&&(this.manualSet=!0,this.app.api.setProperty("Basics.ScrollValueV",o),this.manualSet=!1),n.app.RAW_MODE&&n.app.rawModeModule.cacheScrollValues(n.lastdisplayedDataTop,n.lastdisplayedDataIdTop,e.scrollLeft)},isViewState_ScrollValueV:function(){var e,t=!1;return t=this.app.api.getPropertyMeta?!(!(e=this.app.api.getPropertyMeta("Basics.ScrollValueV"))||"viewstate"!==e.type):t},onDataProcessed:function(e){e?this.listenToOnce(this.app,"data-processed",this.onDataProcessed):void 0!==this.pendingScrollValueV&&(this.pendingScrollValueV=void 0,this.onScrollValueChanged())},onModelUnset:function(){this.pendingScrollValueV=void 0},onScrollValueChanged:function(){var e;this.isViewState_ScrollValueV()&&!this.app.api.getProperty("Selection.FollowSelectedValue")&&(this.app.grid?this.manualSet||void 0!==(e=this.parseInt_ScrollValueV())&&this.scrollTo(e):void 0!==(e=this.parseInt_ScrollValueV())&&(this.pendingScrollValueV=e))},parseInt_ScrollValueV:function(){var e=parseInt(this.app.api.getProperty("Basics.ScrollValueV"),10);return e=_.isNaN(e)?void 0:e},remove:function(){this.stopListening()},scrollTo:function(e,t){t&&(t=this.app.grid.getViewport(),e=Math.max(0,e-Math.floor((t.bottom-t.top)/2))),this.app.grid.scrollRowToTop(e)},subscribeToScrollEvent:function(){var i=this;i.app.grid.onScroll.subscribe(function(e,t){i.app.sparklinesManager.refresh(),i.app.highlightingModule.processMinMaxHighlighting_debouncedMore(),i.handleScrollInfo(t)})},updateScrollPosition:function(){var i,o=this;this.app.model.get("_forceReset")&&(o.lastRowDisplayed?o.app.grid.scrollRowIntoView(999999999999,!1):o.lastdisplayedDataTop&&o.app.sortingModule.isSortingSpecEmpty()&&_.find(o.app.grid.getData().getItems(),function(e,t){return i=t,e[o.app.SLICKGRID_ROW_UNIQUE_ID]===o.lastdisplayedDataIdTop})&&o.app.grid.scrollRowToTop(i))}}),(T=jQuery).extend(!0,window,{Slick:{CheckboxSelectColumn:function(e){var u,c,t=new Slick.EventHandler,p={},h=T.extend(!0,{},{columnId:"_checkbox_selector",cssClass:null,toolTip:"Select/Deselect All",width:30},e);function i(e,t){for(var i,o=u.getSelectedRows(),n={},a=[],s=0;s<o.length;s++)n[i=o[s]]=!0,n[i]!==p[i]&&(a.push(i),delete p[i]);for(s in p)a.push(s);p=n;var r,l,d=u.getColumnIndex(h.columnId);_.each(a,function(e){u.updateCell(e,d)}),c&&(r=(l=u.getData()).extractIds(g()),l=l.selectionSyncHelper.getSelectedIds(),r.length===_.intersection(r,l).length?u.updateColumnHeader(h.columnId,"<input type='checkbox' checked='checked'>",h.toolTip):u.updateColumnHeader(h.columnId,"<input type='checkbox'>",h.toolTip))}function o(e,t){32==e.which&&u.getColumns()[t.cell].id===h.columnId&&(u.getEditorLock().isActive()&&!u.getEditorLock().commitCurrentEdit()||a(t.row),e.preventDefault(),e.stopImmediatePropagation())}function n(e,t){u.getColumns()[t.cell].id===h.columnId&&(T(e.target).is(":checkbox")||T(e.target).find(":checkbox").length)&&(u.getEditorLock().isActive()&&!u.getEditorLock().commitCurrentEdit()?e.preventDefault():(a(t.row),e.stopPropagation()),e.stopImmediatePropagation())}function a(t){var e=new Slick.EventData;e.rememberHidden=!0,p[t]?u.setSelectedRows(T.grep(u.getSelectedRows(),function(e){return e!=t}),void 0,e):u.setSelectedRows(c?u.getSelectedRows().concat(t):[t],void 0,e)}function s(e,t){var i;t.column.id==h.columnId&&T(e.target).is(":checkbox")&&(u.getEditorLock().isActive()&&!u.getEditorLock().commitCurrentEdit()?e.preventDefault():(i=(t=u.getData()).extractIds(g()),T(e.target).is(":checked")?t.selectionSyncHelper.addSelectedIds(i):t.selectionSyncHelper.removeSelectedIds(i),u.focus(),e.stopPropagation()),e.stopImmediatePropagation())}function g(){for(var e,t=[],i=0,o=u.getDataLength();i<o;i++)if((e=u.getDataItem(i))instanceof Slick.NonDataRow){if(e instanceof Slick.Group&&e.collapsed)for(var n=0,a=e.rows.length;n<a;n++)t.push(e.rows[n])}else t.push(e);return t}function r(e,t,i,o,n){return n?((n=document.createElement("input")).setAttribute("type","checkbox"),p[e]&&n.setAttribute("checked","checked"),n):null}T.extend(this,{init:function(e){(c=(u=e).getOptions().multiSelect)||u.updateColumnHeader(h.columnId,"",""),t.subscribe(u.onSelectedRowsChanged,i).subscribe(u.onClick,n).subscribe(u.onHeaderClick,s).subscribe(u.onKeyDown,o)},destroy:function(){t.unsubscribeAll()},getColumnDefinition:function(){return{id:h.columnId,name:"<input type='checkbox'>",toolTip:h.toolTip,field:"sel",width:h.width,resizable:!1,sortable:!1,cssClass:h.cssClass,formatter:r}}})}}}),_.extend(Be.prototype,w.Events,{PROP_SELECTION_COLUMN:"Selection.RowSelectionColumn",initialize:function(){this.listenTo(this.app.viewModel,"change:"+this.PROP_SELECTION_COLUMN,this.onChange_SelectionColumn),this.listenTo(this.app.viewModel,"change:Selection.SelectedValue",this.onChange_SelectedValue),this.listenTo(this.app.viewModel,"change:Selection.SelectedField",this.onChange_SelectedValue),this.listenTo(this.app.viewModel,"change:Selection.Mode",this.onChange_SelectionMode),this.listenTo(this.app.viewModel,"change:Selection.CheckboxAlignment",this.onChange_CheckboxAlignment)},convertValueIfNecessary:function(e){return b.isKDBTemporal(e)?b.convertKDBTemporalToMoment(e).toDashString():e},doActions:function(r,l,d,u){var c,p,h=this,e=h.app.viewModel.get("Selection.Actions"),g=h.app.viewModel.get("Selection.DefaultFallbackOnDeselect"),f=this.app.dataView.selectionSyncHelper,m=[];function C(e){return h.app.api.getPropertyMeta("Selection.Actions."+e+".Target")}0===(c=f?f.getSelectedIds():h.app.grid.getSelectedRows()).length&&0!==d.indexOf("Mouse")&&(r={}),_.each(e,function(e,t){var i,o,n=!1,a=e.Current,s=e.TriggerColumn||"";e.Trigger===d&&("*"===s?n=!0:"<div></div>"!==u&&-1===u.indexOf("disable-action")&&(n=s===l)),n&&(s=!1,n={_PropertyIndex:t},"map"===e._Type&&("Click"===d&&(o=C(t))&&"viewstate"===o.type&&"list"===o.viewstateType&&(p=p||(f?_.map(c,h.app.dataView.getItemById.bind(h.app.dataView)):h.getDataRowsWithoutGroups(c)),s=!0),g&&0===c.length&&0!==d.indexOf("Mouse")?(o=o||C(t))&&"viewstate"===o.type&&(i=o.defaultValue):("*"===a&&(a=l),i=s?_.chain(p).map(a).map(h.convertValueIfNecessary).value():_.has(r,a)?h.convertValueIfNecessary(r[a]):a),n.Value=i),m.push(_.extend({},e,n)))}),h.app.api.doActions(m,"Selection.Actions")},getCurrentSelectedRanges:function(){var e=this.app.grid.getSelectionModel().getSelectedRanges();return _.map(e,function(e){return[e.fromRow,e.toRow,e.fromCell,e.toCell].join(" ")})},getDataRowsWithoutGroups:function(e){var i=this.app.dataView.getItem.bind(this.app.dataView);return _.reduce(e,function(e,t){t=i(t);return!t||t instanceof Slick.NonDataRow||e.push(t),e},[])},getSelectedRowObject:function(){return this.selectedRowObject},getSelectedRowObjects:function(){return this.selectedRowObjects},initCheckBoxColumn:function(e){var t=this.app.viewModel.get("Selection.CheckboxAlignment");"none"!==t&&(this.checkboxSelector=new Slick.CheckboxSelectColumn({cssClass:"slick-cell-checkboxsel",width:0,minWidth:30}),e["right"===t?"push":"unshift"](this.checkboxSelector.getColumnDefinition()))},onAction:function(e,t,i){var o,n=this.app.grid;!this.hasActions&&"Double Click"!==e||this.app.editorModule&&this.app.editorModule.isEditable||(null===(t=n.getCellFromEvent(t))&&_.has(i,"row")&&_.has(i,"cell")&&(t=i),(i=this.app.dataView.getItem(t.row))instanceof Slick.NonDataRow)||(o=n.getColumns()[t.cell]).selectable&&(o=o.field,n=n.getCellNode(t.row,t.cell).innerHTML,this.app.api.doActions&&this.doActions(i,o,e,n),"Double Click"===e&&i&&this.app.trigger("dataGridRowDoubleClicked",i),"Right Click"===e)&&i&&this.app.trigger("dataGridRowRightClicked",i)},onChange_CheckboxAlignment:function(){this.onChange_SelectionMode()},onChange_SelectedValue:function(){this.app.skipGridGeneration||this.setSelectedRows_ignoreCallback_onSelectedRowsChanged()},onChange_SelectionColumn:function(){var e;this.app.skipGridGeneration||this.app.RAW_MODE&&(e=this.app.viewModel.get(this.PROP_SELECTION_COLUMN),this.app.rawModeModule.populateFields([e],"selection"))},onChange_SelectionActions:function(){var e=this.app.viewModel.get("Selection.Actions");this.hasActions=!(!e||!e.length)},onChange_SelectionMode:function(){this.app.skipGridGeneration||this.app.generateDataGridFromReceivedData()},onKeyDown:function(e,t){this.hasActions&&(this.lastSelectedRanges=this.getCurrentSelectedRanges())},onKeyDownDone:function(e,t){this.hasActions&&_.includes([40,38,34,33,39,37,9],e.which)&&!_.isEqual(this.getCurrentSelectedRanges(),this.lastSelectedRanges)&&(e.target=this.app.grid.getActiveCellNode(),this.onAction("Click",e))},registerGridSelectionModel:function(){var e,r=this,t=r.app.viewModel.get("Selection.Mode"),l="Selection.SelectedValue",i=r.app.grid;_.includes(["Single Row","Multi Row"],t)?(e=new Slick.RowSelectionModel,i.onSelectedRowsChanged.subscribe(function(e,t){r.ignoreCallback_onSelectedRowsChanged||r.userClickSelection||0===i.getSelectedRows().length&&0===r.app.dataView.selectionSyncHelper.getSelectedIds().length&&null!=r.selectedRowObject&&(r.selectedRowObject=null,r.trigger_selectedRowChanged(),r.trigger_selectedRowsChanged([]))}),this.app.dataView.syncGridSelection(i,!0,!0).subscribe(function(e,t){var i,o,n;r.ignoreCallback_onSelectedRowsChanged||r.userClickSelection||(t=t.ids,i=r.app.api.getPropertyMeta(l),n=r.app.viewModel.get("Selection.RowSelectionColumn"),r.selectedRowObject=0===t.length?null:r.app.dataView.getItemById(_.last(t)),r.trigger_selectedRowChanged(),r.trigger_selectedRowsChanged(t),o=0<t.length?i&&"list"===i.viewstateType?_.chain(t).map(r.app.dataView.getItemById.bind(r.app.dataView)).map(n).map(r.convertValueIfNecessary).value():(o=r.selectedRowObject[n],r.convertValueIfNecessary(o)):(o="",i&&(r.app.viewModel.get("Selection.DefaultFallbackOnDeselect")?o=i.defaultValue:"list"===i.viewstateType&&(o=[])),r.convertValueIfNecessary(o)),r.userClickSelection=!0,r.ignoreCallback_setSelectedRows=!0,r.app.api.setProperty(l,o),r.ignoreCallback_setSelectedRows=!1,r.userClickSelection=!1)}.bind(this))):_.includes(["Cell","Area"],t)?(e=new Slick.CellSelectionModel({singleCellMode:"Cell"===t})).onSelectedRangesChanged.subscribe(function(e,t){var i,o,n=r.app.viewModel.get("Selection.RowSelectionColumn"),a=[],s=[];t&&t[0]&&r.app.dataView&&(i=1<t.length?_.map(t,"fromRow"):_.range(t[0].fromRow,t[0].toRow+1),t=_.range(t[0].fromCell,t[0].toCell+1),i=r.getDataRowsWithoutGroups(i),o=_.map(t,function(e){return r.app.grid.getColumns()[e].field}),_.each(i,function(t){_.each(o,function(e){a.push(t[e])}),s.push(t[n])}),r.setViewstateProperty("Selection.SelectedField",o),r.setViewstateProperty("Selection.SelectedCellValue",a),r.ignoreCallback_setSelectedRows=!0,r.setViewstateProperty(l,s),r.ignoreCallback_setSelectedRows=!1)}):"None"===t&&(e=new function(e){var t=[];$.extend(this,{init:_.noop,destroy:_.noop,getSelectedRanges:function(){return t},setSelectedRanges:_.noop,onSelectedRangesChanged:new Slick.Event})}),"none"!==r.app.viewModel.get("Selection.CheckboxAlignment")&&i.registerPlugin(this.checkboxSelector),i.onClickDone.subscribe(_.bind(this.onAction,this,"Click")),i.onDblClick.subscribe(_.bind(this.onAction,this,"Double Click")),i.onMouseEnter.subscribe(_.bind(this.onAction,this,"Mouse In")),i.onMouseLeave.subscribe(_.bind(this.onAction,this,"Mouse Out")),i.onKeyDown.subscribe(this.onKeyDown.bind(this)),i.onKeyDownDone.subscribe(this.onKeyDownDone.bind(this)),i.setSelectionModel(e)},remove:function(){this.stopListening()},setSelectedRows_ignoreCallback_onSelectedRowsChanged:function(){this.ignoreCallback_onSelectedRowsChanged=!0,this.setSelectedRows(),this.ignoreCallback_onSelectedRowsChanged=!1},setSelectedRows:function(){if(!this.ignoreCallback_setSelectedRows&&this.app.grid&&this.app.api.getPropertyMeta){var e,t,r=this.app.dataView,s=[],l=this,d=l.app.viewModel.get("Selection.Mode"),u=this.app.viewModel.get("Selection.RowSelectionColumn");if(_.includes(["Single Row","Multi Row"],d))e=this.app.dataView.selectionSyncHelper;else{if("Cell"!==d)return;var i=this.app.api.getPropertyMeta("Selection.SelectedValue")||{};if(!u||"viewstate"!==i.type)return;e={getSelectedIds:function(){var e=this.app.grid.getSelectionModel().getSelectedRanges();return e&&e[0]?_.without(r.mapRowsToIds(_.range(e[0].fromRow,e[0].toRow+1)),void 0):[]}.bind(this),setSelectedIds:function(e){var t,i,e=_.without(r.mapIdsToRows(e),void 0),o=[],n=this.app.viewModel.get("Selection.SelectedField"),a=this.app.grid.getColumns(),s=-1;(n=n&&_.isArray(n)?n.length?n[0]:"":n)&&(s=_.findIndex(a,{field:n})),t=i=0<=s?s:_.max([0,_.findIndex(a,{field:u})]),e.length&&(o=_.map("Cell"===d?[e[0]]:e,function(e){return new Slick.Range(e,t,e,i)})),this.app.grid.getSelectionModel().setSelectedRanges(o)}.bind(this)}}void 0===(i=(l.app.api.getPropertyMeta("Selection.SelectedValue")||{value:void 0}).value)||_.isArray(i)||(i=[i]),_.each(i,function(e){var t,i;if(void 0!==e)for(t=0,i=r.getItems().length;t<i;t++){var o,n,a=(n=r.getItemByIdx(t))[u];o=!1,b.isKDBTemporal(a)?o=b.convertKDBTemporalToMoment(a).toDashString()==e:(a==e||_.isArray(e)&&_.includes(e,a))&&(o=!0),o&&s.push(n[l.app.SLICKGRID_ROW_UNIQUE_ID])}}),0!==s.length&&_.isEqual(e.getSelectedIds(),s)||this.app.grid.resetActiveCell(),e.setSelectedIds(s),0<s.length&&this.app.viewModel.get("Selection.FollowSelectedValue")&&!this.userClickSelection&&this.app.scrollingModule&&(t=void 0,_.find(s,function(e){return void 0!==(t=r.getRowById(e))}),void 0!==t)&&this.app.scrollingModule.scrollTo(t,!0)}},setViewstateProperty:function(e,t){var i=this.app.api.getPropertyMeta?this.app.api.getPropertyMeta(e):null;i&&"viewstate"===i.type&&(t="list"===i.viewstateType?_.map(_.isArray(t)?t:[t],this.convertValueIfNecessary):this.convertValueIfNecessary(_.isArray(t)&&t.length?t[0]:""),this.app.api.setProperty(e,t))},trigger_selectedRowChanged:function(){this.app.trigger("selectedRowChanged",this.selectedRowObject)},trigger_selectedRowsChanged:function(e){e=_.compact(_.map(e,this.app.dataView.getItemById.bind(this.app.dataView)));this.selectedRowObjects=e,this.app.trigger("selectedRowsChanged",e)}}),_.extend(He.prototype,w.Events,{initialize:function(){this.onMouseMove=this.onMouseMove.bind(this),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this)},initRowTooltip:function(){var e=this.app.grid;this.remove_onMouseMoveHandler(),e.onMouseEnter.subscribe(this.onMouseEnter),e.onMouseLeave.subscribe(this.onMouseLeave)},onMouseEnter:function(e){var i,o,t=this.app.grid;"none"!==this.app.viewModel.get("Tooltip.Position")&&(e=t.getCellFromEvent(e))&&(o=this.app.dataView.getItem(e.row))&&!o.__group&&(o=_.omit(o,"_rowIndex","idProperty"),this.app.api.getProperty("Tooltip.UseFormattedCellValue")&&(i=_.keyBy(t.getColumns(),"field"),_.each(Object.keys(o),function(e){var t=i[e];t&&(t=t.formatter(void 0,void 0,o[e],t,o,!0),o[e]=t.textContent)})),t=this.app.grid.getColumns()[e.cell].field,o.thisField=t,o.thisRawValue=o.thisValue=o[t],this.tooltip=this.app.api.setTooltip({data:o,text:this.app.viewModel.get("Tooltip.Template")}),this.remove_onMouseMoveHandler(),$(document).mousemove(this.onMouseMove))},onMouseLeave:function(e){this.tooltip&&(this.app.api.removeTooltip(),delete this.tooltip),this.remove_onMouseMoveHandler()},onMouseMove:function(e){var t,i,o,n,a,s=this.app.grid,r=this.app.viewModel.get("Tooltip.Position"),l=s.getCellFromEvent(e);if(l){switch(r){case"cursor":t=e.clientY+10,i=e.clientX+20;break;case"right":case"left":a=s.getCellNode(l.row,l.cell),t=$(a).offset().top,i=(n=(a=$(s.getContainerNode())).offset()).left+a.width(),o=$("body").width()-n.left}this.tooltip.updatePosition(_.extend({top:t},"left"===r?{right:o}:{left:i}))}else this.onMouseLeave()},remove:function(){this.$tooltipDiv&&this.$tooltipDiv.remove(),this.remove_onMouseMoveHandler(),this.stopListening()},remove_onMouseMoveHandler:function(){$(document).off("mousemove",this.onMouseMove)}}),{COLOR_SCHEMAS:{},_clamp:function(e,t,i){return i<e?i:e<t?t:e},_generateColorSchema:function(e){for(var t=[],i=V._hexToRgb(e),o=i[0],n=i[1],a=i[2],s=0;s<10;s++)t[s]="rgb("+(o-10*s)+","+(n-10*s)+","+(a-10*s)+")";return t.reverse(),V.COLOR_SCHEMAS[e]=t},getColor:function(e,t){return e=e.replace("#",""),(V.COLOR_SCHEMAS[e]||V._generateColorSchema(e))[t]},_hexToRgb:function(e){return[parseInt(e.substr(0,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(4,2),16)]},interpolateColor:function(e,t,i,o){for(var i=(i-t)/(e.length-1),o=this._clamp((o-t)/i,0,e.length-1),t=e[Math.floor(o)].color.replace("#",""),i=e[Math.ceil(o)].color.replace("#",""),n=this._hexToRgb(t),a=this._hexToRgb(i),s=o-Math.floor(o),r=n.slice(),l=0;l<3;l++)r[l]=Math.round(r[l]+s*(a[l]-n[l]));return"#"+this._rgbToHex(r)},_rgbToHex:function(e){return((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1)}}),Xe=(k.PREVIOUS_VALUE="previous value",_.extend(k.prototype,w.Events,{isPreviousValueUsedInAnyRule:!1,displayArrowsOrHighlightOnChange:!1,initialize:function(){this.clearHighlightRuleChains(),this.listenTo(this.app.viewModel,"change:HighlightRules",this.onChange_HighlightRules),this.listenTo(this.app.viewModel,"change:ColumnsConfiguration",this.onChange_ColumnsConfiguration)},clearHighlightRuleChains:function(){this.highlightRuleChains={}},evalHighlight_Equality:function(e,t,i,o){e&&null!==i&&i===o&&(t["border-color"]=e,t["box-shadow"]="inset 0px 0px 1px 1px rgba(0,0,0, 0.8)")},evalHighlight_Range:function(e,t,i,o,n,a){e&&null!==i&&(i=n===o?1:(i-o)/(n-o),i=Math.round(9*i),n=V.getColor(e,i=a?9-i:i),t["background-color"]=n)},getFieldsUsedInRulesWithPreviousValue:function(){var i,e;return _.includes(this.fieldsUsedInRulesWithPreviousValue,"<this>")?(i=_.without(this.fieldsUsedInRulesWithPreviousValue,"<this>"),e=_.compact(_.map(_.filter(this.app.grid.getColumns(),function(e){return e._dashboardConfig}),"field")),_.each(_.filter(this.app.viewModel.get("HighlightRules"),{ConditionSource:"<this>",ConditionValue:k.PREVIOUS_VALUE,RuleType:"discrete",Enabled:!0}),function(t){_.each(e,function(e){l.isFieldMatched(t.Target,e)&&i.push(e)})}),_.uniq(i)):this.fieldsUsedInRulesWithPreviousValue},getHighlightBox:function(e){var t=e.find(">.highlightBox");return t.length?t.removeAttr("style"):(t=$('<div class="highlightBox"></div>')).prependTo(e),t},getHighlightingFields:function(){var e=_.uniq(_.map(this.getTrackedColumns(function(e){return e.ShowArrowsOnChange||e.HighlightChanges}),"field"));return e=_.uniq(e.concat(this.getFieldsUsedInRulesWithPreviousValue()))},getHighlightRuleChain:function(t){var e=this.highlightRuleChains[t];return e||(e=this.app.viewModel.get("HighlightRules"),(e=_.filter(e,function(e){return e.Enabled&&!!e.ConditionSource&&l.isFieldMatched(e.Target,t)})).reverse(),this.highlightRuleChains[t]=e),e},getTrackedColumns:function(o,n){var a=this.app.columnInfo;return _.filter(this.app.grid.getColumns(),function(e){var t=e._dashboardConfig,i=!1;return t&&(i=o(t),n)&&i&&(t=e.field,e=a.get(t))&&(n[t]=7===e.get("kdbType")),i})},highlightCachedChanges:function(){console.log("IK REMOVE THIS CODE highlightCachedChanges")},hasPreviousValueInAnyRule:function(){return this.isPreviousValueUsedInAnyRule},isValidHighlightRulesConfig:function(){var e=this.app.viewModel.get("HighlightRules");return e&&(0===e.length||_.every(e,function(e){var t=e.Target&&e.ConditionSource,i=e.ConditionOperator&&void 0!==e.ConditionValue||_.includes(["Fill Left-to-Right","Fill Right-to-Left"],e.ConditionOperator);return!e.Enabled||t&&i}))},getAffectedIndicies:function(e,l){var d=[],u=this.app.previousValuesMap,c=this.app.atomizeTemporal,p=this.app.columnInfo,h=this.app.SLICKGRID_ROW_UNIQUE_ID;return _.each(e,function(e){if(l&&l.length)for(var t=0;t<l.length;t++){var i,o,n,a=!1,s=l[t],r=s.ConditionSource;if("gradient"===s.RuleType||"<this>"===r?a=!0:(i=s.ConditionValue,s=s.ConditionOperator,o=e[r],(n=p.get(r))&&7===n.get("kdbType")&&_.isString(o)&&(o=parseInt(o,10)),i===k.PREVIOUS_VALUE?(n=u[c(e[h])])&&(n=n[r],o&&o.class&&(o=O._convertKdbValueforComparison(o)),n&&n.class&&(n=O._convertKdbValueforComparison(n)),a=O._getConditionResult(o,n,s)):a=o&&o.class?O._getConditionResult(O._convertKdbValueforComparison(o),i,s):O._getConditionResult(o,i,s)),a)return void d.push(e[h])}}),this.app.dataView.mapIdsToRows(d)},onChange_ColumnsConfiguration:function(){this.displayArrowsOrHighlightOnChange=_.some(this.app.viewModel.get("ColumnsConfiguration"),function(e){return e.ShowArrowsOnChange||e.HighlightChanges})},onChange_HighlightRules:function(e){var t,i;this.setupStateForRulesWithPreviousValue(e.get("HighlightRules")),!this.app.skipGridGeneration&&this.app.grid&&(i=(i=e.changedAttributes())?_.keys(i.HighlightRules):[],t=_.pick(e.previousAttributes(),_.map(i,function(e){return"HighlightRules."+e})),e=_.pick(e.attributes,_.map(i,function(e){return"HighlightRules."+e})),i=this.app.grid.getRenderedRange(),i=this.app.dataView.mapRowsToIds(_.range(i.top,i.bottom+1)),_.remove(i,_.isUndefined),i=_.map(i,this.app.dataView.getItemById.bind(this.app.dataView)),i=this.getAffectedIndicies(i,(t.HighlightRules||[]).concat(e.HighlightRules||[])),this.clearHighlightRuleChains(),this.app.grid.invalidateRows(i),this.app.grid.render(),this.app.sparklinesManager.refresh(),this.processMinMaxHighlighting())},prepareValue:function(e,t){return e=void 0!==(e=t&&_.isString(e)?parseInt(e,10):e).i?e.i:e},processMinMaxHighlighting:function(){var e,h,g,f,t,m=this.app.grid,i=this.app.dataView,C={};m&&(this.app.filteringModule.refreshDataviewIfFilterNotEmpty(),0!==(e=this.getTrackedColumns(function(e){var t=this.app.columnInfo.get(e.Field);return t&&11!==t.get("kdbType")&&(e.HighlightMinValueColor||e.HighlightMaxValueColor||e.RangeHighlightColor)}.bind(this),C)).length)&&(this.app.RAW_MODE&&this.app.rawModeModule.populateFields(_.map(e,function(e){return e.name}),"minmax"),0!==(h=i.getItems()).length)&&(t=m.getViewport(),g=_.range(t.top,t.bottom+1),f=_.map(i.mapRowsToIds(g),function(e){return i.getItemById(e)}),_.each(e,function(e){for(var t,o=m.getColumnIndex(e.id),n=e.field,e=e._dashboardConfig,a=e.HighlightMinValueColor,s=e.HighlightMaxValueColor,r=e.RangeHighlightColor,l=e.IsRangeHighlightColorInverted||!1,d=Number.MAX_VALUE,u=Number.MIN_VALUE,c=C[n],i=0,p=h.length;i<p;i++)null!=(t=h[i][n])&&((t=this.prepareValue(t,c))<d&&(d=t),u<t)&&(u=t);_.each(f,function(e,t){var i;e&&null!=(e=e[n])&&(e=this.prepareValue(e,c),this.evalHighlight_Equality(a,i={},e,d),this.evalHighlight_Equality(s,i,e,u),this.evalHighlight_Range(r,i,e,d,u,l),!_.isEmpty(i))&&(e=g[t],t=m.getCellNode(e,o))&&this.getHighlightBox($(t)).css(i)}.bind(this))}.bind(this)))},processMinMaxHighlighting_debounced:function(){(this.processMinMaxHighlighting_debounced=_.debounce(this.processMinMaxHighlighting.bind(this),10))()},processMinMaxHighlighting_debouncedMore:function(){(this.processMinMaxHighlighting_debouncedMore=_.debounce(this.processMinMaxHighlighting.bind(this),100))()},processNumberDiffHighlighting:function(){var t,i,h=this.app.grid,o=this.app.dataView,n=this.app.previousValuesMap,g=this.app.diffValuesMap,a=this.app.atomizeTemporal,f={};h&&this.displayArrowsOrHighlightOnChange&&0!==(t=this.getTrackedColumns(function(e){return e.ShowArrowsOnChange||e.HighlightChanges},f)).length&&(i=this.app.getRowIxRange(),_.each(o.mapRowsToIds(i),function(d,e){var u,c,p;void 0!==d&&(p=i[e],d=a(d),u=o.getItemById(d),c=n[d])&&_.each(t,function(e){var t,i,o=h.getColumnIndex(e.id),n=e.field,e=e._dashboardConfig,a=e.Precision,s=e.HighlightChangeDuration,r=u[n],l=c[n];f[n]&&_.isString(l)&&_.isString(r)&&(l=parseInt(l,10),r=parseInt(r,10)),_.isNumber(l)&&_.isNumber(r)&&(l=this.roundToPrecision(l,a),t=(r=this.roundToPrecision(r,a))===l?void 0:l<r,e.ShowArrowsOnChange&&void 0===t&&g&&g[d]&&(l=g[d][n],f[n]&&_.isString(l)&&(l=parseInt(l,10)),_.isNumber(l))&&(i=r===(l=this.roundToPrecision(l,a))?void 0:l<r),n=_.some([t,i],_.negate(_.isUndefined)))&&(a=h.getCellNode(p,o))&&(e.HighlightChanges&&void 0!==t&&this.setBackgroundColorInCell(a,s,t),e.ShowArrowsOnChange)&&n&&this.showArrowInCell(a,void 0===t?i:t)}.bind(this))}.bind(this)))},remove:function(){this.stopListening()},roundToPrecision:function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},setBackgroundColorInCell:function(e,t,i){e.dataset.tid&&clearTimeout(e.dataset.tid),e.style.backgroundColor=i?"green":" red",e.dataset.tid=setTimeout(function(){e.style.backgroundColor=""},t)},setupStateForRulesWithPreviousValue:function(e){var t=[];_.each(e,function(e){e.Enabled&&"discrete"===e.RuleType&&e.ConditionValue===k.PREVIOUS_VALUE&&t.push(e.ConditionSource)}.bind(this)),this.fieldsUsedInRulesWithPreviousValue=_.uniq(t),this.isPreviousValueUsedInAnyRule=0<this.fieldsUsedInRulesWithPreviousValue.length},showArrowInCell:function(e,t){var i=document.createElement("i");i.className="fa fa-caret-"+(t?"up":"down"),e.appendChild(i)},showArrowsOrHighlightOnChange:function(){return this.displayArrowsOrHighlightOnChange}}),_.extend(Ge.prototype,{initialize:function(){_.defaults(this.api,{getTemplateViewStates:function(){return{}},subscribeTemplateViewStates:function(e,t){t&&t({})},unsubscribeTemplateViewStates:_.noop})},remove:function(){this.unsubscribeViewstateSubscribers()},subscribeViewstateSubscribers:function(e){_.each(e,function(o){var e=_.get(o,"_dashboardConfig.Template","");$.trim(e)&&this.viewstateSubscriberIDs.push(this.api.subscribeTemplateViewStates(e,function(){var t,e,i=this.app.grid;i&&void 0!==(t=i.getColumnIndex(o.id))&&(e=i.getViewport(),_.each(_.range(e.top,e.bottom+1),function(e){i.updateCell(e,t)}))}.bind(this)))}.bind(this))},unsubscribeViewstateSubscribers:function(){_.isEmpty(this.viewstateSubscriberIDs)||_.each(this.viewstateSubscriberIDs,function(e){this.api.unsubscribeTemplateViewStates(e)}.bind(this)),this.viewstateSubscriberIDs=[]}}),F.prototype.getSummaryRowFields=function(){var i=[];return _.each(this.app.grid.getColumns(),function(e){var t=_.get(e,"_dashboardConfig.Footer","None");"None"!==t&&(i.push(e.field),"WeightedAverage"===t)&&i.push(_.get(e,"_dashboardConfig.FooterWeights"))}),_.uniq(_.filter(i))},F.prototype.getSummaryRowHeight=function(){var e=_.map(null==(e=this.app.grid)?void 0:e.getColumns(),"_dashboardConfig");return _.some(e,function(e){return e&&!_.isNil(e.Footer)&&"None"!==e.Footer})?this.viewModel.get("Style.RowHeight"):0},F.prototype.positionSummaryRowHeight=function(e){this.summaryRowEl&&(this.summaryRowEl.style.bottom=(e?30:0)+"px")},F.prototype.updateSummmaryRow=function(){var e=this,t=this.app.$(".pnlSummaryRow").empty();if(this.getSummaryRowHeight()){for(var i=this.app.columnInfo,o=document.createDocumentFragment(),n=this.app.grid.getUID(),a=this.viewModel.get("Style.RowHeight"),n=(t.attr("class","pnlSummaryRow").addClass(n).css({height:a,lineHeight:a}),this.summaryRowEl=t[0],this.viewportEl=this.app.grid.getCanvasNode().parentElement,this.app.positionPanelWithDatagrid(),this.app.columnsConfig),a=this.app.dataView.getItems(),s=this.getDataContext(n,i,a),r=_.filter(n,function(e){return!_.get(e,"_dashboardConfig.Hidden")}),l=0;l<r.length;l++){var d=r[l],u=!0,c=d.field,p=document.createElement("div"),c=(p.className="slick-cell l"+l+" r"+l+" ui-state-default "+d.cssClass,d.formatter(void 0,void 0,s[c],d,s,!0));_.get(d,"_dashboardConfig.Template")&&(c.className=p.className,o.appendChild(c),u=!1),d=""+(c instanceof Node?c.textContent:c),u&&(p.innerText=d,o.appendChild(p))}null!=(t=this.summaryRowEl)&&t.appendChild(o),$(this.viewportEl).on("scroll",function(){return e.updateSummaryRowScrollPosition()}),this.updateSummaryRowScrollPosition()}else this.app.positionPanelWithDatagrid()},F.prototype.getDataContext=function(e,i,t){var o={};function n(e){return _.isNumber(e)&&!_.isNaN(e)}function a(e,t){e=_.map(e,t),t=i.get(t);return e=t&&7===t.get("kdbType")?_.map(e,function(e){return _.isString(e)?parseInt(e,10):e}):e}for(var s=0;s<e.length;s++){var r=e[s],l=r.field,d=_.get(r,"_dashboardConfig.Footer","None");if("None"!==d){var u=0,c=[];switch(d){case"Count":u=t.length;break;case"WeightedAverage":for(var p=_.get(r,"_dashboardConfig.FooterWeights"),h=a(t,l),g=a(t,p),f=0,m=0,C=0;C<h.length;C++){var v=h[C],w=g[C];n(w)&&n(v)&&(f+=w*v,m+=w)}0!==m&&(u=f/m);break;case"Average":case"Sum":p=a(t,l),c=_.filter(p,function(e){return!_.isNull(e)&&!_.isUndefined(e)&&(_.isNumber(e)||_.has(e,"i"))}),u=_.reduce(c,function(e,t){return e+t},0)}"Average"===d&&(u/=c.length),o[l]=u}}return o},F.prototype.updateSummaryRowScrollPosition=function(){this.summaryRowEl&&this.viewportEl&&(this.summaryRowEl.style.width=this.app.grid.getCanvasNode().offsetWidth+"px",this.summaryRowEl.style.left=-this.viewportEl.scrollLeft+"px")},F.prototype.remove=function(){this.viewportEl&&$(this.viewportEl).off("scroll")},F);function F(e){this.app=e,this.viewModel=e.viewModel}Ze.prototype.remove=function(){},Ze.prototype.render=function(){if(this.viewModel.get("Basics.ExpandOnPdf")){if(this.isMultipageGridRendered)return!0;if(this.isActive||(this.isActive=!!$("body.pdf").length),this.isActive&&this.app.$el.height())return this.isMultipageGridRendered=this.renderDatagrid(),this.isMultipageGridRendered}return!1},Ze.prototype.generateDatagridModel=function(){var e=new p.DocumentDataModel({_subscriptionKey:this.app.SLICKGRID_ROW_UNIQUE_ID,_dataType:"copy",_maxRows:1e6},void 0,"",null);return e.apply(),e.onExecuteSuccess(x.dummyKdbResponse(),!0),new w.Model({data:e,datagridConfig:{Basics:{Filtering:"disabled"},ColumnsConfiguration:this.viewModel.get("ColumnsConfiguration"),Style:this.viewModel.get("Style")},theme:this.viewModel.get("Style.Theme")})},Ze.prototype.renderDatagrid=function(){var e=this.app.dataView.getItems(),t=e.length,i=this.app.$el.parents("[data-componentid]"),o=i.map(function(){return $(this).attr("data-componentid")}).get(),n=_.find([["Datagrid","Panel","Tabs"],["Datagrid","Tabs"]],function(e){return _.isEqual(e,o)});if(n){var a,s=0,i=(1<=n.length&&(r=(l=(i=i.filter(".ui-tabs-panel")).parent()).find("> div:not(.interaction-div):not(.hidden-tab)"),i[0]===r[0])&&(s=l.find(">ul").height()),2===n.length?null:this.app.$el.closest(".grid-stack").children(".grid-stack-item:not([data-componentid='Datagrid'])").eq(0)),r=0,l=(i&&(r=i.height(),(a=$(i.find(".grid-stack-item-content").prop("outerHTML"))).css({height:r,width:i.width(),position:"relative"})),parseFloat(this.viewModel.get("Style.HeaderRowHeight"))+1),n=parseFloat(this.viewModel.get("Style.RowHeight")),d=1080-r,u=this.app.$el.siblings(".title-div").outerHeight(),c=Math.floor((d-l)/n),p=Math.floor((d-s-u-l)/n),h=1+Math.ceil((t-p)/c);if(1<h){var l=1080*h-s,g=(this.app.$el.closest(".ui-tabs-panel").css("height",l),i&&(i.css({height:r,"min-height":r}),this.app.$el.closest(".grid-stack-item").css({height:l-r,top:r})),this.app.$(".datagridFrame"));g.empty(),"_rowIndex"===this.app.SLICKGRID_ROW_UNIQUE_ID&&(e=_.cloneDeep(e));for(var f=0;f<h;f++){a&&0<f&&a.clone().appendTo(g);var m=$("<div></div>",{class:"singlePageGrid",css:{position:"relative",height:d-(0===f?s+u:0)}}).appendTo(g),C=this.generateDatagridModel(),m=(new E.Master({el:m,model:C}),this.app.columnInfo.map("id")),v=this.app.columnInfo.map("kdbType"),w=_.take(_.drop(e,0===f?0:p+(f-1)*c),0===f?p:c),C=C.get("data");C.onExecuteBegin(),C.onExecuteSuccess({rows:w,columns:m,meta:_.zipObject(m,v)},!0)}return!0}}else console.warn("Datagrid > multi page printing > current layout not supported");return!1};var Je=Ze;function Ze(e){this.isActive=!1,this.isMultipageGridRendered=!1,this.app=e,this.viewModel=e.viewModel}var K={initialize:function(e){var t,i,o,n,a,s=this;this.subscriptionKey=_.uniqueId("datagridMaster_"),e=(i=e.model).get("data"),o=i.get("columnsConfig")||[],n=i.get("datagridConfig")||{},t=i.get("theme")||"Dark",a=i.get("gridMasterModelEventSubscribers"),this.customEditors=i.get("customEditors"),this.ignoreMetaChanges=i.get("ignoreMetaChanges")||!1,this.settingsModel=E.getSettingsModel($.extend(!0,{Basics:{Data:e,Filtering:"Column Filters",ShowPagingControl:!1,EnableGrouping:!1},ColumnsConfiguration:o,FileExport:{ShowExportCsvButton:!1,ShowExportExcelButton:!1},Selection:{RowSelectionColumn:e.get("_subscriptionKey"),SelectedValue:new p.DocumentViewModel({_default:[],_viewType:!0,_type:"list",value:[]})}},n)),o={sortColumns:i.get("sortColumns"),sortColumnsForCaseInsensitiveSort:i.get("sortColumnsForCaseInsensitiveSort"),gridEventSubscribers:i.get("gridEventSubscribers"),dataViewFilter:i.get("dataViewFilter"),dashboardViewModel:i.get("dashboardViewModel")||new w.Model({DashboardTheme:t}),serverSidePaging:!1,settingsModel:this.settingsModel,api:{showQueryStatus:$.noop,hideQueryStatus:$.noop,subscribe:function(e,t){t={key:s.subscriptionKey,source:e,onData:t};e.subscribe(t.key,t)},unsubscribe:function(e){e.unsubscribe&&e.unsubscribe(s.subscriptionKey)},doActions:$.noop,getProperty:$.proxy(this.getProperty,this),getPropertyMeta:$.proxy(this.getPropertyMeta,this),setProperty:$.proxy(this.setProperty,this),loadSetting:$.noop,saveSetting:$.noop}},E.prototype.initialize.apply(this,[o]),_.defer(function(){s.listenTo(s.settingsModel,"change",function(){s.onSettingsChange(s.settingsModel.toFlat())}),s.onSettingsChange(s.settingsModel.toFlat()),_.isArray(a)&&_.each(a,function(e){_.isFunction(e)&&e.call(s,i)})})},determineType:function(e){return _.isObject(e)&&_.isFunction(e.get)?e.get("_viewType")?"viewstate":e.get("_dataType")?"datasource":void 0:"none"},getProperty:function(e){var t,i;if(!e)return null;if(!(i=this.settingsModel.get(e)))return null;switch(this.determineType(i)){case"data":t=null;break;case"viewstate":t=this.getPropertyValue(i);break;default:t=i}return t},getPropertyMeta:function(e){var t,i,o,n;if(!e)return null;if(!(t=this.settingsModel.get(e)))return null;switch(e=this.determineType(t)){case"data":n=null;break;case"viewstate":n=this.getPropertyValue(t),i=t.get("_default"),o=t.get("_type");break;default:n=t}return{path:t.path||null,type:e,value:n,viewstateType:o||null,defaultValue:i||null}},getPropertyValue:function(e){return"viewstate"===this.determineType(e)?e.get("value"):e},setProperty:function(e,t){var i=this.settingsModel.get(e);"viewstate"===this.determineType(i)?i.set("value",t):this.settingsModel.set(e,t)}},E=w.View.extend({SLICKGRID_ROW_UNIQUE_ID:"slickGridId",RAW_MODE:!1,initialize:function(e){var o=this;this.api=e.api,this.settingsModel=e.settingsModel,this.dashboardAppModel=e.dashboardAppModel,this.dashboardViewModel=e.dashboardViewModel,this.dataConfigDialogMode=e.dataConfigDialogMode||!1,this.orderBookMode=e.orderBookMode,this.widgetId=e.widgetId,this.groupingsOrder=e.groupingsOrder,this.sortColumns=e.sortColumns,this.sortFunctions=e.sortFunctions,this.sortColumnsForCaseInsensitiveSort=e.sortColumnsForCaseInsensitiveSort,this.sortFunctionsMap=_.reduce(this.sortColumns,function(e,t,i){return o.sortFunctions&&_.isFunction(o.sortFunctions[i])&&(e[t.sortCol]=o.sortFunctions[i]),e},{}),this.gridEventSubscribers=e.gridEventSubscribers,this.dataViewFilter=e.dataViewFilter,this.removedColumnInfoCache=new w.Collection([]),this.$el.html(z.app()),this.viewModel=new Y,this.columnInfo=new w.Collection([],{comparator:"index"}),this.$pnlGrid=this.$(".pnlGrid"),this.editorModule=new xe(this),this.filteringModule=new R(this),this.highlightingModule=new k(this),this.groupingModule=new Ne(this),this.layoutModule=new Oe(this),this.pagerModule=new je(this),this.queryStatusModule=new Ve(this),this.rawModeModule=new Le(this),this.scrollingModule=new Ae(this),this.selectionModule=new Be(this),this.sortingModule=new Pe(this),this.themeModule=new Ee(this),this.tooltipModule=new He(this),this.sparklinesManager=new M,this.viewstateTrackingModule=new Ge(this),this.summaryRowModule=new Xe(this),this.printModule=new Je(this),this.resetPreviousValuesMap(),this.initEvents()},manageDiffMaps:function(e){e&&e.reset&&this.resetPreviousValuesMap(),this.previousValuesMapPending&&(this.previousValuesMap=this.previousValuesMapPending,this.previousValuesMapPending=null),e.remove&&(this.highlightingModule.hasPreviousValueInAnyRule()||this.highlightingModule.showArrowsOrHighlightOnChange())&&_.each(e.remove,function(e){e=e[this.SLICKGRID_ROW_UNIQUE_ID],e=this.atomizeTemporal(e);delete this.previousValuesMap[e],delete this.diffValuesMap[e]}.bind(this))},atomizeTemporal:function(e){return null!==e&&"object"==typeof e&&void 0!==e.i?void 0===e.n?""+e.i:e.i+"_"+e.n:e},cloneDeep_processViewStates:function(e){return _.cloneDeepWith(e,function(e){if(e instanceof w.Model)return e.get("value")})},columnIsInstantEditable:function(e){var t;if(e&&this.editorModule.checkUpdateQueryExists())return t=this.columnInfo.get(e.field),"instant"===this.viewModel.get("Basics.EditMode")&&1===t.get("kdbType")&&!e._dashboardConfig.IsReadonly},correctWidthWeights:function(e,t){var i,o,n=!1,t=t||!1,a={},s=_.filter(e,{Hidden:!1}),s=_.filter(_.map(s,"WidthWeight")),s=_.partition(s,function(e){return e<30}),r=s[0],s=s[1];function l(e,t,i){a["ColumnsConfiguration."+t+".WidthWeight"]=e.WidthWeight=i}return 0<r.length&&0<s.length&&(n=!0,r.length>s.length?(i=_.max(r),_.each(e,function(e,t){e.WidthWeight&&30<=e.WidthWeight&&l(e,t,i)})):(o=_.min(s),_.each(e,function(e,t){e.WidthWeight&&e.WidthWeight<30&&l(e,t,o)}))),t?(this.viewModel.set({ColumnsConfiguration:null},{silent:!0}),this.api.setProperty("ColumnsConfiguration",e)):n&&(this.viewModel.set({ColumnsConfiguration:null},{silent:!0}),_.each(a,function(e,t){this.api.setProperty(t,e,{silent:!0})}.bind(this)),this.onSettingsChange({ColumnsConfiguration:e})),t||n},destroyGrid:function(){this.grid&&(this.filteringModule.unsubscribeFromEvents(),this.pagerModule.removePager(),this.grid.onContextMenu.unsubscribe(),this.grid.destroy(),this.grid=null,this.columnFields=null,this.RAW_MODE&&this.rawModeModule.reset(),this.dataView&&this.dataView.destroy&&this.dataView.destroy(),this.dataView=null)},initEvents:function(){this.listenTo(this.viewModel,"change:Basics.Data",this.onChange_Data),this.listenTo(this.viewModel,"change:Basics.ExperimentalMode",this.onChange_ExperimentalMode),this.listenTo(this.viewModel,"change:Basics.LazyDataLoading",this.onChange_DataRelated),this.listenTo(this.viewModel,"change:ColumnsConfiguration",this.generateDataGridFromReceivedData),this.listenTo(this.viewModel,"change:Tooltip.Position",this.generateDataGridFromReceivedData),this.listenTo(this.pagerModule,"paged",this.onPage),this.listenTo(this.viewModel,"change:HeaderGroup",this.generatePossibleHeaderColumns),this.listenTo(this.viewModel,"change:Selection.SelectOnCheckOnly",this.onSelectOnCheckOnly)},injectViewstateValuesToUnpackedConfiguration:function(){var e=["Hidden"],n=this,t=n.viewModel.get("ColumnsConfiguration");_.each(n.unpackedColumnsConfiguration,function(i){var o=_.findIndex(t,{Field:i.Field,Format:i.Format,DisplayName:i.DisplayName});0<=o&&_.each(e,function(e){var t=n.api.getPropertyMeta("ColumnsConfiguration."+o+"."+e);t&&"viewstate"===t.type&&(i[e]=t.value)})})},insertIntoDataView:function(e){var i,o,n,a,s,r=this,t=this.grid.getSortColumns();t&&t[0]&&(i=t[0].sortAsc,o=(t[0].columnId?_.find(this.columnsConfig,{id:t[0].columnId}):t[0].sortCol).field),o&&(a=this.sortFunctionsMap[o]?(n=this.sortFunctionsMap[o],this.orderBookMode&&!i?function(e,t){return-n(e,t[o],-1)}:function(e,t){return n(e,t[o],1)}):(t=this.getKdbTypeFromColumn(o),b.getComparator(t,function(e){return e[o]})),s=this.dataView.getItems(),i||(s=s.slice().reverse()),_.each(e,function(e){_.each(e,function(e){var t=b.binarySearch2(e[o],s,a);t<0&&(t=Math.abs(t)-1),i||(s.splice(t,0,e),t=s.length-t-1),r.dataView.insertItem(t,e)})}))},isValidUsersColumnsConfiguration:function(e){var i=this,o=i.viewModel.get("ColumnsConfiguration"),n=_.filter(o,l.isDynamic);return _.every(e,function(t){return _.find(o,{Field:t.Field,Format:t.Format,DisplayName:t.DisplayName})||_.some(n,function(e){return l.getRegex(e).regex.test(t.Field)&&e.Format===t.Format&&(0===i.columnInfo.length||i.columnInfo.get(t.Field))})})},onChange_Data:function(){var e,t,i,o,n;this.editorModule.stopListeningToCurrentDataModel(),this.unsubscribeModel(),this.queryStatusModule.remove(),this.model=this.viewModel.get("Basics.Data")||null,this.sortingModule.resetSortingSpec(),this.filteringModule.resetColumnFiltersMap(),this.columnInfo.reset(),this.removedColumnInfoCache.reset(),this.queryStatusModule.initializeQueryStatusHandler(this.model),this.model?(this.editorModule.checkIfEditable(),this.viewModel.isLazyDataLoadingOn()&&(e=(o=this.viewModel.get("Basics")).SortColumn,t=o.SortOrder,o=o.ScrollValueV||0,n=this.viewModel.get("Style"),n=Math.max(1,Math.ceil((this.$pnlGrid.height()-n.HeaderRowHeight)/n.RowHeight)),i=null,o=Math.max(0,o-Math.ceil(+n)),n=3*n,e&&((i={})[e]="descending"!==t),e={_lazyLoading:!0,_forceReset:!1,_pageSize:n,_pageSort:i,_pagingNum:o,_pagingType:this.viewModel.getDeltaPagingType(),_serverPaging:!0}),this.api.subscribe(this.model,_.bind(this.onData,this),this.RAW_MODE,e)):(this.resetLayout(),this.trigger("model-unset"))},onChange_DataRelated:function(){this.viewModel.get("Basics.Data")&&this.onChange_Data()},onChange_ExperimentalMode:function(){this.RAW_MODE=this.viewModel.get("Basics.ExperimentalMode"),this.onChange_DataRelated()},onData:function(e,i,t){var o,n,a,s,r=this,l=!1,d=!1,u=!1,c=!1;if(this.viewModel.isLazyDataLoadingOn()&&this.model&&!this.model.get("_lazyLoading"))this.onChange_Data();else{if(this.RAW_MODE=_.has(i,"cols"),this.rawModeModule.switchDataviewGetters(),this.skipGridGeneration=!1,this.trigger("data-loaded"),i=_.clone(i),this.manageDiffMaps(i),this.sortingModule.setDataChangeSet(i),this.currentPagingInfo=e.paging,o=e.columns,n=this.dataView?this.dataView.getItems().length:0,this.filteringModule.isProcessedServerSide&&this.isChangeSetEmpty(o)&&i.reset&&0===n){if(0===i.reset.length)return;i.add=i.reset,delete i.reset}if(o.reset&&o.reset.length&&this.isChangeSetEmpty(i)&&(i.reset=[]),t&&(this.columnsToRemoveOnNextRun=o.remove||this.columnsToRemoveOnNextRun,o={},c=this.previousOnDataWasError=!0),!c&&this.previousOnDataWasError&&o&&(o.remove=this.columnsToRemoveOnNextRun,o.add=o.reset,delete o.reset,this.previousOnDataWasError=!1,this.columnsToRemoveOnNextRun=null),this.orderBookMode&&this.columnInfo.length&&e.columns&&delete e.columns.reset,(_.isUndefined(this.viewModel.get("ColumnsConfiguration"))||this.viewModel.get("ColumnsConfiguration")&&0===this.viewModel.get("ColumnsConfiguration").length)&&(this.regenerateColumnsConfiguration=!0),this.resortRequired=!1,this.groupingModule.setDataRefresh(!0),this.onDataFirstPassCheck){if(e.columns&&e.columns.reset&&0===e.columns.reset.length&&i.reset&&0===i.reset.length)return}else if(this.onDataFirstPassCheck=u=!0,e.columns&&e.columns.reset&&0===e.columns.reset.length&&i.reset&&0===i.reset.length)return;e.primaryKey!==this.primaryKey&&(this.primaryKey=e.primaryKey,this.SLICKGRID_ROW_UNIQUE_ID=this.primaryKey,l=!0),a=i.reset&&o.change&&void 0===i.change&&void 0===i.add&&void 0===i.remove&&void 0===o.reset&&void 0===o.add&&void 0===o.remove,o.reset?(this.editorModule.isEditable&&this.editorModule.toggleEditMode(!1),this.columnInfo.reset(e.columns.reset),u||this.ignoreMetaChanges||(this.regenerateColumnsConfiguration=!0),this.removedColumnInfoCache.reset()):(this.viewModel.get("Basics.KeepNonExistentColumns")?(this.removedColumnInfoCache.add(o.remove),this.removedColumnInfoCache.remove(_.map(o.add,function(e){return e.id}))):(this.columnInfo.remove(_.map(o.remove,function(e){return e.id})),o.remove&&o.remove.length&&(d=!0)),this.columnInfo.add(o.add),o.add&&o.add.length&&(d=!0),a||this.columnInfo.add(o.change,{merge:!0}),o.change&&this.columnInfo.set(o.change,{add:!1,remove:!1})),_.some(["add","remove","reset"],function(e){return void 0!==o[e]})&&((a=(u=this.columnInfo.pluck("id")).slice(0)).push("*"),(s=u.slice(0)).unshift(""),this.api.setProperty("datagridPossibleColumns",u),this.api.setProperty("datagridPossibleColumnsWithItself",_.concat("<this>",u)),this.api.setProperty("selectedColumnPossibleValues",u),this.api.setProperty("highlightTargetPossibleValues",a),this.api.setProperty("sortingPossibleValues",s)),this.columnInfo.sort(),this.onDataTriggered&&(l?this.sortingModule.resetSortingSpec():this.sortingModule.storeSortingSpec()),this.onDataTriggered=!0,this.RAW_MODE?(u=this.viewModel.isLazyDataLoadingOn()&&this.dataView instanceof he&&!_.isEmpty(this.currentPagingInfo),a=this.rawModeModule.getRowData(i,u?this.currentPagingInfo.startRows:null),this.pks=a.pks,this.pkOffsetMap=a.pkOffsetMap,this.dataColsMap=a.dataColsMap,u&&(i.add=i.reset,delete i.reset,this.dataView.clear(),this.dataView.updateLength())):(this.pks=void 0,this.pkOffsetMap=void 0,this.dataColsMap=void 0),!this.editorModule.isDataviewsLengthAffectedByDeletedRows()&&n&&i.remove&&i.remove.length===n&&!this.filteringModule.isProcessedServerSide&&(i.reset=i.add||[],delete i.add,delete i.remove),(_.reduce(["add","change"],function(e,t){return i[t]?e+i[t].length:e},0)>n/10||this.grid&&(0===this.grid.getSortColumns().length||1<this.grid.getSortColumns().length)||this.viewModel.isLazyDataLoadingOn())&&(this.resortRequired=!0),c?i.reset&&this.dataView&&this.dataView.setItems(i.reset,r.SLICKGRID_ROW_UNIQUE_ID):i.reset?(this.dataToRender_usedOnlyOnce=i.reset.slice(0),this.generateDataGridFromReceivedData(),this.scrollingModule.updateScrollPosition(),this.filteringModule.resetGlobalFilter()):this.dataView&&(this.resortRequired?(this.dataView.beginUpdate(),i.remove&&i.remove.length&&(this.dataView.suspendIndexing(),this.removeItemsFromDataview(i.remove),this.dataView.reactivateIndexing()),i.change&&i.change.length&&i.change.forEach(function(e){e=e[this.primaryKey];this.dataView.updateItem_unchecked_noRefresh(e,i.collection.get(e).attributes)},this),i.add&&i.add.length&&i.add.forEach(function(e){this.dataView.addItem(e)},this)):(this.dataView.beginUpdate(),(i.remove&&i.remove.length||i.change&&i.change.length)&&(this.dataView.suspendIndexing(),i.remove&&i.remove.length&&this.removeItemsFromDataview(i.remove),i.change&&i.change.length&&(this.grid.invalidateRows(this.dataView.mapIdsToRows(_.map(i.change,this.SLICKGRID_ROW_UNIQUE_ID))),this.removeItemsFromDataview(i.change)),this.dataView.reactivateIndexing(!(!i.change||!i.change.length))),(i.add&&i.add.length||i.change&&i.change.length)&&(this.dataView.suspendIndexing(),s=_.map(i.change,function(e){return i.collection.get(e[r.primaryKey]).attributes}),this.insertIntoDataView([i.add,s]),this.dataView.reactivateIndexing(),_.each(s,function(e){this.dataView.updateItem_unchecked_noRefresh(e[r.primaryKey])}.bind(this)))),this.dataView.endUpdate(),r.regenerateColumnsConfiguration&&(i.add||i.reset||i.change)||!i.add&&!i.reset&&!i.change&&l||d?r.generateDataGridFromReceivedData():(this.summaryRowModule.updateSummmaryRow(),this.onSelectOnCheckOnly())),this.filteringModule.reapplyColumnFilters(),this.resortRequired&&(this.model.get("_serverPaging")||this.sortingModule.isInNaturalOrder()||this.dataView.reSort(),this.resortRequired=!1),this.filteringModule.isProcessedServerSide&&this.dataView&&(this.sortingModule.forceResort=!0,this.dataView.reSort(),this.sortingModule.forceResort=!1),this.viewModel.isLazyDataLoadingOn()?this.dataView&&(this.dataView.updateLength(),this.dataView.updateScrollbar(),this.dataView.onViewportChanged(),this.grid.render()):this.selectionModule.setSelectedRows(),this.pagerModule.onData(e,i,t),this.sortingModule.onData(e,i,t),this.groupingModule.setDataRefresh(!1),this.highlightingModule.processNumberDiffHighlighting(),this.highlightingModule.processMinMaxHighlighting(),(this.highlightingModule.hasPreviousValueInAnyRule()||this.highlightingModule.showArrowsOrHighlightOnChange())&&this.storeAllCurrentDataRows(),this.trigger("data-processed",t)}},generatePossibleHeaderColumns:function(){var n=this,a=this.api.getProperty("datagridPossibleHeaderColumns"),t=[];_.each(this.api.getProperty("HeaderGroup"),function(e,i){var o=n.api.getProperty("HeaderGroup."+i+".ColumnProperty");t.push(o),a.indexOf(o)<0&&_.each(n.viewModel.get("ColumnsConfiguration"),function(e,t){e.Header===a[i+1]&&n.viewModel.set("ColumnsConfiguration."+t+".Header",o)})}),this.api.setProperty("datagridPossibleHeaderColumns",_.concat("none",t))},generateDatagridColumnsConfiguration:function(){var e,i=this;i.unpackedColumnsConfiguration=null,e=i.api.loadSetting("UsersColumnsConfiguration"),(e=i.layoutModule.recoverColumnDefaults(e))&&e.length&&(i.isValidUsersColumnsConfiguration(e)?(e=r.upgradeColumnsConfig(e,this.viewModel.get("ColumnsConfiguration")),i.unpackedColumnsConfiguration=e,i.api.getProperty("CustomLayout.IgnoreCustomLayoutViewstate")||i.injectViewstateValuesToUnpackedConfiguration()):i.api.saveSetting("UsersColumnsConfiguration",null)),i.unpackedColumnsConfiguration=i.unpackedColumnsConfiguration||_.clone(i.viewModel.get("ColumnsConfiguration")),_.some(i.unpackedColumnsConfiguration,l.isDynamic)&&(!i.viewModel.get("Basics.KeepNonExistentColumns")&&i.removedColumnInfoCache.length&&(i.columnInfo.remove(i.removedColumnInfoCache.pluck("id")),i.removedColumnInfoCache.reset()),i.unpackedColumnsConfiguration=i.unpackColumnConfiguration(i.unpackedColumnsConfiguration,i.columnInfo)),this.editorModule.addDeleteColumnIfNecessary(i.unpackedColumnsConfiguration),i.columnsConfig=_.map(i.unpackedColumnsConfiguration,function(e,t){return Qe(e,t,i)}),i.groupingModule.loadAndApplyGroupingSettings()},generateDataGridFromReceivedData:function(){var n,a,e,i,s=!1,t=!1;this.skipGridGeneration||(this.regenerateColumnsConfiguration&&(this.regenerateColumnsConfiguration=!1,e=this.viewModel.get("Basics.Data"),i=e&&e.path===r.SAMPLE_DATA,e=this.viewModel.get("ColumnsConfiguration"),n=_.map(this.columnInfo.models,function(e){var t=e.get("id"),e=e.get("kdbType");return Fe.generate(t,e,i)}),a=[],_.each(e,function(t){var i,e,o=l.isDynamic(t);o&&(i=l.getRegex(t).regex),e=_.filter(n,function(e){return o?i.test(e.Field):t.Field===e.Field}),n=_.difference(n,e),0<e.length||o||t.UserDefined?a.push(t):s=!0}),this.dataConfigDialogMode||s?a=_.concat(a,n):n.length&&0===a.length&&(a=n),t=!_.isEqual(e,a)),this.correctWidthWeights(t?a:this.viewModel.get("ColumnsConfiguration"),t))||(this.generateDatagridColumnsConfiguration(),this.renderDatagrid())},getAllFilteredItems:function(){return this.RAW_MODE?this.rawModeModule.getAllFilteredItems():this.dataView.getFilteredItems()},getKdbTypeFromColumn:function(e){e=this.columnInfo.get(e);return e?e.get("kdbType"):null},getRowIxRange:function(){return e=this.grid.getRenderedRange(),_.range(e.top,e.bottom+1);var e},isChangeSetEmpty:function(e){return _.isEmpty(_.pick(e,["reset","add","change","remove"]))},onPage:function(){this.grid&&this.grid.scrollRowToTop(0)},onSettingsChange:function(e){var t=_.has(e,"Basics.Data");void 0===this.skipGridGeneration&&(this.skipGridGeneration=!0),_.each(_.omit(e,"Style.Theme","Basics.Data"),_.bind(function(e,t){this.viewModel.set(t,"ColumnsConfiguration"===t?_.cloneDeep(e):e),t===this.filteringModule.BASICS_KDB_FILTER_STRING?this.viewModel.trigger("change:"+this.filteringModule.BASICS_KDB_FILTER_STRING):"Selection.Actions"===t&&this.selectionModule.onChange_SelectionActions()},this)),t&&this.viewModel.set("Basics.Data",_.get(e,"Basics.Data")),this.skipGridGeneration&&(this.skipGridGeneration=!1,this.generateDataGridFromReceivedData())},refreshDataView:function(){this.dataView&&this.dataView.refresh()},registerCellExternalCopyManager:function(){var e={includeHeaderWhenCopying:!0};_.isEmpty(this.customEditors)&&this.grid.registerPlugin(new Slick.CellExternalCopyManager(e))},remove:function(){this.destroyGrid(),this.viewstateTrackingModule.remove(),this.editorModule.remove(),this.filteringModule.remove(),this.groupingModule.remove(),this.highlightingModule.remove(),this.layoutModule.remove(),this.pagerModule.remove(),this.queryStatusModule.remove(),this.scrollingModule.remove(),this.selectionModule.remove(),this.sortingModule.remove(),this.themeModule.remove(),this.tooltipModule.remove(),this.sparklinesManager.remove(),this.rawModeModule.remove(),this.summaryRowModule.remove(),this.printModule.remove(),this.unsubscribeModel(),w.View.prototype.remove.apply(this,arguments)},removeItemsFromDataview:function(e){e&&e.length&&e.forEach(function(e){this.dataView.deleteItem(e[this.primaryKey])},this)},renderDatagrid:function(){var e=this,i=this,t={},o="enabled"===i.viewModel.get("Basics.EditMode")&&i.viewModel.get("Basics.IsInsertable");if(this.dataView||this.dataToRender_usedOnlyOnce){if(this.RAW_MODE&&this.rawModeModule.modifyDataViewConfig(t),i.editorModule.hasUnmodifiedData()&&(this.dataToRender_usedOnlyOnce=i.editorModule.useUnmodifiedData()),this.dataView&&null===this.dataToRender_usedOnlyOnce)if(this.viewModel.isLazyDataLoadingOn()&&this.currentPagingInfo){if(0!==this.currentPagingInfo.startRows)return void this.onChange_DataRelated();this.dataToRender_usedOnlyOnce=[];for(var n=Number(this.currentPagingInfo.numRows),a=0;a<n;a++)this.dataToRender_usedOnlyOnce.push(this.dataView.getItem(a))}else this.dataToRender_usedOnlyOnce=this.dataView.getItems();this.pagerModule.storeCurrentState(),this.destroyGrid();var o={enableCellNavigation:!0,editable:i.customEditors||i.editorModule.isEditable,enableAddRow:i.editorModule.isEditable&&o,enableCellNavigation:!0,asyncEditorLoading:!1,rowHeight:i.viewModel.get("Style.RowHeight"),headerRowHeight:i.viewModel.get("Style.HeaderRowHeight"),multiColumnSort:!0,multiSelect:"Multi Row"===i.viewModel.get("Selection.Mode"),forceFitColumns:!1,autoExpandColumns:!0,forceSyncScrolling:!0,autoEdit:!0,kdbTypesColumnInfo:this.columnInfo,editorLock:new Slick.EditorLock},t=(this.filteringModule.modifyGridConfig(o),_.extend(o,{evenRowBackgroundColorOverride:i.viewModel.get("Style.EvenRowBackgroundColorOverride"),oddRowBackgroundColorOverride:i.viewModel.get("Style.OddRowBackgroundColorOverride"),headerFontWeight:i.viewModel.get("Style.HeaderFontWeight"),fontFamily:i.viewModel.get("Style.FontFamily"),fontSize:this.themeModule.getFontSize(),cellHighlightCssClass:"highlighted",scrollLeft:this.RAW_MODE?this.rawModeModule.scrollLeft:null}),this.groupingModule.modifyDataViewConfig(t),t.atomizeTemporal=this.atomizeTemporal,i.dataView=this.viewModel.isLazyDataLoadingOn()?new he(this,t):new Slick.Data.DataView(t),this.rawModeModule.switchDataviewGetters(),i.columnFields=_.map(i.columnsConfig,"field"),_.map(i.unpackedColumnsConfiguration,function(e,t){return e.Hidden?null:i.columnsConfig[t]})),t=_.compact(t),s=(this.selectionModule.initCheckBoxColumn(t),this.viewstateTrackingModule.unsubscribeViewstateSubscribers(),this.viewstateTrackingModule.subscribeViewstateSubscribers(t),_.some(t,function(e){if(_.get(e,"_dashboardConfig.Header"))return _.get(e,"_dashboardConfig.Header")&&"none"!==e._dashboardConfig.Header}));s&&_.each(t,function(e){e.groupName="none"===_.get(e,"_dashboardConfig.Header")?" ":_.get(e,"_dashboardConfig.Header")}),this.onSelectOnCheckOnly(),i.grid=new Slick.GridModifiedByIK(i.$pnlGrid,i.dataView,t||[],o),i.grid.onContextMenu.subscribe(function(e){e.preventDefault();var t=i.grid.getCellFromEvent(e);i.selectionModule.onAction("Right Click",e,t)}),this.editorModule.resetLists(),this.editorModule.setUpdateTypeConfig(i.columnInfo),this.editorModule.initializeGridListeners(),i.grid.registerPlugin(this.groupingModule.groupItemMetadataProvider),i.grid.registerPlugin(new Slick.AutoTooltips({enableForHeaderCells:!0,enableForCells:"none"===this.viewModel.get("Tooltip.Position")})),s&&(i.grouping=new Slick.ColumnGroup,i.grid.registerPlugin(i.grouping),i.grouping.enableColumnGrouping()),this.tooltipModule.initRowTooltip(),this.selectionModule.registerGridSelectionModel(),i.registerCellExternalCopyManager(),i.subscribeToDataViewEvents(),i.subscribeToGridEvents(),o.explicitInitialization&&(this.filteringModule.registerColumnFilters(),i.grid.init()),"instant"===this.viewModel.get("Basics.EditMode")&&(this.$el.find(".slick-header-columns").on("sortcreate",function(){return e.editorModule.refreshSelectAllState()}),this.editorModule.refreshSelectAllState(!0)),i.dataView.beginUpdate(),i.dataView.setItems(this.dataToRender_usedOnlyOnce,i.SLICKGRID_ROW_UNIQUE_ID),this.dataToRender_usedOnlyOnce=null,this.filteringModule.registerDataViewFilter(),i.dataView.endUpdate(),this.RAW_MODE&&(this.selectionModule.onChange_SelectionColumn(),this.rawModeModule.populateFields(this.highlightingModule.getHighlightingFields(),"highlighting"),this.rawModeModule.populateFields(this.summaryRowModule.getSummaryRowFields(),"summaryRow")),this.pagerModule.initPager(this.model&&this.model.get("_serverPaging"),function(){i.sortingModule.initDefaultSortings(),i.sortingModule.triggerSorting()}),i.groupingModule.groupingChanged(),this.RAW_MODE&&this.rawModeModule.resetVerticalScrollValues(),this.summaryRowModule.updateSummmaryRow(),this.trigger("datagrid-rendered")}},onSelectOnCheckOnly:function(){var t=this.viewModel.get("Selection.SelectOnCheckOnly"),i=this;this.dataView&&!this.RAW_MODE&&(this.dataView.getItemMetadata=function(e){e=i.dataView.getItem(e);return void 0===e?null:e.__group?i.groupingModule.groupItemMetadataProvider.getGroupRowMetadata(e):e.__groupTotals?i.groupingModule.groupItemMetadataProvider.getTotalsRowMetadata(e):{selectable:!t}})},resetLayout:function(){this.dataToRender_usedOnlyOnce=[],this.renderDatagrid()},resetPreviousValuesMap:function(){this.previousValuesMapPending=null,this.previousValuesMap={},this.diffValuesMap={}},storeAllCurrentDataRows:function(){var n,a,s=this.dataView;s&&(a=this.highlightingModule.getHighlightingFields()).length&&(n=s.getOptions&&s.getOptions().populateItem,this.previousValuesMapPending=_.mapValues(s.getInternalMap_idxById(),function(e,t){var i=s.getItemByIdx(e),o={};return n&&(i=n(i)),_.forEach(a,function(e){o[e]=_.cloneDeep(i[e]),this.previousValuesMap&&this.previousValuesMap[t]&&void 0!==this.previousValuesMap[t][e]&&(this.diffValuesMap[t]=this.diffValuesMap[t]||{},_.isEqual(o[e],this.previousValuesMap[t][e])||(this.diffValuesMap[t][e]=this.previousValuesMap[t][e]))}.bind(this)),o}.bind(this)))},subscribeToDataViewEvents:function(){var i=this;i.dataView.onPagingInfoChanged.subscribe(function(e,t){i.highlightingModule.processMinMaxHighlighting_debounced()}),i.dataView.onRowCountChanged.subscribe(function(e,t){i.grid.updateRowCount()}),i.dataView.onRowsChanged.subscribe(function(e,t){i.grid.invalidateRows(t.rows),i.grid.render(),i.sparklinesManager.refresh(),i.highlightingModule.processMinMaxHighlighting_debounced(),i.groupingModule.saveGroupingState()})},subscribeToGridEvents:function(){this.scrollingModule.subscribeToScrollEvent(),this.sortingModule.subscribeToSortEvent(),this.groupingModule.fixColumnReorderingLayoutIssue(),this.layoutModule.subscribeToColumnsResizeEvent(),_.each(this.gridEventSubscribers,_.bind(function(e){e.apply(this)},this))},unpackColumnConfiguration:function(e,t){var s=[],i=_.map(_.reject(e,l.isDynamic),"Field"),r=_.difference(t.pluck("id"),i);return _.each(e,function(i){var o,t,n,a;l.isDynamic(i)?(a=l.getRegex(i),n=a.regex,t=0,o=a.isExact?i.DisplayName:_.map(i.DisplayName,function(e){return"*"===e?"$"+(t+=1):e}).join(""),_.each(r,function(e,t){n.test(e)&&(e=_.extend({},i,{DisplayName:a.isExact&&!i.DisplayName?e:e.replace(n,o),Field:e}),s.push(e),r[t]=null)}),r=_.compact(r)):s.push(i)}),s},unsubscribeModel:function(){this.model&&(this.stopListening(this.model),this.api.unsubscribe(this.model))}},{getComponentDefinition:r.getComponentDefinition,getSettingsModel:r.getSettingsModel,getColumnSettingsModel:r.getColumnSettingsModel,getDefaultJSONTemplates:r.getDefaultJSONTemplates,mergeWithDefault:r.mergeWithDefault});return E.Master=E.extend(K),E});