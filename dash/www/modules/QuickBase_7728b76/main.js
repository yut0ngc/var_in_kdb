define(["backbone","Pickr","Handlebars","dashMoment","fflate","css!./css/app.css"],function(m,R,U,p,F){var q,i,Y,l,H,K,z,Q,W,j,G,X,Z,J,e=this&&this.__extends||(q=function(t,e){return(q=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}q(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),tt=this&&this.__assign||function(){return(tt=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},et=function(){var t;function y(t,e,n){null!=t&&("number"==typeof t?this.fromNumber(t,e,n):null==e&&"string"!=typeof t?this.fromBytes(t):this.fromString(t,e))}function v(){return new y(null)}t="Microsoft Internet Explorer"==navigator.appName?(y.prototype.am=function(t,e,n,i,o,s){for(var a=32767&e,r=e>>15;0<=--s;){var l=32767&this[t],u=this[t++]>>15,c=r*l+u*a;o=((l=a*l+((32767&c)<<15)+n[i]+(1073741823&o))>>>30)+(c>>>15)+r*u+(o>>>30),n[i++]=1073741823&l}return o},30):"Netscape"!=navigator.appName?(y.prototype.am=function(t,e,n,i,o,s){for(;0<=--s;){var a=e*this[t++]+n[i]+o;o=Math.floor(a/67108864),n[i++]=67108863&a}return o},26):(y.prototype.am=function(t,e,n,i,o,s){for(var a=16383&e,r=e>>14;0<=--s;){var l=16383&this[t],u=this[t++]>>14,c=r*l+u*a;o=((l=a*l+((16383&c)<<14)+n[i]+o)>>28)+(c>>14)+r*u,n[i++]=268435455&l}return o},28),y.prototype.DB=t,y.prototype.DM=(1<<t)-1,y.prototype.DV=1<<t;y.prototype.FV=Math.pow(2,52),y.prototype.F1=52-t,y.prototype.F2=2*t-52;for(var e="0123456789abcdefghijklmnopqrstuvwxyz",n=new Array,i="0".charCodeAt(0),o=0;o<=9;++o)n[i++]=o;for(i="a".charCodeAt(0),o=10;o<36;++o)n[i++]=o;for(i="A".charCodeAt(0),o=10;o<36;++o)n[i++]=o;function l(t){return e.charAt(t)}function u(t,e){t=n[t.charCodeAt(e)];return null==t?-1:t}function m(t){var e=v();return e.fromInt(t),e}function b(t){var e,n=1;return 0!=(e=t>>>16)&&(t=e,n+=16),0!=(e=t>>8)&&(t=e,n+=8),0!=(e=t>>4)&&(t=e,n+=4),0!=(e=t>>2)&&(t=e,n+=2),0!=(e=t>>1)&&(t=e,n+=1),n}function w(t){this.m=t}function S(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function s(t,e){return t&e}function a(t,e){return t|e}function r(t,e){return t^e}function c(t,e){return t&~e}function p(){}function d(t){return t}function _(t){this.r2=v(),this.q3=v(),y.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}w.prototype.convert=function(t){return t.s<0||0<=t.compareTo(this.m)?t.mod(this.m):t},w.prototype.revert=function(t){return t},w.prototype.reduce=function(t){t.divRemTo(this.m,null,t)},w.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},w.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},S.prototype.convert=function(t){var e=v();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&0<e.compareTo(y.ZERO)&&this.m.subTo(e,e),e},S.prototype.revert=function(t){var e=v();return t.copyTo(e),this.reduce(e),e},S.prototype.reduce=function(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var n=32767&t[e],i=n*this.mpl+((n*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[n=e+this.m.t]+=this.m.am(0,i,t,e,0,this.m.t);t[n]>=t.DV;)t[n]-=t.DV,t[++n]++}t.clamp(),t.drShiftTo(this.m.t,t),0<=t.compareTo(this.m)&&t.subTo(this.m,t)},S.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},S.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},y.prototype.copyTo=function(t){for(var e=this.t-1;0<=e;--e)t[e]=this[e];t.t=this.t,t.s=this.s},y.prototype.fromInt=function(t){this.t=1,this.s=t<0?-1:0,0<t?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0},y.prototype.fromString=function(t,e){var n;if(16==e)n=4;else if(8==e)n=3;else if(256==e)n=8;else if(2==e)n=1;else if(32==e)n=5;else{if(4!=e)return void this.fromRadix(t,e);n=2}this.t=0,this.s=0;for(var i=t.length,o=!1,s=0;0<=--i;){var a=8==n?255&t[i]:u(t,i);a<0?"-"==t.charAt(i)&&(o=!0):(o=!1,0==s?this[this.t++]=a:s+n>this.DB?(this[this.t-1]|=(a&(1<<this.DB-s)-1)<<s,this[this.t++]=a>>this.DB-s):this[this.t-1]|=a<<s,(s+=n)>=this.DB&&(s-=this.DB))}8==n&&0!=(128&t[0])&&(this.s=-1,0<s)&&(this[this.t-1]|=(1<<this.DB-s)-1<<s),this.clamp(),o&&y.ZERO.subTo(this,this)},y.prototype.fromBytes=function(t){this.t=0;for(var e=-1,n=this.s=0;++e<t.length;){var i=255&t[e];0==n?this[this.t++]=i:n+8>this.DB?(this[this.t-1]|=(i&(1<<this.DB-n)-1)<<n,this[this.t++]=i>>this.DB-n):this[this.t-1]|=i<<n,(n+=8)>=this.DB&&(n-=this.DB)}0!=(128&t[t.length-1])&&(this.s=-1,0<n)&&(this[this.t-1]|=(1<<this.DB-n)-1<<n),this.clamp()},y.prototype.clamp=function(){for(var t=this.s&this.DM;0<this.t&&this[this.t-1]==t;)--this.t},y.prototype.dlShiftTo=function(t,e){for(var n=this.t-1;0<=n;--n)e[n+t]=this[n];for(n=t-1;0<=n;--n)e[n]=0;e.t=this.t+t,e.s=this.s},y.prototype.drShiftTo=function(t,e){for(var n=t;n<this.t;++n)e[n-t]=this[n];e.t=Math.max(this.t-t,0),e.s=this.s},y.prototype.lShiftTo=function(t,e){for(var n=t%this.DB,i=this.DB-n,o=(1<<i)-1,s=Math.floor(t/this.DB),a=this.s<<n&this.DM,r=this.t-1;0<=r;--r)e[r+s+1]=this[r]>>i|a,a=(this[r]&o)<<n;for(r=s-1;0<=r;--r)e[r]=0;e[s]=a,e.t=this.t+s+1,e.s=this.s,e.clamp()},y.prototype.rShiftTo=function(t,e){e.s=this.s;var n=Math.floor(t/this.DB);if(n>=this.t)e.t=0;else{var i=t%this.DB,o=this.DB-i,s=(1<<i)-1;e[0]=this[n]>>i;for(var a=n+1;a<this.t;++a)e[a-n-1]|=(this[a]&s)<<o,e[a-n]=this[a]>>i;0<i&&(e[this.t-n-1]|=(this.s&s)<<o),e.t=this.t-n,e.clamp()}},y.prototype.subTo=function(t,e){for(var n=0,i=0,o=Math.min(t.t,this.t);n<o;)i+=this[n]-t[n],e[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i-=t.s;n<this.t;)i+=this[n],e[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i-=t[n],e[n++]=i&this.DM,i>>=this.DB;i-=t.s}e.s=i<0?-1:0,i<-1?e[n++]=this.DV+i:0<i&&(e[n++]=i),e.t=n,e.clamp()},y.prototype.multiplyTo=function(t,e){var n=this.abs(),i=t.abs(),o=n.t;for(e.t=o+i.t;0<=--o;)e[o]=0;for(o=0;o<i.t;++o)e[o+n.t]=n.am(0,i[o],e,o,0,n.t);e.s=0,e.clamp(),this.s!=t.s&&y.ZERO.subTo(e,e)},y.prototype.squareTo=function(t){for(var e=this.abs(),n=t.t=2*e.t;0<=--n;)t[n]=0;for(n=0;n<e.t-1;++n){var i=e.am(n,e[n],t,2*n,0,1);(t[n+e.t]+=e.am(n+1,2*e[n],t,2*n+1,i,e.t-n-1))>=e.DV&&(t[n+e.t]-=e.DV,t[n+e.t+1]=1)}0<t.t&&(t[t.t-1]+=e.am(n,e[n],t,2*n,0,1)),t.s=0,t.clamp()},y.prototype.divRemTo=function(t,e,n){var i=t.abs();if(!(i.t<=0)){var o=this.abs();if(o.t<i.t)null!=e&&e.fromInt(0),null!=n&&this.copyTo(n);else{null==n&&(n=v());var s=v(),a=this.s,t=t.s,r=this.DB-b(i[i.t-1]),l=(0<r?(i.lShiftTo(r,s),o.lShiftTo(r,n)):(i.copyTo(s),o.copyTo(n)),s.t),u=s[l-1];if(0!=u){var i=u*(1<<this.F1)+(1<l?s[l-2]>>this.F2:0),c=this.FV/i,p=(1<<this.F1)/i,d=1<<this.F2,h=n.t,g=h-l,f=null==e?v():e;for(s.dlShiftTo(g,f),0<=n.compareTo(f)&&(n[n.t++]=1,n.subTo(f,n)),y.ONE.dlShiftTo(l,f),f.subTo(s,s);s.t<l;)s[s.t++]=0;for(;0<=--g;){var m=n[--h]==u?this.DM:Math.floor(n[h]*c+(n[h-1]+d)*p);if((n[h]+=s.am(0,m,n,g,0,l))<m)for(s.dlShiftTo(g,f),n.subTo(f,n);n[h]<--m;)n.subTo(f,n)}null!=e&&(n.drShiftTo(l,e),a!=t)&&y.ZERO.subTo(e,e),n.t=l,n.clamp(),0<r&&n.rShiftTo(r,n),a<0&&y.ZERO.subTo(n,n)}}}},y.prototype.invDigit=function(){var t,e;return this.t<1||0==(1&(t=this[0]))?0:0<(e=(e=(e=(e=(e=3&t)*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)?this.DV-e:-e},y.prototype.isEven=function(){return 0==(0<this.t?1&this[0]:this.s)},y.prototype.exp=function(t,e){if(4294967295<t||t<1)return y.ONE;var n,i=v(),o=v(),s=e.convert(this),a=b(t)-1;for(s.copyTo(i);0<=--a;)e.sqrTo(i,o),0<(t&1<<a)?e.mulTo(o,s,i):(n=i,i=o,o=n);return e.revert(i)},y.prototype.toString=function(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var n,i=(1<<e)-1,o=!1,s="",a=this.t,r=this.DB-a*this.DB%e;if(0<a--)for(r<this.DB&&0<(n=this[a]>>r)&&(o=!0,s=l(n));0<=a;)r<e?(n=(this[a]&(1<<r)-1)<<e-r,n|=this[--a]>>(r+=this.DB-e)):(n=this[a]>>(r-=e)&i,r<=0&&(r+=this.DB,--a)),(o=0<n?!0:o)&&(s+=l(n));return o?s:"0"},y.prototype.negate=function(){var t=v();return y.ZERO.subTo(this,t),t},y.prototype.abs=function(){return this.s<0?this.negate():this},y.prototype.compareTo=function(t){var e=this.s-t.s;if(0!=e)return e;var n=this.t;if(0!=(e=n-t.t))return this.s<0?-e:e;for(;0<=--n;)if(0!=(e=this[n]-t[n]))return e;return 0},y.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+b(this[this.t-1]^this.s&this.DM)},y.prototype.mod=function(t){var e=v();return this.abs().divRemTo(t,null,e),this.s<0&&0<e.compareTo(y.ZERO)&&t.subTo(e,e),e},y.prototype.modPowInt=function(t,e){return e=new(t<256||e.isEven()?w:S)(e),this.exp(t,e)},y.ZERO=m(0),y.ONE=m(1),p.prototype.convert=d,p.prototype.revert=d,p.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n)},p.prototype.sqrTo=function(t,e){t.squareTo(e)},_.prototype.convert=function(t){var e;return t.s<0||t.t>2*this.m.t?t.mod(this.m):t.compareTo(this.m)<0?t:(e=v(),t.copyTo(e),this.reduce(e),e)},_.prototype.revert=function(t){return t},_.prototype.reduce=function(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);0<=t.compareTo(this.m);)t.subTo(this.m,t)},_.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},_.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)};var h=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],g=(1<<26)/h[h.length-1];return y.prototype.chunkSize=function(t){return Math.floor(Math.LN2*this.DB/Math.log(t))},y.prototype.toRadix=function(t){if(null==t&&(t=10),0==this.signum()||t<2||36<t)return"0";var e=this.chunkSize(t),n=Math.pow(t,e),i=m(n),o=v(),s=v(),a="";for(this.divRemTo(i,o,s);0<o.signum();)a=(n+s.intValue()).toString(t).substr(1)+a,o.divRemTo(i,o,s);return s.intValue().toString(t)+a},y.prototype.fromRadix=function(t,e){this.fromInt(0);for(var n=this.chunkSize(e=null==e?10:e),i=Math.pow(e,n),o=!1,s=0,a=0,r=0;r<t.length;++r){var l=u(t,r);l<0?"-"==t.charAt(r)&&0==this.signum()&&(o=!0):(a=e*a+l,++s>=n&&(this.dMultiply(i),this.dAddOffset(a,0),a=s=0))}0<s&&(this.dMultiply(Math.pow(e,s)),this.dAddOffset(a,0)),o&&y.ZERO.subTo(this,this)},y.prototype.fromNumber=function(t,e,n){if("number"==typeof e)if(t<2)this.fromInt(1);else for(this.fromNumber(t,n),this.testBit(t-1)||this.bitwiseTo(y.ONE.shiftLeft(t-1),a,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(y.ONE.shiftLeft(t-1),this);else{var n=new Array,i=7&t;n.length=1+(t>>3),e.nextBytes(n),0<i?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}},y.prototype.bitwiseTo=function(t,e,n){for(var i,o=Math.min(t.t,this.t),s=0;s<o;++s)n[s]=e(this[s],t[s]);if(t.t<this.t){for(i=t.s&this.DM,s=o;s<this.t;++s)n[s]=e(this[s],i);n.t=this.t}else{for(i=this.s&this.DM,s=o;s<t.t;++s)n[s]=e(i,t[s]);n.t=t.t}n.s=e(this.s,t.s),n.clamp()},y.prototype.changeBit=function(t,e){return t=y.ONE.shiftLeft(t),this.bitwiseTo(t,e,t),t},y.prototype.addTo=function(t,e){for(var n=0,i=0,o=Math.min(t.t,this.t);n<o;)i+=this[n]+t[n],e[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i+=t.s;n<this.t;)i+=this[n],e[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i+=t[n],e[n++]=i&this.DM,i>>=this.DB;i+=t.s}e.s=i<0?-1:0,0<i?e[n++]=i:i<-1&&(e[n++]=this.DV+i),e.t=n,e.clamp()},y.prototype.dMultiply=function(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()},y.prototype.dAddOffset=function(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}},y.prototype.multiplyLowerTo=function(t,e,n){var i,o=Math.min(this.t+t.t,e);for(n.s=0,n.t=o;0<o;)n[--o]=0;for(i=n.t-this.t;o<i;++o)n[o+this.t]=this.am(0,t[o],n,o,0,this.t);for(i=Math.min(t.t,e);o<i;++o)this.am(0,t[o],n,o,0,e-o);n.clamp()},y.prototype.multiplyUpperTo=function(t,e,n){var i=n.t=this.t+t.t- --e;for(n.s=0;0<=--i;)n[i]=0;for(i=Math.max(e-this.t,0);i<t.t;++i)n[this.t+i-e]=this.am(e-i,t[i],n,0,0,this.t+i-e);n.clamp(),n.drShiftTo(1,n)},y.prototype.modInt=function(t){if(t<=0)return 0;var e=this.DV%t,n=this.s<0?t-1:0;if(0<this.t)if(0==e)n=this[0]%t;else for(var i=this.t-1;0<=i;--i)n=(e*n+this[i])%t;return n},y.prototype.millerRabin=function(t){var e=this.subtract(y.ONE),n=e.getLowestSetBit();if(n<=0)return!1;for(var i=e.shiftRight(n),o=(h.length<(t=t+1>>1)&&(t=h.length),v()),s=0;s<t;++s){o.fromInt(h[Math.floor(Math.random()*h.length)]);var a=o.modPow(i,this);if(0!=a.compareTo(y.ONE)&&0!=a.compareTo(e)){for(var r=1;r++<n&&0!=a.compareTo(e);)if(0==(a=a.modPowInt(2,this)).compareTo(y.ONE))return!1;if(0!=a.compareTo(e))return!1}}return!0},y.prototype.clone=function(){var t=v();return this.copyTo(t),t},y.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},y.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},y.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},y.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},y.prototype.toByteArray=function(){var t,e=this.t,n=new Array,i=(n[0]=this.s,this.DB-e*this.DB%8),o=0;if(0<e--)for(i<this.DB&&(t=this[e]>>i)!=(this.s&this.DM)>>i&&(n[o++]=t|this.s<<this.DB-i);0<=e;)i<8?(t=(this[e]&(1<<i)-1)<<8-i,t|=this[--e]>>(i+=this.DB-8)):(t=this[e]>>(i-=8)&255,i<=0&&(i+=this.DB,--e)),0!=(128&t)&&(t|=-256),0==o&&(128&this.s)!=(128&t)&&++o,(0<o||t!=this.s)&&(n[o++]=t);return n},y.prototype.equals=function(t){return 0==this.compareTo(t)},y.prototype.min=function(t){return this.compareTo(t)<0?this:t},y.prototype.max=function(t){return 0<this.compareTo(t)?this:t},y.prototype.and=function(t){var e=v();return this.bitwiseTo(t,s,e),e},y.prototype.or=function(t){var e=v();return this.bitwiseTo(t,a,e),e},y.prototype.xor=function(t){var e=v();return this.bitwiseTo(t,r,e),e},y.prototype.andNot=function(t){var e=v();return this.bitwiseTo(t,c,e),e},y.prototype.not=function(){for(var t=v(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t},y.prototype.shiftLeft=function(t){var e=v();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e},y.prototype.shiftRight=function(t){var e=v();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e},y.prototype.getLowestSetBit=function(){for(var t,e,n=0;n<this.t;++n)if(0!=this[n])return n*this.DB+(t=this[n],e=void 0,0==t?-1:((e=0)==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e));return this.s<0?this.t*this.DB:-1},y.prototype.bitCount=function(){for(var t=0,e=this.s&this.DM,n=0;n<this.t;++n)t+=function(t){for(var e=0;0!=t;)t&=t-1,++e;return e}(this[n]^e);return t},y.prototype.testBit=function(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)},y.prototype.setBit=function(t){return this.changeBit(t,a)},y.prototype.clearBit=function(t){return this.changeBit(t,c)},y.prototype.flipBit=function(t){return this.changeBit(t,r)},y.prototype.add=function(t){var e=v();return this.addTo(t,e),e},y.prototype.subtract=function(t){var e=v();return this.subTo(t,e),e},y.prototype.multiply=function(t){var e=v();return this.multiplyTo(t,e),e},y.prototype.divide=function(t){var e=v();return this.divRemTo(t,e,null),e},y.prototype.remainder=function(t){var e=v();return this.divRemTo(t,null,e),e},y.prototype.divideAndRemainder=function(t){var e=v(),n=v();return this.divRemTo(t,e,n),new Array(e,n)},y.prototype.modPow=function(t,e){var n=t.bitLength(),i=m(1);if(n<=0)return i;var o=n<18?1:n<48?3:n<144?4:n<768?5:6,s=new(n<8?w:e.isEven()?_:S)(e),a=new Array,r=3,l=o-1,u=(1<<o)-1;if(a[1]=s.convert(this),1<o){var c=v();for(s.sqrTo(a[1],c);r<=u;)a[r]=v(),s.mulTo(c,a[r-2],a[r]),r+=2}for(var p,d,h=t.t-1,g=!0,f=v(),n=b(t[h])-1;0<=h;){for(l<=n?p=t[h]>>n-l&u:(p=(t[h]&(1<<n+1)-1)<<l-n,0<h&&(p|=t[h-1]>>this.DB+n-l)),r=o;0==(1&p);)p>>=1,--r;if((n-=r)<0&&(n+=this.DB,--h),g)a[p].copyTo(i),g=!1;else{for(;1<r;)s.sqrTo(i,f),s.sqrTo(f,i),r-=2;0<r?s.sqrTo(i,f):(d=i,i=f,f=d),s.mulTo(f,a[p],i)}for(;0<=h&&0==(t[h]&1<<n);)s.sqrTo(i,f),d=i,i=f,f=d,--n<0&&(n=this.DB-1,--h)}return s.revert(i)},y.prototype.modInverse=function(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return y.ZERO;for(var n=t.clone(),i=this.clone(),o=m(1),s=m(0),a=m(0),r=m(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),e?(o.isEven()&&s.isEven()||(o.addTo(this,o),s.subTo(t,s)),o.rShiftTo(1,o)):s.isEven()||s.subTo(t,s),s.rShiftTo(1,s);for(;i.isEven();)i.rShiftTo(1,i),e?(a.isEven()&&r.isEven()||(a.addTo(this,a),r.subTo(t,r)),a.rShiftTo(1,a)):r.isEven()||r.subTo(t,r),r.rShiftTo(1,r);0<=n.compareTo(i)?(n.subTo(i,n),e&&o.subTo(a,o),s.subTo(r,s)):(i.subTo(n,i),e&&a.subTo(o,a),r.subTo(s,r))}return 0!=i.compareTo(y.ONE)?y.ZERO:0<=r.compareTo(t)?r.subtract(t):r.signum()<0&&(r.addTo(t,r),r.signum()<0)?r.add(t):r},y.prototype.pow=function(t){return this.exp(t,new p)},y.prototype.gcd=function(t){var e=this.s<0?this.negate():this.clone(),n=t.s<0?t.negate():t.clone(),i=(e.compareTo(n)<0&&(t=e,e=n,n=t),e.getLowestSetBit());if((t=n.getLowestSetBit())<0)return e;for(0<(t=i<t?i:t)&&(e.rShiftTo(t,e),n.rShiftTo(t,n));0<e.signum();)0<(i=e.getLowestSetBit())&&e.rShiftTo(i,e),0<(i=n.getLowestSetBit())&&n.rShiftTo(i,n),0<=e.compareTo(n)?(e.subTo(n,e),e.rShiftTo(1,e)):(n.subTo(e,n),n.rShiftTo(1,n));return 0<t&&n.lShiftTo(t,n),n},y.prototype.isProbablePrime=function(t){var e,n=this.abs();if(1==n.t&&n[0]<=h[h.length-1]){for(e=0;e<h.length;++e)if(n[0]==h[e])return!0;return!1}if(n.isEven())return!1;for(e=1;e<h.length;){for(var i=h[e],o=e+1;o<h.length&&i<g;)i*=h[o++];for(i=n.modInt(i);e<o;)if(i%h[e++]==0)return!1}return n.millerRabin(t)},y.prototype.square=function(){var t=v();return this.squareTo(t),t},{BigInteger:y}}(),nt={VALUE_CREATED:"created",VALUE_UPDATED:"updated",VALUE_DELETED:"deleted",VALUE_UNCHANGED:"unchanged",getDiff:function(t,e){return this.removeUnchanged(this.map(t,e))},map:function(t,e){if(this.isFunction(t)||this.isFunction(e))throw"Invalid argument. Function given, object expected.";if(this.isValue(t)||this.isValue(e))return _.clone(void 0===t?e:t);var n,i,o={};for(i in t)this.isFunction(t[i])||((n=void 0)!==e[i]&&(n=e[i]),"_Hidden"===i?o[i]=t[i]:"unchanged"!==this.compareValues(t[i],n)?o[i]=this.map(t[i],n):o[i]=null);for(i in e)this.isFunction(e[i])||void 0!==o[i]||(o[i]=this.map(void 0,e[i]));return o},compareValues:function(t,e){return t===e||this.isDate(t)&&this.isDate(e)&&t.getTime()===e.getTime()?this.VALUE_UNCHANGED:void 0===t?this.VALUE_CREATED:void 0===e?this.VALUE_DELETED:this.VALUE_UPDATED},isFunction:function(t){return"[object Function]"==={}.toString.apply(t)},isArray:function(t){return"[object Array]"==={}.toString.apply(t)},isDate:function(t){return"[object Date]"==={}.toString.apply(t)},isObject:function(t){return"[object Object]"==={}.toString.apply(t)},isValue:function(t){return!this.isObject(t)&&!this.isArray(t)},removeUnchangedJSON:function(n){_.each(n,_.bind(function(t,e){_.isEqual(t,{})||_.isEqual([],t)||null===t?delete n[e]:_.isArray(t)||"string"==typeof t||this.removeUnchangedJSON(n[e])},this))},removeUsedKeys:function(t){for(var e in t)null!==t[e]&&"object"==typeof t[e]&&(this.removeUsedKeys(t[e]),_.isEqual(t[e],{}))&&delete t[e],null===t[e]&&delete t[e]},removeUnchanged:function(t){var n={},i=["string","number","boolean"];return _.each(t,_.bind(function(t,e){0<=_.indexOf(i,typeof t)||null===t&&_.isArray(t)?n[e]=t:n[e]=_.pickBy(t,function(t,e){return null!==t})},this)),this.removeUsedKeys(n),n}};function a(){}function o(){}function it(){}function ot(){}function st(t){return encodeURIComponent(t)}function at(t,e){t=function(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(K," "))}catch(t){}}(t);return H.isFunction(e)?e(t):t}function rt(){this.perf={}}function r(){}function lt(){}function ut(t,e,n,i){i=W.call(this,i,t)||this;return i.isSorted=e,i.length=n,i}function ct(t){switch(t){case 1:case 4:case 10:return 1;case 5:return 2;case 6:case 8:case 13:case 14:case 17:case 18:case 19:return 4;case 7:case 9:case 12:case 15:case 16:return 8;case 2:return 16;default:return}}function pt(t){for(var e,n,i,o="",s=0;s<t.length;s++)switch((e=t[s])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(e);break;case 12:case 13:n=t[++s],o+=String.fromCharCode((31&e)<<6|63&n);break;case 14:n=t[++s],i=t[++s],o+=String.fromCharCode((15&e)<<12|(63&n)<<6|(63&i)<<0)}return o}"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),i=1;i<arguments.length;i++){var o=arguments[i];if(null!=o)for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])}return n},writable:!0,configurable:!0}),n=A=A||{},a.binarySearch=function(t,e,n,i){i=a.getComparator(i,n);return a.binarySearch2(t,e,i)},a.binarySearch2=function(t,e,n){for(var i,o,s=0,a=e.length-1;s<=a;)if(0<(i=n(t,e[o=a+s>>1])))s=1+o;else{if(!(i<0))return o;a=o-1}return-s-1},a.calcDialogHeight=function(t,e){e="FSBL"in window?window.finApi.getDialogHeightOffset(e):40;return window.innerHeight<t+e?window.innerHeight-e:t},a.calculateFontContrast=function(t){var e="",n=0===t.indexOf("#"),i=0===t.indexOf("rgb")||0===t.indexOf("rgba");return e=t&&(n||i)&&(i=n?a.hex2RGB(t):a.rgbStr2Array(t)).length?125<Math.round((299*parseInt(String(i[0]))+587*parseInt(String(i[1]))+114*parseInt(String(i[2])))/1e3)?n?a.getDefaultThemeColors("Dark")[0]:"rgb(40,40,40)":n?a.getDefaultThemeColors("Light")[0]:"rgb(15,15,15)":e},a.clickEvent=function(t){var e=this.hasTouch();return t?e?"touchend mouseup":"click":e?"touchstart click":"click"},a.compress=function(t){t=F.strToU8(t);return F.deflateSync(t,{level:9})},a.convertDateStringValueToMoment=function(t,e){return p.tz(t,e||"UTC")},a.convertISODatetimeToKDBLikeObject=function(t){var e=this.TIME_RX.exec(t),e=_.filter(e,function(t){return void 0!==t});return!e||e.length<2?t:a.convertValueToMoment(t).toKdbObject()},a.convertKDBTemporalToMoment=function(t){var e,n=!1;if(t&&_.isNumber(t.i)&&_.includes(a.Types.kdbTemporals,t.class)){switch(t.class){case"1212":(e=p.tz(t.i,"UTC")).nanoseconds(t.n%1e6),n=!0;break;case"1213":(e=p.tz("2000-01-01","UTC")).add(t.i,"month");break;case"1214":e=p.tz(t.toString(),"UTC");break;case"1216":(e=p.duration(0<t.i?Math.floor(t.i/1e6):Math.ceil(t.i/1e6))).nanoseconds(t.i%1e6);break;case"1217":e=p.duration(60*t.i*1e3);break;case"1218":e=p.duration(1e3*t.i);break;case"1219":e=p.duration(t.i);break;default:e=p.tz(t.i,"UTC"),n=!0}e.kdbType(t.class)}else e=p.tz(t,"UTC");return n&&this.timezone&&e.isValid()&&e.tz(this.timezone),e},a.convertKDBToViewstateValue=function(t){var e=t;return e=_.hasIn(t,"class")?"1222"===t.class?t.toString():a.convertKDBTemporalToMoment(t).toDashString():e},a.convertMomentToDatePicker=function(t,e){return t=a.convertValueToMoment(t),e?t.tz("UTC"):this.timezone&&t.isValid()&&!p.isDuration(t)&&t.tz(this.timezone),e=new Date(t.year(),t.month(),t.date(),t.hour(),t.minute(),t.second(),t.millisecond()),(t=t.nanoseconds())&&!_.isNaN(t)&&(e.nanoseconds=t),e},a.convertTypeToKdbType=function(t,e){return t?_.includes(a.Types.kdbTemporals,t)?t:_.includes(a.Types.kdbTemporals,a.Types.dashboardToKdb[t])?a.Types.dashboardToKdb[t]:null:a.inferKdbTypeFromDashString(e)},a.convertUserInputToMoment=function(t,e,n){return _.isString(t)?(t=t.replace(/(\d\d\d\d)\.(\d\d)\.(\d\d)/,"$1-$2-$3"),n=n?p.tz(t,e,"UTC"):this.timezone?p.tz(t,e,this.timezone):p(t,e),(e=a.extractNanos(t))&&!_.isNaN(e)&&(n.kdbType("1212"),n.nanoseconds(e)),n):t},a.convertValueToDuration=function(t,e){var n,i,o=a.convertTypeToKdbType(e,t);return _.includes(["1212","1213","1214","1215"],e)?a.convertValueToMoment(t,e):t?(p.isDuration(t)?n=t:_.isString(t)&&(i=(t=t.replace("1970-01-01T","").replace("Z","")).match(/(\d\d:\d\d:\d\d.\d\d\d)(\d\d\d\d\d\d)/))&&i[1]?("1216"===e&&-1!==t.indexOf("D")&&(e=t.substring(0,t.indexOf(":")).split("D"),e=Number(e[1])+24*Number(e[0]))&&(i[1]=e+i[1].substring(t.indexOf(":")-2)),n=p.duration(i[1]),(e=i[2]?Number(i[2]):0)&&!_.isNaN(e)&&n.nanoseconds(e)):n=p.duration(t),n&&o&&n.kdbType(o),n):p.duration(0)},a.convertValueToMoment=function(t,e,n){var i,o=a.convertTypeToKdbType(e,t),s=0;return _.includes(["1216","1217","1218","1219"],e)?a.convertValueToDuration(t,e):(null==t?(i=p(),n||i.tz(this.timezone)):p.isMoment(t)?i=t:(!_.isString(t)||"1214"!==o&&"1213"!==o?(i=p(t),n||i.tz(this.timezone)):i=p.utc(t),_.isDate(t)?s=t.nanoseconds:_.isString(t)&&(s=a.extractNanos(t)),s&&!_.isNaN(s)&&i.nanoseconds(s)),i&&o&&i.kdbType(o),i)},a.convertStringToMomentFormat=function(t,e){if(t){var n=!1;switch(e){case"1213":t=t.replace("m","");break;case"1212":t=t.split("D")[0].replace(/\./g,"-")+"T"+t.split("D")[1]+"Z",n=!0;break;case"1215":t=t.split("T")[0].replace(/\./g,"-")+"T"+t.split("T")[1]+"Z",n=!0}return a.convertValueToMoment(t,e,n)}},a.createPivotCollectionFunc=function(t){return m.Collection.extend({model:m.Model.extend({idAttribute:t,set:function(t,e){"function"==typeof t.subscribe&&(this.subscribe=t.subscribe),"function"==typeof t.unsubscribe&&(this.unsubscribe=t.unsubscribe),m.Model.prototype.set.call(this,t,e)},setX:function(t,e){var n;"object"==typeof t?n=t:(n={})[t]=e,_.extend(this.attributes,n)}})})},a.castToDashString=function(t,e){return e&&t&&t.class&&_.includes(["date","datetime","month","timestamp","minute","time","timespan","second"],e)?t=a.convertKDBTemporalToMoment(t).toDashString():_.isString(t)&&"timespan"===e&&-1<t.indexOf(".000Z")?t=t.replace(".000Z",".000000000Z"):_.isString(t)&&"datetime"===e&&null!==t.match(/[DTZ]/g)&&23<t.length&&(t=t.slice(0,23)+"Z"),t},a.extractNanos=function(t){var e=0;return e=t&&(t=(t=_.isFunction(t.toString)?t.toString():t).match(/\d{1,2}:\d{2}:\d{2}\.\d{3}(\d{6})/))?Number(t[1]):e},a.convertDataUrlToBlob=function(t){for(var t=t.split(","),e=atob(t[1]),n=e.length,i=new Uint8Array(n);n--;)i[n]=e.charCodeAt(n);return i},a.decompress=function(t){t=F.inflateSync(t);return F.strFromU8(t)},a.decodeFromBase64=function(t){return Uint8Array.from(atob(t),function(t){return t.charCodeAt(0)})},a.encodeToBase64=function(t){return btoa(String.fromCharCode.apply(null,t))},a.fileSave=function(t,e,n){n=n||"application/octet-stream";var i,o=document.createElement("a");return window.Blob?(i=new Blob([e],{type:n}),window.navigator.msSaveOrOpenBlob?o.onclick=function(){window.navigator.msSaveOrOpenBlob(i,t)}:void 0!==o.download&&o.setAttribute("href",URL.createObjectURL(i))):o.setAttribute("href",encodeURI(n+","+e)),void 0!==o.download&&o.setAttribute("download",t),document.body.appendChild(o),o.click(),document.body.removeChild(o),_.get(i,"size")?i.size:0},a.formatNumber=function(t,e){var n=t;return $.isNumeric(t)?(n=(t=this.toFixedNumber(t,e).split("."))[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),2===t.length&&(n+="."+t[1]),n):this.htmlEncode(n)},a.getComparator=function(t,s){switch(t){default:case 1:case 2:case 4:case 5:case 6:case 8:case 9:return function(t,e){e=s(e);return null==t||null==e?null!=t?1:null!=e?-1:0:e<t?1:t<e?-1:0};case 10:case 11:return function(t,e){e=s(e);return null==t||null==e?null!=t?1:null!=e?-1:0:t.localeCompare(e,{caseFirst:"lower"})};case 7:return function(t,e){var n,i,o;return e=s(e),null==t||null==e?null!=t?1:null!=e?-1:0:(i=(n="-"===t[0])?1-t.length:t.length)!==(o="-"===e[0]?1-e.length:e.length)?o<i?1:-1:(n?-1:1)*(e<t?1:t<e?-1:0)};case 12:case 16:return function(t,e){var e=s(e),n=null==t||t===1/0||t===-1/0,i=null==e||e===1/0||e===-1/0;return n&&i?e<t?1:t<e?-1:0:n?t>e.i?1:t<e.i?-1:0:i?t.i>e?1:t.i<e?-1:0:t.i>e.i?1:t.i<e.i?-1:t.n>e.n?1:t.n<e.n?-1:0};case 13:case 14:case 15:case 17:case 18:case 19:return function(t,e){var e=s(e),n=null==t||t===1/0||t===-1/0,i=null==e||e===1/0||e===-1/0;return n&&i?e<t?1:t<e?-1:0:n?t>e.i?1:t<e.i?-1:0:i?t.i>e?1:t.i<e?-1:0:t.i>e.i?1:t.i<e.i?-1:0}}},a.getCookie=function(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return decodeURIComponent(o.substring(e.length,o.length))}return""},a.getDeepDiff=function(t,e){return nt.getDiff(t,e)},a.getDefaultThemeColors=function(t){return"Light"===t?["#ffffff","#f4f4f4","#cecece"]:["#282828","#303030","#505050"]},a.getHash=function(t){t=(t||window).location.href.match(/#(.*)$/);return t?t[1]:""},a.getTimezoneOffset=function(){var t=this.timezone?p.tz(this.timezone):p();return t.utcOffset()},a.getTypeCategory=function(t){var e="";switch(t){case"1212":case"1213":case"1214":case"1215":case"date":case"datetime":case"month":case"timestamp":e="date";break;case"1216":case"1217":case"1218":case"1219":case"minute":case"second":case"time":case"timespan":e="duration"}return e},a.getNumberDecimalPlaces=function(t){var e=0;return e=-1!==t.lastIndexOf(".")?t.substr(t.lastIndexOf(".")+1,t.length).length:e},a.hasDefaultThemeColors=function(t,e,n,i){return!("Light"!==t||"#f0f0f0"!==e||"#e0e0e0"!==n&&n||"#c8c8c8"!==i&&i)||!("Dark"!==t||"#282828"!==e||"#303030"!==n&&n||"#505050"!==i&&i)},a.hasTouch=function(){return $(document).hasClass("touch")},a.hex2RGB=function(t){t=(4<t.length?RegExp(/^\#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/):RegExp(/^\#?([a-f\d])([a-f\d])([a-f\d])$/)).exec(t);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[]},a.hoverFix=function(t){var e=t.parentNode,n=t.nextSibling;e.removeChild(t),setTimeout(function(){e.insertBefore(t,n)},0)},a.htmlEncode=function(t){return t.toString().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},a.inferKdbTypeFromDashString=function(t){var e;if(t&&_.isString(t)&&(e=t.match(/^(\d\d\d\d-\d\d)?(-\d\d)?(T\d\d:\d\d:\d\d\.\d{3})?(\d{6})?(?:Z)?$/))){if(e[1]&&e[2]&&e[3]&&e[4])return"1970-01-01"===t.substr(0,10)?"1216":"1212";if(e[1]&&e[2]&&e[3])return"1970-01-01"===t.substr(0,10)?"1219":"1215";if(e[1]&&e[2])return"1214";if(e[1])return"1213"}return null},a.isIE=function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");return 0<e?parseInt(t.substring(e+5,t.indexOf(".",e)),10):0<t.indexOf("Trident/")?(e=t.indexOf("rv:"),parseInt(t.substring(e+3,t.indexOf(".",e)),10)):0<(e=t.indexOf("Edge/"))&&parseInt(t.substring(e+5,t.indexOf(".",e)),10)},a.isKDBTemporal=function(t){return t&&t.class&&_.includes(a.Types.kdbTemporals,t.class)||!1},a.objToUri=function(n){return _.reduce(_.keys(n),function(t,e){return e&&t.push(e+"="+n[e]),t},[]).join("&")},a.padLeft=function(t,e){return _.isNull(t)||_.isUndefined(t)?"":(t=t.toString()).length<e?a.padLeft("0"+t,e):t},a.roundToPlaces=function(t,e){e=Math.pow(10,e);return t*=e,(t=Math.round(t))/e},a.round=function(t,e,n){return n===this.Rounding.Normal?a.roundToPlaces(t,e):(e=Math.pow(10,e),n===a.Rounding.Floor?Math.floor(t*e)/e:Math.ceil(t*e)/e)},a.rgb2hex=function(t){var e="";return e=t.length?"#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+t[2]).toString(16).slice(1):e},a.rgbStr2Array=function(t){t=t.match(/rgba?\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3})\)?(?:, ?(\d(?:\.\d?))\))?/);return t?[t[1],t[2],t[3],t[4]]:[]},a.smartFormatNumber=function(t,e,n){var i=Number(t),o="",s=1;return isNaN(i)?"":"string"==typeof t&&(i>Number.MAX_SAFE_INTEGER||i<Number.MIN_SAFE_INTEGER)?this.toFixedNumber(t,e):(t=Math.max(0,void 0===e?2:e),1e18<=(e=Math.abs(i))?(s=1e18,o="E"):1e15<=e?(s=1e15,o="P"):1e12<=e?(s=1e12,o="T"):1e9<=e?(s=1e9,o="B"):1e6<=e?(s=1e6,o="M"):1e3<=e&&(s=1e3,o="k"),e=a.roundToPlaces(i/s,t),(e=n?e.toFixed(t):e)+o)},a.sum=function(t){return _.reduce(t,function(t,e){return t+e},0)},a.toFixedNumber=function(t,e){e=void 0===e?2:e,e=Math.min(20,Math.max(0,e));return"string"!=typeof t||/(^[^-\d]|^[-\d].*[^\d]+|^-$)/.test(t)?"number"==typeof t?t.toFixed(e):this.htmlEncode(t):t+(e?".":"")+_.repeat("0",e)},a.touchDownEvent=function(t){return this.hasTouch()?"touchstart":"mousedown"},a.tapEvent=function(){return this.hasTouch()?"tap":"mousedown"},a.uriToObj=function(t){return _.reduce(t.split("&"),function(t,e){e=e.split("=");return t[e[0]]=e[1],t},{})},a.isIE11=/Trident\/.*rv:11/.test(navigator.userAgent),a.timezone=function(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return decodeURIComponent(o.substring(e.length,o.length))}return""}("dashboard-timezone")||p.tz.guess(),a.Formats={Date:["YYYY-MM-DD","DD/MM/YYYY","DD.MM.YYYY","MM/DD/YYYY","D/M/YYYY","M/D/YYYY","D/M/YY","M/D/YY","YYYY-MMM-DD","D MMM","D MMM YYYY","MMM D","MMM D, YYYY","YYYY-MM","MM/YYYY","M/YY","MMM YYYY"],DateTime:["YYYY-MM-DD HH:mm:ss","YYYY-MM-DD HH:mm:ss.SSS","YYYY-MM-DD HH:mm:ss.SSSSSS","YYYY-MM-DD HH:mm:ss.SSSSSSSSS","YYYY-MM-DD","MM/DD/YYYY","D/M/YYYY","M/D/YYYY","D/M/YY","M/D/YY","YYYY-MMM-DD","D MMM","D MMM YYYY","MMM D","MMM D, YYYY","HH:mm","HH:mm:ss","HH:mm:ss.SSS","HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS","mm:ss","mm:ss.SSS","mm:ss.SSSSSS","mm:ss.SSSSSSSSS","ss","ss.SSS","ss.SSSSSS","ss.SSSSSSSSS"],Time:["HH:mm","HH:mm:ss","HH:mm:ss.SSS","HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS","mm:ss","mm:ss.SSS","ss","ss.SSS"]},a.TIME_RX=/^((\d\d\d\d-\d\d)|(\d\d\d\d-\d\d-\d\d))?((T\d\d:\d\d:\d\d\.\d{3})(\d{6})?)?(?:Z)?$/,a.Rounding={Normal:0,Floor:1,Ceiling:2},a.Types={dashboardToKdb:{timestamp:"1212",month:"1213",date:"1214",datetime:"1215",timespan:"1216",minute:"1217",second:"1218",time:"1219"},kdbTemporals:["1212","1213","1214","1215","1216","1217","1218","1219"],kdbToDashboard:{1212:"timestamp",1213:"month",1214:"date",1215:"datetime",1216:"timespan",1217:"minute",1218:"second",1219:"time"}},n.Tools=a,i=A=A||{},o.castDate=function(t){return t instanceof Date?t:t&&t.i?new Date(t.i):new Date(t)},o.convertDateToTimeObject=function(t){return{hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisec:t.getUTCMilliseconds()}},o.getByQTypeNum=function(t){return(o.infosByNum=o.infosByNum?o.infosByNum:_.map(o.simple,function(t){return o.infos[t]}))[t]},o.getByName=function(t){var e=this.infos["double"===t?"float":t];return e||((e=this.infos[t.replace("[]","")])?{char:e.char+"[]",num:-e.num,literal:e.literal,null:"",name:t,editor:_.extend({},e.editor,{type:"List",itemType:e.editor.type,editorClass:e.name+"List"}),toKDBInput:function(t){t=_.values(t);return null!=t&&0<t.length?"("+(1<t.length?"":"enlist ")+_.map(t,function(t){return t&&t.toKDBInput?t.toKDBInput():e.toKDBInput(t)}).join(";")+")":"()"}}:this.infos.symbol)},o.toTimeMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);return n.isNilOrInfinite?n.returnType:(n=i.Tools.isKDBTemporal(e)?i.Tools.convertKDBTemporalToMoment(e):i.Tools.convertValueToDuration(e),""===t?p.isDuration(n)?"'"+n.formatNano("HH:mm:ss.SSS",{trim:!1})+"'":"NULL":p.isDuration(n)?n.formatNano("HH:mm:ss.SSS",{trim:!1}):"0Nt")},o.isNilorInfinite=function(t,e){if(""===e){if(_.isNull(t)||_.isUndefined(t)||""===t||t===-1/0||t===1/0)return{isNilOrInfinite:!0,returnType:"NULL"}}else{if(_.isNull(t)||_.isUndefined(t))return{isNilOrInfinite:!0,returnType:"0N"+e};if(t===-1/0)return{isNilOrInfinite:!0,returnType:"-0W"+e};if(t===1/0)return{isNilOrInfinite:!0,returnType:"0W"+e}}return{isNilOrInfinite:!1,returnType:""}},o.toSecondMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);return n.isNilOrInfinite?n.returnType:(n=i.Tools.isKDBTemporal(e)?i.Tools.convertKDBTemporalToMoment(e):i.Tools.convertValueToDuration(e),""===t?p.isDuration(n)?"'"+n.formatNano("HH:mm:ss",{trim:!1})+"'":"NULL":p.isDuration(n)?n.formatNano("HH:mm:ss",{trim:!1}):"0Nv")},o.toMinuteMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);return n.isNilOrInfinite?n.returnType:(n=i.Tools.isKDBTemporal(e)?i.Tools.convertKDBTemporalToMoment(e):i.Tools.convertValueToDuration(e),""===t?p.isDuration(n)?"'"+n.format("HH:mm",{trim:!1})+"'":"NULL":p.isDuration(n)?n.format("HH:mm",{trim:!1}):"0Nu")},o.toTimespanMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);return n.isNilOrInfinite?n.returnType:(n=i.Tools.isKDBTemporal(e)?i.Tools.convertKDBTemporalToMoment(e):i.Tools.convertValueToDuration(e),""===t?p.isDuration(n)?"'"+n.format("DD")+"D"+n.formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1})+"'":"NULL":p.isDuration(n)?n.format("DD")+"D"+n.formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1}):"0N"+t)},o.toMonthMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);return n.isNilOrInfinite?n.returnType:(n=i.Tools.isKDBTemporal(e)?i.Tools.convertKDBTemporalToMoment(e):p.tz(e,"Y.MM","UTC"),""===t?p.isMoment(n)&&n.isValid()?"'"+n.utcOffset(0).format("YYYY-MM-DD")+"'":"NULL":p.isMoment(n)&&n.isValid()?n.utcOffset(0).format("YYYY.MM")+"m":"0Nm")},o.toMomentUTC=function(t){return i.Tools.isKDBTemporal(t)?i.Tools.convertKDBTemporalToMoment(t):p.tz(t,"UTC")},o.toTimeStampMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);if(n.isNilOrInfinite)return n.returnType;_.isString(e)&&(e=e.replace("D","T").replace(/^(\d\d\d\d)\.(\d\d).(\d\d)/,"$1-$2-$3"),e=/Z$/.test(e)?e:e+"Z");n=i.Tools.isKDBTemporal(e)?i.Tools.convertKDBTemporalToMoment(e):i.Tools.convertValueToMoment(e);return""===t?p.isMoment(n)&&n.isValid()?"'"+n.utcOffset(0).format("YYYY-MM-DD")+" "+n.formatNano("HH:mm:ss.SSSSSS",{trim:!1})+"'":"NULL":p.isMoment(n)&&n.isValid()?n.utcOffset(0).format("YYYY.MM.DD")+"D"+n.formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1}):"0Np"},o.toDateTimeMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);if(n.isNilOrInfinite)return n.returnType;_.isString(e)&&(e=e.replace(/^(\d\d\d\d)\.(\d\d).(\d\d)/,"$1-$2-$3"),e=/Z$/.test(e)?e:e+"Z");n=o.toMomentUTC(e);return""===t?p.isMoment(n)&&n.isValid()?"'"+n.utcOffset(0).format("YYYY-MM-DD")+" "+n.formatNano("HH:mm:ss.SSS",{trim:!1})+"'":"NULL":p.isMoment(n)&&n.isValid()?n.utcOffset(0).format("YYYY.MM.DD")+"T"+n.formatNano("HH:mm:ss.SSS",{trim:!1}):"0Np"},o.toDateMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);if(n.isNilOrInfinite)return n.returnType;_.isString(e)&&(e=e.replace(/^(\d\d\d\d)\.(\d\d)\.(\d\d)/,"$1-$2-$3"));n=o.toMomentUTC(e);return""===t?p.isMoment(n)&&n.isValid()?"'"+n.utcOffset(0).format("YYYY-MM-DD")+"'":"NULL":p.isMoment(n)&&n.isValid()?n.utcOffset(0).format("YYYY.MM.DD"):"0Nd"},o.toNumberInput=function(t,e){return""===t?_.isNull(e)||_.isUndefined(e)||isNaN(e)||""===e||e===-1/0||e===1/0?"NULL":e:_.isNull(e)||_.isUndefined(e)||isNaN(e)||""===e?"0N"+t:e===-1/0?"-0W"+t:e===1/0?"0W"+t:e+t},o.toListInput=function(t,e){return e?"("+(_.every(e,function(t){return _.isNull(t)||_.isUndefined(t)||_.isNumber(t)})?_.map(e,function(t){return o.infos.float.toKDBInput(t)}):_.map(e,function(t){return o.infos.char.toKDBInput(t)})).join(t?",":";")+")":"()"},o.REGEX_DATEPICKER=/^\d{4}-\d{2}-\d{2}$/,o.REGEX_ROLLING=/^(?:NOW|T([\+|\-]\d+)|T)(\@)?(\d{1,2})?(:\d{2})?(:\d{2})?(.(\d{9}|\d{3}))?(?:Z)?$/,o.REGEX_DURATION=/^\d{4}-\d{2}-\d{2}T(\d{2,6}):(\d{2}):(\d{2})?[.](\d{9}|\d{3})?Z$/,o.REGEX_TIMEPICKER=/^\d{4}-\d{2}-\d{2}T(\d{2}):(\d{2}):(\d{2})?[.](\d{9}|\d{3})?Z$/,o.infos={List:{char:void 0,size:void 0,num:0,literal:void 0,null:"",name:"list",editor:"List",toKDBInput:function(t){return o.toListInput(!1,t)},toSQLInput:function(t){return o.toListInput(!0,t)}},boolean:{char:"b",size:"1",num:1,literal:"0b",null:"",name:"boolean",editor:{type:"Checkbox"},toKDBInput:function(t){return t?"1b":"0b"},toSQLInput:function(t){return t?"1":"0"}},guid:{char:"g",size:"16",num:2,literal:"",null:"0Ng",name:"guid",editor:{type:"Text",editorAttrs:{maxLength:36},validators:[function(t){if(!t.match(/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/))return{type:"guid",message:"Invalid, requires: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"}}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||""===t?"0Ng":t===-1/0?"0w":t===1/0?"-0w":'"G"$"'+t.toString()+'"'},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)||""===t||t===-1/0||t===1/0?"NULL":"'"+t.toString()+"'"}},byte:{char:"x",size:"1",num:4,literal:"0x00",null:"",name:"byte",editor:{type:"Number",editorAttrs:{min:-128,max:127,step:1},validators:["number",{type:"range",min:-128,max:127},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||isNaN(t)||""===t||t===-1/0?"0x0":t===1/0?"0xFF":"0x"+Number(t).toString(16)},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)||isNaN(t)||""===t||t===-1/0||t===1/0?"NULL":Number(t).toString(16)}},short:{char:"h",size:"2",num:5,literal:"0h",null:"0Nh",name:"short",editor:{type:"Number",editorAttrs:{min:-32768,max:32767,step:1},validators:["number",{type:"range",min:-32768,max:32767},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return o.toNumberInput("h",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},int:{char:"i",size:"4",num:6,literal:"0",null:"0N",name:"int",editor:{type:"Number",editorAttrs:{min:-2147483648,max:2147483647,step:1},validators:["number",{type:"range",min:-2147483648,max:2147483647},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return o.toNumberInput("i",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},long:{char:"j",size:"8",num:7,literal:"0j",null:"0Nj",name:"long",editor:{type:"Long",validators:["number",{type:"range",min:-0x8000000000000000,max:0x8000000000000000},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return o.toNumberInput("j",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},real:{char:"e",size:"4",num:8,literal:"0e",null:"0Ne",name:"real",editor:{type:"Number",editorAttrs:{step:"any"},validators:["number"]},toKDBInput:function(t){return o.toNumberInput("e",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},float:{char:"f",size:"8",num:9,literal:"0.0 or 0f",null:"0n",name:"float",editor:{type:"Number",editorAttrs:{step:"any"},validators:["number"]},toKDBInput:function(t){return o.toNumberInput("f",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},char:{char:"c",size:"1",num:10,literal:'" "',null:'" "',name:"char",editor:{type:"Text",editorAttrs:{maxlength:1}},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||0===t.length?'" "':'"'+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):" ")+'"'},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)?"''":"'"+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+"'"}},symbol:{char:"s",size:".",num:11,literal:"`",null:"`",name:"symbol",editor:{type:"Text"},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?"`":'`$"'+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+'"'},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)?"''":"'"+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+"'"}},timestamp:{char:"p",size:"8",num:12,literal:"dateDtimespan",null:"0Np",name:"timestamp",editor:{type:"DateTimePicker",options:{hasNano:!0,isTimestamp:!0,dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSSSSSSSS",width:200,bindButton:!1},validators:[function(t){if(t){t=i.Tools.convertUserInputToMoment(t,"YYYY/MM/DD HH:mm:ss.SSS");if(t&&!t.isValid())return{type:"timestamp",message:"Invalid date/time"}}}]},toKDBInput:function(t){return o.toTimeStampMomentInput("p",t)},toSQLInput:function(t){return o.toTimeStampMomentInput("",t)}},month:{char:"m",size:"4",num:13,literal:"2000.01m",null:"0Nm",name:"month",editor:{type:"Month",options:{bindButton:!1}},toKDBInput:function(t){return o.toMonthMomentInput("m",t)},toSQLInput:function(t){return o.toMonthMomentInput("",t)}},date:{char:"d",size:"4",num:14,literal:"2000.01.01",null:"0Nd",name:"date",editor:{type:"DatePicker",options:{dateFormat:"yy-mm-dd",width:75,bindButton:!0},validators:[function(t){if(t){var e=i.Tools.convertUserInputToMoment(t,"YYYY/MM/DD");if(e&&!e.isValid())return{type:"date",message:"Invalid date"}}return!o.REGEX_DATEPICKER.test(t.substr(0,10))}]},toKDBInput:function(t){return o.toDateMomentInput("d",t)},toSQLInput:function(t){return o.toDateMomentInput("",t)}},datetime:{char:"z",size:"8",num:15,literal:"dateTtime",null:"0Nz",name:"datetime",editor:{type:"DateTimePicker",options:{dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSS",width:155,bindButton:!0},validators:[function(t){return _.isFunction(t.toISOString)&&(t=t.toISOString()),!o.REGEX_TIMEPICKER.test(t)}]},toKDBInput:function(t){return o.toDateTimeMomentInput("z",t)},toSQLInput:function(t){return o.toDateTimeMomentInput("",t)}},timespan:{char:"n",size:"8",num:16,literal:"00:00:00.00",null:"0Nn",name:"timespan",editor:{type:"TimePicker",options:{isDuration:!0,hasNano:!0,isTimespan:!0,timeFormat:"HH:mm:ss.SSSSSSSSS",width:142,bindButton:!1},validators:[function(t){return!1}]},toKDBInput:function(t){return o.toTimespanMomentInput("n",t)},toSQLInput:function(t){return o.toTimespanMomentInput("",t)}},minute:{char:"u",size:"4",num:17,literal:"00:00:00",null:"0Nu",name:"minute",editor:{type:"TimePicker",options:{isDuration:!0,timeFormat:"HH:mm",width:61,bindButton:!1},validators:[function(t){return!1}]},toKDBInput:function(t){return o.toMinuteMomentInput("u",t)},toSQLInput:function(t){return o.toMinuteMomentInput("",t)}},second:{char:"v",size:"4",num:18,literal:"00:00:00",null:"0Nv",name:"second",editor:{type:"TimePicker",options:{isDuration:!0,timeFormat:"HH:mm:ss",width:79,bindButton:!1},validators:[function(t){return!1}]},toKDBInput:function(t){return o.toSecondMomentInput("v",t)},toSQLInput:function(t){return o.toSecondMomentInput("",t)}},time:{char:"t",size:"4",num:19,literal:"00:00:00.000",null:"0Nt",name:"time",editor:{type:"TimePicker",options:{isDuration:!0,timeFormat:"HH:mm:ss.SSS",width:102,bindButton:!1},validators:[function(t){return!o.REGEX_TIMEPICKER.test(t.toString())}]},toKDBInput:function(t){return o.toTimeMomentInput("t",t)},toSQLInput:function(t){return o.toTimeMomentInput("",t)}},string:{char:"",size:".",num:20,literal:"",null:"",name:"string",editor:{type:"TextArea"},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?'""':'"'+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+'"'},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)?"''":"'"+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+"'"}},list:{char:"Q",size:"",num:21,literal:[],null:"",name:"list",editor:{type:"CustomList",options:{itemType:"Text"}},toKDBInput:function(t){t=_.values(t);return null!=t&&0<t.length?"("+(1<t.length?"":"enlist ")+_.map(t,function(t){return t&&t.toKDBInput?t.toKDBInput():'`$"'+(_.isString(t)?t.replace(/\"/g,'\\"'):t)+'"'}).join(";")+")":"()"},toSQLInput:function(t){t=_.values(t);return void 0!==t&&0<t.length?"("+_.map(t,function(t){return t&&t.toKDBInput?t.toKDBInput():_.isString(t)?"'"+t+"'":t}).join(",")+")":"()"}},dateRolling:{char:"d",size:"4",num:22,literal:"2000.01.01",null:"0Nd",name:"dateRolling",editor:{type:"DatePickerRolling",options:{dateFormat:"yy-mm-dd"},validators:[function(t){return!(o.REGEX_ROLLING.test(t.toString())||t&&t.toISOString&&o.REGEX_DATEPICKER.test(t.toISOString())||o.REGEX_DATEPICKER.test(t.substr(0,10)))&&{type:"rolling",message:"Valid rolling syntax includes NOW, T+x or T+x@HH:mm"}}]},toKDBInput:function(t){return $.datepicker.formatDate("yy.mm.dd",o.castDate(t))},toSQLInput:function(t){return"'"+$.datepicker.formatDate("yyyy-mm-dd",o.castDate(t))+"'"}},datetimeRolling:{char:"z",size:"8",num:23,literal:"dateTtime",null:"0Nz",name:"datetimeRolling",editor:{type:"DateTimePickerRolling",options:{dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSS"},validators:[function(t){return!(o.REGEX_ROLLING.test(t.toString())||t&&t.toISOString&&o.REGEX_TIMEPICKER.test(t.toISOString())||o.REGEX_TIMEPICKER.test(t))&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T+x@HH:mm"}}]}},timestampRolling:{char:"p",size:"8",num:24,literal:"dateDtimespan",null:"0Np",name:"timestampRolling",editor:{type:"DateTimePickerRolling",options:{hasNano:!0,isTimestamp:!0,dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSSSSSSSS"},validators:[function(t){return!(o.REGEX_ROLLING.test(t.toString())||t&&t.toISOString&&o.REGEX_TIMEPICKER.test(t.toISOString())||o.REGEX_TIMEPICKER.test(t))&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T+x@HH:mm"}}]}},timeRolling:{char:"t",size:"4",num:25,literal:"00:00:00.000",null:"0Nt",name:"timeRolling",editor:{type:"TimePickerRolling",options:{isDuration:!0,timeFormat:"HH:mm:ss.SSS"},validators:[function(t){return!o.REGEX_ROLLING.test(t.toString())&&!o.REGEX_TIMEPICKER.test(t.toString())&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T-x"}}]}},minuteRolling:{char:"u",size:"4",num:26,literal:"00:00:00",null:"0Nu",name:"minuteRolling",editor:{type:"TimePickerRolling",options:{isDuration:!0,timeFormat:"HH:mm"},validators:[function(t){return!o.REGEX_ROLLING.test(t.toString())&&!o.REGEX_TIMEPICKER.test(t.toString())&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T-x"}}]}},secondRolling:{char:"v",size:"4",num:27,literal:"00:00:00",null:"0Nv",name:"secondRolling",editor:{type:"TimePickerRolling",options:{isDuration:!0,timeFormat:"HH:mm:ss"},validators:[function(t){return!o.REGEX_ROLLING.test(t.toString())&&!o.REGEX_TIMEPICKER.test(t.toString())&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T-x"}}]}},dict:{char:"Q",size:"",num:98,literal:[],null:"",name:"dict",editor:{type:"Dict",options:{itemType:"Text"}},toKDBInput:function(t){var e,n;return _.isEmpty(t)?"()!()":(e=_.keys(t),t=_.values(t),"("+(n=1===e.length?"enlist ":"")+_.map(e,function(t){return'`$"'+t+'"'}).join(";")+")!("+n+_.map(t,function(t){return t.type?o.getByName(t.type).toKDBInput(t.value):'`$"'+t.replace(/\"/g,'\\"')+'"'}).join(";")+")")},toSQLInput:function(t){return t}},email:{char:"",size:"",num:29,literal:"",null:"",name:"email",editor:{type:"Text",options:{itemType:"Text"},validators:["email"]},toKDBInput:function(t){return o.infos.symbol.toKDBInput(t)},toSQLInput:function(t){return"'"+o.infos.symbol.toKDBInput(t)+"'"}}},o.simple=["list","boolean","guid","byte","byte","short","int","long","real","float","char","symbol","timestamp","month","date","datetime","timespan","minute","second","time","dict"],o.infosByNum=null,i.RTTI=o,Y=A=A||{},it.constructPivotWhereString=function(t){var e=[];return t.forEach(function(t){switch(t.columnType){case 1:case 2:case 4:case 5:case 6:case 7:case 8:case 9:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:e.push("("+t.columnOperator+';`$"'+t.columnName+'"; '+Y.RTTI.getByQTypeNum(t.columnType).toKDBInput(t.columnValue)+")");break;case 10:1==t.columnValue.length?e.push("("+t.columnOperator+';`$"'+t.columnName+'"; "'+t.columnValue.toString()+'")'):e.push('(~\\:;`$"'+t.columnName+'"; "'+t.columnValue.toString()+'")');break;case 11:e.push("("+t.columnOperator+';`$"'+t.columnName+'"; enlist `$"'+t.columnValue.toString()+'")');break;default:_.isString(t.columnValue)?e.push('(~\\:;`$"'+t.columnName+'"; "'+t.columnValue.toString()+'")'):e.push("("+t.columnOperator+';`$"'+t.columnName+'"; enlist `$"'+t.columnValue.toString()+'")')}}),1==e.length?"enlist "+e[0]:"("+e.join(";")+")"},it._generateOrderingKdbSyntax=function(t){var e,n="";return n=2===(t=(t=t||"").split(",")).length&&"null"!=(e=t[1])?"`"+t[0]+";"+("asc"===e?1:-1):n},it.strip=function(t){return t&&0<t.length?t.replace(/((^|\s+)\/.*$)|^\s+|\s*\n/gm," "):t},it.constructPivotQuery=function(n){var t,e,i,o,s,a,r="",l="0j",u=n.pivotSource,c=n.table,p=this.strip(n.queryString),d=n.queryParams,h=n.aggFn,g=n.aggregateFns,f=n._generateOrderingKdbSyntax,m=/^[A-Za-z0-9]+\w*$/;function y(t){return 1<t.length?_.reduce(t,function(t,e,n,i){t+=";"!==t.substr(-1)&&0<n?";":"";return e.match(m)?t+="`"+e:t+='`$"'+e+'"'+(n<i.length-1?";":""),t},"(")+")":1===t.length?t[0].match(m)?"enlist `"+t[0]:'enlist `$"'+t[0]+'"':void 0}return f=this._generateOrderingKdbSyntax(f),a=y(n.dimensions),t=y(_.isArray(n.aggregateLabels)&&!_.isEmpty(n.aggregateLabels)?_.map(n.aggregateLabels,function(t,e){return t||n.aggregateCols[e]}):n.aggregateCols),e=this.constructPivotWhereString(n.wheres),1===n.aggregateCols.length&&(r="enlist "),r+="(",_.each(n.aggregateCols,function(t,e){0<t.length&&(o=g&&g[e]||h,r+="("+o+";"+(t.match(m)?"`"+t:'`$"'+t+'"')+");")}),r=r.substr(0,r.length-1)+")",n.topX&&"null"!==n.topX&&"all"!==n.topX&&(l=n.topX+"j"),a="`d`g!("+a+";"+(n.columnLabel&&0<n.columnLabel.length?"enlist `"+n.columnLabel:"()")+")","query"===u?(p=$.trim(p),u=/^{\[([a-z0-9A-Z\;\w\/ ]+?)\]/.exec(p),s="",$.isArray(u)?s=u[0]:"{[]"!==p.substring(0,3)?p="{[] "+p+"}[]":p+="[]",0<s.length&&(1===d.length?p=p+"["+d[0].name+"]":(p+="[",_.each(d,function(t,e){0<e&&(p+=";"),p+=t.name}),p+="]")),i=s+" "+this.PIVOT_FUNCTION+"["+p+";"+e+";"+a+";"+t+";"+r+";"+l+";("+f+")]",0<s.length&&(i+="}")):i=this.PIVOT_FUNCTION+"[`"+c+";"+e+";"+a+";"+t+";"+r+";"+l+";("+f+")]",i},it.PIVOT_FUNCTION="$[{x~key x}`.pivot.pivotV3;.pivot.pivotV3;{[t;w;d;a;f;n;o] g:(); if [(type d)=99h; [g:d[`g]; d:d[`d],g;]];piv: 0!?[t;w;d!d;a!f]; if [(count g)>0; [d: (-1 _ d); a2:d,a; piv2: 0!?[piv;();g!g;a2!a2]; grpData:{[x;d;grpCol;f] labels: $[(count f)>1;(`$((string x[grpCol]) ,/: string f[;0]));x[grpCol]]; d xkey (d,labels) xcol flip x _ grpCol}; piv: 0! () uj/ each[grpData[;d;g[0];f]] piv2; ]]; if [(count o)>0;[field: o[0]; order: o[1]; piv:$[order>0;field xasc piv;field xdesc piv];]]; $[n<=0;piv;n sublist piv]}]",Y.Pivot=it,l=A=A||{},ot.applyAnalytic=function(){function t(t,e,n){i.setLastRunInfo(n||{}),i.onExecuteSubscriptionSuccess(t,i.get("_forceReset"),e)}function e(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];i.onError(i,i.attributes,t,"Error",e)}var i=this,n=i.get("_subscriptionKey")||l.DataSet.DEFAULT_ROW_INDEX;i.dataSet=new l.DataSet({idAttribute:n,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:n})}),agent:i.agent,maxRows:i.get("_maxRows"),primaryKey:n}),i.dataSet2=new l.DataSet2({idAttribute:n,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:n})}),agent:i.agent,maxRows:i.get("_maxRows"),primaryKey:n}),i.unset("error"),i.unset("queryStatus"),i.updateParameters(!0),"streaming"===i.get("_subscriptionType")?i.execute=i.wrapWithErrorHandler(function(){i.onExecuteBegin(),i.runWithConnectionCheck(e,function(){i.updateBuilder(function(){i.subscriptionId=l.DashClient.client.subscribe(i.get("_maxRows"),i.get("_selectedAnalytic"),i.get("_connection"),t,e,i.bindViewStateToKdbParams(i.get("_analyticParams"))),l.Log.Log("Subbd: "+i.subscriptionId)},e)})},i,i.attributes):i.execute=i.wrapWithErrorHandler(function(){i.onExecuteBegin(),i.runWithConnectionCheck(e,function(){i.updateBuilder(function(){l.DashClient.runAnalytic2(i.get("_selectedAnalytic"),i.get("_connection"),i.bindViewStateToKdbParams(i.get("_analyticParams")),t,e,i.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,null,i.performance)},e)})},i,i.attributes)},ot.applyQuery=function(){function n(t,e,n){o.setLastRunInfo(n||{}),o.onExecuteSuccess(t,o.get("_forceReset"),e)}function i(t){o.onError(o,o.attributes,t,"Error",arguments)}var o=this,t=o.get("_subscriptionKey")||l.DataSet.DEFAULT_ROW_INDEX;o.applyViewStateAttributes();o.dataSet=new l.DataSet({idAttribute:t,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:t})}),agent:o.agent,maxRows:o.get("_maxRows"),primaryKey:t}),o.dataSet2=new l.DataSet2({idAttribute:t,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:t})}),agent:o.agent,maxRows:o.get("_maxRows"),primaryKey:t}),o.unset("error"),o.unset("queryStatus"),o.updateParameters(),"streaming"===o.get("_subscriptionType")?o.execute=o.wrapWithErrorHandler(function(){o.onExecuteBegin();var t=o.get("_queryString"),e=o.bindViewStateToKdbParams(o.get("_queryParams")),t=ot.replaceParameters(t,e);o.subscriptionId=l.DashClient.client.subscribe(o.get("_maxRows"),t,o.get("_connection"),n,i),l.Log.Log("Subbd: "+o.subscriptionId)},o,o.attributes):o.execute=o.wrapWithErrorHandler(function(){o.onExecuteBegin();var t=o.get("_queryString"),e=o.bindViewStateToKdbParams(o.get("_queryParams"));""!==t.trim()&&("sql"===o.get("_dataType")?l.DashClient.runAnalytic2(l.KdbQuery.executeSql,o.get("_connection"),[{type:"string",value:o.toSQLString(t,e)}],n,i,o.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,void 0,o.performance):l.DashClient.getQueryData2("q",o.get("_connection"),t,e,n,i,o.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,void 0,o.performance))},o,o.attributes)},ot.bindViewStateToKdbParams=function(t){var o,s,a=this,e=[];return $.extend(!0,e,t),0<e.length&&_.each(e,function(i){var t,e,n;"string"==typeof i.value&&(s=i.value.match(l.DocumentDataModel.PARAMETER_RX))&&(e=a.getViewState().getByPath($.trim(s[0].substring(2,s[0].length-2))))&&((t=void 0)===(t=_.isFunction(e.get)?e.get("_rolling")&&a.isUsingApi()?l.Helpers.convertRollingToDate(e.get("_default"),e.get("_type")):e.get("value"):e.value)&&(i.value=null),i.value=_.isObject(t)&&!_.isArray(t)?$.extend(!0,{},t):t),"dict"===i.type&&_.isObject(i.value)?_.each(_.keys(i.value),function(t){var e,n;i.value[t]instanceof m.Model?i.value[t]={type:i.value[t].get("_type"),IsKdbParam:!0,isViewState:!0,name:i.value[t].path,value:i.value[t].get("value")}:"object"==typeof i.value[t]?_.has(i.value[t],"_isKdbReady")||((n=a.getViewState().getByPath(i.value[t].name))?(i.value[t].type=n.get("_type"),i.value[t].value=n.get("value")):"string"==typeof i.value[t].value&&0===i.value[t].value.indexOf("<%")&&(e=$.trim(i.value[t].value.substring(2,i.value[t].value.length-2)),n=a.getViewState().getByPath(e))&&(i.value[t].value=n.get("value"))):"string"==typeof i.value[t]&&0===i.value[t].indexOf("<%")&&(e=$.trim(i.value[t].substring(2,i.value[t].length-2)),n=a.getViewState().getByPath(e))&&(i.value[t]={type:n.get("_type"),IsKdbParam:!0,isViewState:!0,name:i.value[t],value:n.get("value")})}):(s=i.type,(o=l.RTTI.getByName(s))&&"dict"===o.name&&(e=i.value.split(""),n={},_.each(e,function(t){t=t.split("");6===t.length&&(n[t[0]]={type:t[1],IsKdbParam:!0,isViewState:!0,name:t[0],value:t[2]})}),i.value=n))}),e},ot.generatePivotModel=function(t,e,n,s){var a,r=this;return s.breakdownCols instanceof m.Model&&(s.breakdownCols=s.breakdownCols.get("value")),r.meta={},a=m.Model.extend({defaults:{_dataType:r.get("_dataType"),_pivotType:r.get("_pivotType"),_subscriptionType:r.get("_subscriptionType"),_subscriptionInterval:r.get("_subscriptionInterval")},idAttribute:t,childId:e,childModelType:n,initialize:function(){this.isDirty=!0,this.isPending=!1,this.legacyUpdates=[],this.agent=new l.Agent},apply:function(){this.dataSet=new l.DataSet({idAttribute:e,collectionFunc:m.Collection.extend({model:n}),agent:this.agent,maxRows:s.maxRows,primaryKey:e})},getRoot:function(){return r},getViewState:function(){return r.getViewState()},execute:function(t){function e(t,e){i.onExecuteSuccess(r.executeClientPivotQuery(r.clientPivotData,{wheres:s.wheres}),r.get("_forceReset"),void 0)}var n,i=this,o=!r.clientPivotData||r.isDirty||t&&t.intervalQuery;this.wheres||(this.wheres=s.wheres),i.onExecuteBegin();try{s.topX=null,s.ordering=null,s.queryParams=r.bindViewStateToKdbParams(r.get("_queryParams")),s.maxRows=r.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,s.queryString=s.queryString,_.each(s.wheres,function(t,e){var t="string"==typeof t?t:t.columnName,n=r.meta[t];s.wheres[e]={columnName:t,columnType:n,columnOperator:"=",columnValue:i.get(t)}}),n=function(t){r.onError(a,s,t,"Error",arguments)},"client"===i.get("_pivotType")?o?r.runWithConnectionCheck(n,function(){switch(r.get("_dataType")){case"query":l.DashClient.getQueryData("kdb",r.get("_connection"),s.queryString,s.queryParams,function(t){t&&(r.clientPivotData=t),e()},n,null,null,r.performance);break;case"virtual":r.executeVirtualQuery(r.get("_virtualQueryString"),r.get("_virtualParams"),function(t){r.clientPivotData=t,e()})}}):e():r.runWithConnectionCheck(n,function(){ot.getPivotData(s,function(t,e){_.extend(r.meta,t.meta),i.onExecuteSuccess(t,r.get("_forceReset"),e,r.meta)},n,r.performance)})}catch(t){r.onError(a,s,t,"Error",arguments)}},exportPivotData:function(t,e){e("Pivot export not supported")},clearVirtualSubscriptions:_.noop,clearVirtualSubscriptionsAll:_.noop,executeClientPivotQuery:r.executeClientPivotQuery,formatValue:r.formatValue,getViewStateAttribute:r.getViewStateAttribute,isPagingData:r.isPagingData,legacyFlush:r.legacyFlush,legacyUpdate:r.legacyUpdate,logPrefix:r.logPrefix,onComplete:r.onComplete,onExecuteBegin:r.onExecuteBegin,onExecuteSuccess:r.onExecuteSuccess,reset:r.reset,start:r.start,stop:r.stop,subscribe:r.subscribe,triggerCallbacks:_.noop,updateVirtualSubscriptions:_.noop,unsubscribe:r.unsubscribe},{staticIdAttribute:t})},ot.connectionCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for DocumentCollection";l.DashClient.runAPI(".api.conList","gw",[],function(t){return n.success(_.map(t.rows,function(t){return t.type=t.dbtype,delete t.dbtype,t.password=t.pass,delete t.pass,t}))},function(t){return n.error(t)})},ot.connectionSync=function(t,e,n){var i,o=this;switch(t){case"update":(i={}).originalName=o.get("originalName");case"create":i=_.extend(i||{},{name:o.id,dbtype:o.get("type"),tls:o.get("tls"),host:o.get("host"),port:o.get("port"),user:o.get("user"),pass:o.get("password"),database:""}),l.DashClient.runAPI(".api.conUpsert","gw",[{type:"symbol",value:o.id},{type:"string",value:JSON.stringify(i)}],function(t){return n.success(t)},function(t){return n.error(t)});break;case"delete":l.DashClient.runAPI(".api.conDelete","gw",[{type:"symbol",value:o.id}],function(){return n.success()},function(t){return n.error(t)});break;default:throw"data operation not supported for Document"}},ot.documentCollectionSync=function(t,e,i){if("read"!==t)throw"data operation not supported for DashCollection";l.DashClient.runAPI(".api.dashList","gw",[],function(t){var e,n=[];t.rows.forEach(function(e){try{n.push(new l.Document(JSON.parse(e.description)))}catch(t){l.Log.Error("Error parsing dashboard description",e)}}),i.success&&((e=this.location.hostname)&&(n=_.filter(n,function(t){t=t.get("hostnameAccess");return!t||0<=t.indexOf(e)})),i.success(n))},function(t){alert("Retrieve Dashboards FAILED"),i.error&&i.error(t)})},ot.documentSync=function(t,e,n){var i,o=this;switch(t){case"read":l.DashClient.runAPI(".api.dashRead","gw",[{type:"symbol",value:o.id}],function(t){try{i=JSON.parse(t.rows[0].string)}catch(t){n.error&&n.error(t)}n.success&&n.success(i)},function(t){n.error&&n.error(t)});break;case"update":l.DashClient.runAPI(".api.dashUpsert","gw",[{type:"symbol",value:o.id},{type:"string",value:JSON.stringify(_.omit(o.attributes,["permissionEntity"]),null,2)}],function(){n.success&&n.success(o.attributes)},function(t){n.error&&n.error(t)});break;case"delete":l.DashClient.runAPI(".api.dashDelete","gw",[{type:"symbol",value:o.id}],function(){n.success&&n.success()},function(t){n.error&&n.error(t)});break;default:throw"data operation not supported for Document"}},ot.replaceParameters=function(t,n){var e,i=0;if("string"==typeof t){if(t=this.strip(t),(e=/^\{(\[([^\]]+)\])?(.*)\}$/.exec(t))&&4===e.length)return e[2]?(e=e[2].split(";"),i+=e.length,t+"["+_.map(e,function(t,e){return l.RTTI.getByName(n[e].type).toKDBInput(n[e].value)}).join(";")+"]"):t+"[]";t=t.replace(/<%[^<>%]+%>/g,function(t){var e=i++;return l.RTTI.getByName(n[e].type).toKDBInput(n[e].value)})}return t},ot.stop=function(){var t=this;t.pollingEvent&&(clearInterval(t.pollingEvent),t.pollingEvent=null),t.subscriptionId&&(l.DashClient.client.unsubscribe(t.subscriptionId),t.subscriptionId=null,t.isPending=!1)},ot.getPivotData=function(t,n,e,i){l.DashClient.getQueryData("q",t.connection,l.Pivot.constructPivotQuery(t),t.queryParams,function(t,e){n(t,e)},e,t.maxRows,void 0,i)},ot.strip=function(t){return t&&0<t.length?t.replace(/((^|\s+)\/.*$)|^\s+|\s*\n/gm," ").trim():t},ot.parameterRx=new RegExp("<%([^<>%]+?)%>","g"),ot.DEFAULT_NULL_VALL=-0x8000000000000000,l.DashClientLib=ot,H=$,K=/\+/g,H.cookie=function(t,e,n){var i,o;if(void 0!==e&&!H.isFunction(e))return"number"==typeof(n=H.extend({},n)).expires&&(i=n.expires,(o=n.expires=new Date).setTime(+o+864e5*i)),document.cookie=[st(t),"=",st(String(e)),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("");for(var s=t?void 0:{},a=document.cookie?document.cookie.split("; "):[],r=0,l=a.length;r<l;r++){var u=a[r].split("="),c=(c=u.shift(),decodeURIComponent(c)),u=u.join("=");if(t&&t===c){s=at(u,e);break}t||void 0===(u=at(u))||(s[c]=u)}return s},H.removeCookie=function(t,e){return void 0!==H.cookie(t)&&(H.cookie(t,"",H.extend({},e,{expires:-1})),!H.cookie(t))},n=A=A||{},rt.prototype.trigger=function(t){this.perf[t]=Date.now()},rt.prototype.set=function(t,e){this.perf[t]=e},Object.defineProperty(rt.prototype,"performance",{get:function(){return this.perf},enumerable:!1,configurable:!0}),n.PerformanceMetrics=rt,z=A=A||{},r.attemptUpload=function(t){r.logUploadConnected?z.DeltaClientLib.createLog(t,function(){},function(){r.logUploadConnected=!1,r.storeLocal(t),r.debounceRetryConnection()}):r.storeLocal(t)},r.logPerformanceMetrics=function(t,e){var n,i,o;r.clientLoggingEnabled&&(e=e.performance,n=e.onAgentNotify-e.apply,t="Performance Metrics<--\x3e"+p().format("H:mm:ss.SSS")+"<--\x3e"+t+" (Roundtrip: "+n.toFixed(0)+"ms)<--\x3e",o=function(t){var e=t/n*100;return t.toFixed(0)+" ms  "+e.toFixed(2)+"%"},(i=[])[0]=e.serverStart?e.serverStart-e.apply:0,i[1]=e.serverStart&&e.serverEnd?e.serverEnd-e.serverStart:n,i[2]=e.serverEnd?e.onAgentNotify-e.serverEnd:0,t=(t=(t+="Dispatch: "+o(i[0]))+", Server Duration: "+o(i[1]))+", IPC & Deserialize: "+o(i[2]),r.attemptUpload(t))},r.setClientLogging=function(){r.logUploadConnected=!0,r.clientLoggingEnabled=!0,r.traceConsoleError(),r.trace(z.Tools.getCookie("dashboard-log-level"))},r.trace=function(t){t=Number(t);r.clientLoggingEnabled?r.turnOnUploads(t):(r.Error=0<t?console.error.bind(console,"%s",r.logPrefix(r.Level.Error)):_.noop,r.Handled=1<t?console.error.bind(console,"%s",r.logPrefix(r.Level.Handled)):_.noop,r.Warn=1<t?console.warn.bind(console,"%s",r.logPrefix(r.Level.Warn)):_.noop,r.Debug=2<t?console.debug.bind(console,"%s",r.logPrefix(r.Level.Debug)):_.noop,r.Log=2<t?console.log.bind(console,"%s",r.logPrefix(r.Level.Info)):_.noop,r.Info=3<t?console.info.bind(console,"%s",r.logPrefix(r.Level.Info)):_.noop)},r.turnOnUploads=function(n){r.Error=function(t,e){0<n&&console.error(t,e||""),0<r.ServerLogLevel&&r.attemptUpload(r.logUploadString(this.Level.Error,t,e))},r.Handled=function(t,e){1<n&&console.error(t,e||""),1<r.ServerLogLevel&&r.attemptUpload(r.logUploadString(this.Level.Handled,t,e))},r.Warn=function(t,e){1<n&&console.warn(r.logPrefix(this.Level.Warn)+t,e||""),2<r.ServerLogLevel&&r.attemptUpload(r.logUploadString(this.Level.Warn,t,e))},r.Debug=function(t,e){2<n&&console.debug(r.logPrefix(this.Level.Debug)+t,e||""),2<r.ServerLogLevel&&r.attemptUpload(r.logUploadString(this.Level.Debug,t,e))},r.Log=function(t,e){2<n&&console.log(r.logPrefix(this.Level.Log)+t,e||""),2<r.ServerLogLevel&&r.attemptUpload(r.logUploadString(this.Level.Log,t,e))},r.Info=function(t,e){3<n&&console.info(r.logPrefix(this.Level.Info)+t,e||""),3<r.ServerLogLevel&&r.attemptUpload(r.logUploadString(this.Level.Info,t,e))}},r.getStackTrace=function(){return"\nStack Trace: "+(new Error("").stack||"").split("\n").slice(3,9).join("\n")},r.logPrefix=function(t){function e(){}return e.toString=function(){return t+"\t"+p().format("H:mm:ss.SSS")+"\t"},e},r.logUploadString=function(t,e,n){e=t+"<--\x3e"+p().format("H:mm:ss.SSS")+"<--\x3e"+e+"<--\x3e";return n&&(e+=JSON.stringify(n)),t!==this.Level.Info&&(e+=r.getStackTrace()),e},r.retryConnection=function(t){var e=[1,3,15,60,180,900];t===e.length&&--t,setTimeout(function(){r.uploadStoredLogs(t)},1e3*e[t])},r.storeLocal=function(t){var e,n,i=localStorage.length-1;if(localStorage.getItem("0000"))for(;!n;)(e=localStorage.key(i)).match(/\d\d\d\d/)&&(n=("000"+(parseInt(e)+1)).slice(-4)),--i;else n="0000";localStorage.setItem(n,t)},r.traceConsoleError=function(){var i=console.error;console.error=function(t,e){var n=r.logPrefix(r.Level.Error)+t;i.apply(console,[n,e||""]),r.attemptUpload(r.logUploadString(r.Level.Error,t,e))}},r.uploadStoredLogs=function(e){function n(t){t<localStorage.length?(i=localStorage.key(t)).match(/\d\d\d\d/)?(o=localStorage.getItem(i),z.DeltaClientLib.createLog(o,function(){s=!0,localStorage.removeItem(i),n(t)},function(){r.retryConnection(s?0:e+1)})):n(t+1):r.logUploadConnected=!0}var i,o,s=!1;n(0)},r.ServerLogLevel=4,r.debounceRetryConnection=_.debounce(function(){r.retryConnection(0)},300,{maxWait:1e3}),n=r,z.Log=n,(s=(s=n=z.Log||(z.Log={})).Level||(s.Level={})).Info="INFO",s.Warn="WARN",s.Error="ERROR",s.Fatal="FATAL",s.Critical="CRITICAL",s.Off="OFF",s.Handled="HANDLED",s.Debug="DEBUG",n.trace($.cookie("dashboard-log-level")),window.onerror=function(t,e,n,i,o){t&&t.toString&&t.toString(),o&&o.toString&&o.toString(),z.DeltaClientLib.createLog(t+"<--\x3e"+p().format("H:mm:ss.SSS")+"<--\x3e"+o,_.noop,_.noop)},Q=A=A||{},lt.initializeDeltaClient=function(t,e,n,i,o,s,a,r,l,u,c,p,d){this.host=t,this.port=e,this.secure=n,this.fromUrl=i,this.username=o,this.successCallback=a,this.errorCallback=r,this.token=l,this.appid=u,this.saml=p,this.forceLogin=d,this.properties={},this.clientLoggedIn=!1,this.errorCallback=r,this.deltaClient?this.saml?this.deltaClient.register("dashboards"):this.deltaClient.login(this.username,s,this.appid,[],this.forceLogin):(this.deltaClient=new win.Client({host:this.host,port:this.port,secure:this.secure,fromURL:this.fromUrl},c,c),this.initDeltaClient(s))},lt.initializeDeltaClientCopy=function(t,e,n,i,o,s,a,r,l,u,c){this.host=e,this.port=n,this.secure=i,this.fromUrl=o,this.username=s,this.successCallback=r,this.errorCallback=l,this.appid=u,this.saml=c,this.properties={},this.clientLoggedIn=!0,this.deltaClient=t,this.deltaClient.DeltaClientLogin=!0,this.initDeltaClient(a)},lt.initDeltaClient=function(t){var n=this,i=!1,o=null;this.deltaClient.status._subscribe({next:function(t){switch(t.type){case win.Client.status.CONNECTING:i&&($(n).trigger("DeltaClientDisconnect"),n.disconnected=!0),n.eCode=t.eCode,o=o||_.delay(function(){n.sendError(1006===n.eCode?"WebSocket connection error, please check proxy settings":"Server connectivity issues, please try again.")},n.DEFAULT_TIMEOUT);break;case win.Client.status.CONNECTED:try{i=!0;var e=n.deltaClient.systemConfig();e&&(n.showLastLoginAttempts=e.showLastLoginAttempts),n.clientLoggedIn?$(n).trigger("DeltaClientConnect"):n.onFirstLogin(),clearTimeout(o),$.cookie("deltaToken",n.deltaClient.tokenKey(),{expires:30,path:"/",secure:"https:"===_.get(window,"location.protocol")}),o=null}catch(t){n.sendError("There was a problem connecting to the server: "+t)}break;case win.Client.status.LOGGED_IN:clearTimeout(o),o=null,n.username=n.deltaClient.user();break;case win.Client.status.LOGGED_OUT:n.changingPassword&&_.isString(t.data)&&-1!==t.data.indexOf("Client action")?setTimeout(function(){this.changingPasswordFailed=!1,this.deltaClient.resetPassword(this.username,this.changingPasswordOld,this.changingPasswordNew)},500):_.isString(t.data)&&-1===t.data.indexOf("no connection available")?($.removeCookie("deltaToken",{path:"/"}),n.saml?n.ssoLogout("local"):(-1!==t.data.indexOf("timeout")?$.cookie("deltaLoginError","Your session timed out",{expires:30,path:"/",secure:"https:"===_.get(window,"location.protocol")}):-1!==t.data.indexOf("force logout")?$.cookie("deltaLoginError","Forced logout",{expires:30,path:"/",secure:"https:"===_.get(window,"location.protocol")}):-1!==t.data.indexOf("session limit")?$.cookie("deltaLoginError",t.data.split("|")[2],{expires:30,path:"/",secure:"https:"===_.get(window,"location.protocol")}):$.removeCookie("deltaLoginError",{path:"/"}),window.onbeforeunload=function(t){},location.reload())):!t.data&&n.disconnected?n.errorCallback("loginRequired"):i&&($.removeCookie("deltaToken",{path:"/"}),location.reload());break;case win.Client.status.EXPIRED:clearTimeout(o),o=null,Q.Log.Log("Expired",t),n.sendError("Your password has expired");break;case win.Client.status.RESET:clearTimeout(o),o=null,$(n).trigger("Reset"),n.sendError("Please reset password"),Q.Log.Log("Reset",t);break;case win.Client.status.RESET_FAIL:clearTimeout(o),o=null,n.changingPasswordFail&&n.changingPasswordFail(t.data),n.changingPasswordFailed=!0,Q.Log.Log("Reset Fail",t);break;case win.Client.status.RESET_SUCCESS:n.changingPassword&&(n.changingPasswordFailed?n.changingPassword=!1:(n.changingPasswordSuccess&&n.changingPasswordSuccess(),n.changingPassword=!1,n.changingPasswordFail=null,n.changingPasswordSuccess=null,n.changingPasswordOld=null,n.changingPasswordNew=null,n.successCallback&&n.successCallback(),$.cookie("deltaLoginError","Password changed. Please login again.",{expires:30,secure:"https:"===_.get(window,"location.protocol"),path:"/"}),$.removeCookie("deltaToken",{path:"/"})));break;case win.Client.status.FAULT:Q.Log.Log("Fault",t),clearTimeout(o),o=null,"userSessionLimit"!==t.data&&$.removeCookie("deltaToken",{path:"/"}),n.sendError(t.data)}},error:function(){Q.Log.Error("onError",arguments)},complete:function(){Q.Log.Info("onCompleted",arguments)}}),this.token=this.token||this.deltaClient.tokenKey(),this.deltaClient.DeltaClientLogin?this.onFirstLogin():this.saml?this.deltaClient.register("dashboards"):this.token?this.deltaClient.loginWithTokenKey(this.token,this.appid):this.deltaClient.login(this.username,t,this.appid,[],this.forceLogin)},lt.getDashboardProperty=function(t){return this.properties[t]},lt.changeUserPassword=function(t,e,n,i){this.changingPassword||(this.changingPassword=!0,this.changingPasswordOld=t,this.changingPasswordNew=e,this.changingPasswordSuccess=n,this.changingPasswordFail=i,this.changingPasswordFailed=!1,this.deltaClient.resetPassword(this.username,this.changingPasswordOld,this.changingPasswordNew))},lt.onFirstLogin=function(){var e=this;this.deltaClient.request("ConfigAPI.getConfigParameter",function(t){t.rows.forEach(function(t){e.properties[t.Property.elementValue]=t.Value.elementValue}),"true"==e.properties.legacy_managed&&(e.startManagedQuery=e.startLegacyManagedQuery,e.startManagedQuery2=e.startLegacyManagedQuery2),Q.Tools.timezone=$.cookie("dashboard-timezone")||e.properties.timezone||p.tz.guess(),e.clientLoggedIn=!0,e.deltaClient.clientLoggingEnabled()&&(e.properties.hasOwnProperty("log-level")&&(Q.Log.ServerLogLevel=Number(e.properties["log-level"])),Q.Log.setClientLogging()),$(e).trigger("DeltaClientLogin"),e.deltaClient.DeltaClientLogin=!0,e.successCallback&&e.successCallback(),$(e).trigger("DeltaClientConnect")},_.noop,"DASHproperties","DEFAULT","delta_install_default")},lt.sendError=function(t,e){this.errorCallback&&this.errorCallback(t)},lt.ssoLogout=function(t){this.deltaClient&&this.deltaClient.ssoLogout(t),$.removeCookie("deltaToken",{path:"/"}),_.delay(function(){location.reload()},500)},lt.clientLoggedIn=!1,lt.changingPassword=!1,lt.changingPasswordFailed=!1,lt.disconnected=!1,lt.DEFAULT_TIMEOUT=6e4,Q.DCBase=lt,s=A=A||{},j=function(t,e){this.offset=t,this.qtype=e},s.qAtom=j,e(ut,W=j),G=ut,s.qVector=G,X=function(t,e,n){this.qtype=0,this.isSorted=t,this.values=e,this.end=n},s.qGenericList=X,Z=function(t,e){this.qtype=11,this.isSorted=t,this.offsets=e},s.qSymList=Z,J=function(t,e,n,i){this.keys=n,this.values=i,this.qtype=t,this.isSorted=e},s.qDict=J,s.getTypeSize=ct,s.u8u16=function(t){for(var e=[],n=0;n<t.length;n++){var i=t.charCodeAt(n);i<128?e.push(i):i<2048?e.push(192|i>>6,128|63&i):i<55296||57344<=i?e.push(224|i>>12,128|i>>6&63,128|63&i):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++n)),e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return e},s.u16u8=pt,s.deserialize=function(t,e,n){var p=void 0===e?8:e,d=new DataView(t);function h(){return d.getInt8(p++)}function g(){return d.getUint8(p++)}function f(){var t=d.getInt32(p,!0);return p+=4,t}function m(t){var e,n=1===g(),i=f(),o=ct(t);if(o)return e=new G(t,n,i,p),p+=i*o,e;if(11===t){for(var s=new Array(i),a=0;a<i;a++){s[a]=p;for(;0!==g(););}return new Z(n,s)}if(0!==t)throw"Unsupported type";for(var r=new Array(i),a=0;a<i;a++)r[a]=v();return new X(n,r,p)}function y(){var t=1===g();return 99!==h()&&console.error("c.js Assertion type=99 failed."),new J(98,t,m(h()),m(h()))}function v(){var t,e,n,i=h();if(-20<i&&i<0){var o=i,s=new j(p,o),a=ct(-o);if(a)p+=a;else{if(-11!==o)throw"Unsupported type";for(;0!==g(););}return s}if(99<i){a=new j(p,i);if(100===i){for(var r,l=[];0!==(r=d.getUint8(p++));)l.push(r);return pt(l),v()}if(i<104)return 0===h()&&101===i?new j(p-1,i):a;if(105<i)v();else for(var u=0,c=f()||0;u<c;u++)v();return a}return 99===i?98===d.getUint8(p)?(t=1===g(),e=y(),p++,n=y(),new J(99,t,e,n)):(t=m(h()),n=98===(e=g())?y():m(e),new J(99,!1,t,n)):98===i?y():m(i)}if(n){if(0===h()){f();if(0===h()&&-6===h())return e=f(),h(),[e,g(),v()]}return[0,5,"Message parse error"]}return v()};var n=A=A||{};(s=dt=n.CommandOp||(n.CommandOp={}))[s.Add=0]="Add",s[s.Remove=1]="Remove",s[s.Set=2]="Set";var dt,ht=function(t,e,n){this.op=t,this.key=e,this.payload=n},gt=(n.Todo=ht,ft.pathArrayToText=function(t){return t.reverse().join(".")},ft.prototype.pathText=function(){return ft.pathArrayToText(this.path)},ft);function ft(t,e,n,i){this.title=t,this.path=e,this.todo=n,this.undo=i}n.Command=gt,mt=m.Model,e(yt,mt),yt.prototype.setParent=function(t){this.parent=t},yt.prototype.getComponents=function(){return[]};var mt,s=yt;function yt(t,e,n){t=mt.call(this,t,e)||this;return t.parent=n,t}n.CommandoModel=s,vt=m.Collection,e(bt,vt),bt.prototype.commandAdd=function(t,e){var n=_.isArray(t)?t:[t];this.postCommand(this,new gt(this.getCommandDescription(dt.Add,t,e||"Add"),[],n.map(function(t){return new ht(dt.Add,"",{attributes:t.toJSON()})}),n.map(function(t){return new ht(dt.Remove,"",t.id)})))},bt.prototype.commandRemove=function(t){var e=this,n=_.isArray(t)?t:[t];this.postCommand(this,new gt(this.getCommandDescription(dt.Remove,t),[],n.map(function(t){return new ht(dt.Remove,"",t.id)}),n.map(function(t){return new ht(dt.Add,"",{attributes:t.toJSON(),index:e.findIndex(t)})})))},bt.prototype.commandSet=function(t){var i=this,e=t.map(function(t,e){var n=i.get(t.id)||i.at(e);if(n)return e=n.changedAttributes(t),t=_.mapValues(e,function(t,e){return n.previous(e)}),n.id&&(t.id=n.id),t});this.postCommand(this,new gt(this.getCommandDescription(dt.Set,t),[],[new ht(dt.Set,"",t)],[new ht(dt.Set,"",e)]))},bt.prototype.doCommand=function(t,e){var n=this,i=t.pop();i?(i=this.get(i))&&i.doCommand(t,e):e.forEach(function(t){n.doCommandByOp[t.op](t.payload)})},bt.prototype.doCommandAdd=function(t){this.add(t.attributes,{at:t.index})},bt.prototype.doCommandSet=function(t){this.set(t,{remove:!1})},bt.prototype.doCommandRemove=function(t){this.remove(t)},bt.prototype.getCommandDescription=function(t,e,n){var i=this.getCommandDescriptor(e);return(n=n||dt[t])+" "+(i=i&&_.isArray(e)&&1<e.length?this.getPluralDescriptor(i):i)},bt.prototype.getCommandDescriptor=function(t){return this.descriptor},bt.prototype.getComponents=function(){return _.flatMap(this.models,function(t){return t.getComponents()})},bt.prototype.getPluralDescriptor=function(t){return t+"s"},bt.prototype.postCommand=function(t,e){return this.parent.postCommand(this,e)},bt.prototype.preinitialize=function(t,e){this.parent=e.parent},bt.prototype.setParent=function(t){this.parent=t},bt.prototype._prepareModel=function(t,e){return this._isModel(t)?(t.collection||(t.collection=this),t):(t=new((e=e?_.clone(e):{}).collection=this).model(t,e,this)).validationError?(this.trigger("invalid",this,t.validationError,e),!1):t};var vt,s=bt;function bt(t,e,n){t=vt.call(this,t,_.extend(e,{parent:n}))||this;return t.doCommandByOp=((e={})[dt.Add]=t.doCommandAdd.bind(t),e[dt.Remove]=t.doCommandRemove.bind(t),e[dt.Set]=t.doCommandSet.bind(t),e),t}n.ComandoCollection=s;function wt(t,e){if(("Accordion"===t||"Popup"===t)&&e&&e.widgets&&1<e.widgets.length&&!(e.widgets instanceof m.Collection))if("Popup"===t){t=_.findLast(e.widgets,function(t){return t.component});e.widgets.length=0,t&&e.widgets.push(t)}else for(var n,i={},o=e.widgets.length-1;0<=o;o--)i[n=e.widgets[o].sectionId]?e.widgets.splice(o,1):i[n]=!0}St=m.Model,e(b,St),b.objToPaths=function(t,e,n){var i,o,s=!1,a={},r=b.keyPathSeparator;for(o in t){var l=t[o];if(n=n?n+r+o:o,(!0===e||e&&"string"==typeof e&&e!==n&&0===e.indexOf(n))&&(s=!0),l&&l.constructor===Object)if(_.isEmpty(l))a[o]=l;else if(_.has(l,"_dashboardsType"))a[o]=l;else for(var u in i=this.objToPaths(l,e,n)){var c=i[u];a[o+r+u]=c}else if(l&&l.constructor===Array&&s)for(var u in i=this.objToPaths(l,e,n)){c=i[u];a[o+r+u]=c}else a[o]=l}return a},b.getNested=function(t,e,n){for(var i=e?e.split(b.keyPathSeparator):[],o=t,s=0,a=i.length;s<a;s++){if(n&&!_.has(o,i[s]))return!1;if(void 0===(o=null==(o=o[i[s]])&&s<a-1?{}:o))return!!n||o}return!!n||o},b.setNested=function(t,e,n,i){i=i||{};for(var o=e?e.split(b.keyPathSeparator):[],s=t,a=0,r=o.length;a<r&&void 0!==s;a++){var l,u=o[a];a===r-1?i.unset?delete s[u]:s[u]=n:(void 0!==s[u]&&_.isObject(s[u])||(l=o[a+1],s[u]=/^\d+$/.test(l)?[]:{}),s=s[u])}},b.deleteNested=function(t,e){this.setNested(t,e,null,{unset:!0})},b.prototype.toJSON=function(t){return _.merge({},this.attributes)},b.prototype.get=function(t){return b.getNested(this.attributes,t)},b.prototype.set=function(t,e,n){var i,o,s,a,r,l,u,c;if(null!=t){if("object"==typeof t?(o=t,n=e||{}):(o={})[t]=e,!this._validate(o,n=n||{}))return null;for(i in s=n.unset,r=n.silent,a=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=_.merge({},this.attributes),this.changed={}),c=this.attributes,u=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]),o=b.objToPaths(o))e=o[i],_.isEqual(b.getNested(c,i),e)||a.push(i),_.isEqual(b.getNested(u,i),e)?b.deleteNested(this.changed,i):b.setNested(this.changed,i,e),s?b.deleteNested(c,i):b.setNested(c,i,e);if(_.each(this.changed,_.bind(function(t,e){_.isEmpty(t)&&_.isObject(t)&&!_.isArray(t)&&delete this.changed[e]},this)),!r){a.length&&(this._pending=!0);for(var p=b.keyPathSeparator,d={},h=0,g=a.length;h<g;h++)for(var t=a[h],f=(d.hasOwnProperty(t)&&d[t]||(d[t]=!0,this.trigger("change:"+t,this,b.getNested(c,t),n)),t.split(p)),m=f.length-1;0<m;m--){var y=f.slice(0,m).join(p),v=y+p+"*";d.hasOwnProperty(v)&&d[v]||(d[v]=!0,this.trigger("change:"+v,this,b.getNested(c,y),n)),d.hasOwnProperty(y)&&d[y]||(d[y]=!0,this.trigger("change:"+y,this,b.getNested(c,y),n))}}if(!l){if(!r)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);this._pending=!1,this._changing=!1}}return this},b.prototype.clear=function(t){var e,n={};for(e in b.objToPaths(this.attributes))n[e]=void 0;return this.set(n,_.extend({},t,{unset:!0}))},b.prototype.hasChanged=function(t){return null==t?!_.isEmpty(this.changed):void 0!==b.getNested(this.changed,t)},b.prototype.changedAttributes=function(t,e){if(!t)return!!this.hasChanged()&&b.objToPaths(this.changed,e);var n,i=this._changing?this._previousAttributes:this.attributes,o=b.objToPaths(t),s=b.objToPaths(i),a=!1;for(n in o)_.includes(["array","object"],typeof i[n])&&void 0===t[n]?(a=a||{})[n]=void 0:_.isEqual(s[n],o[n])||((a=a||{})[n]=o[n]);return a},b.prototype.previous=function(t){return null!=t&&this._previousAttributes?b.getNested(this._previousAttributes,t):null},b.prototype.previousAttributes=function(){return _.merge({},this._previousAttributes)},b.prototype.toFlat=function(t){return b.objToPaths(this.attributes,t)},b.keyPathSeparator=".";var St,n=b;function b(t,e){var n,i=St.call(this,t,e)||this,o=t||{};return i.cid=_.uniqueId("c"),i.attributes={},e&&e.collection&&(i.collection=e.collection),e&&e.parse&&(o=i.parse(o,e)||{}),(n=_.result(i,"defaults"))&&(o=_.merge(n,o)),i.set(o,e),i.changed={},i.initialize.apply(i,arguments),i}m.DeepModel=n;function _t(){return{appArgs:{json:{Style:{advanced:"",cssClasses:""},Alignment:{paddingLeft:null,paddingRight:null,paddingTop:null,paddingBottom:null,innerPaddingLeft:null,innerPaddingRight:null,innerPaddingTop:null,innerPaddingBottom:null,titlePaddingLeft:null,titlePaddingRight:null,titlePaddingTop:7,titlePaddingBottom:7},format:{widgetTitle:null,titleFontSize:16,titleHorizontal:"Center",titleColor:null,titleBottomBorderWidth:null,titleFontBold:null,titleShadow:!1,titleBackgroundColor:null,titleTransparentBackground:null,tileBorderWidth:null,tileBorderRounding:null,tileBorderColor:null,tileBackgroundColor:null,tileTransparentBackground:null,tileShadow:null}},schema:{properties:{Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""},cssClasses:{type:"string",title:"CSS Classes",default:""}}},Alignment:{type:"object",title:"Margins",options:{collapsed:!0},properties:{paddingLeft:{type:"number",title:"Outer Left",default:null,format:"number",propertyOrder:2001},paddingRight:{type:"number",title:"Outer Right",default:null,format:"number",propertyOrder:2002},paddingTop:{type:"number",title:"Outer Top",default:null,format:"number",propertyOrder:2003},paddingBottom:{type:"number",title:"Outer Bottom",default:null,format:"number",propertyOrder:2004},innerPaddingLeft:{type:"number",title:"Inner Left",default:null,format:"number",propertyOrder:2005},innerPaddingRight:{type:"number",title:"Inner Right",default:null,format:"number",propertyOrder:2006},innerPaddingTop:{type:"number",title:"Inner Top",default:null,format:"number",propertyOrder:2007},innerPaddingBottom:{type:"number",title:"Inner Bottom",default:null,format:"number",propertyOrder:2008},titlePaddingLeft:{type:"number",title:"Title Left",default:null,format:"number",propertyOrder:2009},titlePaddingRight:{type:"number",title:"Title Right",default:null,format:"number",propertyOrder:2010},titlePaddingTop:{type:"number",title:"Title Top",default:null,format:"number",propertyOrder:2011},titlePaddingBottom:{type:"number",title:"Title Bottom",default:null,format:"number",propertyOrder:2012}}},format:{type:"object",title:"Format",options:{collapsed:!0},properties:{widgetTitle:{type:"string",title:"Title",propertyOrder:2001},titleFontSize:{type:"number",title:"Title Font Size",propertyOrder:2002},titleColor:{type:"gradient",title:"Title Font Color",options:{gradient:!1,noColor:!0},default:null,propertyOrder:2003},titleFontBold:{type:"boolean",title:"Title Bold",default:!1,format:"checkbox",propertyOrder:2004},titleShadow:{type:"boolean",title:"Title Shadow",default:!1,format:"checkbox",propertyOrder:2005},titleHorizontal:{type:"string",title:"Title Horizontal Align",enum:["Left","Center","Right"],propertyOrder:2006},titleBottomBorderWidth:{type:"number",title:"Title Bottom Border Size",default:null,format:"number",propertyOrder:2007},titleBackgroundColor:{type:"gradient",title:"Title Background Color",default:null,options:{gradient:!1,noColor:!0},propertyOrder:2008},titleTransparentBackground:{type:"boolean",title:"Title Transparent Background",default:!1,format:"checkbox",propertyOrder:2009},tileBackgroundColor:{type:"gradient",title:"Background Color",default:null,options:{gradient:!1,noColor:!0},propertyOrder:2010},tileTransparentBackground:{type:"boolean",title:"Transparent Background",default:!1,format:"checkbox",propertyOrder:2011},tileBorderWidth:{type:"number",title:"Border Size",default:null,format:"number",propertyOrder:2012},tileBorderRounding:{type:"number",title:"Border Rounding",default:null,format:"number",propertyOrder:2013},tileBorderColor:{type:"gradient",title:"Border Color",default:null,options:{gradient:!1,noColor:!0},propertyOrder:2014},tileShadow:{type:"boolean",title:"Component Shadow",default:!1,format:"checkbox",propertyOrder:2015}}}}}}}}var Tt,Ct,Dt=A=A||{};Mt=m.DeepModel,e(Pt,Mt),Pt.setDataProperties=function(t){if(t){for(var e in t)t[e]&&t[e].path?t[e]instanceof Dt.DocumentDataModel?t[e]={_dashboardsType:"data",value:t[e].path}:t[e]instanceof Dt.DocumentViewModel&&(t[e]={_dashboardsType:"viewstate",value:t[e].path}):"object"==typeof t[e]&&(t[e]=Pt.setDataProperties(t[e]));return t}},Pt.prototype.initialize=function(){this.listenTo(this,"change",this.determineMaterialChange.bind(this))},Pt.prototype.clone=function(t){var o,s,a,e={},r=function(n,i){_.each(_.keys(n),function(t){var e=0;if(n[t]instanceof Dt.DocumentViewModel||n[t]instanceof Dt.DocumentDataModel)i[t]=n[t];else if(n[t]instanceof Array)for(i[t]=new Array(n[t].length),e=0;e<n[t].length;e+=1)_.isObjectLike(n[t][e])?(i[t][e]=n[t][e]instanceof Array?[]:{},r(n[t][e],i[t][e])):i[t][e]=n[t][e];else n[t]instanceof Date?(i[t]=new Date,i[t].setTime(n[t].getTime())):_.isObject(n[t])?(i[t]={},r(n[t],i[t])):"advanced"===t&&-1!==n[t].indexOf(o)&&s?i[t]=n[t].replace(a,s):i[t]=n[t]})};return t&&(o=t.previousWidgetId,s=t.widgetId,a=new RegExp(o,"g")),r(this.attributes,e),new Pt(e,{},this.parent)},Pt.prototype.commandSet=function(t){var n=this,e=_.mapValues(t,function(t,e){return n.get(e)}),i=_.keys(t),o="Set ",i=(i[0]&&(o+=_.last(i[0].split("."))),1<i.length&&(o+=" & "+(i.length-1)+" more"),new Dt.Command(o,[],[new Dt.Todo(Dt.CommandOp.Set,"",t)],[new Dt.Todo(Dt.CommandOp.Set,"",e)]));this.postCommand(this,i)},Pt.prototype.determineMaterialChange=function(t,e){t.changed&&!_.isEmpty(_.omit(t.changed,t.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},Pt.prototype.doCommand=function(t,e){var n=this;e.forEach(function(t){n.set(t.payload)})},Pt.prototype.postCommand=function(t,e){return this.parent&&this.parent.postCommand(this,e)},Pt.prototype.setParent=function(t){this.parent=t},Pt.prototype.toDiff=function(t){var o={},s=this._templates;return s&&s.Defaults&&(_.defaultsDeep(s.Defaults,_t().appArgs.json),_.each(t,_.bind(function(t,i){var e;s.Defaults[i]&&("string"==typeof t?o[i]=t:_.isArray(t)||(e=nt.getDiff(t,s.Defaults[i]),_.isEmpty(e))||(o[i]=e),_.isArray(t))&&_.each(t,_.bind(function(t,e){var n={},n=t&&t._Hidden&&t._Hidden._Type?nt.getDiff(t,s[i][t._Hidden._Type]):void 0!==s[i]&&s[i][i]?nt.getDiff(t,s[i][i]):t;o[i]=void 0===o[i]?[]:o[i],o[i].push(n)},this))},this))),o},Pt.prototype.toJSON=function(){var t=$.extend(!0,{},this.attributes),e=(Pt.setDataProperties(t),this.toDiff(t));return _.isEmpty(e)?t:e};var Mt,Et=Pt;function Pt(t,e,n){t=Mt.call(this,t,e)||this;return t.IMMATERIAL_ATTRIBUTES=["version","poss_sel_cols","possible_axis","possible_colors","possible_columns","possible_dashboards","possible_floats","possible_keys","possible_labels","possible_Period","possible_screens","possible_selected_columns","possible_servers","possible_shapes","possible_strings","possible_track","possible_values","possible_viewstates","possibleColumns","possibleConnections","possibleKeys","possibleLabels","possibleValues","datagridPossibleColumns","datagridPossibleColumnsWithItself","selectedColumnPossibleValues","highlightTargetPossibleValues","sortingPossibleValues","Selection"],t.parent=n,t}Dt.ComponentOptions=Et,It=Dt.CommandoModel,e(At,It),At.convertDashboardTypesToModels=function(i,t,e){var o,s,a,r=m.DeepModel.keyPathSeparator;i&&(o={data:t,viewstate:e},t=i.toFlat(!0),s=_.keys(o),a=function(t,e){var n;_.isObject(t)&&_.includes(s,t._dashboardsType)&&"string"==typeof(n=t.value)&&((t=(t=o[t._dashboardsType](n))||{}).path=n,i.set(e,t,{silent:!0}))},_.each(t,function(t,i){_.isArray(t)?_.each(t,function(t,n){_.each(t,function(t,e){a(t,i+r+n+r+e)})}):a(t,i)}))},At.prototype.initialize=function(){var t=this.get("key");t&&/App$/.test(t)&&this.set("key",t.replace(/App$/,""),{silent:!0}),this.silentCast("options",Et),this.silentCast("components",Nt),this.listenTo(this.get("components"),"materialChange",function(){this.trigger("materialChange")}),wt(this.attributes.key,this.attributes),this.silentCast("widgets",Dt.WidgetCollection),this.listenTo(this.get("widgets"),"materialChange",function(){this.trigger("materialChange")}),this.listenTo(this.get("options"),"materialChange",this.onOptionsMaterialChange)},At.prototype.clone=function(t){var e=new At({definitionId:this.get("definitionId"),key:this.get("key"),containerId:this.get("containerId"),components:this.get("components").clone(),widgets:this.get("widgets").clone()},{},this.parent);return t=t||{previousWidgetId:this.id,widgetId:e.id},e.set("options",this.get("options").clone(t),{silent:!0}),e},At.prototype.defaults=function(){return{id:Dt.Helpers.getGUID(),key:null,options:new Et({},{},this),containerId:null,components:new Nt([],{},this),widgets:new Dt.WidgetCollection([],{},this)}},At.prototype.doCommand=function(t,e){if(0<t.length){var n=t.pop();if(-1!=["options","components","widgets"].indexOf(n))return this.get(n).doCommand(t,e);throw"Unsupported command key"}},At.prototype.getComponents=function(){return[this].concat(this.get("widgets").getComponents()).concat(this.get("components").getComponents())},At.prototype.getInnermostComponents=function(t){var e=this.get("components");return 0<e.length&&e.at(0).get("key")===t?e.at(0).getInnermostComponents(t):e},At.prototype.postCommand=function(t,e){return t instanceof Nt?e.path.push("components"):t instanceof Dt.WidgetCollection?e.path.push("widgets"):t instanceof Object&&e.path.push("options"),e.path.push(this.id),this.parent&&this.parent.postCommand(this,e)},At.prototype.onOptionsMaterialChange=function(){this.get("upgrading")||this.trigger("materialChange")},At.prototype.silentCast=function(t,e,n){this.get(t)instanceof e||this.set(t,new e(this.get(t),n,this),{silent:!0})},At.prototype.parseCastAndListen=function(t,e,n,i,o){var s=this;!t||!t[e]||t[e]instanceof n||(t[e]=new n(t[e],o,this),this.listenTo(t[e],i,function(t){s.trigger("change",s)}))},At.prototype.parse=function(t){return this.parseCastAndListen(t,"components",Nt,"change add remove"),this.parseCastAndListen(t,"options",Et,"change"),wt(this.attributes.key,t),this.parseCastAndListen(t,"widgets",Dt.WidgetCollection,"change add remove"),t},At.prototype.setParent=function(t){this.parent=t,this.get("components")&&this.get("components").setParent(this),this.get("options")&&this.get("options").setParent(this),this.get("widgets")&&this.get("widgets").setParent(this)};var It,kt=At;function At(){return null!==It&&It.apply(this,arguments)||this}Dt.Component=kt,xt=Dt.ComandoCollection,e(Lt,xt),Lt.prototype.clone=function(){return new Lt(_.map(this.models,function(t){return t.clone()}),{model:this.model,comparator:this.comparator},this.parent)},Lt.prototype.getCommandDescriptor=function(t){var e,n=xt.prototype.getCommandDescriptor.call(this,t);return _.isArray(t)&&1===t.length?e=t[0]:t instanceof kt&&(e=t),(n=e instanceof m.Model?e.get("key"):n)||this.descriptor},Lt.prototype.setParent=function(t){var e=this;this.parent=t,this.map(function(t){return t.setParent(e)})};var xt,Nt=Lt;function Lt(){var t=null!==xt&&xt.apply(this,arguments)||this;return t.descriptor="Component",t}function Vt(t,e,n){t=Ct.call(this,t,e,n)||this;return t.IMMATERIAL_ATTRIBUTES=["isGridstack"],t.parent=n,t.listenTo(t,"change",t.determineMaterialChange.bind(t)),t}(Dt.ComponentCollection=Nt).prototype.model=kt,Tt=A=A||{},Ct=Tt.CommandoModel,e(Vt,Ct),Vt.prototype.commandSet=function(t){this.postCommand(this,new Tt.Command("Set Layout",[],[new Tt.Todo(Tt.CommandOp.Set,"",t)],[new Tt.Todo(Tt.CommandOp.Set,"",_.clone(this.toJSON()))]))},Vt.prototype.defaults=function(){return{row:null,column:null,rowSpan:12,colSpan:6}},Vt.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,this.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},Vt.prototype.doCommand=function(t,e){var n=this;e.forEach(function(t){n.set(t.payload)})},Vt.prototype.postCommand=function(t,e){return this.parent.postCommand(this,e)},Tt.Layout=Vt;var Ot,Bt,Rt,$t,Ut,Ft,qt,Yt,Ht,Kt,zt,Qt,Wt,jt,Gt,Xt,Zt,Jt,te,ee,ne,ie,oe,se,ae,re,le,ue,ce,pe,de,he,ge,fe,me,ye,ve,be,we,Se,_e,u=A=A||{};Te=u.CommandoModel,e(De,Te),De.prototype.clone=function(t){var e=new De({},{},this.parent),t=(t&&e.set("id",t),_.omit(this.attributes,"id"));return t.component=this.get("component").clone({previousWidgetId:this.id,widgetId:e.id}),t.layout=this.get("layout").clone(),e.set(t),e},De.prototype.defaults=function(){return{id:u.Helpers.getGUID(),layout:new u.Layout({},{},this),component:null}},De.prototype.commandSet=function(t){var e=this.clone(this.id).toJSON();this.postCommand(this,new u.Command("Set Widget",[],[new u.Todo(u.CommandOp.Set,"",t)],[new u.Todo(u.CommandOp.Set,"",e)]))},De.prototype.doCommand=function(t,e){var n=this;if(0<t.length){var i=t.pop();if(-1!==["layout","component"].indexOf(i))return this.get(i).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){t.payload.component&&(t.payload.component instanceof m.Model?n.set("component",t.payload.component):n.set("component",new u.Component(t.payload.component,{},n)))})},De.prototype.getComponents=function(){return this.get("component").getComponents()},De.prototype.postCommand=function(t,e){return t instanceof u.Layout?e.path.push("layout"):t instanceof u.Component&&(e.path.pop(),e.path.push("component")),e.path.push(this.id),this.parent.postCommand(this,e)},De.prototype.onComponentChanged=function(t,e,n){e&&this.listenTo(e,"change",function(t,e){this.trigger("change",t,e)})},De.prototype.onMaterialChange=function(){this.trigger("materialChange")},De.prototype.setParent=function(t){this.parent=t,this.get("component")&&this.get("component").setParent(this),this.get("layout")&&this.get("layout").setParent(this)};var Te,Ce=De;function De(t,e,n){t=Te.call(this,t,e,n)||this;return t.IMMATERIAL_ATTRIBUTES=[],!t.get("layout")||t.get("layout")instanceof u.Layout||t.set({layout:new u.Layout(t.get("layout"),{},t)},{silent:!0}),!t.get("component")||t.get("component")instanceof u.Component||t.set({component:new u.Component(t.get("component"),{},t)},{silent:!0}),t.get("component")&&t.listenTo(t.get("component"),"materialChange",t.onMaterialChange.bind(t)),t.get("layout")&&t.listenTo(t.get("layout"),"materialChange",t.onMaterialChange.bind(t)),t.listenTo(t,"change:component",t.onComponentChanged.bind(t)),t.onComponentChanged(t,t.get("component")),t}u.Widget=Ce,Me=u.ComandoCollection,e(Ee,Me),Ee.prototype.clone=function(){return new Ee(_.map(this.models,function(t){return t.clone()}),{model:Ce,comparator:this.comparator},this.parent)},Ee.prototype.commandSet=function(t){var i=this,e=t.map(function(t,e){var n=i.get(t.id)||i.at(e);if(n)return e=n.changedAttributes(t),t=_.mapValues(e,function(t,e){e=n.get(e);return e instanceof m.Model?e.toJSON():e}),n.id&&(t.id=n.id),t}),t=new u.Command(this.getCommandDescription(u.CommandOp.Set,t),[],[new u.Todo(u.CommandOp.Set,"",t)],[new u.Todo(u.CommandOp.Set,"",e)]);this.postCommand(this,t)},Ee.prototype.doCommandSet=function(t){var n=this;t.forEach(function(t){var e=n.get(t.id);e&&(t.component&&e.get("component").set(t.component),t.layout)&&e.get("layout").set(t.layout)})},Ee.prototype.getCommandDescriptor=function(t){var e,n=Me.prototype.getCommandDescriptor.call(this,t);return _.isArray(t)&&1===t.length?e=t[0]:t instanceof Ce&&(e=t),(n=e instanceof m.Model&&e.get("component")?e.get("component").get("key"):n)||this.descriptor},Ee.prototype.setParent=function(t){var e=this;this.parent=t,this.map(function(t){return t.setParent(e)})};var Me,s=Ee;function Ee(){var t=null!==Me&&Me.apply(this,arguments)||this;return t.commandQueue=[],t.descriptor="Widget",t.model=Ce,t}(u.WidgetCollection=s).prototype.model=Ce;var Pe=A=A||{},n=(Ie.prototype.toDate=function(){return Pe.Tools.convertKDBTemporalToMoment(this)},Ie.prototype.toString=function(){return this.toDate().formatNano("YYYY-MM-DD HH:mm:ss.SSSSSSSSS")},Ie);function Ie(t,e){this.i=t,this.n=e}Pe.rTimestampClass=n,ke.prototype.toDate=function(){return Pe.Tools.convertKDBTemporalToMoment(this)},ke.prototype.toString=function(){return"number"!=typeof this.i||isNaN(this.i)?"":this.i===Number.POSITIVE_INFINITY?"Infinity":this.i===Number.NEGATIVE_INFINITY?"-Infinity":this.toDate().format("YYYY-MM")};s=ke;function ke(t){this.i=t}Pe.rMonthClass=s,Ae.prototype.toDate=function(){return Pe.Tools.convertKDBTemporalToMoment(this)},Ae.prototype.toString=function(){return"number"!=typeof this.i||isNaN(this.i)?"":this.i===Number.POSITIVE_INFINITY?"Infinity":this.i===Number.NEGATIVE_INFINITY?"-Infinity":p(new Date(this.i)).utcOffset(0).format("YYYY-MM-DD")};var c=Ae;function Ae(t,e){this.i=t,this.n=e}Pe.rDateClass=c,xe.prototype.toDate=function(){return Pe.Tools.convertKDBTemporalToMoment(this)},xe.prototype.toString=function(){return this.toDate().format("YYYY-MM-DD HH:mm:ss.SSS")};var d=xe;function xe(t){this.i=t}Pe.rDateTimeClass=d,Le.prototype.toDate=function(){return Pe.Tools.convertKDBTemporalToMoment(this)},Le.prototype.toString=function(){return this.toDate().formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1})};var Ne=Le;function Le(t){this.i=t}Pe.rTimespanClass=Ne,Oe.prototype.toDate=function(){return Pe.Tools.convertKDBTemporalToMoment(this)},Oe.prototype.toString=function(){return this.toDate().format("HH:mm",{trim:!1})};var Ve=Oe;function Oe(t){this.i=t,this.n=0}Pe.rMinuteClass=Ve,Re.prototype.toDate=function(){return Pe.Tools.convertKDBTemporalToMoment(this)},Re.prototype.toString=function(){return this.toDate().format("HH:mm:ss",{trim:!1})};var Be=Re;function Re(t){this.i=t}Pe.rSecondClass=Be,Ue.prototype.toDate=function(){return Pe.Tools.convertKDBTemporalToMoment(this)},Ue.prototype.toString=function(){return this.toDate().format("HH:mm:ss.SSS",{trim:!1})};var $e=Ue;function Ue(t){this.i=t}Pe.rTimeClass=$e,n.prototype.class="1212",s.prototype.class="1213",c.prototype.class="1214",d.prototype.class="1215",Ne.prototype.class="1216",Ve.prototype.class="1217",Be.prototype.class="1218",$e.prototype.class="1219";n=A=A||{},h.isLong=function(t){return!0===(t&&t.__isLong__)},h.fromInt=function(t,e){var n,i,o;return e?(o=0<=(t>>>=0)&&t<256)&&(i=h.UINT_CACHE[t])?i:(n=h.fromBits(t,(0|t)<0?-1:0,!0),o&&(h.UINT_CACHE[t]=n),n):(o=-128<=(t|=0)&&t<128)&&(i=h.INT_CACHE[t])?i:(n=h.fromBits(t,t<0?-1:0,!1),o&&(h.INT_CACHE[t]=n),n)},h.fromNumber=function(t,e){if(isNaN(t))return e?h.UZERO:h.ZERO;if(e){if(t<0)return h.UZERO;if(h.TWO_PWR_64_DBL<=t)return h.MAX_UNSIGNED_VALUE}else{if(t<=-h.TWO_PWR_63_DBL)return h.MIN_VALUE;if(h.TWO_PWR_63_DBL<=t+1)return h.MAX_VALUE}return t<0?h.fromNumber(-t,e).neg():h.fromBits(t%h.TWO_PWR_32_DBL|0,t/h.TWO_PWR_32_DBL|0,e)},h.fromBits=function(t,e,n){return new h(t,e,n)},h.fromString=function(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return h.ZERO;if(e="number"==typeof e?(n=e,!1):!!e,(n=n||10)<2||36<n)throw RangeError("radix");var i;if(0<(i=t.indexOf("-")))throw Error("interior hyphen");if(0===i)return h.fromString(t.substring(1),e,n).neg();for(var o=h.fromNumber(Math.pow(n,8)),s=h.ZERO,a=0;a<t.length;a+=8){var r=Math.min(8,t.length-a),l=parseInt(t.substring(a,a+r),n);s=(r<8?(r=h.fromNumber(Math.pow(n,r)),s.mul(r)):s=s.mul(o)).add(h.fromNumber(l))}return s.unsigned=e,s},h.fromValue=function(t,e){return"number"==typeof t?h.fromNumber(t,e):"string"==typeof t?h.fromString(t,e):h.fromBits(t.low,t.high,"boolean"==typeof e?e:t.unsigned)},h.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},h.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*h.TWO_PWR_32_DBL+(this.low>>>0):this.high*h.TWO_PWR_32_DBL+(this.low>>>0)},h.prototype.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";var e,n;if(this.isNegative())return this.eq(h.MIN_VALUE)?(n=h.fromNumber(t),n=(e=this.div(n)).mul(n).sub(this),e.toString(t)+n.toInt().toString(t)):"-"+this.neg().toString(t);for(var i=h.fromNumber(Math.pow(t,6),this.unsigned),o=this,s="";;){var a=o.div(i),r=(o.sub(a.mul(i)).toInt()>>>0).toString(t);if((o=a).isZero())return r+s;for(;r.length<6;)r="0"+r;s=""+r+s}},h.prototype.getHighBits=function(){return this.high},h.prototype.getHighBitsUnsigned=function(){return this.high>>>0},h.prototype.getLowBits=function(){return this.low},h.prototype.getLowBitsUnsigned=function(){return this.low>>>0},h.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(h.MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;0<e&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},h.prototype.isZero=function(){return 0===this.high&&0===this.low},h.prototype.isNegative=function(){return!this.unsigned&&this.high<0},h.prototype.isPositive=function(){return this.unsigned||0<=this.high},h.prototype.isOdd=function(){return 1==(1&this.low)},h.prototype.isEven=function(){return 0==(1&this.low)},h.prototype.equals=function(t){return h.isLong(t)||(t=h.fromValue(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},h.prototype.notEquals=function(t){return!this.eq(t)},h.prototype.lessThan=function(t){return this.comp(t)<0},h.prototype.lessThanOrEqual=function(t){return this.comp(t)<=0},h.prototype.greaterThan=function(t){return 0<this.comp(t)},h.prototype.greaterThanOrEqual=function(t){return 0<=this.comp(t)},h.prototype.compare=function(t){var e,n;return h.isLong(t)||(t=h.fromValue(t)),this.eq(t)?0:(e=this.isNegative(),n=t.isNegative(),e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1)},h.prototype.negate=function(){return!this.unsigned&&this.eq(h.MIN_VALUE)?h.MIN_VALUE:this.not().add(h.ONE)},h.prototype.add=function(t){h.isLong(t)||(t=h.fromValue(t));var e=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,s=t.high>>>16,a=65535&t.high,r=t.low>>>16,l=0,u=0,c=0,p=0;return u+=(c=c+((p+=o+(65535&t.low))>>>16)+(i+r))>>>16,h.fromBits((c&=65535)<<16|(p&=65535),((l+=(u+=n+a)>>>16)+(e+s)&65535)<<16|(u&=65535),this.unsigned)},h.prototype.subtract=function(t){return h.isLong(t)||(t=h.fromValue(t)),this.add(t.neg())},h.prototype.multiply=function(t){var e,n,i,o,s,a,r,l,u,c,p;return this.isZero()?h.ZERO:(h.isLong(t)||(t=h.fromValue(t)),h.wasm?(e=h.wasm.mul(this.low,this.high,t.low,t.high),h.fromBits(e,h.wasm.get_high(),this.unsigned)):t.isZero()?h.ZERO:this.eq(h.MIN_VALUE)?t.isOdd()?h.MIN_VALUE:h.ZERO:t.eq(h.MIN_VALUE)?this.isOdd()?h.MIN_VALUE:h.ZERO:this.isNegative()?t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg():t.isNegative()?this.mul(t.neg()).neg():this.lt(h.TWO_PWR_24)&&t.lt(h.TWO_PWR_24)?h.fromNumber(this.toNumber()*t.toNumber(),this.unsigned):(e=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,s=t.high>>>16,a=65535&t.high,r=t.low>>>16,p=(p=c=u=l=0)+((u=u+((c+=o*(t=65535&t.low))>>>16)+i*t)>>>16)+((u=(u&65535)+o*r)>>>16),h.fromBits((u&=65535)<<16|(c&=65535),(l=(l=(l+=(p+=n*t)>>>16)+((p=(p&65535)+i*r)>>>16)+((p=(p&65535)+o*a)>>>16))+(e*t+n*r+i*a+o*s)&65535)<<16|(p&=65535),this.unsigned)))},h.prototype.divide=function(t){if((t=h.isLong(t)?t:h.fromValue(t)).isZero())throw Error("division by zero");var e,n,i,o;if(h.wasm)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?(e=(this.unsigned?h.wasm.div_u:h.wasm.div_s)(this.low,this.high,t.low,t.high),h.fromBits(e,h.wasm.get_high(),this.unsigned)):this;if(this.isZero())return this.unsigned?h.UZERO:h.ZERO;if(this.unsigned){if((t=t.unsigned?t:t.toUnsigned()).gt(this))return h.UZERO;if(t.gt(this.shru(1)))return h.UONE;i=h.UZERO}else{if(this.eq(h.MIN_VALUE))return t.eq(h.ONE)||t.eq(h.NEG_ONE)?h.MIN_VALUE:t.eq(h.MIN_VALUE)?h.ONE:(o=this.shr(1).div(t).shl(1)).eq(h.ZERO)?t.isNegative()?h.ONE:h.NEG_ONE:(n=this.sub(t.mul(o)),o.add(n.div(t)));if(t.eq(h.MIN_VALUE))return this.unsigned?h.UZERO:h.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=h.ZERO}for(n=this;n.gte(t);){o=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(o)/Math.LN2),a=s<=48?1:Math.pow(2,s-48),r=h.fromNumber(o),l=r.mul(t);l.isNegative()||l.gt(n);)l=(r=h.fromNumber(o-=a,this.unsigned)).mul(t);r.isZero()&&(r=h.ONE),i=i.add(r),n=n.sub(l)}return i},h.prototype.modulo=function(t){var e;return h.isLong(t)||(t=h.fromValue(t)),h.wasm?(e=(this.unsigned?h.wasm.rem_u:h.wasm.rem_s)(this.low,this.high,t.low,t.high),h.fromBits(e,h.wasm.get_high(),this.unsigned)):this.sub(this.div(t).mul(t))},h.prototype.not=function(){return h.fromBits(~this.low,~this.high,this.unsigned)},h.prototype.and=function(t){return h.isLong(t)||(t=h.fromValue(t)),h.fromBits(this.low&t.low,this.high&t.high,this.unsigned)},h.prototype.or=function(t){return h.isLong(t)||(t=h.fromValue(t)),h.fromBits(this.low|t.low,this.high|t.high,this.unsigned)},h.prototype.xor=function(t){return h.isLong(t)||(t=h.fromValue(t)),h.fromBits(this.low^t.low,this.high^t.high,this.unsigned)},h.prototype.shiftLeft=function(t){return h.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):h.fromBits(0,this.low<<t-32,this.unsigned)},h.prototype.shiftRight=function(t){return h.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):h.fromBits(this.high>>t-32,0<=this.high?0:-1,this.unsigned)},h.prototype.shiftRightUnsigned=function(t){return h.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h.fromBits(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):h.fromBits(32===t?this.high:this.high>>>t-32,0,this.unsigned)},h.prototype.rotateLeft=function(t){var e;return h.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?h.fromBits(this.high,this.low,this.unsigned):t<32?h.fromBits(this.low<<t|this.high>>>(e=32-t),this.high<<t|this.low>>>e,this.unsigned):h.fromBits(this.high<<(t-=32)|this.low>>>(e=32-t),this.low<<t|this.high>>>e,this.unsigned)},h.prototype.rotateRight=function(t){var e;return h.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?h.fromBits(this.high,this.low,this.unsigned):t<32?h.fromBits(this.high<<(e=32-t)|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned):h.fromBits(this.low<<(e=32-(t-=32))|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)},h.prototype.toSigned=function(){return this.unsigned?h.fromBits(this.low,this.high,!1):this},h.prototype.toUnsigned=function(){return this.unsigned?this:h.fromBits(this.low,this.high,!0)},h.prototype.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},h.prototype.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},h.prototype.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},h.fromBytes=function(t,e,n){return n?h.fromBytesLE(t,e):h.fromBytesBE(t,e)},h.fromBytesLE=function(t,e){return new h(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},h.fromBytesBE=function(t,e){return new h(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)},h.wasm=null,h.INT_CACHE={},h.UINT_CACHE={},h.TWO_PWR_16_DBL=65536,h.TWO_PWR_24_DBL=1<<24,h.TWO_PWR_63_DBL=(h.TWO_PWR_64_DBL=(h.TWO_PWR_32_DBL=h.TWO_PWR_16_DBL*h.TWO_PWR_16_DBL)*h.TWO_PWR_32_DBL)/2,h.TWO_PWR_24=h.fromInt(h.TWO_PWR_24_DBL),h.ZERO=h.fromInt(0),h.UZERO=h.fromInt(0,!0),h.ONE=h.fromInt(1),h.UONE=h.fromInt(1,!0),h.NEG_ONE=h.fromInt(-1),h.MAX_VALUE=h.fromBits(-1,2147483647,!1),h.MAX_UNSIGNED_VALUE=h.fromBits(-1,-1,!0),h.MIN_VALUE=h.fromBits(0,-2147483648,!1),s=h;function h(t,e,n){this.eqz=this.isZero.bind(this),this.eq=this.equals.bind(this),this.neq=this.notEquals.bind(this),this.ne=this.notEquals.bind(this),this.lt=this.lessThan.bind(this),this.lte=this.lessThanOrEqual.bind(this),this.le=this.lessThanOrEqual.bind(this),this.gt=this.greaterThan.bind(this),this.gte=this.greaterThanOrEqual.bind(this),this.ge=this.greaterThanOrEqual.bind(this),this.comp=this.compare.bind(this),this.neg=this.negate.bind(this),this.sub=this.subtract.bind(this),this.mul=this.multiply.bind(this),this.div=this.divide.bind(this),this.mod=this.modulo.bind(this),this.rem=this.modulo.bind(this),this.shl=this.shiftLeft.bind(this),this.shr=this.shiftRight.bind(this),this.shru=this.shiftRightUnsigned.bind(this),this.shr_u=this.shiftRightUnsigned.bind(this),this.rotl=this.rotateLeft.bind(this),this.rotr=this.rotateRight.bind(this),this.low=0|t,this.high=0|e,this.unsigned=!!n}n.Long=s,Object.defineProperty(s.prototype,"__isLong__",{value:!0});try{s.wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function Fe(t,e,n,i){this.length=t,this.offset=e,this.qtype=n,this.dataView=i}function qe(t,e,n,i,o){e=$t.call(this,t,e,n,i)||this;return e.indexOffset=0,e.index=null,e.rangeCache=null,e.SIZE=o,e.bufferLength=t,e}function Ye(t,e,n,i){return Ut.call(this,t,e,n,i,1)||this}function He(t,e,n){return qt.call(this,t,e,Ft.TypeNum.Byte,n)||this}function Ke(t,e,n,i){return Yt.call(this,t,e,n,i,4)||this}function ze(){}function Qe(t,e,n){return zt.call(this,t,e,Kt.TypeNum.Date,n)||this}function We(t,e,n){return Wt.call(this,t,e,Qt.TypeNum.Float,n,4)||this}function je(t,e,n){return Gt.call(this,t,e,jt.TypeNum.Int,n)||this}function Ge(t,e,n){return Jt.call(this,t,e,Zt.TypeNum.Minute,n)||this}function Xe(t,e,n,i){return te.call(this,t,e,n,i,8)||this}function Ze(t,e,n){return ne.call(this,t,e,ee.TypeNum.Double,n)||this}function Je(t,e,n){return oe.call(this,t,e,ie.TypeNum.Short,n,2)||this}function tn(t,e,n){return re.call(this,t,e,ae.TypeNum.Time,n)||this}function en(t,e,n,i){return ue.call(this,t,e,n,i,8)||this}function nn(t,e,n){return de.call(this,t,e,pe.TypeNum.Timestamp,n)||this}function on(t,e,n){return ge.call(this,t,e,he.TypeNum.Bool,n)||this}function sn(t,e,n){return ye.call(this,t,e,me.TypeNum.Char,n)||this}function an(t,e,n){return we.call(this,t,e,be.TypeNum.DateTime,n)||this}function rn(t,e,n){return _e.call(this,t,e,Se.TypeNum.Guid,n,16)||this}Ot=A=A||{},(Bt=Ot.ipc||(Ot.ipc={})).fromString=function(t,e){return _.isString(e)&&t.fromString?t.fromString(e):e},(c=Bt.TypeNum||(Bt.TypeNum={}))[c.List=0]="List",c[c.Bool=1]="Bool",c[c.Guid=2]="Guid",c[c.Byte=4]="Byte",c[c.Short=5]="Short",c[c.Int=6]="Int",c[c.Long=7]="Long",c[c.Float=8]="Float",c[c.Double=9]="Double",c[c.Char=10]="Char",c[c.Symbol=11]="Symbol",c[c.Timestamp=12]="Timestamp",c[c.Month=13]="Month",c[c.Date=14]="Date",c[c.DateTime=15]="DateTime",c[c.Timespan=16]="Timespan",c[c.Minute=17]="Minute",c[c.Second=18]="Second",c[c.Time=19]="Time",c[c.Table=98]="Table",c[c.Dict=99]="Dict",c[c.Unary=101]="Unary",Fe.prototype.isAligned=function(){return!0},Fe.prototype.isTemporal=function(){return this.qtype<=12&&this.qtype<=19},Fe.prototype.toLegacy=function(t){return this.getValue(t)},Fe.prototype.toViewState=function(t){return{_type:Bt.Parse.TYPE_NAMES[Math.abs(this.qtype)],value:Ot.Tools.convertKDBToViewstateValue(this.toLegacy(t))}},c=Fe,Bt.TypeBase=c,Rt=A=A||{},d=Rt.ipc||(Rt.ipc={}),$t=d.TypeBase,e(qe,$t),qe.prototype.getRange=function(){return this.rangeCache||(this.rangeCache=this.calcRange())},qe.prototype.mergeIndexed=function(t){if(t.length>=this.length)throw"Invalid Merge Size";this.resetRangeCache(),new Uint8Array(this.dataView.buffer,this.offset,t.length*this.SIZE).set(new Uint8Array(t.dataView.buffer,t.offset,t.length*this.SIZE))},qe.prototype.checkIndex=function(){for(var t=1;t<this.index.length;t++)if(this.hash(this.index[t-1])>this.hash(this.index[t]))return!0;return!1},qe.prototype.hasIndex=function(){return!!this.index},qe.prototype.getIndexFromSortedIndex=function(t){return(this.length+this.index[t]-this.indexOffset)%this.length},qe.prototype.getScalarFromSortedIndex=function(t){return t=(this.indexOffset+t)%this.length,8===this.SIZE&&Rt.Tools.isIE11&&-1!==[9,15].indexOf(this.qtype)?this.getLegacyScalar(this.index[t]):this.getScalar(this.index[t])},qe.prototype.findIndex=function(t){var n=this,e=8!==this.SIZE||-1!==[9,15].indexOf(this.qtype)?function(t,e){return t-n.hash(e)}:Rt.Tools.isIE11?function(t,e){return t.compare(n.hash(e))}:function(t,e){return Number(t-n.hash(e))};return Rt.Tools.binarySearch2(t,this.index,e)},qe.prototype.mergeKeyedPrimary=function(t,e,n){this.resetRangeCache(),this.hasIndex()||this.generateIndex();for(var i=0;i<t.length;i++){var o,s,a=this.findIndex(t.hash(i));a<0?(o=void 0,this.length===e?(o=this.indexOffset%e,s=this.findIndex(this.hash(o)),this.index.splice(s,1),s<-a-1&&a++,this.index.splice(-a-1,0,o),this.indexOffset=(this.indexOffset+1)%e):((o=this.length)>=this.bufferLength&&this.reallocate(e),this.index.splice(-a-1,0,o),this.length++),new Uint8Array(this.dataView.buffer,this.offset+o*this.SIZE,this.SIZE).set(new Uint8Array(t.dataView.buffer,t.offset+i*this.SIZE,this.SIZE)),n.push(o)):(s=this.index[a],n.push(s))}return this.indexOffset},qe.prototype.mergeKeyed=function(t,e,n,i){this.resetRangeCache();for(var o=0;o<e.length;o++){var s=e[o];s===this.length&&(s>=this.bufferLength&&this.reallocate(i),this.length++),new Uint8Array(this.dataView.buffer,this.offset+s*this.SIZE,this.SIZE).set(new Uint8Array(t.dataView.buffer,t.offset+o*this.SIZE,this.SIZE))}this.indexOffset=n},qe.prototype.reallocate=function(t){this.bufferLength=t||this.bufferLength;t=new ArrayBuffer(this.bufferLength*this.SIZE);new Uint8Array(t,0,this.length*this.SIZE).set(new Uint8Array(this.dataView.buffer,this.offset,this.length*this.SIZE)),this.dataView=new DataView(t),this.offset=0},qe.prototype.toTypedArray=function(){var t,e;return this.align(),1===this.SIZE?t=Uint8Array:2===this.SIZE?t=Int16Array:4===this.SIZE?t=8===this.qtype?Float32Array:Int32Array:8===this.SIZE&&(t=-1!==[9,15].indexOf(this.qtype)?Float64Array:BigInt64Array),0===this.indexOffset?new t(this.dataView.buffer,this.offset,this.length):((e=new t(this.length)).set(new t(this.dataView.buffer,this.indexOffset*this.SIZE,this.length-this.indexOffset)),e.set(new t(this.dataView.buffer,0,this.indexOffset),this.length-this.indexOffset),e)},qe.prototype.align=function(){this.offset%this.SIZE!=0&&this.reallocate()},qe.prototype.getByteLocation=function(t){return this.offset+(t+this.indexOffset)%this.length*this.SIZE},qe.prototype.getHashLocation=function(t){return this.offset+t*this.SIZE},qe.prototype.generateIndex=function(){var n=this;this.index=new Array(this.length);for(var t=0;t<this.length;t++)this.index[t]=t;8!==this.SIZE||-1!==[9,15].indexOf(this.qtype)?this.index.sort(function(t,e){return n.hash(t)-n.hash(e)}):Rt.Tools.isIE11?this.index.sort(function(t,e){return n.hash(t).compare(n.hash(e))}):this.index.sort(function(t,e){return Number(n.hash(t)-n.hash(e))})},qe.prototype.resetRangeCache=function(){this.rangeCache=null},d.Vector=qe,Ne=(Ne=A=A||{}).ipc||(Ne.ipc={}),Ut=Ne.Vector,e(Ye,Ut),Ye.prototype.calcRange=function(){for(var t=Ye.MIN,e=Ye.MAX,n=0;n<this.length;n+=1){var i=this.getScalar(n);t<i&&(t=i),i<e&&(e=i)}return[e,t]},Ye.prototype.getScalar=function(t){return this.dataView.getUint8(this.getByteLocation(t))},Ye.prototype.hash=function(t){return this.dataView.getUint8(this.getHashLocation(t))},Ye.MIN=0,Ye.MAX=255,Ne.U8=Ye,Ve=A=A||{},Ft=Ve.ipc||(Ve.ipc={}),qt=Ft.U8,e(He,qt),He.listToIPC=function(t){var e=t.length+6,n=Ft.Util.createBuffer(e);return n.wb(He.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return n.wb(t)}),n.data},He.toIPC=function(t){var e=Ft.Util.createBuffer(2);return e.wb(256-He.TYPE_NUM),e.wb(t||0),e.data},He.prototype.getValue=function(t){return this.getScalar(t)},He.TYPE_NUM=4,Ft.Byte=He,Be=(Be=A=A||{}).ipc||(Be.ipc={}),Yt=Be.Vector,e(Ke,Yt),Ke.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=0;n<this.length;n+=1){var i=this.getScalar(n);(t===Ke.NULL||t<i&&i!==Ke.NULL)&&(t=i),(e===Ke.NULL||i<e&&i!==Ke.NULL)&&(e=i)}return[e,t]},Ke.prototype.getScalar=function(t){return this.dataView.getInt32(this.getByteLocation(t),!0)},Ke.prototype.hash=function(t){return this.dataView.getInt32(this.getHashLocation(t))},Ke.NULL=-2147483648,Ke.INFINITY_NEGATIVE=-2147483647,Ke.INFINITY_POSITIVE=2147483647,Be.I32=Ke,$e=A=A||{},n=$e.ipc||($e.ipc={}),ze.QEPOCH=10957*(ze.MSDAY=864e5),ze.LONG_NULL=new $e.Long(0,2147483648),ze.LONG_INFINITY_NEGATIVE=new $e.Long(1,2147483648),ze.LONG_INFINITY_POSITIVE=$e.Long.MAX_VALUE,ze.JS_DATE_MIN=-864e13,ze.TIME_PARTS_RX=/(-?\d{1,7}:\d\d:\d\d.\d\d\d)(\d\d\d\d\d\d)/,ze.BQEPOCH=new et.BigInteger((1e6*ze.QEPOCH).toString()),n.Constants=ze,Ht=A=A||{},Kt=Ht.ipc||(Ht.ipc={}),zt=Kt.I32,e(Qe,zt),Qe.fromMoment=function(t){return null===t?null:new Ht.rDateClass(t.valueOf())},Qe.fromScalar=function(t){return null===t?null:new Ht.rDateClass(Kt.Constants.QEPOCH+t*Kt.Constants.MSDAY)},Qe.fromString=function(t){if(!t)return null;t=t.replace(/\./g,"-");t=p.utc(t);return Qe.fromMoment(t)},Qe.listToIPC=function(t){var e=4*t.length+6,n=Kt.Util.createBuffer(e);return n.wb(Kt.TypeNum.Date),n.wb(0),n.wi(t.length),_.each(t,function(t){return Qe.writeValue(t,n.wb)}),n.data},Qe.toIPC=function(t){var e=Kt.Util.createBuffer(5);return e.wb(256-Kt.TypeNum.Date),Qe.writeValue(t,e.wb),e.data},Qe.writeValue=function(t,e){Kt.Int.writeValue(null===t?null:Qe.toScalar(t),e)},Qe.toMoment=function(t){return null===t?null:p.tz(t.toString(),"UTC")},Qe.toScalar=function(t){return null===t?null:(t.i-Kt.Constants.QEPOCH)/Kt.Constants.MSDAY},Qe.toString=function(t,e){return void 0===e&&(e="YYYY-MM-DD"),null===t?null:Qe.toMoment(t).format(e)},Qe.prototype.getValue=function(t){t=zt.prototype.getScalar.call(this,t);return t===Kt.I32.NULL?null:t===Kt.I32.INFINITY_NEGATIVE?-1/0:t===Kt.I32.INFINITY_POSITIVE?1/0:new Ht.rDateClass(Kt.Constants.QEPOCH+t*Kt.Constants.MSDAY)},Kt.QDate=Qe,s=A=A||{},Qt=s.ipc||(s.ipc={}),Wt=Qt.Vector,e(We,Wt),We.listToIPC=function(t){var e=4*t.length+6,n=Qt.Util.createBuffer(e);return n.wb(We.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return We.writeValue(t,n.wb)}),n.data},We.toIPC=function(t){var e=Qt.Util.createBuffer(5);return e.wb(256-We.TYPE_NUM),We.writeValue(t,e.wb),e.data},We.writeValue=function(t,e){var n;null!==t?((n=new Float32Array(1))[0]=t,_.each(new Uint8Array(n.buffer),function(t){return e(t)})):_.each([0,0,192,255],function(t){return e(t)})},We.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=0;n<this.length;n+=1){var i=this.getScalar(n);(isNaN(t)||t<i&&!isNaN(i))&&(t=i),(isNaN(e)||i<e&&!isNaN(i))&&(e=i)}return[e,t]},We.prototype.getScalar=function(t){return this.dataView.getFloat32(this.getByteLocation(t),!0)},We.prototype.getValue=function(t){t=this.getScalar(t);return isNaN(t)?null:t},We.prototype.hash=function(t){return this.dataView.getFloat32(this.getHashLocation(t),!0)},We.TYPE_NUM=8,Qt.Float=We,c=A=A||{},jt=c.ipc||(c.ipc={}),Gt=jt.I32,e(je,Gt),je.listToIPC=function(t){var e=4*t.length+6,n=jt.Util.createBuffer(e);return n.wb(je.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return je.writeValue(t,n.wb)}),n.data},je.toIPC=function(t){var e=jt.Util.createBuffer(5);return e.wb(256-je.TYPE_NUM),je.writeValue(t,e.wb),e.data},je.writeValue=function(t,e){var n;null!==t?((n=new Int32Array(1))[0]=t,_.each(new Uint8Array(n.buffer),function(t){return e(t)})):_.each([0,0,0,128],function(t){return e(t)})},je.prototype.getValue=function(t){t=this.getScalar(t);return-2147483648===t?null:-2147483647===t?-1/0:2147483647===t?1/0:t},je.TYPE_NUM=6,jt.Int=je,Xt=A=A||{},Zt=Xt.ipc||(Xt.ipc={}),Jt=Zt.I32,e(Ge,Jt),Ge.fromMoment=function(t){return Ge.fromScalar(t.asMinutes())},Ge.fromScalar=function(t){return null===t?null:new Xt.rMinuteClass(t)},Ge.fromString=function(t){var e=(t=t.replace("1970-01-01T","").replace("Z","")).match(Zt.Constants.TIME_PARTS_RX),e=p.duration(e&&e[1]?e[1]:t);return Ge.fromMoment(e)},Ge.listToIPC=function(t){var e=4*t.length+6,n=Zt.Util.createBuffer(e);return n.wb(Zt.TypeNum.Minute),n.wb(0),n.wi(t.length),_.each(t,function(t){return Ge.writeValue(t,n.wb)}),n.data},Ge.toMoment=function(t){return null===t?null:p.duration(60*t.i*1e3)},Ge.toScalar=function(t){return null===t?null:t.i},Ge.toString=function(t,e,n){return void 0===e&&(e="HH:mm:ss.SSS"),void 0===n&&(n={trim:!1}),null===t?"":Ge.toMoment(t).format(e,n)},Ge.toIPC=function(t){var e=Zt.Util.createBuffer(5);return e.wb(256-Zt.TypeNum.Minute),Ge.writeValue(t,e.wb),e.data},Ge.writeValue=function(t,e){Zt.Int.writeValue(Ge.toScalar(t),e)},Ge.prototype.getValue=function(t){t=Jt.prototype.getScalar.call(this,t);return t===Zt.I32.NULL?null:new Xt.rMinuteClass(t)},Zt.Minute=Ge,d=(d=A=A||{}).ipc||(d.ipc={}),te=d.Vector,e(Xe,te),Xe.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=0;n<this.length;n+=1){var i=this.getScalar(n);(isNaN(t)||t<i&&!isNaN(i))&&(t=i),(isNaN(e)||i<e&&!isNaN(i))&&(e=i)}return[e,t]},Xe.prototype.getScalar=function(t){return this.dataView.getFloat64(this.getByteLocation(t),!0)},Xe.prototype.hash=function(t){return this.dataView.getFloat64(this.getHashLocation(t),!0)},Xe.prototype.toSplitTypedArray=function(){return this.align(),new Float32Array(this.dataView.buffer,this.offset,2*this.length)},d.F64=Xe,Ne=A=A||{},ee=Ne.ipc||(Ne.ipc={}),ne=ee.F64,e(Ze,ne),Ze.listToIPC=function(t){var e=8*t.length+6,n=ee.Util.createBuffer(e);return n.wb(Ze.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return Ze.writeValue(t,n.wb)}),n.data},Ze.toIPC=function(t){var e=ee.Util.createBuffer(9);return e.wb(256-Ze.TYPE_NUM),Ze.writeValue(t,e.wb),e.data},Ze.writeValue=function(t,e){var n;null!==t?((n=new Float64Array(1))[0]=t,_.each(new Uint8Array(n.buffer),function(t){return e(t)})):_.each([0,0,0,0,0,0,248,255],function(t){return e(t)})},Ze.prototype.getValue=function(t){t=this.getScalar(t);return isNaN(t)?null:t},Ze.TYPE_NUM=9,ee.Double=Ze,Ve=A=A||{},ie=Ve.ipc||(Ve.ipc={}),oe=ie.Vector,e(Je,oe),Je.listToIPC=function(t){var e=2*t.length+6,n=ie.Util.createBuffer(e);return n.wb(Je.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return Je.writeValue(t,n.wb)}),n.data},Je.toIPC=function(t){var e=ie.Util.createBuffer(3);return e.wb(256-Je.TYPE_NUM),Je.writeValue(t,e.wb),e.data},Je.writeValue=function(t,e){var n;null!==t?((n=new Int16Array(1))[0]=t,_.each(new Uint8Array(n.buffer),function(t){return e(t)})):_.each([0,128],function(t){return e(t)})},Je.prototype.getValue=function(t){t=this.getScalar(t);return-32768===t?null:-32767===t?-1/0:32767===t?1/0:t},Je.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=0;n<this.length;n+=1){var i=this.getScalar(n);(t===Je.SHORT_NULL||t<i&&i!==Je.SHORT_NULL)&&(t=i),(e===Je.SHORT_NULL||i<e&&i!==Je.SHORT_NULL)&&(e=i)}return[e,t]},Je.prototype.getScalar=function(t){return this.dataView.getInt16(this.getByteLocation(t),!0)},Je.prototype.hash=function(t){return this.dataView.getInt16(this.getHashLocation(t))},Je.TYPE_NUM=5,Je.SHORT_NULL=-32768,ie.Short=Je,se=A=A||{},ae=se.ipc||(se.ipc={}),re=ae.I32,e(tn,re),tn.fromMoment=function(t){return null===t?null:new se.rTimeClass(t.asMilliseconds())},tn.fromScalar=function(t){return null===t?null:new se.rTimeClass(t)},tn.fromString=function(t){var e=(t=t.replace("1970-01-01T","").replace("Z","")).match(ae.Constants.TIME_PARTS_RX),e=p.duration(e&&e[1]?e[1]:t);return tn.fromMoment(e)},tn.listToIPC=function(t){var e=4*t.length+6,n=ae.Util.createBuffer(e);return n.wb(ae.TypeNum.Time),n.wb(0),n.wi(t.length),_.each(t,function(t){return tn.writeValue(t,n.wb)}),n.data},tn.toIPC=function(t){var e=ae.Util.createBuffer(5);return e.wb(256-ae.TypeNum.Time),tn.writeValue(t,e.wb),e.data},tn.toMoment=function(t){return null===t?null:p.duration(t.i)},tn.toScalar=function(t){return null===t?null:t.i},tn.toString=function(t,e,n){return void 0===e&&(e="HH:mm:ss.SSS"),void 0===n&&(n={trim:!1}),null===t?"":tn.toMoment(t).format(e,n)},tn.writeValue=function(t,e){ae.Int.writeValue(tn.toScalar(t),e)},tn.prototype.getValue=function(t){t=re.prototype.getScalar.call(this,t);return t===ae.I32.NULL?null:new se.rTimeClass(t)},ae.Time=tn,le=A=A||{},Be=le.ipc||(le.ipc={}),ue=Be.Vector,e(en,ue),en.prototype.calcRange=function(){if("undefined"!=typeof BigInt){for(var t=this.getScalar(0),e=t,n=BigInt("-9223372036854775808"),i=1;i<this.length;i++){var o=this.getScalar(i);(t===n||t<o&&o!==n)&&(t=o),(e===n||o<e&&o!==n)&&(e=o)}return[e,t]}for(var s=this.getLegacyScalar(0),a=s,r=en.LONG_NULL,i=1;i<this.length;i++){o=this.getLegacyScalar(i);(s.eq(r)||o.gt(s)&&!o.eq(r))&&(s=o),(a.eq(r)||o.lt(a)&&!o.eq(r))&&(a=o)}return[a,s]},en.prototype.getLegacyScalar=function(t){t=new Uint8Array(this.dataView.buffer,this.getByteLocation(t),this.SIZE);return le.Long.fromBytesLE(t)},en.prototype.getScalar=function(t){return this.dataView.getBigInt64(this.getByteLocation(t),!0)},en.prototype.hash=function(t){return this.dataView.getBigInt64(this.getHashLocation(t),!0)},en.LONG_NULL=new le.Long(0,2147483648),en.LONG_INFINITY_NEGATIVE=new le.Long(1,2147483648),en.LONG_INFINITY_POSITIVE=le.Long.MAX_VALUE,$e=en,Be.I64=$e,le.Tools.isIE11&&($e.prototype.hash=function(t){t=new Uint8Array(this.dataView.buffer,this.getHashLocation(t),this.SIZE);return le.Long.fromBytesLE(t)},$e.prototype.toTypedArray=function(){var t;return this.align(),0===this.indexOffset?new Uint8Array(this.dataView.buffer,this.offset,this.length*this.SIZE):((t=new Uint8Array(this.length*this.SIZE)).set(new Uint8Array(this.dataView.buffer,this.indexOffset*this.SIZE,(this.length-this.indexOffset)*this.SIZE)),t.set(new Uint8Array(this.dataView.buffer,0,this.indexOffset*this.SIZE),(this.length-this.indexOffset)*this.SIZE),t)}),ce=A=A||{},pe=ce.ipc||(ce.ipc={}),de=pe.I64,e(nn,de),nn.fromMoment=function(t){return null===t?null:new ce.rTimestampClass(t.valueOf(),1e6*t.milliseconds()+t.nanoseconds())},nn.fromScalar=function(t){var t="bigint"==typeof t||"number"==typeof t?ce.Long.fromString(t.toString()):t;return t.equals(pe.Constants.LONG_NULL)?null:(t=new et.BigInteger(t.toString()).add(pe.Constants.BQEPOCH).toString(),new ce.rTimestampClass(Number(t.substring(0,t.length-6)),Number(t.substring(t.length-9))))},nn.fromString=function(t){if(null===t)return null;var e=t.match(/(.*)(D|T)(.*?)Z?$/);if(!e)return null;t=e[1].replace(/\./g,"-")+"T"+e[3]+"Z";e=p(t);return e.nanoseconds(ce.Tools.extractNanos(t)),nn.fromMoment(e)},nn.listToIPC=function(t){var e=8*t.length+6,n=pe.Util.createBuffer(e);return n.wb(pe.TypeNum.Timestamp),n.wb(0),n.wi(t.length),_.each(t,function(t){return pe.DateTime.writeValue(t,n.wb)}),n.data},nn.toIPC=function(t){var e=pe.Util.createBuffer(9);return e.wb(256-pe.TypeNum.Timestamp),nn.writeValue(t,e.wb),e.data},nn.toMoment=function(t){var e;return null===t?null:((e=p.tz(t.i,"UTC")).nanoseconds(t.n%1e6),ce.Tools.timezone&&e.isValid()&&e.tz(ce.Tools.timezone),e)},nn.toScalar=function(t){return null===t?null:BigInt(nn.toScalarString(t))},nn.toString=function(t,e){var n;return null===t?"":(n=(t=nn.toMoment(t)).format(e||"YYYY-MM-DDTHH:mm:ss.SSS"),e?n:n.substr(0,23)+_.padEnd(""+t.nanoseconds(),6,"0")+"Z")},nn.writeValue=function(t,e){t=nn.toScalarString(t);pe.QLong.writeValue(t,e)},nn.toScalarString=function(t){if(null===t)return null;_.isNumber(t)&&(t=this.fromMoment(p(t)));var e=_.padStart(t.n.toFixed(0),9,"0"),t=t.i.toFixed(0);return new et.BigInteger(t+e.substring(3)).subtract(pe.Constants.BQEPOCH).toString()},nn.prototype.getValue=function(t){var t=new Uint8Array(this.dataView.buffer,this.getByteLocation(t),this.SIZE),t=ce.Long.fromBytesLE(t);return t.equals(nn.LONG_NULL)?null:(t=new et.BigInteger(t.toString()).add(pe.Constants.BQEPOCH).toString(),new ce.rTimestampClass(Number(t.substring(0,t.length-6)),Number(t.substring(t.length-9))))},pe.Timestamp=nn,n=A=A||{},he=n.ipc||(n.ipc={}),ge=he.U8,e(on,ge),on.listToIPC=function(t){var e=t.length+6,n=he.Util.createBuffer(e);return n.wb(on.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return n.wb(t?1:0)}),n.data},on.toIPC=function(t){var e=he.Util.createBuffer(2);return e.wb(256-on.TYPE_NUM),e.wb(t?1:0),e.data},on.prototype.getValue=function(t){return 1===this.getScalar(t)},on.TYPE_NUM=1,he.Boolean=on,fe=A=A||{},me=fe.ipc||(fe.ipc={}),ye=me.U8,e(sn,ye),sn.listToIPC=function(t){var t=t.map(function(t){return fe.u8u16(t&&t.length?t[0]:" ")}),e=[].concat.apply([],t),t=t.length+6,n=me.Util.createBuffer(t);return n.wb(sn.TYPE_NUM),n.wb(0),n.wi(e.length),_.each(e,function(t){return n.wb(t)}),n.data},sn.toIPC=function(t){var t=fe.u8u16(t&&t.length?t[0]:" "),e=me.Util.createBuffer(1+t.length);return e.wb(256-sn.TYPE_NUM),t.forEach(function(t){return e.wb(t)}),e.data},sn.u16u8=function(t){for(var e,n,i,o="",s=0;s<t.length;s++)switch((e=t[s])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(e);break;case 12:case 13:n=t[++s],o+=String.fromCharCode((31&e)<<6|63&n);break;case 14:n=t[++s],i=t[++s],o+=String.fromCharCode((15&e)<<12|(63&n)<<6|(63&i)<<0)}return o},sn.prototype.getValue=function(t){t=this.getScalar(t);return 0===t?"":fe.u16u8([t])},sn.TYPE_NUM=10,me.Char=sn,ve=A=A||{},be=ve.ipc||(ve.ipc={}),we=be.F64,e(an,we),an.fromMoment=function(t){return null===t?null:new ve.rDateTimeClass(t.valueOf())},an.fromScalar=function(t){return isNaN(t)||null===t?null:new ve.rDateTimeClass(be.Constants.QEPOCH+t*be.Constants.MSDAY)},an.fromString=function(t){if(null===t)return null;var e=t.match(/(.*)(D|T)(.*?)Z?$/);if(!e)return null;t=e[1].replace(/\./g,"-")+"T"+e[3]+"Z";e=p(t);return an.fromMoment(e)},an.listToIPC=function(t){var e=8*t.length+6,n=be.Util.createBuffer(e);return n.wb(be.TypeNum.DateTime),n.wb(0),n.wi(t.length),_.each(t,function(t){return an.writeValue(t,n.wb)}),n.data},an.toIPC=function(t){var e=be.Util.createBuffer(9);return e.wb(256-be.TypeNum.DateTime),an.writeValue(t,e.wb),e.data},an.toMoment=function(t){return null===t?null:(t=p.tz(t.i,"UTC"),ve.Tools.timezone&&t.isValid()&&t.tz(ve.Tools.timezone),t)},an.toScalar=function(t){return null===t?null:(t.i-be.Constants.QEPOCH)/be.Constants.MSDAY},an.toString=function(t,e){return null===t?"":(t=an.toMoment(t),void 0!==e?t.format(e):t.toISOString())},an.writeValue=function(t,e){be.Double.writeValue(an.toScalar(t),e)},an.prototype.getValue=function(t){return an.fromScalar(this.getScalar(t))},be.DateTime=an,s=A=A||{},Se=s.ipc||(s.ipc={}),_e=Se.Vector,e(rn,_e),rn.prototype.calcRange=function(){throw"Not implemented"},rn.prototype.hash=function(t){throw"GUID hash not implemented "+t},rn.prototype.getScalar=function(t){return this.dataView.getBigInt64(this.getByteLocation(t),!0)},rn.prototype.getValue=function(t){for(var e=this.getByteLocation(t),n=e+this.SIZE,i="0123456789abcdef",o="",s=e;s<n;s++)var a=this.dataView.getUint8(s),r=s-e,o=(o+=4==r||6==r||8==r||10==r?"-":"")+i[a>>4]+i[15&a];return"00000000-0000-0000-0000-000000000000"===o?null:o},Se.Guid=rn;_i.hash=function(t){t=_i.md51_array(t);return _i.hex(t)},_i.rhex=function(t){for(var e="",n=0;n<4;n+=1)e+=_i.hex_chr[t>>8*n+4&15]+_i.hex_chr[t>>8*n&15];return e},_i.hex=function(t){for(var e=0;e<t.length;e+=1)t[e]=_i.rhex(t[e]);return t.join("")},_i.md5cycle=function(t,e){var n=t[0],i=t[1],o=t[2],s=t[3],i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&o|~i&s)+e[0]-680876936|0)<<7|n>>>25)+i|0)&i|~n&o)+e[1]-389564586|0)<<12|s>>>20)+n|0)&n|~s&i)+e[2]+606105819|0)<<17|o>>>15)+s|0)&s|~o&n)+e[3]-1044525330|0)<<22|i>>>10)+o|0;i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&o|~i&s)+e[4]-176418897|0)<<7|n>>>25)+i|0)&i|~n&o)+e[5]+1200080426|0)<<12|s>>>20)+n|0)&n|~s&i)+e[6]-1473231341|0)<<17|o>>>15)+s|0)&s|~o&n)+e[7]-45705983|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&o|~i&s)+e[8]+1770035416|0)<<7|n>>>25)+i|0)&i|~n&o)+e[9]-1958414417|0)<<12|s>>>20)+n|0)&n|~s&i)+e[10]-42063|0)<<17|o>>>15)+s|0)&s|~o&n)+e[11]-1990404162|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&o|~i&s)+e[12]+1804603682|0)<<7|n>>>25)+i|0)&i|~n&o)+e[13]-40341101|0)<<12|s>>>20)+n|0)&n|~s&i)+e[14]-1502002290|0)<<17|o>>>15)+s|0)&s|~o&n)+e[15]+1236535329|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&s|o&~s)+e[1]-165796510|0)<<5|n>>>27)+i|0)&o|i&~o)+e[6]-1069501632|0)<<9|s>>>23)+n|0)&i|n&~i)+e[11]+643717713|0)<<14|o>>>18)+s|0)&n|s&~n)+e[0]-373897302|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&s|o&~s)+e[5]-701558691|0)<<5|n>>>27)+i|0)&o|i&~o)+e[10]+38016083|0)<<9|s>>>23)+n|0)&i|n&~i)+e[15]-660478335|0)<<14|o>>>18)+s|0)&n|s&~n)+e[4]-405537848|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&s|o&~s)+e[9]+568446438|0)<<5|n>>>27)+i|0)&o|i&~o)+e[14]-1019803690|0)<<9|s>>>23)+n|0)&i|n&~i)+e[3]-187363961|0)<<14|o>>>18)+s|0)&n|s&~n)+e[8]+1163531501|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&s|o&~s)+e[13]-1444681467|0)<<5|n>>>27)+i|0)&o|i&~o)+e[2]-51403784|0)<<9|s>>>23)+n|0)&i|n&~i)+e[7]+1735328473|0)<<14|o>>>18)+s|0)&n|s&~n)+e[12]-1926607734|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i^o^s)+e[5]-378558|0)<<4|n>>>28)+i|0)^i^o)+e[8]-2022574463|0)<<11|s>>>21)+n|0)^n^i)+e[11]+1839030562|0)<<16|o>>>16)+s|0)^s^n)+e[14]-35309556|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i^o^s)+e[1]-1530992060|0)<<4|n>>>28)+i|0)^i^o)+e[4]+1272893353|0)<<11|s>>>21)+n|0)^n^i)+e[7]-155497632|0)<<16|o>>>16)+s|0)^s^n)+e[10]-1094730640|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i^o^s)+e[13]+681279174|0)<<4|n>>>28)+i|0)^i^o)+e[0]-358537222|0)<<11|s>>>21)+n|0)^n^i)+e[3]-722521979|0)<<16|o>>>16)+s|0)^s^n)+e[6]+76029189|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i^o^s)+e[9]-640364487|0)<<4|n>>>28)+i|0)^i^o)+e[12]-421815835|0)<<11|s>>>21)+n|0)^n^i)+e[15]+530742520|0)<<16|o>>>16)+s|0)^s^n)+e[2]-995338651|0)<<23|i>>>9)+o|0,i=((i+=((s=((s+=(i^((n=((n+=(o^(i|~s))+e[0]-198630844|0)<<6|n>>>26)+i|0)|~o))+e[7]+1126891415|0)<<10|s>>>22)+n|0)^((o=((o+=(n^(s|~i))+e[14]-1416354905|0)<<15|o>>>17)+s|0)|~n))+e[5]-57434055|0)<<21|i>>>11)+o|0,i=((i+=((s=((s+=(i^((n=((n+=(o^(i|~s))+e[12]+1700485571|0)<<6|n>>>26)+i|0)|~o))+e[3]-1894986606|0)<<10|s>>>22)+n|0)^((o=((o+=(n^(s|~i))+e[10]-1051523|0)<<15|o>>>17)+s|0)|~n))+e[1]-2054922799|0)<<21|i>>>11)+o|0,i=((i+=((s=((s+=(i^((n=((n+=(o^(i|~s))+e[8]+1873313359|0)<<6|n>>>26)+i|0)|~o))+e[15]-30611744|0)<<10|s>>>22)+n|0)^((o=((o+=(n^(s|~i))+e[6]-1560198380|0)<<15|o>>>17)+s|0)|~n))+e[13]+1309151649|0)<<21|i>>>11)+o|0,i=((i+=((s=((s+=(i^((n=((n+=(o^(i|~s))+e[4]-145523070|0)<<6|n>>>26)+i|0)|~o))+e[11]-1120210379|0)<<10|s>>>22)+n|0)^((o=((o+=(n^(s|~i))+e[2]+718787259|0)<<15|o>>>17)+s|0)|~n))+e[9]-343485551|0)<<21|i>>>11)+o|0,t[0]=n+t[0]|0,t[1]=i+t[1]|0,t[2]=o+t[2]|0,t[3]=s+t[3]|0},_i.md5blk_array=function(t){for(var e=[],n=0;n<64;n+=4)e[n>>2]=t[n]+(t[n+1]<<8)+(t[n+2]<<16)+(t[n+3]<<24);return e},_i.md51_array=function(t){for(var e,n,i,o,s=t.length,a=[1732584193,-271733879,-1732584194,271733878],r=64;r<=s;r+=64)_i.md5cycle(a,_i.md5blk_array(t.subarray(r-64,r)));for(e=(t=r-64<s?t.subarray(r-64):new Uint8Array(0)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<e;r+=1)n[r>>2]|=t[r]<<(r%4<<3);if(n[r>>2]|=128<<(r%4<<3),55<r)for(_i.md5cycle(a,n),r=0;r<16;r+=1)n[r]=0;return o=(o=8*s).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(o[2],16),o=parseInt(o[1],16)||0,n[14]=i,n[15]=o,_i.md5cycle(a,n),a},_i.hex_chr=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];var ln,un,cn,pn,dn,hn,gn,fn,mn,yn,vn,bn,wn,Sn,_n,Tn,Cn,Dn,Mn,En,Pn,In,kn,An,g,f,xn,Nn,Ln,Vn,On,Bn,Rn,$n,Un,Fn,qn,Yn,Hn,Kn,zn,Qn,Wn,jn,Gn,Xn,Zn,Jn,ti,ei,ni,ii,oi,si,ai,ri,li,ui,y,ci,pi,di,hi,v,gi,fi,w,mi,yi,vi,bi,wi,Si=_i;function _i(){}function Ti(t,e,n){n=cn.call(this,t.length,void 0,0,n)||this;return n.indexOffset=0,n.end=e,n.values=t,n}function Ci(t,e,n){return hn.call(this,t,e,dn.TypeNum.Long,n)||this}function Di(t,e,n){t=mn.call(this,t,t?e[0]:void 0,fn.TypeNum.Symbol,n)||this;return t.indexOffset=0,t.offsets=e,t}function Mi(){}function Ei(t,e,n){return wn.call(this,t,e,bn.TypeNum.Month,n)||this}function Pi(t,e,n){return Tn.call(this,t,e,_n.TypeNum.Second,n)||this}function Ii(t,e,n){return Mn.call(this,t,e,Dn.TypeNum.Timespan,n)||this}function ki(t,e,n){return Pn.call(this,t,e,En.TypeNum.Unary,n)||this}function Ai(t,e,n,i){this.length=t,this.keys=e,this.values=n,this.qtype=i||In.TypeNum.Dict}function xi(t,n,i){var o=this;this.class="203",this.columns=[],this.meta={},this.cols={},void 0!==t&&(this.columns=t).forEach(function(t,e){o.meta[t]=n[e].qtype,o.cols[t]=kn.Parse.col(n[e],i)})}function S(){}function T(t){var e=this,n=(this.requests={},this.requestId=1,this.httpOn=!1,this.insightsAPI=!1,(T.client=this).insightsAPI=t.insightsAPI||!1,this.debouncedHeartbeat=t.httpOnly?_.noop.bind(this):_.debounce(this.heartbeat.bind(this),15e3),(t.httpOn||t.httpOnly||t.insightsAPI)&&(this.httpOn=!0),t.httpOnly||t.insightsAPI);if(t.noWorker||n)n?_.defer(function(){return e.onOpen(void 0)}):this.init();else{n=requirejs.toUrl("worker")+".js";f.Log.Log(T.WORK+n);try{!window.SharedWorker||"FSBL"in window?(this.worker=new Worker(n,t),this.worker.onmessage=function(t){return e.onWsMessage(t)},this.worker.onerror=function(t){return e.onWorkerError(t)}):(this.worker=new SharedWorker(n,t),this.worker.port.onmessage=function(t){return e.onWsMessage(t)},this.worker.port.onmessageerror=function(t){return e.onWorkerError(t)},this.worker.port.start(),this.worker.onerror=function(t){return e.onWorkerError(t)})}catch(t){throw f.Log.Log(T.WORK+"create err",t),t}}}function Ni(){this.legacySubscribers={},this.rawSubscribers={}}function Li(t){var n=this,i=t.mappings||{};this.setDataModelMappings=t.setMappings,this.subscriptionKey=_.uniqueId("mapper_"),this.subscribe=t.subscribe,this.subscribed=!1,this.unsubscribe=t.unsubscribe,this.viewState=t.viewState,this.model=new m.Model({key:i.key||"",value:i.value||""}),this.mappings=new m.Collection(_.map(i.mappings,function(t,e){return new m.Model({key:e,value:"",viewstate:t&&t._dashboardsType?n.viewState.getByPath(i.mappings[e].value):t})})||[]),_.extend(this,m.Events)}function Vi(t){this.collection=t}ln=A=A||{},un=ln.ipc||(ln.ipc={}),cn=un.TypeBase,e(Ti,cn),Ti.toIPC=function(t){var e=_.sumBy(t,function(t){return t.length})+6,n=un.Util.createBuffer(e);return n.wb(0),n.wb(0),n.wi(t.length),_.each(t,function(t){_.each(t,function(t){return n.wb(t)})}),n.data},Ti.prototype.getFirstOffset=function(t){var e,t=this.values[t];return 0===(t=98!==t.qtype&&99!==t.qtype?t:(98===(e=t).keys.qtype||99===e.keys.qtype?e.keys:e).keys).qtype?new Ti((e=t).values,e.end,this.dataView).getFirstOffset(0):11===t.qtype?t.offsets[0]:(0<=t.qtype&&t.qtype,t.offset)},Ti.prototype.getEndOffset=function(t){t=this.values[t];if(0===(t=98!==t.qtype&&99!==t.qtype?t:(98===(e=t).values.qtype||99===e.values.qtype?e.values:e).values).qtype)return t.end;if(11===t.qtype)for(var e=t,n=e.offsets[e.offsets.length-1];0!==this.dataView.getUint8(n++););else{if(-11!==t.qtype)return 0<=t.qtype&&t.qtype<=19?(e=t).offset+ln.getTypeSize(e.qtype)*e.length:(e=t).offset+ln.getTypeSize(Math.abs(e.qtype));for(n=t.offset;0!==this.dataView.getUint8(n++););}return n},Ti.prototype.getValue=function(t){t=this.values[t];return 98===t.qtype||99===t.qtype?un.Parse.table(t,this.dataView):un.Parse.col(t,this.dataView)},Ti.prototype.isolate=function(t){var e=this.getFirstOffset(t),n=this.getEndOffset(t)-e,i=new ArrayBuffer(n),o=new Uint8Array(i,0,n);return o.set(new Uint8Array(this.dataView.buffer,e,n)),this.offsetItem(t,-e),98===this.values[t].qtype||99===this.values[t].qtype?(this.values[t]=un.Parse.table(this.values[t],new DataView(i)),Si.hash(o)):(this.values[t]=n=un.Parse.col(this.values[t],new DataView(i)),10===n.qtype?this.toLegacy(t):1===n.length&&-20<n.qtype&&n.qtype<20&&0!==n.qtype&&11!==n.qtype&&-11!==n.qtype?(e=n.hash(0),ln.Long.isLong(e)?e.toString():e):Si.hash(o))},Ti.prototype.offsetItem=function(t,e){var n,i=this.values[t];98!==i.qtype&&99!==i.qtype||(i=(98===(n=i).keys.qtype||99===n.keys.qtype?n.keys:n).keys,n=(98===n.values.qtype||99===n.values.qtype?n.values:n).values,this.offsetQTyped(t,e,n)),this.offsetQTyped(t,e,i)},Ti.prototype.offsetQTyped=function(t,e,n){if(0===n.qtype)for(var i=new Ti(n.values,n.end,this.dataView),o=0;o<i.length;o++)i.offsetItem(o,e);else if(11===n.qtype)for(var s=n,a=0;a<s.offsets.length;a++)s.offsets[a]+=e;else n.offset+=e},Ti.prototype.mergeIndexed=function(t){if(t.length>=this.length)throw"Invalid Merge Size";if(0!==t.length){var e=t.getFirstOffset(0),n=t.end-e,i=this.getFirstOffset(t.values.length),o=this.end-i,s=new ArrayBuffer(n+o);new Uint8Array(s,0,n).set(new Uint8Array(t.dataView.buffer,e,n)),new Uint8Array(s,n,o).set(new Uint8Array(this.dataView.buffer,i,o));for(var a=0;a<t.length;a++)this.values[a]=t.values[a],this.offsetItem(a,-e);for(var r=n-i,a=t.length;a<this.length;a++)this.offsetItem(a,r);this.end+=r,this.dataView=new DataView(s)}},Ti.prototype.mergeKeyedPrimary=function(t,e,n){var i=this;if(void 0===this.keyIndex){for(var o={},s=0;s<this.length;s++)o[this.isolate(s)]=s;this.keyIndex=o,delete this.dataView,this.getValue=function(t){return i.values[(t+i.indexOffset)%i.length]}}for(s=0;s<t.length;s++){var a,r=t.isolate(s),l=t.values[s],u=this.keyIndex[r];void 0===u?this.length===e?(a=this.indexOffset%e,this.keyIndex[r]=a,this.values[a]=l,n.push(a),this.indexOffset++):(this.keyIndex[r]=this.length,n.push(this.length),this.values.push(l),this.length++):n.push(u)}return this.indexOffset},Ti.prototype.mergeKeyed=function(t,e,n,i){var o=this;if(void 0===this.values){for(var s=[],a=0;a<this.length;a++){var r=this.getValue(a);s.push(r)}this.values=s,delete this.dataView,this.getValue=function(t){return o.values[(t+o.indexOffset)%o.length]}}for(a=0;a<e.length;a++){var l=t.getValue(a),u=e[a];u===this.length?(this.values.push(l),this.length++):u>this.length||(this.values[u]=l)}this.indexOffset=n},Ti.prototype.toLegacy=function(t){var e,n=this.values[t],i=this.dataView;if(10!==n.qtype)return-20<n.qtype&&n.qtype<0?un.Parse.col(n,i).toLegacy(0):0<=n.qtype&&n.qtype<20?(e=un.Parse.col(n,i),_.times(e.length).map(function(t){return e.toLegacy(t)})):98===n.qtype||99===n.qtype?un.Parse.table(n,i).toLegacy():101===n.qtype?null:void 0;var o=n,s=[];for(t=0;t<o.length;t++)s.push(i.getUint8(o.offset+t));return un.Char.u16u8(s)},Ti.prototype.toViewState=function(t){var e=this.values[t];return 99===e.qtype||98===e.qtype?un.Parse.table(e,this.dataView).toViewState():{_type:10===e.qtype?"string":un.Parse.TYPE_NAMES[Math.abs(e.qtype)],value:ln.Tools.convertKDBToViewstateValue(this.toLegacy(t))}},un.List=Ti,pn=A=A||{},dn=pn.ipc||(pn.ipc={}),hn=dn.I64,e(Ci,hn),Ci.listToIPC=function(t){var e=8*t.length+6,n=dn.Util.createBuffer(e);return n.wb(Ci.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return Ci.writeValue(t,n.wb)}),n.data},Ci.toIPC=function(t){var e=dn.Util.createBuffer(9);return e.wb(256-Ci.TYPE_NUM),Ci.writeValue(t,e.wb),e.data},Ci.writeValue=function(t,e){null!==t?(t=pn.Long.fromString(""+t),_.each(t.toBytesLE(),function(t){return e(t)})):_.each([0,0,0,0,0,0,0,128],function(t){return e(t)})},Ci.prototype.getValue=function(t){t=this.getLegacyScalar(t);return t.equals(dn.I64.LONG_INFINITY_NEGATIVE)?-1/0:t.equals(dn.I64.LONG_INFINITY_POSITIVE)?1/0:t.equals(dn.I64.LONG_NULL)?null:t.toString()},Ci.TYPE_NUM=7,dn.QLong=Ci,gn=A=A||{},fn=gn.ipc||(gn.ipc={}),mn=fn.TypeBase,e(Di,mn),Di.listToIPC=function(t){var e=_.sumBy(t,function(t){return t.length+1})+6,n=fn.Util.createBuffer(e);return n.wb(11),n.wb(0),n.wi(t.length),_.each(t,function(t){return Di.writeValue(t,n.wb)}),n.data},Di.toIPC=function(t){var e=t?t.length+2:2,e=fn.Util.createBuffer(e);return e.wb(245),null===t&&void 0===t||Di.writeValue(t,e.wb),e.data},Di.writeValue=function(t,e){null!=t&&_.each(""+t,function(t){return e(t.charCodeAt(0))}),e(0)},Di.prototype.getValue=function(t){if(this.values)return this.values[(t+this.indexOffset)%this.length];for(var e,n=this.offsets[(t+this.indexOffset)%this.length],i=[];0!==(e=this.dataView.getUint8(n++));)i.push(e);return gn.u16u8(i)},Di.prototype.hash=function(t){return this.getValue(t)},Di.prototype.mergeIndexed=function(t){if(t.length>=this.length)throw"Invalid Merge Size";if(null!==t.offset){for(var e=_.last(t.offsets);0!==t.dataView.getUint8(e++););for(var n=e-t.offset,i=this.offsets[t.length],o=_.last(this.offsets);0!==this.dataView.getUint8(o++););var s=o-i,a=new ArrayBuffer(n+s);new Uint8Array(a,0,n).set(new Uint8Array(t.dataView.buffer,t.offset,n)),new Uint8Array(a,n,s).set(new Uint8Array(this.dataView.buffer,i,s));for(var r=0;r<t.length;r++)this.offsets[r]=t.offsets[r]-t.offset;for(var l=n-i,r=t.length;r<this.length;r++)this.offsets[r]=this.offsets[r]+l;this.offset=0,this.dataView=new DataView(a)}},Di.prototype.mergeKeyedPrimary=function(t,e,n){if(void 0===this.keyIndex){for(var i={},o=[],s=0;s<this.length;s++){var a=this.getValue(s);i[a]=s,o.push(a)}this.keyIndex=i,this.values=o,delete this.offsets,delete this.dataView}for(s=0;s<t.length;s++){var r,l=t.getValue(s),u=this.keyIndex[l];void 0===u?this.length===e?(r=this.indexOffset%e,this.keyIndex[l]=r,this.values[r]=l,n.push(r),this.indexOffset++):(this.keyIndex[l]=this.length,n.push(this.length),this.values.push(l),this.length++):n.push(u)}return this.indexOffset},Di.prototype.mergeKeyed=function(t,e,n,i){if(void 0===this.values){for(var o=[],s=0;s<this.length;s++){var a=this.getValue(s);o.push(a)}this.values=o,delete this.offsets,delete this.dataView}for(s=0;s<e.length;s++){var r=t.getValue(s),l=e[s];l===this.length?(this.values.push(r),this.length++):l>this.length||(this.values[l]=r)}this.indexOffset=n},fn.Symbol=Di,c=A=A||{},yn=c.ipc||(c.ipc={}),Mi.u8u16=function(t){for(var e=[],n=0;n<t.length;n++){var i=t.charCodeAt(n);i<128?e.push(i):i<2048?e.push(192|i>>6,128|63&i):i<55296||57344<=i?e.push(224|i>>12,128|i>>6&63,128|63&i):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++n)),e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return e},Mi.listToIPC=function(t){return yn.List.toIPC(t.map(function(t){return Mi.toIPC(t)}))},Mi.toIPC=function(t){var t=t?Mi.u8u16(t):[],e=t.length+6,n=yn.Util.createBuffer(e);return n.wb(Mi.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return n.wb(t)}),n.data},Mi.TYPE_NUM=10,yn.QString=Mi,vn=A=A||{},bn=vn.ipc||(vn.ipc={}),wn=bn.I32,e(Ei,wn),Ei.fromMoment=function(t){return null===t?null:new vn.rMonthClass(Math.round(t.diff(p([2e3]),"months",!0)))},Ei.fromScalar=function(t){return null===t?null:new vn.rMonthClass(t)},Ei.fromString=function(t){if(null===t)return null;t=t.replace(/\./g,"-").replace(/m$/,"");t=p.utc(t);return Ei.fromMoment(t)},Ei.listToIPC=function(t){var e=4*t.length+6,n=bn.Util.createBuffer(e);return n.wb(Ei.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return Ei.writeValue(t,n.wb)}),n.data},Ei.toIPC=function(t){var e=bn.Util.createBuffer(5);return e.wb(256-Ei.TYPE_NUM),Ei.writeValue(t,e.wb),e.data},Ei.toMoment=function(t){var e;return null===t?null:((e=p.tz("2000-01-01","UTC")).add(t.i,"month"),e)},Ei.toScalar=function(t){return null===t?null:t.i},Ei.toString=function(t,e){return void 0===e&&(e="YYYY-MM"),null===t?"":Ei.toMoment(t).format(e)},Ei.writeValue=function(t,e){bn.Int.writeValue(Ei.toScalar(t),e)},Ei.prototype.getValue=function(t){t=wn.prototype.getScalar.call(this,t);return t===bn.I32.NULL?null:new vn.rMonthClass(t)},Ei.TYPE_NUM=13,bn.Month=Ei,Sn=A=A||{},_n=Sn.ipc||(Sn.ipc={}),Tn=_n.I32,e(Pi,Tn),Pi.fromMoment=function(t){return null===t?null:new Sn.rSecondClass(t.asSeconds())},Pi.fromScalar=function(t){return null===t?null:new Sn.rSecondClass(t)},Pi.fromString=function(t){var e=(t=t.replace("1970-01-01T","").replace("Z","")).match(_n.Constants.TIME_PARTS_RX),e=p.duration(e&&e[1]?e[1]:t);return Pi.fromMoment(e)},Pi.listToIPC=function(t){var e=4*t.length+6,n=_n.Util.createBuffer(e);return n.wb(_n.TypeNum.Second),n.wb(0),n.wi(t.length),_.each(t,function(t){return Pi.writeValue(t,n.wb)}),n.data},Pi.toIPC=function(t){var e=_n.Util.createBuffer(5);return e.wb(256-_n.TypeNum.Second),Pi.writeValue(t,e.wb),e.data},Pi.toMoment=function(t){return null===t?null:p.duration(1e3*t.i)},Pi.toScalar=function(t){return null===t?null:t.i},Pi.toString=function(t,e,n){return void 0===e&&(e="HH:mm:ss.SSS"),void 0===n&&(n={trim:!1}),null===t?"":Pi.toMoment(t).format(e,n)},Pi.writeValue=function(t,e){_n.Int.writeValue(Pi.toScalar(t),e)},Pi.prototype.getValue=function(t){t=Tn.prototype.getScalar.call(this,t);return t===_n.I32.NULL?null:new Sn.rSecondClass(t)},_n.Second=Pi,Cn=A=A||{},Dn=Cn.ipc||(Cn.ipc={}),Mn=Dn.I64,e(Ii,Mn),Ii.fromScalar=function(t){return null===t?null:new Cn.rTimespanClass(t)},Ii.fromMoment=function(t){return null===t?null:new Cn.rTimespanClass(t.valueOfNano())},Ii.fromString=function(t){var e,n=(t=t.replace("1970-01-01T","").replace("Z","")).match(Dn.Constants.TIME_PARTS_RX);return n&&n[1]?(-1!==t.indexOf("D")&&(e=t.substring(0,t.indexOf(":")).split("D"),e=Number(e[1])+24*Number(e[0]))&&(n[1]=e+n[1].substring(2)),e=p.duration(n[1]),(n=Number(n[2]||0))&&!_.isNaN(n)&&e.nanoseconds(n)):e=p.duration(t),Ii.fromMoment(e)},Ii.listToIPC=function(t){var e=8*t.length+6,n=Dn.Util.createBuffer(e);return n.wb(Dn.TypeNum.Timespan),n.wb(0),n.wi(t.length),_.each(t,function(t){return Ii.writeValue(t,n.wb)}),n.data},Ii.toIPC=function(t){var e=Dn.Util.createBuffer(9);return e.wb(256-Dn.TypeNum.Timespan),Ii.writeValue(t,e.wb),e.data},Ii.toMoment=function(t){var e;return null===t?null:((e=p.duration((0<t.i?Math.floor:Math.ceil)(t.i/1e6))).nanoseconds(t.i%1e6),e)},Ii.toScalar=function(t){return null===t?null:t.i},Ii.toString=function(t,e,n){return null===t?"":(n=(t=Ii.toMoment(t)).format(e||"HH:mm:ss.SSS",n||{trim:!1}),e?n:n+_.padEnd(""+t.nanoseconds(),6,"0"))},Ii.writeValue=function(t,e){Dn.QLong.writeValue(t?Ii.toScalar(t).toFixed(0):null,e)},Ii.prototype.getValue=function(t){t=this.getLegacyScalar(t),t="bigint"==typeof t||"number"==typeof t?Cn.Long.fromString(t.toString()):t;return t.equals(Dn.I64.LONG_NULL)?null:new Cn.rTimespanClass(Number(t.toString()))},Dn.Timespan=Ii,d=A=A||{},En=d.ipc||(d.ipc={}),Pn=En.U8,e(ki,Pn),ki.prototype.getValue=function(t){return this.getScalar(t)},En.Unary=ki,Ne=A=A||{},In=Ne.ipc||(Ne.ipc={}),Ai.toIPC=function(t,e){var n=_.sumBy(t,function(t){return t.length+1})+7+e.length,i=In.Util.createBuffer(n);return i.wb(99),i.wb(11),i.wb(0),i.wi(t.length),_.each(t,function(t){return In.Symbol.writeValue(t,i.wb)}),_.each(e,function(t){return i.wb(t)}),i.data},Ai.prototype.getKey=function(t){return this.keys.getValue(t)},Ai.prototype.getValue=function(t){return this.values.getValue(t)},Ai.prototype.toObject=function(){for(var t={},e=0;e<this.length;e++)t[this.getKey(e)]=this.getValue(e);return t},Ai.prototype.toLegacy=function(){var e=this,n=new In.Table;return 99===this.qtype?(n.addParsedColumn("Property",this.keys),n.addParsedColumn("Value",this.values)):_.times(this.keys.length,function(t){n.addParsedColumn(e.keys.toLegacy(t),e.values.getValue(t))}),n.toLegacy()},Ai.prototype.toViewState=function(){for(var t={},e=0;e<this.length;e++)t[this.getKey(e)]=this.values.toViewState(e);return{_type:"dict",value:t}},Ne=Ai,(In.Dict=Ne).prototype.qtype=99,Ve=A=A||{},kn=Ve.ipc||(Ve.ipc={}),xi.toLegacy=function(t,i,o){for(var e=0<i.length?o[i[0]].length:0,s=new Array(e),n=0;n<e;n++)!function(e){var n=new Object;i.forEach(function(t){return n[t]=o[t].toLegacy(e)}),s[e]=n}(n);return{class:"203",columns:i.slice(0),meta:_.clone(t),rows:s}},xi.prototype.addColumn=function(t,e,n){this.columns.push(t),this.meta[t]=e.qtype,this.cols[t]=kn.Parse.col(e,n)},xi.prototype.addParsedColumn=function(t,e){this.columns.push(t),this.meta[t]=e.qtype,this.cols[t]=e},xi.prototype.merge=function(e){var n=this;return this.columns=this.columns.concat(e.columns),e.columns.forEach(function(t){n.meta[t]=e.meta[t],n.cols[t]=e.cols[t]}),this},xi.prototype.toLegacy=function(){return xi.toLegacy(this.meta,this.columns,this.cols)},xi.prototype.toViewState=function(){return{_type:"table",value:this.toLegacy()}},Ve=xi,(kn.Table=Ve).prototype.qtype=98,An=A=A||{},g=An.ipc||(An.ipc={}),S.col=function(t,e){var n;return-11===t.qtype?new g.Symbol(1,[t.offset],e):11===t.qtype?new g.Symbol(t.offsets.length,t.offsets,e):0===t.qtype?new g.List(t.values,t.end,e):101===t.qtype?new g.Unary(1,t.offset,e):98===t.qtype||99===t.qtype?S.table(t,e):101===t.qtype?new g.Unary(1,t.offset,e):(n=S.VECTOR_COLUMN_CLASSES[Math.abs(t.qtype)])?t.qtype<0?new n(1,t.offset,e):new n(t.length,t.offset,e):null},S.dict=function(t,e){var n=S.col(t.keys,e),e=S.col(t.values,e);return new g.Dict(n.length,n,e,t.qtype)},S.flipDict=function(t,e){var n=S.col(t.keys,e),i=S.col(t.values,e);return new g.Table(_.times(n.length,function(t){return n.toLegacy(t)}),_.times(i.length,function(t){return i.getValue(t)}),e)},S.reshape=function(t,e){var n=t.qtype,i=new DataView(e);if("com.fd.business.querymanager.subscriptions.StreamingSubscription"===t.class||"210"===t.class||"207"===t.class)return t;e=S.table(t,i);if(e&&98===e.qtype)return e;var o=new g.Table;if(-20<n&&n<0){e=S.TYPE_NAMES[-n]||"unknown";o.addColumn(e,-11===n?new An.qSymList(!0,[t.offset]):new An.qVector(-n,!0,1,t.offset),i)}else if(99===n){e=t;o.addColumn("Property",e.keys,i),o.addColumn("Value",e.values,i)}else if(10===n){var s=t;o.addColumn("string",new An.qGenericList(!0,[s],s.offset+s.length*An.getTypeSize(s.qtype)),i)}else if(0===n)t.values.forEach(function(t,e){null!==t&&(e=(10===t.qtype?"string":S.TYPE_NAMES[Math.abs(t.qtype)]||"unknown")+e,t.qtype<0?o.addColumn(e,-11===t.qtype?new An.qSymList(!0,[t.offset]):new An.qVector(-t.qtype,!0,1,t.offset),i):o.addColumn(e,10!==t.qtype&&t.qtype<=19?t:new An.qGenericList(!0,[t],10===t.qtype?t.offset+An.getTypeSize(t.qtype)*t.length:t.offset),i))});else if(11===n){var a=t;a.offsets.forEach(function(t,e){o.addColumn((S.TYPE_NAMES[a.qtype]||"unknown")+e,new An.qSymList(!0,[t]),i)})}else{if(!(0<=n&&n<20)){if(101===n)return o;throw"Unsupported Root Object"}for(var s=t,r=An.getTypeSize(s.qtype),l=0;l<s.length;l++)o.addColumn((S.TYPE_NAMES[s.qtype]||"unknown")+l,new An.qVector(s.qtype,!0,1,s.offset+r*l),i)}return o},S.table=function(t,e){if(98===t.qtype)return S.flipDict(t,e);if(99===t.qtype){var n,i,o,s=t;if(98!==s.values.qtype)return S.dict(t,e);if(98===s.keys.qtype)return t=S.flipDict(s.keys,e),n=S.flipDict(s.values,e),t.merge(n);if(11===s.keys.qtype&&11===s.values.keys.qtype)return i=S.col(s.values.keys,e),t=["key"].concat(_.times(i.length,function(t){return i.toLegacy(t)})),o=S.col(s.values.values,e),new g.Table(t,[s.keys].concat(_.times(o.length,function(t){return o.getValue(t)})),e);throw"Unsupported nested table/dict"}},S.TYPE_NAMES=["list","boolean","guid",void 0,"byte","short","int","long","real","float","char","symbol","timestamp","month","date","datetime","timespan","minute","second","time"],S.VECTOR_COLUMN_CLASSES=[null,g.Boolean,g.Guid,null,g.Byte,g.Short,g.Int,g.QLong,g.Float,g.Double,g.Char,null,g.Timestamp,g.Month,g.QDate,g.DateTime,g.Timespan,g.Minute,g.Second,g.Time],g.Parse=S,f=A=A||{},xn=function(t,e,n,i,o,s){this.maxResults=2147483647,this.timestamp=(new Date).getTime(),this.op=t,this.connectionId=e,this.query=n,i&&(this.maxResults=i),this.success=o,this.error=s},f.DCRequest=xn,T.createLog=function(t,e,n){},T.getQueryData=function(t,e,n,i,o,s,a,r,l){T.getQueryData2(t,e,n,i,T.legacyRowCallback(o),s,a,r,l)},T.getQueryData2=function(t,e,n,i,o,s,a,r,l){r&&f.Log.Error("Paging not supported in lite"),"sql"===t&&f.Log.Error("SQL not supported in lite");r=this.parametersToString(i);r&&(n=n+"["+r+"]"),l&&l.trigger("serverStart"),T.client.send(2,a,e,n,function(t,e,n){n&&l&&(l.set("serverStart",n[0]),l.set("serverEnd",n[1])),o(t,e)},s)},T.parametersToString=function(t){var n,e="";return _.isEmpty(t)||(n=[],_.each(t,function(t,e){n.push(f.RTTI.getByName(t.type).toKDBInput(t.value))}),e=n.join(";")),e},T.parametersToIPC=function(t){function n(t){var e=T.deltaNameMap[t.type];if(e)return e.toIPC(f.ipc.fromString(e,t.value));throw"Unsupported param type: "+t.type}var i=[];return _.isEmpty(t)||_.each(t,function(t,e){"dict"===t.type?i.push(f.ipc.Dict.toIPC(_.map(t.value,function(t,e){return e}),f.ipc.List.toIPC(_.map(t.value,n)))):"list"===t.type?i.push(f.ipc.Symbol.listToIPC(t.value.map(function(t){return _.isNil(t)?"":t.toString()}))):i.push(n(t))}),f.ipc.List.toIPC(i)},T.runAnalytic=function(t,e,n,i,o,s,a,r){T.runAnalytic2(t,e,n,function(t,e){var t=f.ipc.Parse.reshape(t,e),n=t.toLegacy();return delete t.cols,e=null,i(n)},o,s,null,r)},T.runAnalytic2=function(t,e,n,i,o,s,a,r){n&&_.values(n).length||(n=[{type:"symbol",value:null}]),T.client.send(2,s,e,[{type:"symbol",value:t}].concat(_.values(n)),function(t,e,n){n&&r&&(r.set("serverStart",n[0]),r.set("serverEnd",n[1])),i(t,e)},o)},T.runAPI=function(t,e,n,i,o,s,a,r){n&&_.values(n).length||(n=[{type:"symbol",value:null}]),T.client.send(1,s,e,[{type:"symbol",value:t}].concat(_.values(n)),function(t,e){var t=f.ipc.Parse.reshape(t,e),n=t.toLegacy();return delete t.cols,e=null,i(n)},o)},T.getDeltaAnalytics=function(e,t){T.runAnalytic(f.KdbQuery.getFunctions,t,[],function(t){return e(_.map(t.rows,function(t){return t.parameters=t.parameters.rows,t.name=".api."+t.name,t}))},function(){})},T.legacyRowCallback=function(n){return function(t,e){n&&(e&&e.byteLength&&(t.dataSet?t.dataSet=f.ipc.Parse.reshape(t.dataSet,e).toLegacy():t=f.ipc.Parse.reshape(t,e).toLegacy()),n(t))}},T.updateTable=function(n,t,e){for(var i=[],o=0;o<3;o+=1)i[o]={type:"dict",value:{},index:o};_.each(i,function(t,e){t.index=e}),_.each(n.addedDict.items,function(t,e){i[0].value[e]={type:T.updateTableGetListType(n.typeConfig[e],t),value:t}}),_.each(n.updatedDict.items,function(t,e){i[1].value[e]={type:T.updateTableGetListType(n.typeConfig[e],t),value:t}}),_.each(n.deletedDict.items,function(t,e){i[2].value[e]={type:T.updateTableGetListType(n.typeConfig[e],t),value:t}}),"analytic"===n.updateType?n.updateAnalytic&&T.runAnalytic(n.updateAnalytic,n.connection,i,t,e):T.getQueryData("kdb",n.connection,n.query,i,t,e)},T.updateTableGetListType=function(t,e){var n;switch(t){case 0:return n=_.isArray(e)?_.isBoolean(e[0])?"listlistboolean":_.isString(e[0])?"listliststring":"listlistsymbol":_.isString(e)?"string[]":"symbol[]";case 1:return"boolean[]";case 2:return"guid[]";case 4:return"byte[]";case 5:return"short[]";case 6:return"int[]";case 7:return"long[]";case 8:return"real[]";case 9:return"float[]";case 10:return n="char[]",_.each(e,function(t){1<t.length&&(n="string[]")}),n;case 11:return"symbol[]";case 12:return"timestamp[]";case 13:return"month[]";case 14:return"date[]";case 15:return"datetime[]";case 16:return"timespan[]";case 17:return"minute[]";case 18:return"second[]";case 19:return"time[]";default:return"symbol[]"}},T.prototype.destroy=function(){if(this.ws)try{this.ws.onopen=_.noop.bind(this),this.ws.onclose=_.noop.bind(this),this.ws.onmessage=_.noop.bind(this),this.ws.close(),this.ws=null}catch(t){this.ws=null}},T.prototype.send=function(t,e,n,i,o,s){return this.sendRequest(new xn(t,n,i,e,o,s))},T.prototype.subscribe=function(t,e,n,i,o,s){if(void 0===s){var a=void 0,r=/^(`[a-zA-Z]\w+)+$/gm;if(e.match(/^\((`\$"([^"]+)")(;`\$"([^"]+)")*\)$/gm))a=e.match(/`\$"([^"]+)"/g).map(function(t){return t.substring(3,t.length-1)});else{if(!e.match(r))return void o('Enter stream query as a symbol list in the form: (`$"symA";`$"symB")');a=e.match(r).map(function(t){return t.substring(1,t.length)})}s=(1<a.length?a.slice(1):[]).map(function(t){return{type:"symbol",value:t}})}return _.first(s)||s.push({type:"symbol",value:null}),s.splice(0,0,{type:"symbol",value:e}),this.send(3,-t,n,s,i,o)},T.prototype.unsubscribe=function(t){delete this.requests[t],this.sendRequest(new xn(4,null,null,_.noop.bind(this),_.noop.bind(this)),t)},T.prototype.heartbeat=function(){this.ws?this.sendRequest(new xn(0)):this.init()},T.prototype.init=function(){try{var t="file:"===location.protocol?"ws://localhost:10001/":("https:"===location.protocol?"wss://":"ws://")+location.host+"/api/ws";f.Log.Log(T.SOCK+t),this.ws=new WebSocket(t),this.ws.binaryType="arraybuffer",this.ws.onopen=this.onWsOpen.bind(this),this.ws.onclose=this.onWsClose.bind(this),this.ws.onerror=this.onWsError.bind(this),this.ws.onmessage=this.onWsMessage.bind(this)}catch(t){f.Log.Log(T.SOCK+"Create Err",t)}this.debouncedHeartbeat()},T.prototype.sendRequest=function(e,n){function t(t,e){return e.push(f.ipc.Symbol.toIPC(t.connectionId)),e.push(f.ipc.List.toIPC([f.ipc.Int.toIPC(t.maxResults),"string"==typeof t.query?f.ipc.Char.listToIPC(t.query.split("")):t.query instanceof Array?T.parametersToIPC(t.query):t.query])),e}var i,o,s,a,r=this,l=(n=n||this.requestId++,this.requests[n]=e,[f.ipc.Int.toIPC(this.httpOn?0:n),f.ipc.Int.toIPC(e.op)]);switch(e.op){case 3:if(this.insightsAPI||!e.query||2!==e.query.length)throw new Error("Client: Unsupported Operation");case 1:case 2:this.worker&&!this.httpOn?(o=t(e,[n,e.op]),(!window.SharedWorker||"FSBL"in window?this.worker:this.worker.port).postMessage(o)):((i=new XMLHttpRequest).onprogress=function(t){t.lengthComputable&&(t=t.loaded/t.total*100,f.Log.Log("DashClient download: "+t+"%"))},i.onload=function(){delete r.requests[n],500===i.status?e.error(f.u16u8(new Uint8Array(i.response,Math.min(i.response.byteLength,14)))):i.response&&10<=i.response.byteLength?e.success(f.deserialize(i.response),i.response,[e.timestamp,Date.now()]):e.error("Invalid response")},i.onerror=function(t){delete r.requests[n],e.error("Network failure")},o=location.protocol+"//"+location.host+"/",s="object"==typeof e.query&&(null==(s=e.query[0])?void 0:s.value)===f.KdbQuery.executeSql,this.insightsAPI&&2===e.op&&("string"==typeof e.query||s)?(o+="servicegateway/sandbox/"+encodeURIComponent(e.connectionId)+(s?"/sql":"/qsql"),a=JSON.stringify({query:s?e.query[1].value:e.query,maxResults:Number(e.maxResults)}),i.open("POST",o,!0),i.responseType="arraybuffer",i.send(a)):(a=f.ipc.Util.toMessage(f.ipc.List.toIPC(t(e,l)))).byteLength<2048?(i.open("GET",o+"api/"+btoa(a.reduce(function(t,e){return t+String.fromCharCode(e)},"")).replace(/\//g,"+"),!0),i.responseType="arraybuffer",i.send()):(i.open("POST",o,!0),i.responseType="arraybuffer",i.send(a)));break;case 0:case 4:this.ws&&this.ws.readyState===WebSocket.OPEN&&(this.ws.send(f.ipc.Util.toMessage(f.ipc.List.toIPC(t(e,l)))),this.debouncedHeartbeat());break;default:throw new Error("Client: Unsupported Operation")}return n},T.prototype.onDisconnect=function(t){f.Log.Log("DashClient Disconnect",t),$(this).trigger("DeltaClientDisconnect",t)},T.prototype.onOpen=function(t){f.Log.Log("DashClient Connect"),$(this).trigger("DeltaClientConnect"),f.Log.Log("DashClient Login"),$(this).trigger("DeltaClientLogin")},T.prototype.onWorkerError=function(t){f.Log.Log(T.WORK+"error",t),this.onDisconnect(t)},T.prototype.onWsClose=function(t){f.Log.Log(T.SOCK+"Closed",t),this.destroy()},T.prototype.onWsError=function(t){f.Log.Log(T.SOCK+"Error",t),this.onDisconnect(t),this.destroy()},T.prototype.onWsMessage=function(t){if(t.data instanceof Array){if(6===t.data[0])return void(t.data[1]===WebSocket.OPEN?this.onOpen(null):this.onWorkerError(t.data[2]||"ws not open"));if(5===t.data[0])return this.onWorkerError(t.data[1])}var e=f.deserialize(t.data,8,!0),n=e[0],i=e[1],o=this.requests[n];o?(3!==o.op&&delete this.requests[n],2!==o.op&&1!==o.op&&3!==o.op||(5===i?(i=e[2],o.error(f.u16u8(new Uint8Array(t.data,i.offset,i.length)))):(i=this.httpOn&&3!==o.op?Date.now():new Float64Array(t.data,0,1)[0],o.success(e[2]||{},t.data,[o.timestamp,i])))):f.Log.Warn('Stray Response "'+n+'"')},T.prototype.onWsOpen=function(t){console.log("websocket open",t),this.ws.readyState===WebSocket.OPEN?(f.Log.Log(T.SOCK+"Open",t),this.onOpen(t)):(f.Log.Log(T.SOCK+"Open Error",t),this.onDisconnect(t))},T.SOCK="Socket ",T.WORK="Worker ",T.deltaNameMap={boolean:f.ipc.Boolean,guid:f.ipc.Symbol,byte:f.ipc.Byte,short:f.ipc.Short,int:f.ipc.Int,long:f.ipc.QLong,real:f.ipc.Float,float:f.ipc.Double,char:f.ipc.Char,symbol:f.ipc.Symbol,timestamp:f.ipc.Timestamp,month:f.ipc.Month,date:f.ipc.QDate,datetime:f.ipc.DateTime,timespan:f.ipc.Timespan,minute:f.ipc.Minute,second:f.ipc.Second,time:f.ipc.Time,string:f.ipc.QString},f.DashClient=T,Nn=A=A||{},Ni.prototype.notifyAllLegacyChange=function(e,n,i,o){var s=this;_.each(this.legacySubscribers,function(t){return s.notifyChange(t,e,n,i,o)})},Ni.prototype.notifyAllRawChange=function(e,n,i,o){var s=this;_.each(this.rawSubscribers,function(t){return s.notifyChange(t,e,n,i,o)})},Ni.prototype.notifyChange=function(t,e,n,i,o){this.callSubscriber(t,t.onData,e,n,i,o)},Ni.prototype.getSubscribers=function(){return _.union(_.keys(this.legacySubscribers),_.keys(this.rawSubscribers))||[]},Ni.prototype.subscribe=function(t,e,n){n=n?this.rawSubscribers:this.legacySubscribers;return!n[t]&&(n[t]=e,!0)},Ni.prototype.subscriberCount=function(){return this.subscriberLegacyCount()+this.subscriberRawCount()},Ni.prototype.subscriberLegacyCount=function(){return _.keys(this.legacySubscribers).length},Ni.prototype.subscriberRawCount=function(){return _.keys(this.rawSubscribers).length},Ni.prototype.unsubscribe=function(t){return this.legacySubscribers[t]?(delete this.legacySubscribers[t],!0):!!this.rawSubscribers[t]&&(delete this.rawSubscribers[t],!0)},Ni.prototype.unsubscribeAll=function(){return this.legacySubscribers={},this.rawSubscribers={},!0},Ni.prototype.callSubscriber=function(e,t,n,i,o,s){if(t)try{t.apply(e,Array.prototype.slice.call(arguments,2))}catch(t){this.onSubscriberError(e,t)}},Ni.prototype.onSubscriberError=function(t,e){Nn.Log.Error("ERROR: Subscriber error!",e)},Nn.Agent=Ni,Ln=A=A||{},Li.prototype.trigger=function(t){for(var e=1;e<arguments.length;e++)e-1,0},Li.prototype.listenTo=function(t,e,n){},Li.prototype.stopListening=function(t,e,n){},Li.prototype.initialize=function(){this.setSubscription(),this.initializeEvents()},Li.prototype.initializeEvents=function(){this.listenTo(this.mappings,"add reset remove",this.onMappingsCollectionChange),this.listenTo(this.mappings,"change:key",this.onMappingItemKeyChange),this.listenTo(this.mappings,"change:viewstate",this.onMappingItemViewStateChange),this.listenTo(this.model,"change:key",this.onMappingKeyChange),this.listenTo(this.model,"change:value",this.onMappingValueChange)},Li.prototype.addMapping=function(){var t=this.getPossibleKeys(),e=_.difference(t,this.mappings.map(function(t){return t.get("key")})),e=e?e[0]:t[0]||"",t=_.isString(e)?this.viewState.getByPath(e):"";this.mappings.add({key:e,value:this.getValue(e),viewstate:t||""})},Li.prototype.cleanUp=function(){this.stopListening(),this.mappings.reset(),this.setSubscription()},Li.prototype.generateValues=function(){this.mappings.each(function(t){t.set("value",this.getValue(t.get("key")))}.bind(this))},Li.prototype.getColumns=function(){return this.columns||[]},Li.prototype.getPossibleKeys=function(){return this.data?_.keys(this.data):[]},Li.prototype.getValue=function(t){return this.data?this.data[t]:void 0},Li.prototype.onData=function(t,e,n){var i,o=this.model.get("key"),s=this.model.get("value"),a={},r=[],l=this.mappings.reduce(function(t,e){return t[e.get("key")]=e.get("viewstate"),t},{}),u=e.cols?e.cols[o]?e.cols[o].length:0:(i=e.collection.models.map(function(t){return t.attributes})).length;this.columns=t.columns.collection.map("id"),this.columns.length&&!_.isEqual(this.columns,["unknown0"])&&(this.model.get("key")&&_.includes(this.columns,this.model.get("key"))||this.model.set("key",(_.intersection(this.columns,["k","Key","key"])||[])[0]||this.columns[0]||""),this.model.get("value")&&_.includes(this.columns,this.model.get("value"))||this.model.set("value",(_.intersection(this.columns,["v","Val","val"])||[])[0]||this.columns[1]||""));for(var c=0;c<u;c++){var p=i?i[c][o]:e.cols[o].getValue(c);a[p]=i?Ln.Tools.convertKDBToViewstateValue(i[c][s]):(e.cols[s]&&e.cols[s].toViewState(c)||{}).value,r.push({Key:p,Viewstate:l[p]})}this.data=a,this.trigger("on-data"),_.each(r,function(t){var e=t.Key,e=a[e],t=_.isString(t.Viewstate)?this.viewState.getByPath(t.Viewstate):t.Viewstate&&t.Viewstate.path?this.viewState.getByPath(t.Viewstate.path):null;_.isObject(e)&&_.each(e,function(t){t&&t._type&&(t.type=t._type,delete t._type)}),t&&_.isFunction(t.set)&&!_.isUndefined(e)&&t.setModelValue(e)}.bind(this))},Li.prototype.onMappingItemKeyChange=function(t){t.set("value",this.getValue(t.get("key"))),this.setDataModel()},Li.prototype.onMappingItemViewStateChange=function(){this.setDataModel()},Li.prototype.onMappingKeyChange=function(){this.generateValues(),this.setDataModel(),this.trigger("key-change")},Li.prototype.onMappingsCollectionChange=function(){this.setSubscription(),this.setDataModel(),this.trigger("mappings-change")},Li.prototype.onMappingValueChange=function(){this.generateValues(),this.setDataModel(),this.trigger("value-change")},Li.prototype.removeMapping=function(t){this.mappings.remove(t)},Li.prototype.resetMappings=function(){var e=this;this.mappings.reset(_.map(this.getPossibleKeys(),function(t){return new m.Model({key:t,value:e.getValue(t),viewstate:""})})),this.onMappingsCollectionChange()},Li.prototype.setDataModel=function(){this.setDataModelMappings(this.toJSON())},Li.prototype.setSubscription=function(t){this.mappings.isEmpty()&&!t?this.subscribed&&(this.subscribed=!1,this.unsubscribe(this.subscriptionKey)):this.subscribed||(this.subscribed=!0,this.subscribe(this.subscriptionKey,{onData:this.onData.bind(this)}))},Li.prototype.toJSON=function(){return{key:this.model.get("key"),mappings:this.mappings.reduce(function(t,e){var n=e.get("key"),e=e.get("viewstate");return e instanceof Ln.DocumentViewModel?t[n]={_dashboardsType:"viewstate",value:e.path}:t[n]=e,t},{}),value:this.model.get("value")}},Ln.DataMapper=Li,Be=A=A||{},Vi.prototype.assign=function(t){this.collection=t},Vi.prototype.items=function(){return this.reset||_.map(this.collection.models,function(t){return t.attributes})},Be.ChangeSet=Vi;var Oi=A=A||{},Bi={1212:!0,1213:!0,1214:!0,1215:!0,1216:!0,1217:!0,1218:!0,1219:!0};function Ri(t,e,n){if(null!=t){var i,o;for(o in"object"==typeof t?(i=t,0):(i={})[t]=e,this.changed={},i){var s=this.attributes[o];e=i[o],(s&&e&&"object"==typeof s&&"object"==typeof e?Bi[s.class]&&Bi[e.class]?s.i===e.i&&s.n===e.n:_.isEqual(s,e):s==e)||(this.attributes[o]=this.changed[o]=e)}this.idAttribute in i&&(this.id=this.get(this.idAttribute))}return this}function $i(){return!!this.hasChanged()&&this.changed}function C(t){this.breakdownColumns=[],this.columns=new m.Collection,this.columnDict={},this.preferBackground=!1,this.breakdownColumns=[],this.agent=t.agent,this.collection=new t.collectionFunc,this.collectionFunc=t.collectionFunc,this.collection.model.prototype.set=Ri,this.collection.model.prototype.changedAttributes=$i,this.idAttribute=t.idAttribute,this.maxRows=t.maxRows||100,this.primaryKey=t.primaryKey||C.DEFAULT_ROW_INDEX,this.lazyLoading=t.lazyLoading||!1}function Ui(t){this.breakdownColumns=[],this.columns=new m.Collection,this.columnDict={},this.breakdownColumns=[],this.agent=t.agent,this.idAttribute=t.idAttribute,this.maxRows=Number(t.maxRows||100),this.primaryKey=t.primaryKey||Vn.DataSet.DEFAULT_ROW_INDEX}m.Model,C.columnsToCollection=function(t){var e=new m.Collection;return e.models=t.map(function(t){var e=new m.Model;return e.id=t.id,e.attributes=t,e}),e.length=t.length,e},C.updateColumns=function(e,t,n,i){var s=[],a=[],o=t.columns||[],t=[];return i||_.isEmpty(e)?(e={},o.forEach(function(t){return e[t.id]=t}),n.reset=o):(o.forEach(function(t){var n,i,o=e[t.id];o?(i=!(n={}),_.each(t,function(t,e){o[e]!==t&&(i=!0,n[e]=t)}),i&&a.push(_.extend(n,{id:t.id}))):s.push(t)}),(t=(i=_.values(e)).length+s.length>o.length?_.reject(i,function(e){return _.find(o,function(t){return t.id===e.id})}):t).forEach(function(t){return delete e[t.id]}),s.forEach(function(t){return e[t.id]=t}),s.length&&(n.add=s),a.length&&(n.change=a),t&&t.length&&(n.remove=t)),e},C.prototype.addOrExtendExisting=function(t,e,n){var i=t[e=_.isObject(e)?e.toString():e];return i?(_.extend(i,n),!1):(t[e]=n,!0)},C.prototype.addSubscribeFunctions=function(t){var e=this;return t.forEach(function(t){var n=e.collection.get(t[e.primaryKey]);n&&(n.subscribe&&(t.subscribe=function(t,e){n.subscribe(t,e)}),n.unsubscribe)&&(t.unsubscribe=function(t){n.unsubscribe(t)})}),t},C.prototype.background=function(){this.preferBackground=!0},C.prototype.cleanUp=function(){this.columnDict={},this.columns=C.columnsToCollection([]),this.collection.reset(),this.visibilityChangeHandler&&document.removeEventListener("visibilitychange",this.visibilityChangeHandler)},C.prototype.flushUpdates=function(){this.tempDataSet&&(this.onDataInternal({breakdownColumns:this.tempDataSet.breakdownColumns,columns:_.values(this.tempDataSet.columnDict),paging:this.tempDataSet.pagingMeta},this.tempDataSet.collection.models.map(function(t){return t.attributes}),this.tempDataSet.forceReset),delete this.tempDataSet,this.preferBackground=!1)},C.prototype.indexArray=function(t){var e,n;if(this.lazyLoading)for(n=this.pagingMeta.startRows,e=0;e<t.length;e+=1,n+=1)t[e][C.DEFAULT_ROW_INDEX]=n;else for(e=0;e<t.length;e+=1)t[e][C.DEFAULT_ROW_INDEX]=e},C.prototype.isBackground=function(){return!this.noBackground&&(this.preferBackground||document.hidden&&!("FSBL"in window))},C.prototype.isEmpty=function(){return!(this.collection&&this.collection.models&&this.collection.models.length)&&(!this.tempDataSet||this.tempDataSet.isEmpty())},C.prototype.mergeData=function(t,e,n,i){var o,s,a,r,l,u=this,c={},p={},d=[],h=[];if(u.primaryKey===C.DEFAULT_ROW_INDEX&&u.indexArray(t),0===u.collection.length&&0<t.length)t.forEach(function(t){_.isNull(t[u.primaryKey])&&(t[u.primaryKey]=""),d.push(t)}),n.reset=d,u.collection.model&&u.collection.model.prototype.defaults?u.collection.reset(d):u.collection.reset(d.map(function(t){var e=new u.collection.model;return e.attributes=t,e.idAttribute in t&&(e.id=t[e.idAttribute]),e})),u.addSubscribeFunctions(d);else{for(o=0;o<t.length;o+=1)_.isNull(t[o][u.primaryKey])&&(t[o][u.primaryKey]=""),s=t[o][u.primaryKey],s=_.isObject(s)?s.toString():s,!c[s]&&u.collection.get(s)?u.addOrExtendExisting(p,s,t[o]):u.addOrExtendExisting(c,s,t[o])&&d.push(t[o]);l=[],e?l=u.collection.filter(function(t){return s=t.get(u.primaryKey),!(_.has(p,s)||_.has(c,s))}):(r=u.collection.length+d.length,(r-=(l=r>u.maxRows?u.collection.models.slice(0,r-u.maxRows):l).length)>u.maxRows&&(d=d.slice(r-u.maxRows))),l.length&&(u.collection.remove(l),i||(n.remove=_.map(l,function(t){return t.attributes}))),_.each(p,function(t){s=t[u.primaryKey],(a=u.collection.get(s))&&(a.set(t),i||(t=a.changedAttributes())&&(t[u.primaryKey]=s,h.push(t)))}),u.collection.add(d),u.addSubscribeFunctions(d),i||(d.length&&(n.add=d),h.length&&(n.change=h),e&&0===t.length&&!(n.add||n.change||n.remove)&&(n.reset=[]))}},C.prototype.onData=function(t,e,n,i,o){this.isBackground()?(this.tempDataSet||(this.tempDataSet=new C({idAttribute:this.idAttribute,collectionFunc:this.collectionFunc,agent:new Oi.Agent,maxRows:this.maxRows,primaryKey:this.primaryKey}),this.tempDataSet.forceReset=!1),this.tempDataSet.onDataInternal(t,e,n,i,void 0,!0),n&&(this.tempDataSet.forceReset=!0)):this.onDataInternal(t,e,n,i,o)},C.prototype.onDataInternal=function(t,e,n,i,o,s){var a,r=new Oi.ChangeSet(this.collection),l=new Oi.ChangeSet(void 0);t&&(_.isUndefined(t.breakdownColumns)||(this.breakdownColumns=t.breakdownColumns),this.columnDict=C.updateColumns(this.columnDict,t,l,s),l.remove)&&(a=l.remove.map(function(t){return t.id}),this.collection.models.forEach(function(e){a.forEach(function(t){delete e.attributes[t],delete e.changed[t]})})),this.pagingMeta=t.paging,e&&(this.mergeData(e,n,r,s),Oi.Log.Info("Data: "+this.updateSetCountToString(r,this.collection.models))),s||(t={primaryKey:this.primaryKey,columns:l},e=i||void 0,this.pagingMeta&&(t.paging=this.pagingMeta),_.isArray(this.breakdownColumns)&&(t.breakdownColumns=this.breakdownColumns,t.breakdownColumns instanceof m.Model)&&(t.breakdownColumns=t.breakdownColumns.get("value")),o&&o.trigger("onAgentNotify"),t.columns.assign(this.columns=C.columnsToCollection(_.values(this.columnDict))),this.agent.notifyAllLegacyChange(t,r,e,o))},C.prototype.onDataRefresh=function(t){var e=_.values(this.columnDict),n=new Oi.ChangeSet(this.collection),i=new Oi.ChangeSet(this.columns),o={};i.reset=e,o={primaryKey:this.primaryKey,columns:i},_.isArray(this.breakdownColumns)&&(o.breakdownColumns=this.breakdownColumns,o.breakdownColumns instanceof m.Model)&&(o.breakdownColumns=o.breakdownColumns.get("value")),this.pagingMeta&&(o.paging=this.pagingMeta),n.reset=this.addSubscribeFunctions(this.collection.map(function(t){return t.attributes})),t?this.agent.notifyChange(t,o,n):this.agent.notifyAllLegacyChange(o,n)},C.prototype.updateSetCountToString=function(t,e){return(t.add?" +"+t.add.length:"")+(t.remove?" -"+t.remove.length:"")+(t.change?" ~"+t.change.length:"")+(t.reset?" ="+t.reset.length:"")+" ==>"+e.length},C.DEFAULT_ROW_INDEX="_rowIndex",Oi.DataSet=C,Vn=A=A||{},Ui.prototype.cleanUp=function(){this.columnDict={},this.columns=Vn.DataSet.columnsToCollection([]),this.cols=void 0},Ui.prototype.indexArray=function(t){for(var e=0;e<t.length;e+=1)t[e][Vn.DataSet.DEFAULT_ROW_INDEX]=e},Ui.prototype.isEmpty=function(){var t=Object.keys(this.columnDict);return!this.cols||0==t.length||!this.cols[t[0]]||0==this.cols[t[0]].length},Ui.prototype.onData=function(t,e,n,i,o){var s,a,r=this,l=new Vn.ChangeSet(this.collection),u=new Vn.ChangeSet(void 0),c={},i=i||void 0;t&&(_.isUndefined(t.breakdownColumns)||(this.breakdownColumns=t.breakdownColumns),this.columnDict=Vn.DataSet.updateColumns(this.columnDict,t,u)),c={primaryKey:this.primaryKey,columns:u},this.pagingMeta=t.paging,this.pagingMeta&&(c.paging=this.pagingMeta),_.isArray(this.breakdownColumns)&&(c.breakdownColumns=this.breakdownColumns,c.breakdownColumns instanceof m.Model)&&(c.breakdownColumns=c.breakdownColumns.get("value")),n||!this.cols?this.cols=e:null==this.primaryKey||"_rowIndex"===this.primaryKey?_.each(e,function(t,e){var n=r.cols[e];n&&(t.length<n.length?t.qtype!==n.qtype?Vn.Log.Error("Column '"+e+"': meta mis-match - cannot merge kdb type "+t.qtype+" -> "+n.qtype):n.mergeIndexed(t):r.cols[e]=t)}):(t=this.cols[this.primaryKey],e[this.primaryKey]&&e[this.primaryKey].length>=this.maxRows?this.cols=e:(n=e[this.primaryKey],a=t.mergeKeyedPrimary(n,this.maxRows,s=[]),t.length===this.maxRows&&t.findIndex&&t.findIndex(n.hash(0))>=this.maxRows-n.length&&(l.keyCol=n),_.each(e,function(t,e){var n;e!==r.primaryKey&&((n=r.cols[e])?n.mergeKeyed(t,s,a,r.maxRows):r.cols[e]=t)}))),l.cols=this.cols,u.assign(this.columns=Vn.DataSet.columnsToCollection(_.values(this.columnDict))),this.agent.notifyAllRawChange(c,l,i,o)},Ui.prototype.onDataRefresh=function(t){var e=_.values(this.columnDict),n=new Vn.ChangeSet(this.collection),i=new Vn.ChangeSet(this.columns),e=(i.reset=e,{primaryKey:this.primaryKey,columns:i});_.isArray(this.breakdownColumns)&&(e.breakdownColumns=this.breakdownColumns,e.breakdownColumns instanceof m.Model)&&(e.breakdownColumns=e.breakdownColumns.get("value")),this.pagingMeta&&(e.paging=this.pagingMeta),n.cols=this.cols,t?this.agent.notifyChange(t,e,n):this.agent.notifyAllRawChange(e,n)},Ui.prototype.updateSetCountToString=function(t,e){return(t.add?" +"+t.add.length:"")+(t.remove?" -"+t.remove.length:"")+(t.change?" ~"+t.change.length:"")+(t.reset?" ="+t.reset.length:"")+" ==>"+e.length},Vn.DataSet2=Ui,(A||(A={})).LegacyUpdate=function(t,e,n,i){this.table=t,this.forceReset=e,this.pagingMeta=n,this.pivotMeta=i},(A||(A={})).ViewStateBinding=function(t,e){this.callback=t,this.model=e},m.emulateHTTP=!0;var $e=A=A||{};Fi=m.Model,e(Hi,Fi),Hi.prototype.defaults=function(){return{name:"default",type:"q",host:"localhost",port:"80",tls:"false",user:"",password:""}};var Fi,qi,Yi=Hi;function Hi(){return null!==Fi&&Fi.apply(this,arguments)||this}function Ki(){var t=null!==qi&&qi.apply(this,arguments)||this;return t.model=Yi,t}function zi(t){var e=Bn.call(this,t)||this;return e.options=t,e.setSchema(),e}function Qi(e){var n,t=Un.call(this,e)||this,i=t.get("children");return i&&!_.isArray(i)||(n=new m.Collection,_.each(i||[],function(t){_.extend(t,{appModel:e.appModel}),t=new(t.hasOwnProperty("children")?Qi:$n.RuleModel)(t),n.add(t)}),t.set("children",n)),0<t.get("children").length&&t.set("active",!0,{silent:!0}),t.listenTo(t.get("children"),"add remove reset change",function(){0<t.get("children").filter(function(t){return t.get("active")}).length?t.set("active",!0):t.set("active",!1),t.trigger("change")}),t}function Wi(){return null!==Yn&&Yn.apply(this,arguments)||this}function ji(t){this.id=t.id,this.group=t.group,t.meta&&(this.meta=t.meta),"result"!==this.group&&(this.data=t.data||{})}function Gi(){return null!==Wn&&Wn.apply(this,arguments)||this}function Xi(){return null!==Gn&&Gn.apply(this,arguments)||this}function Zi(){return null!==Jn&&Jn.apply(this,arguments)||this}function Ji(t){t=ei.call(this,t)||this;return _.isEmpty(t.data)&&(t.data={fn:"lj",swap:!1,left:[],right:[]}),t}function to(){return null!==ii&&ii.apply(this,arguments)||this}function eo(){return null!==ai&&ai.apply(this,arguments)||this}function no(){var t=null!==ui&&ui.apply(this,arguments)||this;return t.docDataModel=null,t.bindingParams=[],t}function D(t,e,n,i,o,s){var a=ci.call(this,t)||this,r=(a.agent=new y.Agent,a.callbacks=[],a.dataMapper=null,a.dataSet=null,a.dataSet2=null,a.forceInternalReset=!1,a.isClone=!1,a.isDirty=!1,a.isPending=!1,a.legacyFlushTime=0,a.consolidateCount=0,a.dataExecuteSuccessCount=0,a.onExecuteBeginCount=0,a.durationMovingAverage=D.FAST_THRESHOLD,a.paramChanged=[],a.parameterModels=[],a.performance=new y.PerformanceMetrics,a.pollingEvent=null,a.subscriptionId=null,a.subscriptionTypes=["polling","subscription","streaming"],a.viewStateBindings={},a.virtualSubscriptions={},[]);return a.root=e||a,a.path=n,a.viewState=i,a.group=o,a.virtualSubscriptions=s||{},a.group&&(a.unset("_pagingType",{silent:!0}),a.unset(D.AUTO_EXECUTE,{silent:!0})),a.get("_queryString")||!a.get("_pivotQuery")&&!a.get("_table")||(a.set("_queryString",a.get("_pivotQuery")||"select from "+a.get("_table")),a.unset("_pivotQuery"),a.unset("_table")),_.keys(a.attributes).forEach(function(t){var e,n=a.get(t);_.isArray(n)||!_.isObject(n)||n instanceof m.Model||(n._dataType?("copy"===n._dataType&&(n._dataType="query"),_.includes(["api","analytic","streaming","pivot","query","virtual","builder","sql"],n._dataType)?(e=new D(n,a.root,a.path?a.path+"/"+t:t,a.viewState),r.push(e),a.set(t,e,{silent:!0}),a.listenTo(e,"materialChange",a.onMaterialChange)):y.Log.Error(a.logPrefix()+" unsupported datatype: ",n._dataType)):"viewstate"===n._dashboardsType?(e=a.viewState.getByPath(n.value),a.set(t,e,{silent:!0})):_.includes(["_analyticParams","_mappings","_pageSort"],t)||n instanceof m.Model&&n.get("_viewType")||(e=new D(n,a.root,a.path?a.path+"/"+t:t,a.viewState,!0),a.set(t,e,{silent:!0}),a.listenTo(e,"change",function(){return a.trigger("change",a)}),a.listenTo(e,"materialChange",a.onMaterialChange)))}),a.has("_pagingNum")&&a.set("_pagingNum",0,{silent:!0}),a.has("_pageSort")&&a.set("_pageSort",{},{silent:!0}),a.debouncedParameterChange=_.throttle(a.applyParameterChange.bind(a),60,{leading:!1}),a.listenTo(a,"change",a.onModelChange),a}function io(){}function M(t,e,n){t=hi.call(this,t,e,n)||this;return t.MATERIAL_ATTRIBUTES=["_type","_default"],t.withAllProperties=!1,e&&(e.path&&(t.path=e.path),t.root=!0===e.root?t:e.root),_.each(_.keys(t.attributes),function(t){var e,n=this.get(t);if(_.isObject(n)&&-1===["_default","value",".settings"].indexOf(t))e=new M(n,{path:this.path?this.path+"/"+t:t,root:this.root},this),this.set(t,e,{silent:!0}),this.listenTo(e,"change",this.onChildModelChange),this.listenTo(e,"materialChange",this.onMaterialChange);else if(".settings"===t){if(!(n instanceof m.Model)){for(var i in n)n.hasOwnProperty(i)&&(n[i]=new m.Model(n[i]));this.set(t,new m.Model(n))}}else this.set(t,n),"_default"===t&&(this.get("_rolling")?this.set("value",di.Helpers.convertRollingToDate(n,this.get("_type"))):this.set("value",n))}.bind(t)),_.has(t.attributes,"_default")&&_.has(t.attributes,"value")&&(t.attributes._type=t.attributes._type||"symbol",t.schema={_type:{type:"Select",options:["boolean","byte","char","date","datetime","dict","double","float","guid","int","list","long","minute","month","second","short","string","symbol","time","timespan","timestamp"]}},t.updateSchema()),t.listenTo(t,"change",t.onChange),t}($e.Connection=Yi).prototype.idAttribute="name",qi=m.Collection,e(Ki,qi),$e.ConnectionCollection=Ki,On=A=A||{},n=On.DataFilter||(On.DataFilter={}),Bn=m.Model,e(zi,Bn),zi.prototype.defaults=function(){return{propertyName:null,propertyType:null,operator:null,value:null,value2:null,active:!0,type:"normal",compareFields:!1}},zi.prototype.getBindingValue=function(e){var t=_.find(this.get("appModel").get("settingsModel").get("Bindings"),function(t){return t.Key===e});return t&&t.ViewState instanceof On.DocumentViewModel?t.ViewState.get("value"):""},zi.prototype.getTypeOperators=function(t){void 0===t&&(t=null);function e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];_.each(t,function(t){return n.push.apply(n,t)})}var n=[],i={equal:[{label:"equal",val:"equal"},{label:"not equal",val:"not_equal"}],like:[{label:"like",val:"like"},{label:"not like",val:"not_like"}],blank:[{label:"is blank",val:"is_blank"},{label:"is not blank",val:"is_not_blank"}],compare:[{label:"less",val:"less"},{label:"less or equal",val:"less_or_equal"},{label:"greater",val:"greater"},{label:"greater or equal",val:"greater_or_equal"}],in:[{label:"in",val:"in"},{label:"not in",val:"not_in"}]};switch(this.get("compareFields")&&(i.like=i.blank=i.in=[]),e(i.equal),t){case 0:e(i.like,i.blank);break;case 5:case 6:case 7:case 8:case 9:case 4:e(i.compare,i.blank,i.in);break;case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:e(i.compare,i.blank);break;case 11:e(i.in,i.like,i.blank);break;case 2:e(i.in,i.blank);break;case 10:case 1:e(i.blank)}return n},zi.prototype.replaceBindings=function(t){var e=this;return _.isString(t)&&this.get("appModel").get("Bindings")?t.replace(zi.VSRx,function(t){t=t.substring(2,t.length-2);return e.getBindingValue(t)}):t},zi.prototype.setSchema=function(){var n,t,i,o,e,s=this,a=this.get("propertyType");"histogram"===this.get("type")?(n=[5,6,7,8,9,12,13,14,15,16,17,18,19],t=this.options.appModel.get("data.items").filter(function(t,e){return _.includes(n,s.options.appModel.get("data.meta.columns.models")[e].get("kdbType"))}).map(function(t){return{label:t.get("propertyName"),val:t.get("propertyName")}}),this.schema={active:{title:"Is Active:",type:"Checkbox"},propertyName:{title:"Property:",type:"Select",options:_.sortBy(t,"label")},value:_.extend({title:"From"},On.RTTI.getByQTypeNum(a||11).editor),value2:_.extend({title:"To"},On.RTTI.getByQTypeNum(a||11).editor)}):(t=this.options.appModel.get("data.items").map(function(t){return{label:t.get("propertyName"),val:t.get("propertyName")}}),this.schema={active:{title:"Is Active:",type:"Checkbox"},propertyName:{title:"Property:",type:"Select",options:_.sortBy(t,"label")},operator:{title:"Operator:",type:"Select",options:this.getTypeOperators(a)},value:_.extend({title:"Value"},On.RTTI.getByQTypeNum(a||11).editor)}),this.get("compareFields")?this.schema.value={title:"Value",type:"Select"}:this.get("operator")&&this.get("propertyName")&&_.some(["in","not_in","equal","not_equal","greater","less","greater_or_equal","less_or_equal"],function(t){return t===s.get("operator")})&&(t=this.options.appModel.get("data.items").get(this.get("propertyName")),a=0<=_.indexOf(["equal","not_equal","greater","less","greater_or_equal","less_or_equal"],this.get("operator")),t)&&(e=null,t.get("result")&&t.get("result").data?(i=t.get("DataSourceMapping.Text")||this.get("propertyName"),o=t.get("DataSourceMapping.Value")||this.get("propertyName"),e=t.get("result").data.collection.map(function(t){var e=t.get(i),t=t.get(o);return{label:_.isBoolean(e)?e+"":e,val:_.isBoolean(t)?t+"":t}}),(e=_.uniqBy(_.reject(e,function(t){return _.isNil(t.label)}),function(t){return t.label})).length<=0&&this.get("value")&&_.isArray(this.get("value"))&&0<this.get("value").length&&_.each(this.get("value"),function(t){e.push({label:t,val:t})}),e.splice(0,0,{label:"",val:""}),this.schema.value={title:"Value",type:a?"Select":"MultiSelect",options:e,modelKey:"value"}):0<t.get("items").length?((e=_.map(t.get("items"),function(t){return{label:t.Text,val:t.Value}})).splice(0,0,{label:"",val:""}),this.schema.value={title:"Value",type:a?"Select":"MultiSelect",options:e,modelKey:"value"}):a||(this.schema.value=_.extend({title:"Value"},On.RTTI.getByQTypeNum(0).editor)))},zi.prototype.isValueValid=function(t){return!!_.includes(["is_not_blank","is_blank"],this.get("operator"))||!(_.isUndefined(t)||_.isNull(t)||""===t)},zi.prototype.toJSON=function(){var t="histogram"===this.get("type")?_.pick(this.attributes,"propertyName","propertyType","value","value2","active","type"):_.pick(this.attributes,"propertyName","propertyType","operator","value","active","type","compareFields");return null===t.propertyType&&(t.propertyType=11),t},zi.prototype.toIPC=function(){return"histogram"===this.get("type")?this.toIPCHistogram():this.toIPCNormal()},zi.prototype.toIPCHistogram=function(){var t=new Uint8Array([102,5]),e=[],n=this.get("propertyName"),i=this.get("propertyType"),o=7===i?Math.ceil(this.get("value")):this.get("value"),s="greater_or_equal",i=7===i?Math.floor(this.get("value2")):this.get("value2"),a="less_or_equal";return this.get("active")&&n&&this.isValueValid(o)&&this.isValueValid(i)?(e.push(this.toIPCNormal(n,s,o)),e.push(this.toIPCNormal(n,a,i)),On.ipc.List.toIPC([t].concat(e))):null},zi.prototype.toIPCNormal=function(t,e,n){var i=this,o=(void 0===e&&(e=null),void 0===n&&(n=null),t=(t=void 0===t?null:t)||this.get("propertyName"),e=e||this.get("operator"),n=this.replaceBindings(n||this.get("value")),-this.get("propertyType")||10);return this.get("active")&&t&&e&&this.isValueValid(n)?(t=On.ipc.Util.getType(o),n=this.get("compareFields")&&n===this.get("value")?On.ipc.Symbol.toIPC(n):"in"===e||"not_in"===e?(_.isArray(n)||(n=null===n?[]:[n]),t.listToIPC(_.map(n,function(t){return i.typeCast(t)}))):(-1===o&&_.isString(n)&&(n="true"===n),t.toIPC(On.ipc.fromString(t,n))),On.ipc.Dict.toIPC(["src","comparison","value","dataType","compareFields"],On.ipc.List.toIPC(_.map([this.get("propertyName"),e],function(t){return On.ipc.Symbol.toIPC(t)}).concat([n,On.ipc.Short.toIPC(o),On.ipc.Boolean.toIPC(this.get("compareFields"))])))):null},zi.prototype.toKDB=function(){var t,e;return this.get("active")&&this.get("propertyName")&&this.get("operator")&&this.isValueValid(this.get("value"))?(e="in"===this.get("operator")||"not_in"===this.get("operator")?(t=On.RTTI.getByQTypeNum(0),e=this.get("value"),t.toKDBInput(e)):(t=On.RTTI.getByQTypeNum(this.get("propertyType")||11)).toKDBInput(this.get("value")),"(`src`comparison`value!(`"+this.get("propertyName")+";`"+this.get("operator")+";"+e+"))"):null},zi.prototype.typeCast=function(t){switch(this.get("propertyType")){case 4:case 5:case 6:case 7:case 8:case 9:if(!_.isNaN(Number(t)))return Number(t)}return null!==t?""+t:""},zi.prototype.validate=function(t,e){var n,t=isNaN(t)||isNaN(e)?(n=p(t),p(e)):(n=new Number(t),new Number(e));return t<=n},zi.VSRx=/^<%[^<>%]*%>$/i,n.RuleModel=zi,Rn=A=A||{},$n=Rn.DataFilter||(Rn.DataFilter={}),Un=m.Model,e(Qi,Un),Qi.prototype.defaults=function(){return{children:new m.Collection,operator:"AND",active:!1}},Qi.prototype.isNull=function(){return _.every(this.get("children").filter(function(t){return t.get("active")}),function(t){return t instanceof Qi?t.isNull():_.isNull(t.toIPC())})},Qi.prototype.toJSON=function(){return{operator:this.get("operator"),children:this.get("children").toJSON()}},Qi.prototype.toIPC=function(){var e,n=new Array,t=this.get("children").filter(function(t){return t.get("active")}),t=(0<t.length&&_.each(t,function(t){(e=t instanceof Qi&&t.isNull()?null:t.toIPC())&&n.push(e)}),new Uint8Array([102,"AND"===this.get("operator")?5:6]));return Rn.ipc.List.toIPC([t].concat(n))},Qi.prototype.toKDB=function(){var e,t="("+this.get("operator")+";",n=[];return!(0<this.get("children").length)||(this.get("children").each(function(t){(e=t.toKDB())&&n.push(e)}),n.length<=0)?null:(t+=n.join(";"))+")"},$n.GroupModel=Qi,Fn=A=A||{},qn=Fn.DataFilter||(Fn.DataFilter={}),Yn=m.View,e(Wi,Yn),Wi.generateIpcHexMessage=function(t){t=new qn.GroupModel(_.extend({appModel:new m.DeepModel({"data.items":new m.Collection})},t));return Fn.ipc.Util.toHexString(Fn.ipc.Util.toMessage(t.toIPC()))},qn.App=Wi,Hn=A=A||{},Kn=Hn.QueryBuilder||(Hn.QueryBuilder={}),ji.getBindingKeysFromArray=function(t,e){return t.concat(_.filter(e,function(t){return _.isString(t)&&ji.VSRx.exec(t)}).map(function(t){return t.substring(2,t.length-2)}))},ji.getActiveBindingKeys=function(t){return[]},ji.replaceAllBindings=function(t,e){void 0===e&&(e="value"),_.each(t,function(t){!t[e]&&t.children?ji.replaceAllBindings(t.children):t[e]="string"==typeof t[e]&&ji.VSRx.test(t[e])?ji.replaceBindings(t[e]):t[e]})},ji.replaceBindings=function(t){var e,t=t.substring(2,t.length-2);return ji.viewModel?(e=ji.viewModel.getByPath(t))&&e.get("value"):ji.bindings[t]},ji.replaceKeys=function(t){var o=this,s=!1;_.each(t,function(t,e,n){var i;ji.VSRx.exec(e)&&(i=e.replace(ji.VSRx,ji.replaceBindings.bind(o)),s=!0),s&&(delete n[e],n[i||e]=t)})},ji.prototype.toIPC=function(){return Hn.ipc.Dict.toIPC(["type","data"],Hn.ipc.List.toIPC([Hn.ipc.Symbol.toIPC(this.group),Kn.App.groupToClass[this.group].dataToIPC(this.data)]))},ji.bindings={},ji.VSRx=/^<%[^<>%]*%>$/i,Kn.GraphNode=ji,zn=A=A||{},Qn=zn.QueryBuilder||(zn.QueryBuilder={}),Wn=Qn.GraphNode,e(Gi,Wn),Gi.partitionParameterToIPC=function(t,e){return t instanceof Array?zn.ipc.List.toIPC(t.map(function(t){return e.toIPC(zn.ipc.fromString(e,""+t))})):e.toIPC(zn.ipc.fromString(e,""+t))},Gi.dataToIPC=function(t){var e,n;return(t=Gi.processBindings(t)).name&&t.params?zn.ipc.List.toIPC([zn.ipc.Symbol.toIPC(t.name)].concat(Gi.recursiveToIPC(t.params))):t.name&&t.partition?(n=zn.RTTI.getByName(t.partition.type).num,e=zn.ipc.Util.getType("-"+n),n="equals"===t.partition.operator?8:"in"===t.partition.operator?23:24,zn.ipc.Dict.toIPC(["table","operator","type","values"],zn.ipc.List.toIPC([zn.ipc.Symbol.toIPC(t.partition.name),new Uint8Array([102,n]),zn.ipc.Symbol.toIPC("long"===t.partition.type?"year":t.partition.type),1<t.partition.parameters.length?zn.ipc.List.toIPC(t.partition.parameters.map(function(t){return Gi.partitionParameterToIPC(t.value,e)})):Gi.partitionParameterToIPC(t.partition.parameters[0].value,e)]))):zn.ipc.QString.toIPC(t)},Gi.processBindings=function(t){return(t=_.cloneDeep(t))&&t.params?Gi.replaceAllBindings(t.params):t&&t.partition&&Gi.replaceAllBindings(t.partition.parameters),t},Gi.getActiveBindingKeys=function(t){return t.params?t.params.filter(function(t){return!!_.isString(t.value)&&Qn.GraphNode.VSRx.exec(t.value)}).map(function(t){return t.value.substring(2,t.value.length-2)}):[]},Gi.recursiveToIPC=function(t){return _.flatten(_.map(t,function(t){var e=zn.RTTI.getByName("list"===t.type?"List":t.type),n=e?e.num:11;return 98===n?Gi.recursiveToIPC(t.value):(7===n&&""===t.value&&(t.value="0"),e=zn.ipc.Util.getType(0<n?"-"+n:""+n)||zn.ipc.Util.getType("-11"),0===n&&t.value instanceof Array?e.toIPC(t.value.map(function(t){return zn.ipc.Symbol.toIPC(t)})):e.toIPC(zn.ipc.fromString(e,t.value)))}))},Qn.DataNode=Gi,jn=A=A||{},s=jn.QueryBuilder||(jn.QueryBuilder={}),Gn=s.GraphNode,e(Xi,Gn),Xi.dataToIPC=function(t){return t=Xi.processBindings(t),jn.ipc.Dict.toIPC(["select","where","distinct"],jn.ipc.List.toIPC([jn.ipc.Dict.toIPC(_.keys(t.select),jn.ipc.Symbol.listToIPC(_.values(t.select))),jn.ipc.Util.fromHexString(jn.DataFilter.App.generateIpcHexMessage(t.where).slice(16)),jn.ipc.Boolean.toIPC(t.distinct)]))},Xi.getActiveBindingKeys=function(t){var e=[];return _.each(t.where.children,function(t){return e=Xi.getBindingKeysFromArray(e,_.keys(t))}),Xi.getBindingKeysFromArray(e,_.keys(t.select))},Xi.processBindings=function(t){return t=_.cloneDeep(t),this.replaceAllBindings(t.where.children),this.replaceKeys(t.select),t},Xi.operatorMap={AND:" and ",OR:" or ",equal:"=",in:" in ",like:" like ",greater_or_equal:">=",less:"<",less_or_equal:"<=",greater:">",is_blank:" is blank",not_equal:"!=",not_in:" not in ",not_like:" not like ",is_not_blank:" is not blank"},s.FilterNode=Xi,Xn=A=A||{},Zn=Xn.QueryBuilder||(Xn.QueryBuilder={}),Jn=Zn.GraphNode,e(Zi,Jn),Zi.dataToIPC=function(t){return t=Zi.processBindings(t),Xn.ipc.Dict.toIPC(["groupBy","agg"],Xn.ipc.List.toIPC([Xn.ipc.Dict.toIPC(_.keys(t.groupBy),Xn.ipc.List.toIPC(_.values(t.groupBy).map(function(t){return _.isString(t)?Xn.ipc.Symbol.toIPC(t):Xn.ipc.Dict.toIPC(_.keys(t),Xn.ipc.Symbol.listToIPC(_.values(t)))}))),_.isEmpty(t.agg)?Xn.ipc.List.toIPC([]):Xn.ipc.Dict.toIPC(_.keys(t.agg),Xn.ipc.List.toIPC(_.map(_.values(t.agg),function(t){return Xn.ipc.Symbol.listToIPC(t.map(function(t){return String(t)}))})))]))},Zi.getActiveBindingKeys=function(t){return Zi.getBindingKeysFromArray([],_.union(_.keys(t.agg),_.keys(t.groupBy)))},Zi.processBindings=function(t){return t=_.cloneDeep(t),Zn.GraphNode.replaceKeys(t.agg),Zn.GraphNode.replaceKeys(t.groupBy),t},Zn.GroupByNode=Zi,ti=A=A||{},c=ti.QueryBuilder||(ti.QueryBuilder={}),ei=c.GraphNode,e(Ji,ei),Ji.dataToIPC=function(t){return t?ti.ipc.Dict.toIPC(["fn","swap","left","right"],ti.ipc.List.toIPC([ti.ipc.Symbol.toIPC(t.fn),ti.ipc.Boolean.toIPC(t.swap),ti.ipc.List.toIPC(_.map(t.left,function(t){return ti.ipc.Symbol.toIPC(String(t))})),ti.ipc.List.toIPC(_.map(t.right,function(t){return ti.ipc.Symbol.toIPC(String(t))}))])):ti.ipc.Int.toIPC(null)},c.JoinNode=Ji,ni=A=A||{},d=ni.QueryBuilder||(ni.QueryBuilder={}),ii=d.GraphNode,e(to,ii),to.dataToIPC=function(){return ni.ipc.Int.toIPC(null)},d.ResultNode=to,oi=A=A||{},si=oi.QueryBuilder||(oi.QueryBuilder={}),ai=si.GraphNode,e(eo,ai),eo.dataToIPC=function(t){return t=eo.processBindings(t),oi.ipc.Dict.toIPC(["filter","update"],oi.ipc.List.toIPC([oi.ipc.Util.fromHexString(oi.DataFilter.App.generateIpcHexMessage(t.filter).slice(16)),oi.ipc.Dict.toIPC(_.map(t.update,"column"),oi.ipc.List.toIPC(_.map(t.update,function(t){var e=oi.ipc.Util.getType(t.propertyType),e=e.toIPC(oi.ipc.fromString(e,t.val));return-11===t.propertyType?oi.ipc.List.toIPC([e]):e})))]))},eo.getActiveBindingKeys=function(t){var e=[];return _.each(t.filter.children,function(t){return e=eo.getBindingKeysFromArray(e,_.keys(t))}),_.each(t.update,function(t){return e=eo.getBindingKeysFromArray(e,_.values(t))}),e},eo.processBindings=function(t){return t=_.cloneDeep(t),si.GraphNode.replaceAllBindings(t.filter.children),si.GraphNode.replaceAllBindings(t.update,"val"),t},si.UpdateNode=eo,ri=A=A||{},li=ri.QueryBuilder||(ri.QueryBuilder={}),ui=m.View,e(no,ui),no.calculateReverseEdges=function(t){t=_.reduce(t,function(e,t,n){return _.each(t,function(t){void 0===e[t]?e[t]=[n]:e[t].push(n)}),e},{});return _.fromPairs(_.map(t,function(t,e){return[e,_.sortBy(t)]}))},no.createNode=function(t){switch(t.group){case"data":case"function":case"stream":return new li.DataNode(t);case"filter":return new li.FilterNode(t);case"groupBy":return new li.GroupByNode(t);case"join":return new li.JoinNode(t);case"update":return new li.UpdateNode(t);case"result":return new li.ResultNode(t);default:throw"Invalid node "+t}},no.graphToIPC=function(e,n,i){var o=this,s={},a={},r=this.calculateReverseEdges(n),l=function(t){_.extend(s,_.pick(e,t)),t!==i&&_.extend(a,_.pick(n,t)),_.each(r[t],function(t){l(t)})},t=(l(i||"result"),e=s,n=a,ri.ipc.Dict.toIPC(["nodes","edges"],ri.ipc.List.toIPC([ri.ipc.Dict.toIPC(_.keys(e),ri.ipc.List.toIPC(_.values(e).map(function(t){return o.createNode(t).toIPC()}))),ri.ipc.Dict.toIPC(_.keys(r),ri.ipc.List.toIPC(_.values(r).map(function(t){return ri.ipc.List.toIPC(_.sortBy(t).map(function(t){return ri.ipc.Symbol.toIPC(t)}))})))])));return ri.ipc.Util.toHexString(ri.ipc.Util.toMessage(t))},no.prototype.getIPC=function(t,e,n){t=JSON.parse(t);return this.docDataModel=n,t=this.replaceBindingsInGraph(t),no.graphToIPC(t.nodes,t.edges,e)},no.prototype.replaceBindings=function(t){var e=t.substring(2,t.length-2),e=this.docDataModel.getViewState().getByPath(e);return this.bindingParams.push({value:t}),e&&e.get("value")},no.prototype.replaceBindingsInGraph=function(t){var n=this;return this.bindingParams=[],_.values(t.nodes).forEach(function(e){[{type:"params",value:"value",children:null},{type:"filter",value:"value",children:"children"},{type:"where",value:"value",children:"children"},{type:"update",value:"val",children:null}].forEach(function(t){return e.data&&e.data[t.type]&&n.replaceAllBindings(e.data[t.type],t.value,t.children)}),["select","agg","groupBy"].forEach(function(t){return e.data&&e.data[t]&&n.replaceKeys(e.data[t])})}),this.docDataModel.set("_builderParams",this.bindingParams),t},no.prototype.replaceAllBindings=function(t,e,n){var i=this;void 0===e&&(e="value"),void 0===n&&(n=""),_.isEmpty(n)||(t=t[n]),_.each(t,function(t){!t[e]&&t.children?i.replaceAllBindings(t.children):void 0!==t[e]&&(t[e]="string"==typeof t[e]&&no.VSRx.test(t[e])?i.replaceBindings(t[e]):t[e])})},no.prototype.replaceKeys=function(t){var o=this,s=!1;_.each(t,function(t,e,n){var i;no.VSRx.exec(e)&&(i=e.replace(no.VSRx,o.replaceBindings.bind(o)),s=!0),s&&(delete n[e],n[i||e]=t)})},no.groupToClass={data:li.DataNode,function:li.DataNode,stream:li.DataNode,filter:li.FilterNode,update:li.UpdateNode,groupBy:li.GroupByNode,join:li.JoinNode,result:li.ResultNode},no.VSRx=/^<%[^<>%]*%>$/i,li.App=no,y=A=A||{},ci=m.Model,e(D,ci),D.convertDeltaClientColumnSpecToMeta=function(n){return(n.columns||[]).map(function(t,e){return{id:t,index:e,kdbType:n.meta[t]}})},D.convertMetaToDeltaClientColumnSpec=function(t){return{columns:_.map(t,function(t){return t.id}),meta:_.fromPairs(_.map(t,function(t){return[t.id,t.kdbType]}))}},D.prototype.apply=function(){var n=this,i=(this.performance.trigger("apply"),!1),o=!1;if(this.has("error")||this.set("error",null,{silent:!0}),"pivot"===this.get("_dataType")&&this.set({_dataType:"query",_pivotType:"server"},{silent:!0}),this.stop(),this.reset(),this.get("_pivotType"))this.applyPivot();else switch(this.get("_dataType")){case"query":this.applyQuery();break;case"api":o=!0;case"analytic":case"builder":case"streaming":this.applyAnalytic();break;case"copy":this.applyCopy();break;case"virtual":this.applyVirtual(),i=!0;break;case"sql":this.applyQuery()}this.forceInternalReset=!0,i&&this.performance&&this.performance.trigger("serverStart"),this.updateVirtualSubscriptions(),i&&this.performance&&this.performance.trigger("serverEnd"),this.dataMapper=new y.DataMapper({mappings:this.get("_mappings"),setMappings:function(t){n.set("_mappings",t)},subscribe:function(t,e){return n.subscribe(t,e,!(i||o))},unsubscribe:function(t){return n.unsubscribe(t)},viewState:this.viewState}),this.dataMapper.initialize()},D.prototype.applyCopy=function(){var t=this.get("_subscriptionKey")||y.DataSet.DEFAULT_ROW_INDEX;this.dataSet=new y.DataSet({idAttribute:t,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:t})}),agent:this.agent,maxRows:this.get("_maxRows"),primaryKey:t}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),this.isDirty=!1,this.execute=_.noop.bind(this)},D.prototype.applyAnalytic=function(){function t(t,e){o.onExecuteSubscriptionSuccess(t,o.get("_forceReset"),e)}function e(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];o.onError(o,o.attributes,t,"Error",e)}var n,i,o=this,s=this.get("_subscriptionKey")||y.DataSet.DEFAULT_ROW_INDEX,a=this.applyViewStateAttributes();this.dataSet=new y.DataSet({idAttribute:s,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:s})}),agent:this.agent,maxRows:this.get("_maxRows"),primaryKey:s}),this.dataSet2=new y.DataSet2({idAttribute:s,agent:this.agent,maxRows:this.get("_maxRows"),primaryKey:s}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(!0),"subscription"===this.get("_subscriptionType")?(i=this.formatValue(a._subscriptionInterval,"_subscriptionInterval"),this.execute=this.wrapWithErrorHandler(function(){o.onExecuteBegin(),o.get("_serverPaging")&&(n={type:o.getPagingType(),num:o.get("_pagingNum")||0,size:o.get("_pageSize")||D.DEFAULT_PAGE_SIZE,sorting:o.get("_pageSort")||{}}),o.runWithConnectionCheck(e,function(){o.updateBuilder(function(){y.DeltaClientLib.startManagedAnalytic2(o.get("_selectedAnalytic"),o.get("_connection"),o.bindViewStateToKdbParams(o.get("_analyticParams")),t,e,i,o.get("_maxRows")||D.DEFAULT_MAX_ROWS,o.performance)},e)})},this,this.attributes)):"streaming"===this.get("_subscriptionType")?this.execute=this.wrapWithErrorHandler(function(){o.updateBuilder(function(){o.onExecuteBegin(),o.runWithConnectionCheck(e,function(){y.DeltaClientLib.startStreamingAnalytic2(o.get("_selectedAnalytic"),o.get("_connection"),o.bindViewStateToKdbParams(o.get("_analyticParams")),t,e,o.performance)})},e)},this,this.attributes):this.execute=this.wrapWithErrorHandler(function(){o.updateBuilder(function(){o.onExecuteBegin(),o.get("_serverPaging")&&(n={type:o.getPagingType(),num:o.get("_pagingNum")||0,size:o.get("_pageSize")||D.DEFAULT_PAGE_SIZE,sorting:o.get("_pageSort")||{}}),o.runWithConnectionCheck(e,function(){y.DeltaClientLib.runAnalytic2(o.get("_selectedAnalytic"),o.get("_connection"),o.bindViewStateToKdbParams(o.get("_analyticParams")),t,e,o.get("_maxRows")||D.DEFAULT_MAX_ROWS,n,o.performance)})},e)},this,this.attributes)},D.prototype.updateBuilder=function(t,e){var n,i;"builder"===this.get("_dataType")&&(n="streaming"===this.get("_subscriptionType"),i=(new y.QueryBuilder.App).getIPC(this.get("_graphJSON"),this.get("_selectedNode"),this),n?(this.set("_selectedAnalytic",i),this.set("_analyticParams",[],{silent:!0})):(this.set("_selectedAnalytic",".queryBuilder.processGraph2"),this.set("_analyticParams",[{id:"graph",name:"graph",index:0,type:n?"symbol":"string",value:i}],{silent:!0}))),t()},D.prototype.runWithConnectionCheck=function(t,e){var n=this.get("_connection");!this.get("_ignoreNullConnectionCheck")&&(null==n||"DC"===n)?t({message:"Invalid connection specified"}):e()},D.prototype.applyPivot=function(){var s,a=this,r=this.get("_breakdownCols"),l={dataSource:this.get("_dataSource"),connection:this.get("_connection"),pivotSource:"query",queryString:this.get("_queryString"),queryParams:this.get("_queryParams"),breakdownCols:this.get("_breakdownCols"),aggFn:this.get("_aggFn"),ordering:this.get("_ordering"),maxRows:this.get("_maxRows"),subscriptionType:this.get("_subscriptionType"),subscriptionInterval:this.get("_subscriptionInterval"),columnLabel:this.get("_columnLabel")},n=this.applyViewStateAttributes();_.each(n,function(t,e){"_subscriptionInterval"===e?n[e]=a.formatValue(t,"_subscriptionInterval"):_.isString(t)&&(n[e]=t.trim(),n[e]=t.split(",")),l[e.replace("_","")]=t}),r=l.breakdownCols,s=m.Model.extend({idAttribute:_.last(r),getRoot:function(){return a}}),_.each(r,function(t,e){var n={},i=r[r.length-e-1],o=e===r.length-1?"id":r[r.length-e-2];_.extend(n,l,{dimensions:r.slice(0,r.length-e),wheres:r.slice(0,r.length-e-1),id:o}),s=a.generatePivotModel(o,i,s,n)}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),_.extend(this,{dataSet:new y.DataSet({idAttribute:s.prototype.childId,collectionFunc:m.Collection.extend({model:s.prototype.childModelType||s}),agent:this.agent,maxRows:l.maxRows,primaryKey:s.prototype.childId}),dataSet2:new y.DataSet2({idAttribute:s.prototype.childId,agent:this.agent,maxRows:l.maxRows,primaryKey:s.prototype.childId}),execute:s.prototype.execute||_.noop.bind(this),exportPivotData:s.prototype.exportPivotData,staticIdAttribute:s.staticIdAttribute})},D.prototype.applyQuery=function(){function n(t,e){s.onExecuteSubscriptionSuccess(t,s.get("_forceReset"),e)}function i(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.onError(s,s.attributes,t,"Error",e)}var o,s=this,t=this.get("_subscriptionKey")||y.DataSet.DEFAULT_ROW_INDEX,e=this.applyViewStateAttributes();this.dataSet=new y.DataSet({idAttribute:t,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:t})}),agent:this.agent,lazyLoading:this.get("_lazyLoading"),maxRows:this.get("_maxRows"),primaryKey:t}),this.dataSet2=new y.DataSet2({idAttribute:t,agent:this.agent,lazyLoading:this.get("_lazyLoading"),maxRows:this.get("_maxRows"),primaryKey:t}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),"subscription"===this.get("_subscriptionType")?(o=this.formatValue(e._subscriptionInterval,"_subscriptionInterval"),this.execute=this.wrapWithErrorHandler(function(){var t=null,e=(s.onExecuteBegin(),s.replaceViewStateParams(s.get("_queryString")));s.get("_serverPaging")&&(t={type:s.getPagingType(),num:s.get("_pagingNum")||0,size:s.get("_pageSize")||D.DEFAULT_PAGE_SIZE,sorting:s.get("_pageSort")||{}}),s.runWithConnectionCheck(i,function(){y.DeltaClientLib.startManagedQuery2(s.get("_connection"),e,s.bindViewStateToKdbParams(s.get("_queryParams")),n,i,o,s.get("_maxRows")||D.DEFAULT_MAX_ROWS,t,s.performance)})},this,this.attributes)):this.execute=this.wrapWithErrorHandler(function(){var t=null,e=(s.onExecuteBegin(),s.replaceViewStateParams(s.get("_queryString")));s.get("_serverPaging")&&(t={type:s.getPagingType(),num:s.get("_pagingNum")||0,size:s.get("_pageSize")||D.DEFAULT_PAGE_SIZE,sorting:s.get("_pageSort")||{}}),s.runWithConnectionCheck(i,function(){y.DeltaClientLib.getQueryData2(s.get("_dataSource"),s.get("_connection"),"sql"===s.get("_dataType")?y.KdbQuery.executeSql+' "'+s.toSQLString(e,s.bindViewStateToKdbParams(s.get("_queryParams")))+'"':e,"sql"===s.get("_dataType")?[]:s.bindViewStateToKdbParams(s.get("_queryParams")),n,i,s.get("_maxRows")||D.DEFAULT_MAX_ROWS,t,s.performance)})},this,this.attributes)},D.prototype.applyVirtual=function(){function t(t,e){n.onExecuteSuccess(t,n.get("_forceReset"),e)}var n=this,e=this.get("_subscriptionKey")||y.DataSet.DEFAULT_ROW_INDEX;this.dataSet=new y.DataSet({idAttribute:e,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:e})}),agent:this.agent,maxRows:9007199254740991,primaryKey:e}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),this.execute=this.wrapWithErrorHandler(function(){this.onExecuteBegin(),this.updateVirtualSubscriptions(),this.executeVirtualQuery(this.get("_virtualQueryString"),this.get("_virtualParams"),t)},this,this.attributes)},D.prototype.applyParameterChange=function(){var t,e;this.paramChanged&&this.paramChanged.length&&(t=!!_.find(this.paramChanged,function(t){return"#forced"===t}),e=!!_.find(this.paramChanged,function(t){return t.runApply}),y.Log.Info(this.logPrefix()+"apply parameter change",this.paramChanged),this.paramChanged=[],this.agent.subscriberCount()?e?(this.apply(),this.start()):this.isPending?this.isDirty=!0:(this.isDirty=this.isDirty||t,this.performance.trigger("paramChange"),this.start()):t&&(e=this.onExecuteBeginCount,this.dataSet||this.apply(),e===this.onExecuteBeginCount)&&this.execute())},D.prototype.applyViewStateAttributes=function(){var e=this,s={},t=_.clone(D.VIEW_STATE_ATTRIBUTES[this.get("_dataType")])||{},a=_.clone(this.viewStateBindings);return this.get("_pivotType")&&_.extend(t,D.VIEW_STATE_ATTRIBUTES.pivot),_.each(t,function(n,i){var o=e.get(i),t=_.findKey(a,function(t,e){return e===i&&t.callback===n&&t.model===o});t?(a=_.omit(a,t),o=o.get("value")):o instanceof m.Model&&(e.listenTo(o,"change:value",e[n]),e.viewStateBindings[i]=new y.ViewStateBinding(n,o),o=o.get("value")),s[i]=o}),this.get("_pivotType")&&s[D.AGGREGATE_COLS_PROP]&&s[D.AGGREGATE_LABELS_PROP]&&s[D.AGGREGATE_COLS_PROP].length!==s[D.AGGREGATE_LABELS_PROP].length&&(y.Log.Warn(this.logPrefix()+"invalid aggregate labels length"),s[D.AGGREGATE_LABELS_PROP]=[]),_.each(a,function(t){e.stopListening(t.model,"change:value",t.callback)}),s},D.prototype.bindViewStateToKdbParams=function(t){var o,s,n,a=this,e=[];return $.extend(!0,e,t),e&&0<e.length&&e.forEach(function(i){var t,e;"string"==typeof i.value&&(n=i.value.match(D.PARAMETER_RX))&&(t=a.getViewState().getByPath($.trim(n[0].substring(2,n[0].length-2))))&&(void 0===(t=_.isFunction(t.get)?t.get("value"):t.value)&&(i.value=null),i.value=_.isObject(t)&&!_.isArray(t)?$.extend(!0,{},t):t),"dict"===i.type&&_.isObject(i.value)?_.keys(i.value).forEach(function(t){if(i.value[t]instanceof m.Model)i.value[t]={type:i.value[t].get("_type"),IsKdbParam:!0,isViewState:!0,name:i.value[t].path,value:i.value[t].get("value")};else if("object"==typeof i.value[t]){if(_.has(i.value[t],"_isKdbReady"))return;"string"==typeof i.value[t].value&&0===i.value[t].value.indexOf("<%")?(e=$.trim(i.value[t].value.substring(2,i.value[t].value.length-2)),(n=a.getViewState().getByPath(e))&&(i.value[t].type=n.get("_type"),i.value[t].value=n.get("value"))):"dict"===i.value[t].type&&(i.value[t]=a.bindViewStateToKdbParams([i.value[t]])[0])}else{var e,n;"string"==typeof i.value[t]&&(e=void 0,0===i.value[t].indexOf("<%"))&&(e=$.trim(i.value[t].substring(2,i.value[t].length-2)),n=a.getViewState().getByPath(e))&&(i.value[t]={type:n.get("_type"),IsKdbParam:!0,isViewState:!0,name:i.value[t],value:n.get("value")})}o=i.value[t].type,(s=o?y.RTTI.getByName(o):null)&&s.toKDBInput&&(i.value[t].value=_.includes(D.TYPES_TO_PARSE,o)?s.toKDBInput(i.value[t].value):i.value[t].value,y.Log.Info(a.logPrefix()+"View State  Binding ["+i.name+"]",i.value[t].value))}):(o=i.type,(s=y.RTTI.getByName(o))&&("dict"!==s.name&&s.toKDBInput?(i.value=_.includes(D.TYPES_TO_PARSE,o)?s.toKDBInput(i.value):i.value,y.Log.Info(a.logPrefix()+"View State  Binding ["+i.name+"]",i.value)):"dict"===s.name&&(t=i.value.split(""),e={},t.forEach(function(t){t=t.split("");6===t.length&&(e[t[0]]={type:t[1],IsKdbParam:!0,isViewState:!0,name:t[0],value:t[2]})}),i.value=e)))}),e},D.prototype.clearVirtualSubscriptions=function(t){var n=this;_.each(t,function(t){var e=n.virtualSubscriptions[t];e&&(e instanceof D&&e.unsubscribe(t),delete n.virtualSubscriptions[t])})},D.prototype.clearVirtualSubscriptionsAll=function(){var t=_.keys(this.virtualSubscriptions);this.clearVirtualSubscriptions(t)},D.prototype.clone=function(){var t=new D(this.attributes,this.root,this.path,this.viewState,this.group);return t.isClone=!0,t},D.prototype.defaults=function(){var t={_pagingType:"NONE"};return t[D.AUTO_EXECUTE]=!0,t},D.prototype.destroy=function(){this.stop(),this.reset(),this.agent&&this.agent.unsubscribeAll(),m.Model.prototype.destroy.call(this)},D.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,D.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},D.prototype.doCommand=function(t,e){var n;if(0<t.length)return n=t.reverse().join("/"),this.getByPath(n).doCommand(t,e)},D.prototype.executeClientPivotQuery=function(n,t){var a,r,i,l,u,c,p,d,h,s=this,g={columns:[],meta:{},rows:[]};return n&&(a=this.getViewStateAttribute("_aggregateCols")||[],r=this.getViewStateAttribute("_aggregateFns")||[],u=this.getViewStateAttribute("_aggregateLabels")||[],i=this.getViewStateAttribute("_breakdownCols")||[],l=a.map(function(t){return y.Tools.getComparator(n.meta[t]||0,function(t){return t})}),u=_.map(a,function(t,e){return u[e]||t}),c=t&&t.wheres?t.wheres:[],c=_.filter(c,function(t,e){return t.comparator=y.Tools.getComparator(n.meta[t.columnName]||0,function(t){return t}),t.columnName===i[e]}),p=_.take(i,c.length+1),d=_.last(p),h=y.Tools.getComparator(n.meta[d]||0,function(t){return t[d]}),n.rows.forEach(function(o){for(var t,s,e=0;e<c.length;e++){var n=c[e];if(0!==n.comparator(n.columnValue,o[n.columnName]))break}e<c.length||(t=o[d],(t=y.Tools.binarySearch2(t,g.rows,h))<0?(s=_.pick(o,p),g.rows.splice(-t-1,0,s),u.forEach(function(t,e){"count"===r[e]?s[t]=0:_.includes(["max","min","sum"],r[e])?s[t]=null:s[t]=[]})):s=g.rows[t],a.forEach(function(t,e){var n=r[e],i=u[e];switch(n){case"count":s[i]+=1;break;case"max":null===o[t]||null!==s[i]&&-1!==l[e](s[i],o[t])||(s[i]=o[t]);break;case"min":null===o[t]||null!==s[i]&&1!==l[e](s[i],o[t])||(s[i]=o[t]);break;case"sum":null!==o[t]&&(s[i]+=Number(o[t]));break;default:s[i]=s[i]||[],s[i].push(o)}}))}),_.every(r,function(t){return _.includes(["count","max","min","sum"],t)})||g.rows.forEach(function(o){u.forEach(function(t,e){var n=o[t],i=r[e];if(_.isArray(n))switch(i){case"avg":n=_.map(n,function(t){return _.transform(t,function(t,e,n){return t[n]=Number(e)})}),o[t]=_.meanBy(n,a[e]);break;case"first":o[t]=_.first(n)[a[e]];break;case"last":o[t]=_.last(n)[a[e]];break;default:o[t]=s.executeUserJavascript(i,["data"],[n])}})}),_.each(p,function(t){g.columns.push(t),g.meta[t]=n.meta[t]||11}),_.each(a,function(t,e){g.columns.push(u[e]),g.meta[u[e]]=n.meta[t]||11})),g},D.prototype.executeUserJavascript=function(e,n,i){try{return new Function(n,e).apply({},i)}catch(t){n=/<anonymous>:(\d+):(\d+)/.exec(t.stack);if(n&&3===n.length)throw e=Number(n[1]),i=Number(n[2]),t.message+" ("+(e-2)+":"+i+")";throw t.message}},D.prototype.executeVirtualQuery=function(t,e,n){var o=this,t=D.VIRTUAL_QUERY_REGEX.exec(t),s=[],a=[],r=!1;if(!t)throw"Invalid function definition";_.each(e,function(t){switch(t.type){case"datasource":var e,n,i=o.path+"_"+t.value;o.get("isSourceDataDialog")&&(i+="#edit"),s.push(t.name),(i=o.virtualSubscriptions[i])?(e=i.get("_subscriptionKey")||y.DataSet.DEFAULT_ROW_INDEX,n=o.get("_subscriptionKey")||y.DataSet.DEFAULT_ROW_INDEX,r=r||n===y.DataSet.DEFAULT_ROW_INDEX&&(e===y.DataSet.DEFAULT_ROW_INDEX||"virtual"===i.get("_dataType")),a.push(_.extend(D.convertMetaToDeltaClientColumnSpec(i.dataSet?_.sortBy(i.dataSet.columns.map(function(t){return t.attributes}),"index"):[]),{rows:i.dataSet?i.dataSet.collection.models.map(function(t){return t.attributes}):[]}))):a.push(null);break;case"text":s.push(t.name),a.push(t.value);break;case"viewstate":s.push(t.name),i=o.viewState.getByPath(t.value),a.push(i?i.get("value"):null)}}),s.push("callback"),a.push(function(t){t.rows&&r&&(t.rows=t.rows.map(function(t){return Object.assign({},t)})),n(t)}),s.push("Tools"),a.push(y.Tools),t&&6===t.length&&(e=t[4],this.executeUserJavascript(e,s,a))},D.prototype.exportData=function(t,e,n){var i,o,s={},a="";n&&(n.exportName&&(a=n.exportName),n.exportParams)&&(s=n.exportParams),"analytic"===this.get("_dataType")?this.runWithConnectionCheck(e,function(){y.DeltaClientLib.exportAnalyticData(this.get("_selectedAnalytic"),this.get("_connection"),this.bindViewStateToKdbParams(this.get("_analyticParams")),a,s,t,e)}.bind(this)):"pivot"===this.get("_dataType")||this.get("_pivotType")?(i=this,n&&n.focus&&_.isString(n.focus)&&(o=n.focus.split(","),_.each(o,function(t){i.dataSet.collection.has(t)&&(i=i.dataSet.collection.get(t))})),i.exportPivotData(t,e,n)):"query"===this.get("_dataType")?this.runWithConnectionCheck(e,function(){y.DeltaClientLib.exportQueryData(this.get("_connection"),this.replaceViewStateParams(this.get("_queryString")),this.bindViewStateToKdbParams(this.get("_queryParams")),a,s,t,e)}.bind(this)):e("Export not currently supported for type "+this.get("_dataType"))},D.prototype.flatten=function(){return _.includes(["api","analytic","streaming","pivot","query","virtual","builder","sql"],this.get("_dataType"))?[this]:_.reduce(_.omit(this.attributes,"error"),function(t,e){return t.concat(e.flatten())},[])},D.prototype.flattenObject=function(t){var e={};if(_.keys(t).length){for(var n in t)if(t.hasOwnProperty(n))if("object"==typeof t[n]){var i,o=this.flattenObject(t[n]);for(i in o)o.hasOwnProperty(i)&&(e[n+"."+i]=o[i])}else e[n]=t[n];return e}return{0:t.toString()}},D.prototype.forceExecute=function(t,e){this.paramChanged.push("#forced"),e&&this.callbacks.push(e),this.debouncedParameterChange()},D.prototype.formatValue=function(t,e){return t="_subscriptionInterval"===e?1e3*Math.min(3600,Math.max(.5,Number(t||0))):t},D.prototype.toSQLString=function(t,e){var i=t.replace(/"/g,"'");return _.each(e,function(t){var e,n=t.type,n=n?y.RTTI.getByName(n):null;n&&n.toSQLInput&&(e=new RegExp("{{"+t.name+"}}","g"),i=i.replace(e,n.toSQLInput(t.value)))}),i},D.prototype.generatePivotModel=function(t,e,n,a){var r=this,l=(a.breakdownCols instanceof m.Model&&(a.breakdownCols=a.breakdownCols.get("value")),r.meta={},m.Model.extend({defaults:{_dataType:r.get("_dataType"),_pivotType:r.get("_pivotType"),_subscriptionType:r.get("_subscriptionType"),_subscriptionInterval:r.get("_subscriptionInterval")},idAttribute:t,childId:e,childModelType:n,initialize:function(){this.isDirty=!0,this.isPending=!1,this.legacyUpdates=[],this.agent=new y.Agent},apply:function(){this.dataSet=new y.DataSet({idAttribute:e,collectionFunc:m.Collection.extend({model:n}),agent:this.agent,maxRows:a.maxRows,primaryKey:e})},getRoot:function(){return r},getViewState:function(){return r.getViewState()},execute:function(e){function n(t){t?o(t):o(r.executeClientPivotQuery(r.clientPivotData,{wheres:a.wheres}),r.get("_forceReset"))}var i=this,t=!r.clientPivotData||r.isDirty||e&&e.intervalQuery,o=(this.wheres||(this.wheres=a.wheres),i.onExecuteSubscriptionSuccess.bind(i));i.onExecuteBegin();try{a.topX=null,a.ordering=null,a.queryParams=r.bindViewStateToKdbParams(r.get("_queryParams")),a.maxRows=r.get("_maxRows")||D.DEFAULT_MAX_ROWS,_.each(a.wheres,function(t,e){var t="string"==typeof t?t:t.columnName,n=r.meta[t];a.wheres[e]={columnName:t,columnType:n,columnOperator:"=",columnValue:i.get(t)}});function s(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];r.onError(l,a,t,"Error",e)}"client"===i.get("_pivotType")?t?(i.stop(),r.runWithConnectionCheck(s,function(){switch(r.get("_dataType")){case"query":var t=r.replaceViewStateParams(a.queryString);"subscription"===i.get("_subscriptionType")?y.DeltaClientLib.startManagedQuery(a.connection,t,r.bindViewStateToKdbParams(a.queryParams),function(t,e){t&&t.dataSet&&t.dataSet.rows?(r.clientPivotData=t.dataSet,n()):n(t)},s,1e3*a.subscriptionInterval,a.maxRows,null,i.performance):y.DeltaClientLib.getQueryData(a.dataSource,a.connection,t,r.bindViewStateToKdbParams(a.queryParams),function(t){r.clientPivotData=t,n()},s,a.maxRows,null,i.performance);break;case"api":case"analytic":case"streaming":"subscription"===i.get("_subscriptionType")?y.DeltaClientLib.startManagedAnalytic(r.get("_selectedAnalytic"),r.get("_connection"),r.bindViewStateToKdbParams(r.get("_analyticParams")),function(t,e){t&&t.rows?(r.clientPivotData=t,n()):n(t)},s,1e3*a.subscriptionInterval,a.maxRows,i.performance):y.DeltaClientLib.runAnalytic(r.get("_selectedAnalytic"),r.get("_connection"),r.bindViewStateToKdbParams(r.get("_analyticParams")),function(t){r.clientPivotData=t,n()},s,a.maxRows,null,i.performance);break;case"virtual":r.executeVirtualQuery(r.get("_virtualQueryString"),r.get("_virtualParams"),function(t){r.clientPivotData=t,n()});break;case"builder":"subscription"===i.get("_subscriptionType")?y.DeltaClientLib.startManagedQuery(a.connection,i.get("_analyticString"),i.get("_queryBuilderParams"),function(t,e){t&&t.dataSet&&t.dataSet.rows?(r.clientPivotData=t.dataSet,n()):n(t)},s,1e3*a.subscriptionInterval,a.maxRows,null,i.performance):y.DeltaClientLib.getQueryData(a.dataSource,a.connection,i.get("_analyticString"),i.get("_queryBuilderParams"),function(t){r.clientPivotData=t,n()},s,a.maxRows,null,i.performance)}})):n():("builder"===r.get("_dataType")&&(a.queryString=r.get("_analyticString"),a.queryParams=r.get("_queryBuilderParams")),r.runWithConnectionCheck(s,function(){y.DeltaClientLib.getPivotData(a,function(t,e){_.extend(r.meta,t.meta),"subscription"===r.get("_subscriptionType")?i.onExecuteSubscriptionSuccess(t,r.get("_forceReset"),e,r.meta):i.onExecuteSuccess(t,r.get("_forceReset"),e,r.meta)},s,i.performance)}))}catch(t){r.onError(l,a,t,"Error",e)}},exportPivotData:function(t,e,n){r.runWithConnectionCheck(e,function(){y.DeltaClientLib.exportPivotData($.extend({},a,n),t,e)})},clearVirtualSubscriptions:_.noop,clearVirtualSubscriptionsAll:_.noop,executeClientPivotQuery:r.executeClientPivotQuery,formatValue:r.formatValue,getViewStateAttribute:r.getViewStateAttribute,isPagingData:r.isPagingData,logPrefix:r.logPrefix,legacyFlush:r.legacyFlush,legacyUpdate:r.legacyUpdate,onComplete:r.onComplete,onExecuteSubscriptionSuccess:r.onExecuteSubscriptionSuccess,onExecuteBegin:r.onExecuteBegin,onExecuteSuccess:r.onExecuteSuccess,reset:r.reset,start:r.start,stop:r.stop,subscribe:r.subscribe,triggerCallbacks:_.noop,updateVirtualSubscriptions:_.noop,unsubscribe:r.unsubscribe},{staticIdAttribute:t}));return l},D.prototype.getByPath=function(t){var e;if(t)return t=_.filter(t.split("/"),function(t){return t&&0<t.length}),e=this,_.each(t,function(t){e=e&&e.get(t)}),e},D.prototype.getExecutionRate=function(){var t;return this.performance&&(t=this.performance.performance.apply)?6e4*this.dataExecuteSuccessCount/(Date.now()-t):0},D.prototype.getMappedViewStates=function(){var t=this.get("_mappings"),e=[];return t&&t.mappings&&_.each(t.mappings,function(t){e.push(t&&t._dashboardsType?this.viewState.getByPath(t.value):t)}.bind(this)),e},D.prototype.getMeta=function(e){var n=this,i=_.uniqueId("getMeta_");this.subscribe(i,{onData:function(t){e(t),_.defer(function(){return n.unsubscribe(i)})}})},D.prototype.getRoot=function(){return this},D.prototype.getTreeList=function(){var t=_.filter(this.attributes,function(t){return t instanceof D});return t.length?_.chain(t).map(function(t){return t.getTreeList()}).flatten().value():[this]},D.prototype.getViewState=function(){return this.viewState},D.prototype.getPagingType=function(){var t=D.DEFAULT_PAGING;return t=this.get("_serverPaging")?this.get("_forceReset")?"PAGENO_NOCACHE":this.get("_pagingType")&&"NONE"!==this.get("_pagingType")?this.get("_pagingType"):"PAGENO":t},D.prototype.getParameters=function(){var n,e,t,i=this,o=[];return this.get("_queryParams")?t=this.get("_queryParams"):this.get("_updateQueryParams")?t=this.get("_updateQueryParams"):this.get("_builderParams")?t=this.get("_builderParams"):this.get("_analyticParams")?t=this.get("_analyticParams"):this.get("_virtualParams")&&(t=_.filter(this.get("_virtualParams"),{type:"viewstate"}).map(function(t){return{value:"<%"+t.value+"%>"}})),t&&_.each(t,function(t){"string"==typeof t.value&&(e=t.value.match(D.PARAMETER_RX))&&(n={path:e[0].substring(2,e[0].length-2)},(e=i.viewState.getByPath(e[0].substring(2,e[0].length-2)))&&"dict"===e.get("_type")&&(n.dictParameters=[],_.each(e.get("value"),function(t,e){t instanceof m.Model?n.dictParameters.push({path:t.path,key:e}):_.isObject(t)?t.name?n.dictParameters.push({path:t.name,key:e}):t.type&&n.dictParameters.push({raw:!0,key:e,type:t.type,value:t.value}):_.isString(t)?t.match(D.PARAMETER_RX)?n.dictParameters.push({path:t.substring(2,t.length-2)}):n.dictParameters.push({path:t}):t&&n.dictParameters.push({path:t.name||t})})),o.push(n))}),o},D.prototype.getViewStateAttribute=function(t){t=this.get(t);return t instanceof m.Model?t.get("value"):t},D.prototype.getViewStateDict=function(){var i={},e=[],n=_.union(_.filter(this.get("_analyticParams"),function(t){return"dict"===t.type&&e.push(t),t.isViewState}),_.filter(this.get("_queryParams"),function(t){return"dict"===t.type&&e.push(t),t.isViewState}),_.filter(this.get("_virtualParams"),function(t){return"dict"===t.type&&e.push(t),t.isVirtual=!0,"viewstate"===t.type}));return _.each(e,function(t){_.each(t.value,function(t){t.isViewState&&n.push(t)})}),n&&0<n.length&&_.each(n,_.bind(function(n){var t=this.parseViewState(n.value,n.isVirtual);t&&(i[n.name]=t),"dict"===n.type&&_.isObject(n.value)&&_.each(n.value,function(t,e){t=this.parseViewState(t);t&&(i[n.name+"."+e]=t)}.bind(this))},this)),_.each(_.reduce(_.values(D.VIEW_STATE_ATTRIBUTES),function(t,e){return t.concat(_.keys(e))},[]),_.bind(function(t){var e=this.get(t);e instanceof m.Model&&(i[t]=e)},this)),i},D.prototype.isUsingApi=function(){return"api"===this.get("_dataType")&&!!this.get("_selectedAnalytic")},D.prototype.isMapping=function(){return this.get("_mappings")&&!_.isEmpty(this.get("_mappings").mappings)},D.prototype.isPagingData=function(t){return t&&t.rows&&t.rows[0]&&"startRows"===t.rows[0].Property&&t.rows[3]},D.prototype.legacyFlush=function(){var t;this.legacyFlushTime=Date.now(),this.legacyFlushFrame=void 0,(this.deferredUpdate&&this.agent.subscriberLegacyCount()||this.get("_dataType").match(/virtual|copy/))&&(t=this.legacyUpdate(this.deferredUpdate),this.dataSet&&this.dataSet.flushUpdates(),this.deferredUpdate&&this.deferredUpdate.forceReset&&t.rows&&!t.rows.length||!this.dataSet||this.dataSet&&this.dataSet.isEmpty()?0===this.agent.subscriberRawCount()&&this.set("queryStatus",{type:"NoResults",options:{}}):this.unset("queryStatus"),0<this.consolidateCount?y.Log.Info(this.logPrefix()+"consolidated "+(this.consolidateCount+1)):y.Log.Info(this.logPrefix()+"deferred")),this.consolidateCount=0,this.deferredUpdate=void 0,this.durationMovingAverage=(2*this.durationMovingAverage+(Date.now()-this.legacyFlushTime))/3},D.prototype.legacyUpdate=function(t){var e=t.forceReset,n=t.table,i=t.pivotMeta,o=this.get("_breakdownCols"),i=(o instanceof m.Model&&(o=o.get("value")),i&&_.extend(i,n.meta),n.rows?n:n.toLegacy());return this.dataSet.onData({breakdownColumns:o,columns:D.convertDeltaClientColumnSpecToMeta(i),paging:_.omit(t.pagingMeta,"data")},i.rows,e,void 0,this.performance),i},D.prototype.logPrefix=function(){return"DataModel "+this.agent.subscriberCount()+" "+this.path+" "},D.prototype.objToString=function(e){var n=[];return _.each(_.keys(e),function(t){n.push(t+": "+e[t])}),n.join("\n")},D.prototype.onComplete=function(){this.isDirty&&!this.isPending&&(this.stop(),this.forceInternalReset=!0,this.start())},D.prototype.onError=function(t,e,n,i,o){n={error:_.isObject(n)?this.objToString(this.flattenObject(n)):n,type:i,options:$.extend({},e),args:void 0};this.triggerCallbacks(n),o&&(n.args=$.extend({},o)),this.set({error:n}),this.set({queryStatus:n}),this.isPending=!1,this.onComplete();try{this.dataSet&&this.dataSet.onData([],[],this.forceInternalReset,n),this.dataSet2&&this.dataSet2.onData([],{},this.forceInternalReset,n)}catch(t){}y.Log.Error(this.logPrefix()+"onError ",n),t&&t.trigger&&t.trigger("error",t,n)},D.prototype.onExecuteBegin=function(){this.isPending=!0,this.isDirty=!1,this.onExecuteBeginCount++,this.set({queryStatus:{type:"Loading"}}),y.Log.Info(this.logPrefix()+"execute begin")},D.prototype.onExecuteSuccess=function(e,t,n,i){var o,s={},a=this.get("_breakdownCols");if(a instanceof m.Model&&(a=a.get("value")),this.dataExecuteSuccessCount++,this.triggerCallbacks(),n&&n.byteLength){var r=["startRows","numRows","totalNumRows","data"];if(e&&99===e.qtype&&11===e.keys.qtype&&4===e.keys.offsets.length&&_.isEqual(r,_.times(4,function(t){return y.ipc.Parse.col(e.keys,new DataView(n)).toLegacy(t)}))){for(var l=y.ipc.Parse.col(e.values,new DataView(n)),u=0;u<3;u++)s[r[u]]=l.toLegacy(u);s.pagingType=this.getPagingType(),s.pageSize=this.get("_pageSize"),o=y.ipc.Parse.reshape(l.values[3],n),t=!0}else o=y.ipc.Parse.reshape(e.dataSet||e,n);i&&_.extend(i,o.meta),t=t||this.forceInternalReset,this.agent.subscriberRawCount()&&(this.unset("error"),this.dataSet2.onData({breakdownColumns:a,columns:D.convertDeltaClientColumnSpecToMeta(o),paging:_.omit(s,"data")},o.cols,t,void 0,this.performance),this.forceInternalReset=!1,!this.dataSet2||this.dataSet2&&this.dataSet2.isEmpty()?this.set("queryStatus",{type:"NoResults",options:{}}):this.unset("queryStatus"))}else this.isPagingData(e)?(_.each(e.rows,function(t){s[t.Property]=t.Value}),s.pagingType=this.getPagingType(),s.pageSize=this.get("_pageSize"),o=s.data||{},t=!0):o=e;(this.agent.subscriberLegacyCount()||this.get("_dataType").match(/virtual|copy/))&&(t=t||this.forceInternalReset,a=new y.LegacyUpdate(o,t,s,i),this.forceInternalReset=!1,this.deferredUpdate?(this.dataSet.background(),this.consolidateCount++,this.legacyUpdate(this.deferredUpdate),this.deferredUpdate=a):!this.dataSet.isBackground()&&(this.durationMovingAverage<=D.FAST_THRESHOLD||Date.now()-this.legacyFlushTime-this.durationMovingAverage>D.OLD_THRESHOLD)?(this.deferredUpdate=a,this.legacyFlush(),y.Log.Info(this.logPrefix()+" Express")):this.deferredUpdate=a,!this.legacyFlushFrame)&&this.deferredUpdate&&(this.legacyFlushFrame=window.requestAnimationFrame(this.legacyFlush.bind(this)),this.deferredUpdate=a),this.isPending=!1,this.unset("error"),y.Log.Info(this.logPrefix()+"execute success"),this.onComplete()},D.prototype.onExecuteSubscriptionSuccess=function(t,e,n,i){if("207"===t.class)this.stop(),t.add?(this.subscriptionId=t.clientId+":"+t.subId,this.isPending=!1,y.Log.Info(this.logPrefix()+"sub started "+t.subId)):y.Log.Info(this.logPrefix()+"sub stopped "+t.subId);else if("208"===t.class)y.Log.Info(this.logPrefix()+"sub failed "+t.subId+": "+t.reason),y.DeltaClientLib.removeSubscriptions(t.clientId+":"+t.subId);else{if("209"===t.class){if(this.subscriptionId!==t.clientId+":"+t.subId)return y.Log.Warn(this.logPrefix()+"sub stray persisting: "+t.clientId+":"+t.subId),void y.DeltaClientLib.removeSubscriptions(t.clientId+":"+t.subId)}else{if("210"===t.class)return;if("com.fd.business.querymanager.subscriptions.ManagedSubscription"===t.class||"com.fd.business.querymanager.subscriptions.StreamingSubscription"===t.class)return}this.onExecuteSuccess(t.dataSet||t,e,n,i)}},D.prototype.onMaterialChange=function(){this.trigger("materialChange")},D.prototype.onModelChange=function(t,e){var t=_.keys(t.changed),n=_.intersection(t,D.PAGING_ATTRIBUTES);_.find(t,function(t){return 0===t.indexOf("_")})&&(this.determineMaterialChange(),_.some(t,function(t){return 0===t.indexOf("_")&&!_.includes(["_layout","_mappings"],t)})&&(this.isDirty=!0),_.includes(t,D.AUTO_EXECUTE)&&this.updateParameters(),n)&&n.length&&(this.paramChanged=this.paramChanged.concat(n),this.stop(),this.isDirty=!0,this.forceInternalReset=!0,this.debouncedParameterChange())},D.prototype.onParameterChange=function(t,e,n){n={runApply:!(!n||!n.runApply)||!!this.get("_pivotType"),modelPath:t.path,previous:t.previous("value"),new:e};this.paramChanged.push(n),y.Log.Info(this.logPrefix()+"parameter change",n),this.stop(),this.isDirty=!0,this.forceInternalReset=!0,this.get("_pagingType")!==D.DEFAULT_PAGING&&0!==this.get("_pagingNum")&&this.set("_pagingNum",0),this.debouncedParameterChange()},D.prototype.onPivotSettingChange=function(t,e){this.onParameterChange(t,e,{runApply:!0})},D.prototype.onQuerySettingChange=function(t,e,n){n=_.extend(!0,{runApply:!0},n),this.onParameterChange(t,e,n)},D.prototype.parseViewState=function(t,e){if("string"==typeof t)return e?this.getViewState().getByPath(t):(e=t.match(D.PARAMETER_RX))?this.getViewState().getByPath($.trim(e[0].substring(2,e[0].length-2))):void 0},D.prototype.postCommand=function(t,e){return this.root.postCommand(this,e)},D.prototype.removeSubscriptions=function(){this.stop(),this.group&&this.values().forEach(function(t){return t.removeSubscriptions()})},D.prototype.replaceViewStateParams=function(t){var i=this;return"string"==typeof t?t.replace(D.PARAMETER_RX,function(t,e){var n=i.getViewState().getByPath(e);return n?void 0===(n=n.get("value"))?null:n:(y.Log.Error(i.logPrefix()+"replace parameter: "+e+" not found"),"")}):t},D.prototype.reset=function(){this.dataMapper&&(this.dataMapper.cleanUp(),delete this.dataMapper),this.dataSet&&(this.dataSet.cleanUp(),delete this.dataSet),this.dataSet2&&(this.dataSet2.cleanUp(),delete this.dataSet2),this.deferredUpdate=void 0,this.isDirty=!0,this.isPending=!1,this.dataExecuteSuccessCount=0,this.onExecuteBeginCount=0},D.prototype.setLastRunInfo=function(t){this.lastRunInfo=t},D.prototype.start=function(){var t,e,n=this;0===this.agent.subscriberCount()?y.Log.Info(this.logPrefix()+"start: no subscriptions"):(t=this.formatValue(this.getViewStateAttribute("_subscriptionInterval"),"_subscriptionInterval"),"polling"===(e=this.get("_subscriptionType"))?this.pollingEvent?y.Log.Info(this.logPrefix()+"start: already polling!"):(y.Log.Info(this.logPrefix()+"start: polling now..."),this.pollingEvent=setInterval(function(){n.isPending||(y.Log.Info(n.logPrefix()+"poll"),n.execute({intervalQuery:!0}))},t),this.execute()):"subscription"===e||"streaming"===e?this.subscriptionId||this.execute():this.isDirty&&!this.isPending&&this.execute())},D.prototype.stop=function(){this.pollingEvent&&(clearInterval(this.pollingEvent),this.pollingEvent=null),this.subscriptionId&&(y.DeltaClientLib.removeSubscriptions(this.subscriptionId),y.Log.Info(this.logPrefix()+" unsubcribed "+this.subscriptionId),this.subscriptionId=null)},D.prototype.subscribe=function(t,e,n,i){this.agent.subscribe(t,e,n)?(y.Log.Info(this.logPrefix()+"subscribed "+t),i?this.set(i,{silent:!0}):this.has("_lazyLoading")&&(this.unset("_lazyLoading"),this.dataSet&&(this.dataSet.lazyLoading=!1),this.set({_pagingType:"NONE",_pageNum:0},{silent:!0})),this.dataSet?(n||this.dataSet.collection.isEmpty()&&this.dataSet.columns.isEmpty()?this.dataSet2&&!this.dataSet2.columns.isEmpty()?n?this.dataSet2.onDataRefresh(e):(i=y.ipc.Table.toLegacy(_.mapValues(_.keyBy(this.dataSet2.columns.map(function(t){return t.attributes}),"id"),"kdbType"),this.dataSet2.columns.map(function(t){return t.id}),this.dataSet2.cols),this.dataSet.onData({breakdownColumns:this.dataSet2.breakdownColumns,columns:D.convertDeltaClientColumnSpecToMeta(i)},i.rows,!0,void 0)):n&&!this.dataSet.columns.isEmpty()&&this.apply():this.dataSet.onDataRefresh(e),this.trigger("change:queryStatus",this,this.get("queryStatus"))):this.apply(),this.start()):y.Log.Error(this.logPrefix()+"subscribe: already subscribed",t)},D.prototype.toJSON=function(){var i=this,o={};return _.keys(this.attributes).forEach(function(t){var e=i.attributes[t],n={};_.isObject(e)&&e.has&&e.has("_dataType")?(_.each(_.filter(_.keys(e.attributes),function(t){return 0===t.indexOf("_")&&!_.includes(["_pageSort","_pagingNum"],t)}),function(t){e.get(t)instanceof m.Model?n[t]={_dashboardsType:"viewstate",value:e.get(t).path}:n[t]=e.get(t)}),o[t]=n):e instanceof y.DocumentViewModel?o[t]={_dashboardsType:"viewstate",value:e.path}:(_.isObject(e)&&"Error"===e.type&&(e.options={}),o[t]=e)}),o},D.prototype.triggerCallbacks=function(e){void 0===e&&(e=null),this.callbacks.forEach(function(t){t({success:!e,error:e})}),this.callbacks=[]},D.prototype.unsubscribe=function(t){this.agent.unsubscribe(t)?(y.Log.Info(this.logPrefix()+"unsubscribed "+t),0===this.agent.subscriberCount()&&(this.stop(),this.reset(),this.clearVirtualSubscriptionsAll(),y.Log.Info(this.logPrefix()+"0 subscribers, data source reset"))):y.Log.Warn("unsubscribe not found",t,this)},D.prototype.updateParameterPath=function(t,e,n){var i=new RegExp("^<%"+e);"vs"===t?(_.each([this.get("_analyticParams"),this.get("_queryParams"),this.get("_updateQueryParams")],function(t){_.each(t,function(t){"viewstate"===t.isViewState&&(t.value=t.value.replace(i,"<%"+n))})}),_.each(this.get("_virtualParams"),function(t){"viewstate"===t.type&&(t.value=t.value.replace(i,"<%"+n))})):"ds"===t&&_.each(this.get("_virtualParams"),function(t){"datasource"===t.type&&(t.value=t.value.replace(i,"<%"+n))})},D.prototype.updateParameters=function(t){var e,n,i,o=this,s=[];_.each(_.filter(_.keys(o.attributes),function(t){return 0===t.indexOf("_")}),function(t){"string"==typeof o.get(t)&&o.get(t).replace(D.PARAMETER_RX,function(t,e){return s.push(e),""})}),o.get("_queryParams")&&0<o.get("_queryParams").length?_.each(o.get("_queryParams"),function(t){"string"==typeof t.value&&((e=t.value.match(D.PARAMETER_RX))&&(s.push(e[0].substring(2,e[0].length-2)),i=o.viewState.getByPath(e[0].substring(2,e[0].length-2))),i)&&"dict"===i.get("_type")&&_.each(i.get("value"),function(t,e){var n;t instanceof m.Model?s.push(t.path):_.isObject(t)&&t.value?(n=t.value,_.isString(n)&&n.match(D.PARAMETER_RX)&&s.push(n.substring(2,n.length-2))):_.isString(t)&&t.match(D.PARAMETER_RX)&&s.push(t.substring(2,t.length-2))})}):o.get("_updateQueryParams")&&0<o.get("_updateQueryParams").length?_.each(o.get("_updateQueryParams"),function(t){"string"==typeof t.value&&((e=t.value.match(D.PARAMETER_RX))&&(s.push(e[0].substring(2,e[0].length-2)),i=o.viewState.getByPath(e[0].substring(2,e[0].length-2))),i)&&"dict"===i.get("_type")&&_.each(i.get("value"),function(t,e){var n;t instanceof m.Model?s.push(t.path):_.isObject(t)&&t.value?(n=t.value,_.isString(n)&&n.match(D.PARAMETER_RX)&&s.push(n.substring(2,n.length-2))):_.isString(t)&&t.match(D.PARAMETER_RX)&&s.push(t.substring(2,t.length-2))})}):o.get("_analyticParams")&&0<o.get("_analyticParams").length?_.each(o.get("_analyticParams"),function(t){"string"==typeof t.value?((e=t.value.match(D.PARAMETER_RX))&&(s.push(e[0].substring(2,e[0].length-2)),i=o.viewState.getByPath(e[0].substring(2,e[0].length-2))),i&&"dict"===i.get("_type")&&_.each(i.get("value"),function(t,e){var n;t instanceof m.Model?s.push(t.path):_.isObject(t)&&t.value?(n=t.value,_.isString(n)&&n.match(D.PARAMETER_RX)&&s.push(n.substring(2,n.length-2))):_.isString(t)&&t.match(D.PARAMETER_RX)&&s.push(t.substring(2,t.length-2))})):"object"==typeof t.value&&"dict"===t.type&&_.each(t.value,function(t){!_.has(t,"_isKdbReady")&&(n="object"==typeof t?t.value:"<%"+t+"%>",e="string"==typeof n&&n.match(D.PARAMETER_RX))&&s.push(e[0].substring(2,e[0].length-2))})}):o.get("_virtualParams")&&0<o.get("_virtualParams").length&&_.each(o.get("_virtualParams"),function(t){(e=t.value)&&"viewstate"===t.type&&(s.push(e),i=o.viewState.getByPath(e)),i&&"dict"===i.get("_type")&&_.each(i.get("value"),function(t,e){var n;t instanceof m.Model?s.push(t.path):_.isObject(t)&&t.value?(n=t.value,_.isString(n)&&n.match(D.PARAMETER_RX)&&s.push(n.substring(2,n.length-2))):_.isString(t)&&t.match(D.PARAMETER_RX)&&s.push(t.substring(2,t.length-2))})}),o.parameterModels&&_.each(o.parameterModels,function(t){t&&o.stopListening(t,"change:value",o.onParameterChange)}),o.parameterModels=[],o.get(D.AUTO_EXECUTE)&&_.each(s,function(t){t=o.getViewState().getByPath(t);t&&(o.listenTo(t,"change:value",o.onParameterChange),o.parameterModels.push(t))})},D.prototype.updateVirtualSubscriptions=function(){var i,o=this,n=[];"virtual"!==this.get("_dataType")?this.clearVirtualSubscriptionsAll():(_.each(this.get("_virtualParams"),function(t){var e=t.value;e&&"datasource"===t.type&&n.push(e)}),i=_.keys(this.virtualSubscriptions),_.each(n,function(t){var e,n=o.path+"_"+t;o.get("isSourceDataDialog")&&(n+="#edit"),_.includes(i,n)?i=_.without(i,n):(e=o.root?o.root.getByPath(t):e)&&!o.virtualSubscriptions[n]&&((o.virtualSubscriptions[n]=e).unsubscribe(n),e.subscribe(n,{key:n,onData:function(t,e,n){o.onParameterChange({path:"#virtual",previous:_.noop.bind(o)},Math.random(),{})},source:e}))}),this.clearVirtualSubscriptions(i))},D.prototype.wrapWithErrorHandler=function(t,e,n){var i=this;return function(){try{t.apply(i,arguments)}catch(t){i.onError(e,$.extend(!0,{},n),t,"Error",Array.prototype.slice.call(3,arguments))}}},D.DEFAULT_MAX_ROWS=null,D.DEFAULT_PAGE_SIZE=2e3,D.DEFAULT_PAGING="NONE",D.IMMATERIAL_ATTRIBUTES=["error","queryStatus"],D.NO_DATA_ERROR_TEXT="No data returned from selected data source",D.PAGING_ATTRIBUTES=["_pagingNum","_pageSize","_pagingType","_pageSort","_serverPaging"],D.PARAMETER_RX=new RegExp("<%([^<>%]+?)%>","g"),D.TYPES_TO_PARSE=["date","datetime","guid","minute","month","second","time","timespan","timestamp"],D.VIEW_STATE_ATTRIBUTES={analytic:{_subscriptionInterval:"onQuerySettingChange"},pivot:{_aggregateCols:"onPivotSettingChange",_aggregateFns:"onPivotSettingChange",_aggregateLabels:"onPivotSettingChange",_breakdownCols:"onPivotSettingChange"},query:{_subscriptionInterval:"onQuerySettingChange"}},D.VIRTUAL_QUERY_REGEX=/^(function(?: )?\()([a-z0-9A-Z,\w\/ ]+?)(,(?: +)?callback\)(?: ){)([\s\S]+)(\})$/,D.AGGREGATE_COLS_PROP="_aggregateCols",D.AGGREGATE_LABELS_PROP="_aggregateLabels",D.AUTO_EXECUTE="_autoExecute",D.OLD_THRESHOLD=2e3,D.FAST_THRESHOLD=10,y.DocumentDataModel=D,pi=A=A||{},io.convertRollingToDate=function(t,e){var n,i,o=pi.Tools.convertValueToMoment(null,e);if(t=t||"NOW","duration"===pi.Tools.getTypeCategory(e)&&(o=pi.Tools.convertValueToDuration(o.formatNano("HH:mm:ss.SSS"),e)),"T"===t)_.includes(["date","datetime","timestamp"],e)&&o.set({hour:0,minute:0,second:0,millisecond:0});else if(t.toString().match(pi.RTTI.REGEX_ROLLING)){if(i=t.toString().match(/^T([\+|\-][\d:]+)/))if(-1!==i[1].indexOf(":")&&-1===i[1].indexOf("@"))o.add(p.duration(i[1]));else if(n=parseInt(i[1],10))switch(e){case"date":case"datetime":case"timestamp":o.set({hour:0,minute:0,second:0,millisecond:0}),o.add(n,"days");break;case"time":case"minute":o.add(n,"minutes");break;case"second":o.add(n,"seconds")}(i=t.toString().match(/(?:@)(.+)$/))&&(e=pi.Tools.convertUserInputToMoment(i[1],"HH:mm:ss.SSS")).isValid()&&!p.isDuration(o)&&(o.set({hour:e.hour(),minute:e.minute(),second:e.second(),millisecond:e.millisecond()}),e.nanosecond())&&o.nanosecond(e.nanosecond())}return o.toDashString()},io.convertViewSchemaToBackbone=function(e){var n=this,i={};return _.each(_.keys(e),function(t){_.isObject(e[t])?i[t]=n.convertViewSchemaToBackbone(e[t]):i[t]=e[t]}),m.Model.extend({defaults:function(){var e={};return _.each(_.keys(i),function(t){e[t]="function"==typeof i[t]?new i[t]:i[t]}),e}})},io.getGUID=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},io.preventBackspaceBack=function(){$(document).on("keydown",function(t){var e,n=!1;(n=8===t.which?!("INPUT"===(e=t.srcElement||t.target).tagName.toUpperCase()&&!_.includes(["RADIO","CHECKBOX"],e.type.toUpperCase())||"TEXTAREA"===e.tagName.toUpperCase()||$(e).hasClass("nicEdit-main"))||e.readOnly||e.disabled:n)&&t.preventDefault()})},io.validateGuid=function(t){return!!_.isString(t)&&t.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i)},pi.Helpers=io,di=A=A||{},hi=di.CommandoModel,e(M,hi),M.prototype.postInitialize=function(){var i=this;_.each(i.getViewStateList(),function(t){"dict"===t.model.get("_type")&&(t.model.set("_default",_.mapValues(t.model.get("_default"),function(t,e){var n;return _.isString(t)&&0===t.indexOf("<%")?n=i.getByPath(t.substring(2,t.length-2)):_.isObject(t)&&(t._viewType?t=t.value:t.isViewState&&(n=i.getByPath(t.name))),n||t}),{silent:!0}),t.model.set("value",t.model.get("_default")))})},M.prototype.destroyOnServer=function(e){e=e?_.clone(e):{};function n(){a.trigger("destroy",a,a.collection,e)}var i,o,s,a=this,r=e.success,l=e.wait,t=!(e.success=function(t){l&&n(),r&&r.call(e.context,a,t,e),a.isNew()||a.trigger("sync",a,t,e)});return this.isNew()?_.defer(e.success):(i=this,s=(o=e).error,o.error=function(t){s&&s.call(o.context,i,t,o),i.trigger("error",i,t,o)},t=this.sync("delete",this,e)),l||n(),t},M.prototype.doCommand=function(t,e){var n;if(0<t.length)return n=t.reverse().join("/"),this.getByPath(n).doCommand(t,e)},M.prototype.getByPath=function(t){var e;if(t)return _.isObject(t)?(console.warn("getByPath is deprecated, please update component."),t):(t=_.filter(t.split("/"),function(t){return t&&0<t.length}),e=this,_.each(t,function(t){e&&e.get&&(e=e.get(t))}),e)},M.prototype.getViewStateExport=function(){var a={},r=function(e,n){var i,o,s;if(e&&e.attributes)return _.each(_.keys(e.attributes),function(t){s=n?n+"/"+t:t,o=e.get(t),_.isObject(o)&&_.isFunction(o.get)&&(o.get("_viewType")?_.isEqual(o.get("value"),o.get("_default"))||(a[s]=o.get("value")):".settings"===s?(i=_.mapValues(o.attributes,function(t){return t.omit("version")}),_.isEmpty(i)||(a[".csettings"]=di.Tools.encodeToBase64(di.Tools.compress(JSON.stringify(i))))):r(o,s))}),a};return r(this)},M.prototype.getViewStateList=function(t){return this.viewStates=[],this.getViewStates(this),this.viewStates},M.prototype.getViewStates=function(e,n,i){var o,s,a=this;e.attributes&&_.each(_.keys(e.attributes),function(t){s=n?n+"/"+t:t,o=e.get(t),!i&&".settings"===t||(_.isObject(o)&&_.isFunction(o.get)&&o.get("_viewType")&&"."!==t.substr(0,1)?a.viewStates.push({model:o,path:s}):a.getViewStates(o,s,i))})},M.prototype.onChange=function(){var n=this;_.each(this.changedAttributes(),function(t,e){void 0===n.previous(e)&&t instanceof M?(n.stopListening(t,"change materialChange"),n.listenTo(t,"change",n.onChildModelChange),n.listenTo(t,"materialChange",n.onMaterialChange)):void 0===t&&n.previous(e)instanceof M&&(n.stopListening(n.previous(e),"change"),n.stopListening(n.previous(e),"materialChange"))}),this.changed&&_.some(this.MATERIAL_ATTRIBUTES,function(t){return n.hasChanged(t)})&&this.trigger("materialChange")},M.prototype.onChildModelChange=function(t,e){this.trigger("change",t,e)},M.prototype.postCommand=function(t,e){return e.path.push(this.id),this.parent.postCommand(this,e)},M.prototype.onMaterialChange=function(){this.trigger("materialChange")},M.prototype.setModelValue=function(i){var o=this,s=!1;"dict"===this.get("_type")&&_.each(_.pickBy(i,function(t,e){return o.get("value")[e]instanceof di.DocumentViewModel}),function(t,e){t=_.includes(_.keys(t),"value")?t.value:t;var n=o.get("value")[e];n.get("value")!==t&&(s=!0),n.setModelValue(t),i[e]=n}),this.set("value",i),s&&_.isEmpty(this.changed)&&this.trigger("change:value",this,i)},M.prototype.toJSON=function(o){var s=this,a={},t=_.keys(s.attributes);return o=!0===o||this.root&&this.root.withAllProperties,s.get("_rolling")&&di.Helpers.convertRollingToDate(s.get("_default"),s.get("_type"))===s.get("value")&&(t=_.without(t,"value")),_.each(t,function(t){var e,n=s.attributes[t],i={};if(".settings"===t)for(e in a[t]=n.toJSON(),a[t])a[t].hasOwnProperty(e)&&(a[t][e]=a[t][e].toJSON());else _.isObject(n)&&n.has&&n.has("_viewType")?(_.each(_.filter(_.keys(n.attributes),function(t){return!!o||0===t.indexOf("_")}),function(t){i[t]=n.get(t)}),"dict"===i._type&&(i._default=_.mapValues(n.get("_default"),function(t,e){return t instanceof M?"<%"+t.path+"%>":t}),i.value=_.mapValues(n.get("value"),function(t,e){return t instanceof M?"<%"+t.path+"%>":t})),a[t]=i):a[t]=n}),a},M.prototype.parse=function(t){var e;if(t&&t[".settings"]&&!((e=t[".settings"])instanceof m.Model)){for(var n in e)e.hasOwnProperty(n)&&(e[n]=new m.Model(e[n]));t[".settings"]=new m.Model(e)}return t},M.prototype.updateBinding=function(t,e,n,i,o){var s=_.isString(t)?this.getByPath(t):t;e.stopListening(n,"change:"+i),t&&s&&(o.push(s),n.set(i,s.get("value")),e.listenTo(s,"change:value",function(t,e){n.set(i,e)}),e.listenTo(n,"change:"+i,function(t,e){s.set("value",e)}))},M.prototype.updateBindingDeep=function(t,e,n,i,o){var s=this.get(t);e.stopListening(n,"change:"+i),t&&s&&(o.push(s),n.set(i,s.get("value")),e.listenTo(s,"change:value",function(t,e){n.set(i,e)}),e.listenTo(n,"change:"+i,function(t,e){s.set("value",e)}))},M.prototype.updateSchema=function(){var t=di.RTTI.getByName(this.get("_type")).editor;this.schema._default=t,this.schema.value=t},M.prototype.silentCast=function(t,e,n){this.get(t)instanceof e||this.set(t,new e(this.get(t),n),{silent:!0})},di.DocumentViewModel=M;var oo=A=A||{};so=oo.CommandoModel,e(ao,so),ao.prototype.clone=function(){var t=this.toJSON(),e=(delete t.id,t.widgets=t.widgets.clone(),new ao(t,{},this.parent));return t.widgets.setParent(e),e},ao.prototype.defaults=function(){return{id:null,name:"Screen 1",thumb:null,widgets:new oo.WidgetCollection([],{},this),relativeHeight:void 0,rowCount:void 0,rowHeight:void 0,colCount:36,floatable:!0}},ao.prototype.commandSet=function(t){var n=this,e=_.mapValues(t,function(t,e){return n.previous(e)});this.postCommand(this,new oo.Command("Set Screen",[],[new oo.Todo(oo.CommandOp.Set,"",t)],[new oo.Todo(oo.CommandOp.Set,"",e)]))},ao.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,this.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},ao.prototype.doCommand=function(t,e){var n=this;if(0<t.length){var i=t.pop();if("widgets"===i)return this.get(i).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){n.set(t.payload)})},ao.prototype.getComponents=function(){return this.get("widgets").getComponents()},ao.prototype.onMaterialChange=function(){this.trigger("materialChange")},ao.prototype.parseCastAndListen=function(t,e,n,i){!t||!t[e]||t[e]instanceof n||(t[e]=new n(t[e],{},this),this.listenTo(t[e],i,function(){this.trigger("change",this)}))},ao.prototype.parse=function(t){return this.parseCastAndListen(t,"widgets",oo.WidgetCollection,"change add remove"),t},ao.prototype.postCommand=function(t,e){return t instanceof oo.WidgetCollection&&e.path.push("widgets"),e.path.push(this.id),this.parent&&this.parent.postCommand(this,e)},ao.prototype.silentCast=function(t,e){this.get(t)instanceof e||this.set(t,new e(this.get(t),{},this),{silent:!0})};var so,Ne=ao;function ao(t,e,n){t=so.call(this,t,e,n)||this;return t.IMMATERIAL_ATTRIBUTES=["isDefault","thumb","widgets"],t.get("id")||t.set({id:oo.Helpers.getGUID()},{silent:!0}),t.get("widgets")&&(t.silentCast("widgets",oo.WidgetCollection),t.listenTo(t.get("widgets"),"change add remove",function(t){this.trigger("change")})),t.listenTo(t,"change",t.determineMaterialChange.bind(t)),t.listenTo(t.get("widgets"),"materialChange",t.onMaterialChange.bind(t)),t}oo.Screen=Ne,ro=oo.ComandoCollection,e(lo,ro);var ro,Ve=lo;function lo(){var t=null!==ro&&ro.apply(this,arguments)||this;return t.descriptor="Screen",t}(oo.ScreenCollection=Ve).prototype.model=Ne;var uo=A=A||{};co=uo.CommandoModel,e(ho,co),ho.prototype.convertPathsToModels=function(o){var e=this;_.each(this.attributes,function(i,t){i instanceof Array&&_.each(i,function(t,n){_.each(t,function(t,e){"viewstate"===t._dashboardsType&&(i[n][e]=o.getByPath(t.value))})}),"viewstate"===i._dashboardsType&&e.set(t,o.getByPath(i.value),{silent:!0})})},ho.prototype.defaults=function(){return{visible:!1,dialogTitle:"",dialogHeight:0,dialogWidth:0,modal:!1,resizable:!1,widgets:new uo.WidgetCollection([],{},this),id:uo.Helpers.getGUID()}},ho.prototype.doCommand=function(t,e){var n=this;if(0<t.length){var i=t.pop();if("widgets"===i)return this.get(i).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){t=_.isArray(t.payload)?_.find(t.payload,{id:n.id}):t.payload;t&&n.set(t)})},ho.prototype.getComponents=function(){return this.get("widgets").getComponents()},ho.prototype.postCommand=function(t,e){return t instanceof uo.WidgetCollection&&e.path.push("widgets"),e.path.push(this.id),this.parent.postCommand(this,e)},ho.prototype.onMaterialChange=function(){this.trigger("materialChange")},ho.prototype.transformToWidgetCollection=function(){var t=this.get("widgets");t instanceof uo.WidgetCollection||(t=new uo.WidgetCollection(t?t[0]:[],{},this),this.set("widgets",t,{silent:!0}))};var co,po=ho;function ho(t,e,n){t=co.call(this,t,e,n)||this;return t.idAttribute="id",t.get("id")||t.set({id:uo.Helpers.getGUID()},{silent:!0}),t.transformToWidgetCollection(),t.listenTo(t,"change",t.onMaterialChange.bind(t)),t.listenTo(t.get("widgets"),"add remove materialChange",t.onMaterialChange.bind(t)),t}uo.Popup=po,go=uo.ComandoCollection,e(fo,go),fo.prototype.commandSet=function(t){var n=this,e=[],i=this.toJSON(),o=[],e=_.differenceBy(t,i,function(t){return t.id}),s=_.filter(t,function(t){var e=n.get(t.id);return!!e&&e.changedAttributes(t)}),o=_.differenceBy(i,t,function(t){return t.id});e.length&&this.commandAdd(e.map(function(t){return new po(t,{},n)})),_.each(s,function(t){n.postCommand(n,new uo.Command(n.getCommandDescription(uo.CommandOp.Set,t),[t.id],[new uo.Todo(uo.CommandOp.Set,"",t)],[new uo.Todo(uo.CommandOp.Set,"",i)]))}),o.length&&this.commandRemove(o.map(function(t){return n.get(t.id)||new po(t,{},n)}))},fo.prototype.postInitialize=function(e){this.each(function(t){t.convertPathsToModels(e)}),this.trigger("viewStatesParsed"),this.listenTo(this,"add remove reset",function(){this.trigger("materialChange")})};var go,Be=fo;function fo(){var t=null!==go&&go.apply(this,arguments)||this;return t.descriptor="Popup",t}(uo.PopupCollection=Be).prototype.model=po;var E=A=A||{};mo=m.Model,e(P,mo),P.reorganizePopupsAndMappers=function(d,h){var g={"Basics.DialogHeight":"dialogHeight","Basics.DialogTitle":"dialogTitle","Basics.DialogWidth":"dialogWidth","Basics.Modal":"modal","Basics.Resizable":"resizable","Basics.Visible":"visible"},f=function(t){var n=[],p=function(e){var n,i,o,s,a,t,r,l,u=e.get("components"),c=e.get("widgets");e&&"Popup"===e.get("key")?(r=(t=e).get("options"),l={},_.each(g,function(t,e){e=r.get(e);_.isObject(e)&&"viewstate"===e._dashboardsType?l[t]=d.get("viewState").getByPath(e.value):l[t]=e}),l.widgets=t.get("widgets"),d.get("popups").add(l),h&&f(l.widgets)):e&&"QueryMapper"===e.get("key")?(o=(t=e).get("options").get("Basics.Mapping"),t=t.get("options").get("Basics.Data"),s={key:void 0,value:void 0,mappings:void 0},a=_.uniqueId("queryMapperUpgrade_"),(n=_.isObject(t)&&"data"===t._dashboardsType?d.get("data").getByPath(t.value):n)&&o&&o.length&&(i=n.get("_mappings")||{},n.subscribe(a,{onData:function(t,e){t=t.columns.collection.map("id");n.unsubscribe(a),s.key=t[0]||"",s.value=t[1]||"",s.mappings=i.mappings||{},_.each(o,function(t){t.Viewstate instanceof m.Model?s.mappings[t.Key]={_dashboardsType:"viewstate",value:t.Viewstate.path}:s.mappings[t.Key]=t.Viewstate||""}),n.set("_mappings",s),n.apply()}},!1))):u&&!u.isEmpty()?u.each(function(t){e&&_.includes(["Popup","QueryMapper"],e.get("key"))&&u.remove(t),p(t)}):c&&!c.isEmpty()&&f(c)};t.each(function(t){var e;(e=(t=t).get("component"))&&(_.includes(["Popup","QueryMapper"],e.get("key"))&&n.push(t),p(e))}),t.remove(n)};d.get(h?"popups":"screens").each(function(t){f(t.get("widgets"))})},P.renameCookie=function(t){_.each({viewStateDialogSize:"dashboard-viewStateDialog-size",viewStateDialogPosition:"dashboard-viewStateDialog-position",viewStateDialogWeights:"dashboard-viewStateDialog-weights","kx-datadialog-settings":"dashboard-datadialog-settings"},function(t,e){var n=$.cookie(e);$.removeCookie(e,{path:"/"}),$.cookie(t,n,{secure:"https:"===_.get(window,"location.protocol")})})},P.prototype.commandSet=function(t){var n=this,e=_.mapValues(t,function(t,e){return n.previous(e)}),t=new E.Command("Set Options",[],[new E.Todo(E.CommandOp.Set,"",t)],[new E.Todo(E.CommandOp.Set,"",e)]);this.postCommand(this,t)},P.prototype.defaults=function(){var t=new E.DocumentViewModel({selected:{_viewType:!0,_default:"0",value:""},".settings":new m.Model},{root:!0},this),e=new E.ScreenCollection([],{},this);return e.add(new E.Screen({},{},e)),{id:null,name:"My New Dashboard",creationDate:null,lastUpdateDate:null,thumb:null,screenDetails:[],screens:e,popups:new E.PopupCollection([],{},this),tags:[],dashboardTheme:_.capitalize(($.cookie("dashboard-theme")||"dark").replace(/(kx-|room)/g,"")),themeSwitchable:!0,saveTimestamp:null,relativeHeight:void 0,rowCount:void 0,rowHeight:void 0,colCount:36,floatable:!0,viewState:t,data:new E.DocumentDataModel({},null,"",t,!0),permissionEntity:null,worksheetPadding:10,widgetsSpacing:0,borderColor:"000000",borderBackground:"000000",transparentBackground:!0,borderWidth:0,borderRounding:0,borderSpacing:0,borderShadow:!1,saveViewerState:"enabled",hostnameAccess:"",hash:"",enableShareDashboard:!1,notifications:null,showLoadingIndicators:!0,unsavedViewerPrompt:!1,advancedCss:"",cssClasses:"",version:"4.7.4"}},P.prototype.doCommand=function(t,e){var n=this;if(0<t.length){var i=t.pop();if(-1!=["screens","popups","data","viewState"].indexOf(i))return this.get(i).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){n.set(t.payload)})},P.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,this.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},P.prototype.getComponents=function(){return this.get("screens").getComponents().concat(this.get("popups").getComponents())},P.prototype.onViewStateInit=function(){this.addSystemViewStates(),this.get("viewState").postInitialize();var t=this.get("cssClasses");t&&"viewstate"===t._dashboardsType&&this.set("cssClasses",this.get("viewState").getByPath(t.value),{silent:!0}),this.get("popups").postInitialize(this.get("viewState")),this.viewStateInit=!0},P.prototype.addSystemViewStates=function(){this.get("viewState").has("_settings")||this.get("viewState").set("_settings",new E.DocumentViewModel({dashboardUser:{_viewType:!0,_type:"symbol",_default:""},dashboardTimezone:{_viewType:!0,_type:"symbol",_default:""},dashboardUrl:{_viewType:!0,_type:"string",_default:""},dashboardTitle:{_viewType:!0,_type:"symbol",_default:""},dashboardStartTimestamp:{_viewType:!0,_type:"timestamp",_default:"",_rolling:!0}},{path:"_settings",root:!0},this))},P.prototype.saveDelayed=function(t){var e=this;this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(function(){return e.saveNow(t)},this.SAVE_DELAY)},P.prototype.saveNow=function(t,e){var n,i=this,o=[];_.isEmpty(this.get("screens").models)?(t("Document is empty, skipping save."),E.Log.Warn("Document is empty, skipping save.")):(this.saveTimeout&&clearTimeout(this.saveTimeout),E.Log.Info("SAVE",this.id),this.set({lastUpdateDate:(new Date).toUTCString()},{silent:!0}),_.each(this.get("screens").models,function(t){o.push({label:t.get("name"),value:t.id})}),this.set({screenDetails:o}),this.set({thumb:0<this.get("screens").models.length?this.get("screens").models[0].get("thumb"):null},{silent:!0}),n=$.extend(!0,{},this.attributes),this.setDataProperties(n.notifications),this.setDataProperties(n.shortcuts),n.popups.each(function(t){t.set(i.setDataProperties(_.omit(t.attributes,"widgets")),{silent:!0})}),n.cssClasses=this.setViewStateProperty(n.cssClasses),this.save(n,{error:t,success:function(t){E.Log.Info("success",arguments),i.trigger("documentSaved"),i.set("wasChanged",!1),e&&e(t)}}))},P.prototype.silentCast=function(t,e,n){this.get(t)instanceof e||this.set(t,new e(this.get(t),n,this),{silent:!0})},P.prototype.setDataProperties=function(t){if(t){for(var e in t)t[e]&&t[e].path?t[e]instanceof E.DocumentDataModel?t[e]={_dashboardsType:"data",value:t[e].path}:t[e]instanceof E.DocumentViewModel&&(t[e]={_dashboardsType:"viewstate",value:t[e].path}):"object"==typeof t[e]&&(t[e]=this.setDataProperties(t[e]));return t}},P.prototype.setViewStateProperty=function(t){return t=t instanceof E.DocumentViewModel?{_dashboardsType:"viewstate",value:t.path}:t},P.prototype.toJSON=function(){var e=this,t=$.extend(!0,{},this.attributes);return this.setDataProperties(t.notifications),this.setDataProperties(t.shortcuts),t.popups.each(function(t){t.set(e.setDataProperties(_.omit(t.attributes,"widgets")))}),t.cssClasses=this.setViewStateProperty(t.cssClasses),t},P.prototype.toJSONClone=function(){var e=this,t=_.cloneDeep(this.attributes);return this.setDataProperties(t.notifications),this.setDataProperties(t.shortcuts),t.popups.each(function(t){t.attributes=_.extend(e.setDataProperties(_.omit(t.attributes,"widgets")),{widgets:t.get("widgets")})}),t.cssClasses=this.setViewStateProperty(t.cssClasses),t},P.prototype.parseCastAndListen=function(t,e,n,i,o){!t||!t[e]||t[e]instanceof n||(t[e]=o?o(t[e]):new n(t[e],{},this))},P.prototype.postCommand=function(t,e){return t instanceof E.ScreenCollection?e.path.push("screens"):t instanceof E.PopupCollection?e.path.push("popups"):t instanceof E.DocumentDataModel?e.path.push("data"):t instanceof E.DocumentViewModel&&e.path.push("viewState"),this.trigger("postCommand"),this.set("wasChanged",!0),P.parent&&P.parent.postCommand(this,e)},P.prototype.parse=function(n){var t=this.get("cssClasses");return t&&"viewstate"===t._dashboardsType&&this.set("cssClasses",this.get("viewState").getByPath(t.value)),this.parseCastAndListen(n,"viewState",E.DocumentViewModel,"change",function(t){return new E.DocumentViewModel(t,{root:!0},this)}),this.parseCastAndListen(n,"data",E.DocumentDataModel,"change",function(t){return new E.DocumentDataModel(t,null,"",n.viewState,!0)}),this.parseCastAndListen(n,"screens",E.ScreenCollection,"change add remove"),this.parseCastAndListen(n,"popups",E.PopupCollection,"change add remove"),this.viewStateInit&&this.get("popups").postInitialize(this.get("viewState")),_.each(n.shortcuts,function(t){var e=t.Data;e&&"data"===e._dashboardsType&&(t.Data=n.data.getByPath(e.value))}),n},P.prototype.upgrade=function(){var t,e;if(0<_.keys(this.attributes).length)for(t=E.Document.upgrades.indexOf(_.find(E.Document.upgrades,{version:this.get("version")}))+1;t<E.Document.upgrades.length;t+=1)(e=E.Document.upgrades[t]).fn(this),this.set("version",e.version)},P.upgrades=[{version:"4.3.0",fn:function(n){_.each(n.get("viewState").getViewStateList(),function(t){function e(t){return t=t instanceof E.DocumentViewModel?t.path:_.isObject(t)?t.name:t,n.get("viewState").getByPath(t)}"dict"===t.model.get("_type")&&(t.model.set("_default",_.mapValues(t.model.get("_default"),e)),t.model.set("value",_.mapValues(t.model.get("value"),e)))})}},{version:"4.4.0",fn:function(t){P.reorganizePopupsAndMappers(t,!1)}},{version:"4.4.0p7",fn:function(t){P.reorganizePopupsAndMappers(t,!0)}},{version:"4.6.0",fn:function(t){t.set("saveViewerState",!1===t.get("enableSaveViewState")?"disabled":"enabled")}},{version:"4.6.0P1",fn:function(t){P.renameCookie(t)}},{version:"4.7.3",fn:function(t){var e=t.get("hostnameAccess");t.set("hostnameAccess",_.isNil(e)?"":e)}},{version:"4.7.4",fn:function(t){var e=t.get("hash");t.set("hash",e||t.id)}}];var mo,$e=P;function P(t,e){var t=mo.call(this,t,e)||this,n=(t.IMMATERIAL_ATTRIBUTES=["data","viewState","wasChanged"],t.sampleData=null,t.SAVE_DELAY=3e4,t.saveTimeout=null,t.viewStateInit=!1,t);return t.get("id")||(e=E.Helpers.getGUID(),t.set({id:e,hash:e},{silent:!0})),t.silentCast("viewState",E.DocumentViewModel,{root:!0}),t.silentCast("popups",E.PopupCollection),t.silentCast("screens",E.ScreenCollection),t.get("data")instanceof E.DocumentDataModel||t.set("data",new E.DocumentDataModel(t.get("data"),null,"",t.get("viewState"),!0),{silent:!0}),t.listenTo(t,"view-state-init",t.onViewStateInit),t.listenTo(t,"change",t.determineMaterialChange),t.listenTo(t.get("screens"),"change add remove",function(t){n.trigger("change",arguments)}),t.has("showLoadingIndicators")||t.set("showLoadingIndicators",!0,{silent:!0}),t}E.Document=$e,yo=m.Collection,e(vo,yo),vo.prototype.getSortedDocuments=function(){return this.sortBy(function(t){return 3-(2*(_.includes(t.get("tags"),"defaultdash")?1:0)+(_.includes(t.get("tags"),"starred")?1:0))+t.get("name")})},vo.requiredAccessLevel=null;var yo,n=vo;function vo(t,e){t=yo.call(this,t,e)||this;if(vo.singleton)throw"Singleton Error! DocumentCollection() invoked 2x.";return vo.singleton=t}function I(){return null!==gi&&gi.apply(this,arguments)||this}function bo(){}function wo(t){var e,n=this;(n=fi.call(this,t)||this).cssClass=t.cssClass,n.anchorEl=t.anchorEl,n.data=t.data||{},n.text=t.text,n.position=t.position,n.$el.addClass("generic-tooltip "+n.cssClass);for(var i=t.anchorEl;i&&(null==(e=i.classList)||!e.contains("ui-dialog"));)i=i.parentNode;return null!=(t=null==i?void 0:i.classList)&&t.contains("ui-dialog")?n.$el.appendTo(i):n.$el.appendTo("#appdiv"),n.compileTemplate(),n}function So(){}function _o(){}(E.DocumentCollection=n).prototype.model=$e,v=A=A||{},gi=v.DCBase,e(I,gi),I.createLog=function(t,e,n){var i,o,s,a;this.deltaClient&&this.deltaClient.clientLoggingEnabled()&&(a=[],_.isString(t)&&(a=t.split("<--\x3e")),t=this.username,i=a[0]||"",o=a[1]||"",s=a[2]||"",a=a[3]||"",this.deltaClient.request("ClientLoggerAPI.log",function(t){_.isFunction(e)&&e()},function(t){console.log("Client logging FAILED\n\n"),null==t?console.log("Client logging: "+s+"failed. Data is null"):console.log("Client logging:",t.toString()),_.isFunction(n)&&n()},t,o,i,s,a))},I.deleteComponent=function(t,e,n){this.deltaClient.request("ComponentAPI.deleteComponent",function(t){e(t)},function(t){n(t)},t)},I.connectionCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for DocumentCollection";I.deltaClient.request("ConnectionAPI.getConnections",I.generateSuccessCallback(n),I.generateErrorCallback(n,"Error reading connections"))},I.connectionSync=function(t,e,n){var i,o=this;switch(t){case"update":(i=new win.ConnectionEntity).originalName=o.get("originalName");case"create":(i=i||new win.ConnectionEntity).name=o.id,i.host=o.get("host"),i.port=o.get("port"),i.user=o.get("user"),i.password=o.get("password"),i.type=o.get("type"),i.driver=o.get("driver"),i.tls=o.get("tls"),I.deltaClient.request("ConnectionAPI.updateConnections",I.generateSuccessCallback(n),I.generateErrorCallback(n,"Error "+t.substring(0,5)+"ing connection"),[i],[]);break;case"delete":I.deltaClient.request("ConnectionAPI.updateConnections",I.generateSuccessCallback(n),I.generateErrorCallback(n,"Error deleting connection"),[],[o.id]);break;default:throw"data operation not supported for Document"}},I.connectionGroupCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for ConnectionGroup Collection";I.deltaClient.request("ConnectionAPI.getConnectionGroups",I.generateSuccessCallback(n),I.generateErrorCallback(n,"Error reading connection groups"))},I.connectionGroupSync=function(t,e,n){var i;switch(t){case"create":(i=new win.ConnectionGroupEntity).name=this.id,i.type=this.get("type"),i.connections=this.get("connections"),i.connectionsType=this.get("connectionsType"),I.deltaClient.request("ConnectionAPI.createConnectionGroup",I.generateSuccessCallback(n),I.generateErrorCallback(n,"Error creating connection group"),i);break;case"update":(i=new win.ConnectionGroupEntity).name=this.id,i.type=this.get("type"),i.connections=this.get("connections");for(var o=0;o<i.connections.length;o+=1)i.connectionsType.push("default");I.deltaClient.request("ConnectionAPI.updateConnectionGroup",I.generateSuccessCallback(n),I.generateErrorCallback(n,"Error updating connection group"),i);break;case"delete":I.deltaClient.request("ConnectionAPI.deleteConnectionGroup",I.generateSuccessCallback(n),I.generateErrorCallback(n,"Error deleting connection group"),this.id);break;default:throw"data operation not supported for Connection Group"}},I.documentCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for DashCollection";I.deltaClient.request("ProjectAPI.getDashboards",function(t){var s=[];_.each(t,function(e){if(!e.accessLevel||!v.DocumentCollection.requiredAccessLevel||e.accessLevel===v.DocumentCollection.requiredAccessLevel)try{var t=JSON.parse(e.description),n=this.location.hostname,i=t.hostnameAccess,o=t.hash||"";(!i||0<=i.indexOf(n))&&s.push(new v.Document({id:e.name,name:e.displayName,creationDate:t.creationDate,lastUpdateDate:t.lastUpdateDate||t.creationDate,screenDetails:t.screenDetails||[],thumb:t.thumb||null,tags:t.tags||[],hostnameAccess:i,hash:o}))}catch(t){v.Log.Error("Error parsing dashboard description",e)}}),n.success&&n.success(s)},function(t){alert("Retrieve Dashboards FAILED"),n.error&&n.error(t)})},I.documentSync=function(t,e,n){function i(t){I.deltaClient.request("ProjectAPI.deleteDashboard",function(t){t?n.success&&n.success():n.error&&n.error()},function(t){n.error&&n.error(t)},t.id)}var o,s=this;switch(t){case"read":I.deltaClient.request("ProjectAPI.getDashboard",function(t){var e;t?((e=JSON.parse(t.dataJSON)).permissionEntity=t.permissionEntity,n.success&&n.success(e)):n.error&&n.error()},function(t){n.error&&n.error(t)},s.id);break;case"update":var a=s.get("hash"),r=s.id;a&&r!==a&&(i(s),s.set("id",a),e.set("id",a)),o={id:a||s.id,name:a||s.id,displayName:s.get("name"),description:JSON.stringify({creationDate:s.get("creationDate"),lastUpdateDate:s.get("lastUpdateDate"),tags:s.get("tags"),screenDetails:s.get("screenDetails"),thumb:s.get("thumb"),hostnameAccess:s.get("hostnameAccess"),hash:a},null,2),dataJSON:JSON.stringify(_.omit(s.attributes,["permissionEntity"]),null,2),class:"api.entity.DashboardEntity",permissionEntity:{permissions:s.get("permissionEntity")?s.get("permissionEntity").permissions:{}}},I.deltaClient.request("ProjectAPI.setDashboard",function(t){t?n.success&&(n.success(s.attributes),a)&&r!==a&&(window.location.hash="#"+a,window.location.reload()):n.error&&n.error()},function(t){n.error&&n.error(t)},o);break;case"delete":i(s);break;default:throw"data operation not supported for Document"}},I.documentViewSync=function(t,e,n){var i,o=this;switch(t){case"read":i=I.generateErrorCallback(n,"Error reading viewstate"),I.deltaClient.request("UserSettingsAPI.readUserSetting",function(t){var e;t?n.success&&(t&&t[0]&&(e=JSON.parse(t[0].jsonData)),n.success(e)):i()},i,o.id);break;case"create":case"update":i=I.generateErrorCallback(n,"Error updating viewstate"),I.deltaClient.request("UserSettingsAPI.updateUserSetting",function(t){t?n.success&&n.success(o.attributes):i()},i,{class:"api.entity.UserSettingEntity",id:o.id,type:"dashboard_view_state",jsonData:o.attributes});break;case"delete":i=I.generateErrorCallback(n,"Error deleting viewstate"),I.deltaClient.request("UserSettingsAPI.deleteUserSetting",function(t){t?n.success&&n.success():i()},i,o.id);break;default:throw"data operation not supported for user settings: "+t}},I.exportAnalyticData=function(t,e,n,i,o,s,a){var r=[],l=null;n=n||[],_.keys(o).length&&(l=this.processExportParams(o)),this.createParamsObj(r,n),I.exportData(i,t,r,l,e,s,a)},I.exportQueryData=function(t,e,n,i,o,s,a){var r=[],e=kdb.KDBQuery.create(e,void 0,void 0,!0);n&&(this.createParamsObj(r,n),e.parameters=r,_.keys(o).length)&&(e.uiParams=this.processExportParams(o)),I.exportData(i,e,null,null,t,s,a)},I.exportPivotData=function(t,e,n){var i,o=t.pivotSource,s=t.queryParams,a=[],r={},l="";t&&(t.exportName&&(l=t.exportName),t.exportParams)&&(r=t.exportParams),i=v.Pivot.constructPivotQuery(t),i=kdb.KDBQuery.create(i,void 0,void 0,!0),"query"===o&&(this.createParamsObj(a,s),i.parameters=a,_.keys(r).length)&&(i.uiParams=this.processExportParams(r)),I.exportData(l,i,null,null,t.connection,e,n)},I.exportData=function(n,t,e,i,o,s,a){var r=this,a=["ExportAPI.export"+(n?"ToFile":""),function(t){var e;_.isFunction(s)&&(e=t+"/"+(t=(n||t)+".zip"),t=r.deltaClient.connection.url+"/FileDownloadServlet?client="+r.deltaClient.base64DeltaClient()+"&filename="+t+"&filepath="+e,s(t))},a,t];e&&a.push(e),i&&a.push(i),a.push(o),n&&a.push(n),this.deltaClient.request.apply(this.deltaClient.request,a)},I.generateSuccessCallback=function(e){return function(t){e.success&&e.success(t)}},I.generateErrorCallback=function(e,n){return function(t){v.Log.Error(n,t),e.error&&e.error(t)}},I.getComponents=function(e,n){v.Log.Info("Running Get Components"),this.deltaClient.request("ComponentAPI.getComponents",function(t){e(t)},function(t){n(t)})},I.getDeltaAnalytics=function(e){this.deltaClient.request("AnalyticAPI.getAnalytics",function(t){e&&e(t)},function(){v.Log.Error("Failed to retrieve Analytics\n\n")})},I.getDeltaInstances=function(e){this.deltaClient.request("ConnectionAPI.getProcessInstances",function(t){e&&e(t)},function(){v.Log.Error("Failed to retrieve Instances\n\n")})},I.getPivotData=function(t,i,e,o){var n=t.connection,s=t.pivotSource,a=t.queryParams,r=[],l=t.maxRows||null,u=v.Pivot.constructPivotQuery(t),u=kdb.KDBQuery.create(u,l);"query"===s&&(this.createParamsObj(r,a),u.parameters=r),o&&o.trigger("serverStart"),this.deltaClient.request("QueryAPI.runQueryBA",function(t,e){o&&o.trigger("serverEnd");var n=v.deserialize(e);i&&i(n,e)},function(){e&&e(arguments)},u,n),"subscription"===t.subscriptionType&&(o&&o.trigger("serverStart"),this.deltaClient.request("SubscriptionAPI.addSubscription",function(t,e){i&&(o&&o.trigger("serverEnd"),e&&e.byteLength&&(t.dataSet=v.deserialize(e)),i(t,e))},function(t){e&&e(t)},u,n,1e3*t.subscriptionInterval))},I.getPolledSubscription=function(e){return this.deltaClient.connection.oobupdate.filter(function(t){return"QRPolledMessage"===t.type&&t.data[0]===e})},I.getQueryData=function(t,e,n,i,o,s,a,r,l){I.getQueryData2(t,e,n,i,I.legacyRowCallback(o),s,a,r,l)},I.getQueryData2=function(t,n,e,i,o,s,a,r,l){var u,c,p,d=[],h=a&&0!=a?Number(a):null,g=this;r&&n&&_.includes(I.PAGING_TYPES,r.type)||(r={type:"NONE"}),"sql"===t?this.getSqlQueryData(n,this.strip(e),i,o,s,a):(r&&"NONE"!==r.type?(c=new kdb.QDict,_.each(r.sorting,function(t,e){c.add(e,!0===t,kdb.KDB.BOOLEAN)}),(u=kdb.KDBQuery.createPaged(this.strip(e),r.type,r.num,r.size,c)).unlimitedRows=-1===r.size):u=kdb.KDBQuery.create(this.strip(e),h),i&&(this.createParamsObj(d,i),u.parameters=d),v.Log.Info("QUERY: ",u),g=this,t=[n?"QueryAPI.runQueryBA":"QueryAPI.runQuery",function(t,e){l&&l.trigger("serverEnd"),g.deltaClient.connection.removeResponder(p.uid);t=n?v.deserialize(e):t;o&&o(t,e)},function(){g.deltaClient.connection.removeResponder(p.id),s&&s(arguments)},u],n&&t.push(n),l&&l.trigger("serverStart"),p=this.deltaClient.request.apply(this.deltaClient.request,t))},I.getConfigAPIDataWithProfile=function(t,e,n,i,o,s,a,r){n=[n,function(t){t&&a&&a(t)},function(){r&&r(arguments)},i,o,s];e&&n.push(e),this.deltaClient.request.apply(this.deltaClient.request,n)},I.getConfigAPIData=function(t,e,n,i,o,s){n=[n,function(t){t&&o&&o(t)},function(){s&&s(arguments)},i];e&&n.push(e),this.deltaClient.request.apply(this.deltaClient.request,n)},I.getConfigAPIDataNoParam=function(t,e,n,i,o){n=[n,function(t){t&&i&&i(t)},function(){o&&o(arguments)}];e&&n.push(e),this.deltaClient.request.apply(this.deltaClient.request,n)},I.getAPIQueryData=function(t,n,e,i,o,s){var a=[],r=kdb.APIQuery.create(e);r.lambda=e,this.createParamsObj(a,i),r.parameters=a,e=[n?"QueryAPI.runQueryBA":"QueryAPI.runQuery",function(t,e){t=n?v.deserialize(e):t;o&&o(t,e)},function(){s&&s(arguments)},r],n&&e.push(n),this.deltaClient.request.apply(this.deltaClient.request,e)},I.getSqlQueryData=function(t,e,n,i,o,s){var a,r=[],s=s||2e3;e=$.trim(e),n?(a=kdb.SQLQuery.create(e,s),this.createSqlParamsObj(r,n),a.parameters=r):a=kdb.SQLQuery.create(e,s),n&&(a=kdb.SQLQuery.create(e,s),this.createSqlParamsObj(r,n),a.parameters=r),this.deltaClient.request("QueryAPI.runQuery",function(t){i&&i(t)},function(){o&&o(arguments)},a,t)},I.isConnectionAlive=function(t){return this.deltaClient.request("ConnectionAPI.isAlive",function(t){v.Log.Info(t)},function(t){v.Log.Info(t)},t)},I.legacyRowCallback=function(n){return function(t,e){n&&(e&&e.byteLength&&(t.dataSet?t.dataSet=v.ipc.Parse.reshape(t.dataSet,e).toLegacy():t=v.ipc.Parse.reshape(t,e).toLegacy()),n(t))}},I.logout=function(){this.deltaClient?this.deltaClient.logout():($.removeCookie("deltaToken",{path:"/"}),location.reload())},I.processExportParams=function(o){var s=new kdb.QDict;return _.each({columnLabel:"SYMBOL",dateFormat:"STRING"},function(e,t){var n,i;o[t]&&o[t].length&&(n=new kdb.QDict,i=o[t].split("&&"),_.each(i,function(t){t=t.trim().split("#");n.add(t[0],t[1],kdb.KDB[e])}),s.add(t,n,kdb.KDB.DICT))}),s},I.runAnalytic=function(t,e,n,i,o,s,a,r){I.runAnalytic2(t,e,n,I.legacyRowCallback(i),o,s,a,r)},I.runAnalytic2=function(e,n,t,i,o,s,a,r){var l,u,c=[],s=s&&0!=s?Number(s):null,p=this;t=t||[],n=n||"ds_rdb_fx_eval",a&&n&&_.includes(I.PAGING_TYPES,a.type)||(a={type:"NONE"}),this.createParamsObj(c,t),a&&"NONE"!==a.type?(r&&r.trigger("serverStart"),l=this.deltaClient.request(n?"AnalyticAPI.runPagedBA":"AnalyticAPI.runPaged",function(t,e){r&&r.trigger("serverEnd"),p.deltaClient.connection.removeResponder(l.uid);t=n?v.deserialize(e):t;i&&i(t,e)},function(t){p.deltaClient.connection.removeResponder(l.uid),v.Log.Error("Analytic run failed ("+e+")",t),o&&o(t)},e,c,n,a.type,a.num,a.size,_.keys(a.sorting)[0]||"",_.values(a.sorting)[0]||!1)):(r&&r.trigger("serverStart"),u=this.deltaClient.request(n?"AnalyticAPI.runBA":"AnalyticAPI.run",function(t,e){r&&r.trigger("serverEnd"),p.deltaClient.connection.removeResponder(u.uid);t=n?v.deserialize(e):t;i&&i(t,e)},function(t){p.deltaClient.connection.removeResponder(u.uid),v.Log.Error("Analytic run failed ("+e+")",t),o&&o(t)},e,c,n,s))},I.runApiFunction=function(n,t,e,i,o){var s=_.once(function(t,e){t?e&&i&&i(e):(v.Log.Error("Api Analytic run failed ("+n+")",e),o&&o(e)),clearTimeout(this.timeout)});this.timeout=_.delay(function(){s&&s(!1,"timed out")},this.DEFAULT_TIMEOUT),e=_.flatten([n,_.partial(s,!0,_),_.partial(s,!1,_),e]),this.deltaClient.request.apply(this.deltaClient,e)},I.servicesSync=function(t,e,n){throw"data operation not supported for Service"},I.servicesCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for Service Collection";I.deltaClient.request("ConnectionAPI.getServiceClasses",I.generateSuccessCallback(n),I.generateErrorCallback(n,"Error reading services data"))},I.setComponent=function(e,t,n,i,o,s){this.deltaClient.request("ComponentAPI.setComponent",function(t){v.Log.Info("Save component "+e+" successful",t),o(t)},function(t){v.Log.Error("Save Dashboard "+e+" FAILED"),s(t)},{name:e,displayName:t,description:n,dataJSON:i,class:"api.entity.ComponentEntity"})},I.startManagedAnalytic=function(t,e,n,i,o,s,a,r){I.startManagedAnalytic2(t,e,n,I.legacyRowCallback(i),o,s,a,r)},I.startManagedAnalytic2=function(n,i,t,e,o,s,a,r){var l=this,u=[],c=e||_.noop,p=a||null;this.createParamsObj(u,t=t||[]),r&&r.trigger("serverStart"),this.deltaClient.request(i?"AnalyticAPI.runBA":"AnalyticAPI.run",function(t,e){r&&r.trigger("serverEnd"),t=t||{},e&&e.byteLength&&(t=v.deserialize(e)),c(t,e),l.deltaClient.request("AnalyticAPI.startPolled",function(t,e){"com.fd.delta.stream.queryrouter.entity.QRResponseMessage"==t.class&&t.success?c({class:"207",add:!0,subId:t.runID,clientId:"polled"},void 0):o(t),I.getPolledSubscription(t.runID).subscribe(function(t){t.data[1]||o("Analytic Failed: "+t.data),r&&r.trigger("serverEnd"),t.appMsg&&t.appMsg.byteLength&&(t.data.class="209",t.data.subId=t.data[0],t.data.clientId="polled",t.data.dataSet=v.deserialize(t.appMsg)),c(t.data,t.appMsg)})},function(t){v.Log.Error("Managed Analytic run failed.",t),o&&o(t)},n,u,i,s,p)},function(t){v.Log.Error("Analytic run failed.",t),o&&o(t)},n,u,i,p)},I.startLegacyManagedQuery=function(t,e,n,i,o,s,a,r,l){I.startLegacyManagedQuery2(t,e,n,I.legacyRowCallback(i),o,s,a,r,l)},I.startLegacyManagedQuery2=function(t,e,n,i,o,s,a,r,l){var u,c,p=this,d=i||_.noop,i=[],a=a&&0!=a?Number(a):null,r=(r=r&&t&&_.includes(I.PAGING_TYPES,r.type)?r:{type:"NONE"})&&"NONE"!==r.type?(u=new kdb.QDict,_.each(r.sorting,function(t,e){u.add(e,!0===t,kdb.KDB.BOOLEAN)}),kdb.KDBQuery.createPaged(this.strip(e),r.type,r.num,r.size,u)):kdb.KDBQuery.create(this.strip(e),a);n&&(this.createParamsObj(i,n),r.parameters=i),e=[t?"QueryAPI.runQueryBA":"QueryAPI.runQuery",function(t,e){t=t||{},l&&l.trigger("serverEnd"),e&&e.byteLength&&(t=v.deserialize(e)),d(t,e),p.deltaClient.request.apply(p.deltaClient.request,c)},function(){o&&o(arguments)},r,t],c=["SubscriptionAPI.addSubscription",function(t,e){d&&(e&&e.byteLength&&(t.dataSet=v.deserialize(e)),d(t,e))},function(t){o&&o(t)},r,t,s],l&&l.trigger("serverStart"),this.deltaClient.request.apply(this.deltaClient.request,e)},I.startManagedQuery=function(t,e,n,i,o,s,a,r,l){I.startManagedQuery2(t,e,n,I.legacyRowCallback(i),o,s,a,r,l)},I.startManagedQuery2=function(t,e,n,i,o,s,a,r,l){var u,c=i||_.noop,i=[],a=a&&0!=a?Number(a):null,r=(r=r&&t&&_.includes(I.PAGING_TYPES,r.type)?r:{type:"NONE"})&&"NONE"!==r.type?(u=new kdb.QDict,_.each(r.sorting,function(t,e){u.add(e,!0===t,kdb.KDB.BOOLEAN)}),kdb.KDBQuery.createPaged(this.strip(e),r.type,r.num,r.size,u)):kdb.KDBQuery.create(this.strip(e),a);n&&(this.createParamsObj(i,n),r.parameters=i),l&&l.trigger("serverStart"),this.deltaClient.request("QueryAPI.startPolledQuery",function(t){"com.fd.delta.stream.queryrouter.entity.QRResponseMessage"==t.class&&t.success?c({class:"207",add:!0,subId:t.runID,clientId:"polled"},void 0):o(t),I.getPolledSubscription(t.runID).subscribe(function(t){if(l&&l.trigger("serverEnd"),!t.data[1])return o("Query Failed: "+t.data);t.appMsg&&t.appMsg.byteLength&&(t.data.class="209",t.data.subId=t.data[0],t.data.clientId="polled",t.data.dataSet=v.deserialize(t.appMsg)),c(t.data,t.appMsg)})},function(){o&&o(arguments)},r,t,s)},I.startStreamingAnalytic=function(t,e,n,i,o,s){I.startStreamingAnalytic2(t,e,n,I.legacyRowCallback(i),o,s)},I.startStreamingAnalytic2=function(n,t,e,i,o,s){var a=[];this.createParamsObj(a,e||[]),s&&s.trigger("serverStart"),this.deltaClient.request("AnalyticAPI.startStreaming",function(t,e){s&&s.trigger("serverEnd"),e&&e.byteLength&&(t.dataSet=v.deserialize(e)),e&&10===e.byteLength&&101===new DataView(e).getInt8(8)?v.Log.Info("Streaming "+n+" returned unary primitive!"):i&&i(t,e)},function(t){v.Log.Info("Analytic run failed.",t),o&&o(t)},n,a,t)},I.strip=function(t){var e;return t=null!=t&&0!=t.length&&(t=t.replace(/((^|\s+)\/.*$)|^\s+|\s*\n/gm," "),e=/^\{(.*)\}\s*\[\]\s*$/g.exec(t))?e[1]:t},I.removeSubscriptions=function(t){var n,i,o,e,s=this;t?(n=0==t.indexOf("polled:"),i=n?t.substr(7):t.split(":")[1],o=this.deltaClient.request(n?"QueryAPI.stopPolledQuery":"SubscriptionAPI.removeSubscription",function(t){var e;n&&-1!=(e=I.getPolledSubscription(i))&&e.unsubscribe(),s.deltaClient.connection.removeResponder(o.uid),v.Log.Info("Stop Subscriptions succeeded.",t)},function(t){s.deltaClient.connection.removeResponder(o.uid),v.Log.Error("Stop Subscriptions failed",t)},n?[i]:t),this.deltaClient.connection.removeResponder(i)):(e=this.deltaClient.request("SubscriptionAPI.removeSubscriptions",function(t){s.deltaClient.connection.removeResponder(e.uid),v.Log.Info("Stop Subscriptions succeeded.",t)},function(t){s.deltaClient.connection.removeResponder(e.uid),v.Log.Error("Stop Subscriptions failed",t)}),this.deltaClient.connection.oobupdate.filter(function(t){return"QRPolledMessage"===t.type}).unsubscribe())},I.updateTable=function(n,t,e){for(var i=this,o=[],s=0;s<3;s+=1)o[s]={type:"dict",value:{},index:s};_.each(n.updateParams,function(t){o.push(t)}),_.each(o,function(t,e){t.index=e}),_.each(n.addedDict.items,function(t,e){o[0].value[e]={type:i.updateTableGetListType(n.typeConfig[e],t),value:t}}),_.each(n.updatedDict.items,function(t,e){o[1].value[e]={type:i.updateTableGetListType(n.typeConfig[e],t),value:t}}),_.each(n.deletedDict.items,function(t,e){o[2].value[e]={type:i.updateTableGetListType(n.typeConfig[e],t),value:t}}),"analytic"===n.updateType?n.updateAnalytic&&i.runAnalytic(n.updateAnalytic,n.connection,o,t,e):i.getQueryData("kdb",n.connection,n.query,o,t,e)},I.updateTableGetListType=function(t,e){var n;switch(t){case 0:return n=_.isArray(e)?_.isBoolean(e[0])?"listlistboolean":_.isString(e[0])?"listliststring":"listlistsymbol":_.isString(e)?"string[]":"symbol[]";case 1:return"boolean[]";case 2:return"guid[]";case 4:return"byte[]";case 5:return"short[]";case 6:return"int[]";case 7:return"long[]";case 8:return"real[]";case 9:return"float[]";case 10:return n="char[]",_.each(e,function(t){1<t.length&&(n="string[]")}),n;case 11:return"symbol[]";case 12:return"timestamp[]";case 13:return"month[]";case 14:return"date[]";case 15:return"datetime[]";case 16:return"timespan[]";case 17:return"minute[]";case 18:return"second[]";case 19:return"time[]";default:return"symbol[]"}},I.createDeltaObj=function(n){function i(t){return _.has(t,"i")||"string"!=typeof t?t:(10<(t=t.replace("D","T").replace(/(\d\d\d\d)\.(\d\d)\.(\d\d)/,"$1-$2-$3")).length&&(t+="Z"),v.Tools.convertISODatetimeToKDBLikeObject(t))}var o,s,a,e;switch(n.type.toLowerCase()){case"boolean":(o=new kdb.QBoolean).setValue("string"==typeof n.value?"1b"==n.value:n.value);break;case"guid":o=new kdb.QGUID,e="string"==typeof n.value?n.value.match(/"G"\$"(.+)"$/):n.value,o.value=e?e[1]:"0Ng"==n.value?null:n.value;break;case"symbol":o=new kdb.QSymbol,e="string"==typeof n.value?n.value.match(/`\$"(.*)"$/):n.value,o.value=e?e[1]:n.value;break;case"byte":(o=new kdb.QByte).value="string"==typeof n.value?parseInt(n.value):n.value;break;case"short":(o=new kdb.QShort).value=parseInt(n.value,10);break;case"int":case"integer":(o=new kdb.QInt).value=parseInt(n.value,10);break;case"long":(o=new kdb.QLong).value="number"==typeof n.value?n.value:parseInt(n.value,10);break;case"real":(o=new kdb.QReal).value=parseFloat(n.value);break;case"float":case"double":(o=new kdb.QFloat).value=parseFloat(n.value);break;case"char":(o=new kdb.QChar).setValue(n.value);break;case"timestamp":o=new kdb.QTimeStamp,null!==n.value&&(a=i(n.value),o.setValue(a.i),a)&&a.n&&(o.nanoValue=a.n);break;case"month":o=new kdb.QMonth,null!==n.value&&o.setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"date":o=new kdb.QDate,null!==n.value&&o.setValue(i(n.value).i);break;case"datetime":o=new kdb.QDateTime,null!==n.value&&o.setValue(i(n.value).i);break;case"timespan":(o=new kdb.QTimeSpan).setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"minute":(o=new kdb.QMinute).setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"second":(o=new kdb.QSecond).setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"time":(o=new kdb.QTime).setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"string":(o=new kdb.QString).setValue(n.value);break;case"string[]":o=new kdb.QList,s=[],_.each(n.value,function(t){(a=new kdb.QString).setValue(t),s.push(a)}),o.value=s;break;case"symbol[]":case"liststring":case"list":o=new kdb.QList,s=[],"string"==typeof n.value&&(e=n.value.match(/^\((.+)\)$/),n.value=e?e[1].split(";"):[n.value]),_.each(n.value,function(t){e="string"==typeof t?/`\$"(.*)"$/.exec(t):null,(a=new kdb.QSymbol).setValue(e?e[1]:t),s.push(a)}),o.value=s;break;case"listobject":o=new kdb.QList,s=[],_.each(n.value,_.bind(function(t){_.isEmpty(t)||(t=this.createDeltaObj(t),s.push(t))},this)),o.value=s;break;case"listlistsymbol":(o=new kdb.QList).value=_.map(n.value,function(t){var e=new kdb.QList;return e.value=_.map(t,function(t){var e=new kdb.QSymbol;return e.setValue(t),e}),e});break;case"listlistboolean":(o=new kdb.QList).value=_.map(n.value,function(t){var e=new kdb.QList;return e.value=_.map(t,function(t){var e=new kdb.QBoolean;return e.setValue(t),e}),e});break;case"listliststring":(o=new kdb.QList).value=_.map(n.value,function(t){var e=new kdb.QList;return e.value=_.map(t,function(t){var e=new kdb.QString;return e.setValue(t),e}),e});break;case"listlong":o=new kdb.QList,s=[],_.each(n.value,function(t){(a=new kdb.QLong).setValue(t),s.push(a)}),o.value=s;break;case"listtimestamp":o=new kdb.QList,s=[],_.each(n.value,function(t){var e=new kdb.QTimeStamp;null===t?e.setValue("0Np"):(a=i(t),e.setValue(a.i),a&&a.n&&(e.nanoValue=a.n)),s.push(e)}),o.value=s;break;case"dict":o=new kdb.QDict,_.each(n.value,_.bind(function(t,e){var n=t;_.isString(t)&&(n={type:"symbol",value:t}),t=this.createDeltaObj(n),o.values.push(t),o.fields.push(e)},this));break;case"table":o=new kdb.QFlip,_.each(n.value.columns,function(t,e){o.fields.push(t),o.values.push(this.createDeltaObj({type:n.value.types[e]+"[]",value:n.value.values[e]}))}.bind(this));break;case"nulltype":o=new kdb.QDict;break;case"listdate":o=new kdb.QList,s=[],_.each(n.value,function(t){var e=new kdb.QDate;null===t?e.setValue("0Nd"):e.setValue(i(t).i),s.push(e)}),o.value=s;break;default:-1<n.type.toLowerCase().indexOf("[]")&&(o=new kdb.QList,s=[],_.each(n.value,_.bind(function(t,e){s.push(this.createDeltaObj({type:n.type.toLowerCase().replace("[]",""),value:t,index:e}))},this)),o.value=s)}return o.orderIndex=n.index,o},I.createParamsObj=function(e,t){var n,i=0;t.attributes?n=t.attributes:t&&(n=t),n&&(_.each(n,_.bind(function(t){t.type&&"t"!==t.type&&("symbol[]"===t.type&&(t.type="list"),e[i]=this.createDeltaObj(t),i+=1)},this)),e.sort(function(t,e){return t.orderIndex-e.orderIndex}))},I.createSqlParamsObj=function(e,t){var i,o,s,n,a,r=0;t.attributes?n=t.attributes:t&&(n=t),a=function(t){var n;switch(t.type.toLowerCase()){case"boolean":(n=new kdb.SQLBoolean).value=t.value;break;case"guid":case"symbol":(n=new kdb.SQLVarChar).value=t.value;break;case"byte":(n=new kdb.SQLByte).value=t.value;break;case"short":(n=new kdb.SQLShort).value=t.value;break;case"int":case"integer":(n=new kdb.SQLInt).value=parseInt(t.value,10);break;case"long":(n=new kdb.SQLLong).value=t.value;break;case"real":(n=new kdb.SQLFloat).value=t.value;break;case"float":(n=new kdb.SQLFloat).value=parseFloat(t.value);break;case"double":(n=new kdb.SQLDouble).setValue(t.value);break;case"char":(n=new kdb.SQLVarChar).value=t.value;break;case"timestamp":(n=new kdb.SQLTime).setValue(t.value);break;case"month":(n=new kdb.SQLInt).setValue(t.value);break;case"date":case"datetime":(n=new kdb.SQLTime).setValue(new Date(t.value));break;case"timespan":(n=new kdb.SQLTime).setValue(t.value);break;case"minute":case"second":(n=new kdb.SQLInt).setValue(t.value);break;case"time":(n=new kdb.SQLTime).setValue(t.value);break;case"string":n=new kdb.SQLList,s=t.value.split(""),i=[],_.each(s,function(t){(o=new kdb.SQLVarChar).value=t,i.push(o)}),n.value=i;break;case"list":n=new kdb.SQLList,i=[],_.each(t.value,function(t){(o=new kdb.SQLVarChar).setValue(t),i.push(o)}),n.value=i;break;case"symbol[]":n=new kdb.SQLList,i=[],_.each(t.value,function(t){(o=new kdb.SQLVarChar).setValue(t),i.push(o)}),n.value=i;break;case"listtimestamp":n=new kdb.SQLList,i=[],_.each(t.value,function(t){(o=new kdb.SQLTime).setValue(t),i.push(o)}),n.value=i;break;case"dict":n=new kdb.SQLDict,_.each(t.value,function(t,e){t=a(t);n.values.push(t),n.fields.push(e)});break;case"nulltype":n=new kdb.SQLDict}return n.orderIndex=t.index,n.setName(t.name),n},n&&(_.each(n,function(t){t.type&&"t"!==t.type&&("symbol[]"===t.type&&(t.type="list"),e[r]=a(t),r+=1)}),e.sort(function(t,e){return t.orderIndex-e.orderIndex}))},I.parameterRx=new RegExp("<%([^<>%]+?)%>","g"),I.DEFAULT_NULL_VAL=-0x8000000000000000,I.PAGING_TYPES=["OFFSET","OFFSET_NOCACHE","PAGENO","PAGENO_NOCACHE"],v.DeltaClientLib=I,s=A=A||{},bo.clearAll=function(t){t?$("body .field-error").fadeOut():$("body .field-error").remove()},bo.clear=function(t,e){t&&(e?t.fadeOut():t.remove())},bo.show=function(t,e,n){if(t&&e)return(t=$("<div></div>",{text:t}).addClass("field-error").appendTo("body")).position({of:$(e),my:n?"right center":"left center",at:n?"left center":"right center",collision:"flip fit",using:function(t,e){"right"===e.horizontal?$(this).addClass("error-left-side"):$(this).removeClass("error-left-side"),$(this).css({left:t.left+"px",top:t.top+"px"})}}),t},s.ErrorTooltip=bo,c=A=A||{},fi=m.View,e(wo,fi),wo.prototype.remove=function(){return m.View.prototype.remove.call(this)},wo.prototype.renderTemplate=function(t){try{var e=!this.anchorEl||this.anchorEl.offsetWidth&&this.anchorEl.offsetHeight;this.el.style.display=e?"":"none",e&&(this.el.innerHTML="<div>"+this.templateFn(_.extend({},this.data,t))+"</div>",this.updatePosition(this.position))}catch(t){console.log(this.cssClass+" handlebars render error.",t)}},wo.prototype.updateCSS=function(t){return this.$el.css(_.reduce(t,function(t,e,n){return t[n]=e,t},{})),this},wo.prototype.updatePosition=function(t){var n,i=this;return this.anchorEl&&(n=this.anchorEl.getBoundingClientRect()),this.updateCSS(_.mapValues(_.pickBy(t,function(t){return!_.isNil(t)}),function(t,e){t=Math.max(0,t);return t+=n?n[e]:0,("left"===e||"right"===e)&&$(window).width()<t+i.$el.outerWidth()?t=$(window).width()-i.$el.outerWidth():("top"===e||"bottom"===e)&&$(window).height()<t+i.$el.outerHeight()&&(t=$(window).height()-i.$el.outerHeight()),t+"px"}))},wo.prototype.updateTooltip=function(t){var n=this;return _.each(t,function(t,e){n[e]=t}),this},wo.prototype.compileTemplate=function(){try{this.templateFn=U.compile(this.text)}catch(t){console.log(this.cssClass+" handlebars compile error.",t)}},wo.directions=["left","right","top","bottom"],c.GenericTooltip=wo,(w=A=A||{}).getComponentDefinitionCollection=function(){return new w.ComponentDefinitionCollection},w.getDocumentCollection=function(t,e){return w.DocumentCollection.singleton||new w.DocumentCollection(t,e)},w.getDocument=function(t){return new w.Document(t)},w.getDocumentView=function(t){return new w.DocumentView(t)},w.getBackboneModel=function(t){return new m.Model(t)},w.InitializeQuickbase=function(i){var o;this.initialized?i():(this.initialized=!0,o=$.cookie("dashboard-language")||"en",require.config({paths:{cldr:"./locale/cldr","cldr-data":"./locale/cldr-data",globalize:"./locale/globalize",locales:"./locale/locales"}}),require(["json!locales/messages.json"],function(t){function e(t){return n[t]||t||""}var n=t[o||"en"]||{};window.t=e,U.registerHelper("moment",function(t,e,n){if(null!=t||!e){if(null==t&&null==e)return p.locale("en"),p().format("MMMM DD, YYYY");var i={lang:"en",date:new Date},i=_.extend({},i,t,e,n);if(i=_.extend({},i,i.hash),p.locale(i.lang),"string"==typeof t&&"string"==typeof e)return p(t).format(e);if(w.Tools.isKDBTemporal(t))return n=w.Tools.convertKDBTemporalToMoment(t),p.isDuration(n)?n.formatNano(e):n.format(e);if(i.hash){i.context&&_.extend(i.hash,i.context);var o,s=p(t);for(o in i.hash){if(s[o])return s[o](i.hash[o]);console.log('moment.js does not support "'+o+'"')}}return"object"==typeof t?p(t).format(e):"string"!=typeof t||e?p(t).format(e):p().format(t)}}),U.registerHelper("t",e),U.registerHelper("typeOf",function(t){var e=Object.prototype.toString,n=function(t){return t.constructor?t.constructor.name:null};if(void 0===t)return"undefined";if(null===t)return"null";var i=typeof t;if("boolean"===i)return"boolean";if("string"===i)return"string";if("number"===i)return"number";if("symbol"===i)return"symbol";if("function"===i)return"GeneratorFunction"===n(t)?"generatorfunction":"function";if(w.Tools.isKDBTemporal(t))return w.Tools.Types.kdbToDashboard[t.class];if(_.isArray(t))return"array";if(_.isBuffer(t))return"buffer";if(_.isArguments(t))return"arguments";if(_.isDate(t))return"date";if(_.isError(t))return"error";if(_.isRegExp(t))return"regexp";switch(n(t)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if("function"==typeof(n=t).throw&&"function"==typeof n.return&&"function"==typeof n.next)return"generator";switch(i=e.call(t)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return i.slice(8,-1).toLowerCase().replace(/\s/g,"")}),U.registerHelper("isNull",function(t,e){return!0!==e&&_.isString(t)?0===t.length:_.isNull(t)}),U.registerHelper("encodeURI",function(t){return null==t?"":encodeURI(t)}),U.registerHelper("encodeURIComponent",function(t){return null==t?"":encodeURIComponent(t)}),U.registerHelper("toISOString",function(t){return w.Tools.convertKDBToViewstateValue(t)}),U.registerHelper("UTCtoTimeZone",function(t,e,n){if(null!=t)return e="string"==typeof e?e:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",w.Tools.convertValueToMoment(t)[(n=!!_.isNil(n)||n)?"formatNano":"format"](e)}),_.isFunction(i)&&i({globalize:void 0,language:o})}))},w.initializeEmbedded=function(i,t,e,o){require(["jquery","underscore","backbone","select2","jqueryui"],function(){$.cookie("dashboard-viewer-theme","kx-light",{expires:30,path:"/",secure:"https:"===_.get(window,"location.protocol")}),$.cookie("dashboard-theme","kx-light",{expires:30,path:"/",secure:"https:"===_.get(window,"location.protocol")});var t=w.DashClientLib,e=w.DocumentSyncHelpers.buildDocumentSync(i.config.parameters.documentAPI,t.documentSync),n=w.DocumentSyncHelpers.buildDocumentCollectionSync(i.config.parameters.documentAPI);w.Helpers.preventBackspaceBack(),w.Document.prototype.sync=e,w.DocumentCollection.prototype.sync=n,w.DocumentCollection.requiredAccessLevel="update",w.Connection.prototype.sync=t.connectionSync,w.ConnectionCollection.prototype.sync=t.connectionCollectionSync,Object.assign(w.DocumentDataModel.prototype,t),w.DeltaClientLib.PIVOT_SOURCE_CODE=w.DashClientLib.PIVOT_SOURCE_CODE,w.DashClient.client=i.dashClient,w.DeltaClientLib=w.DashClient,w.getDocumentCollection(null,null).fetch({success:function(){$(i.dashClient).trigger("DeltaClientConnect"),$(i.dashClient).trigger("DeltaClientLogin"),w.InitializeQuickbase(function(){o()})}})}),require(["css!css/font-awesome-4.7.0/css/font-awesome.min.css","css!css/material-icons/css/material-icons.min.css","css!css/jquery-ui-fa.css","css!kx-darkroom","css!kx-light","css!QuickView/css/main.css"])},d=(d=A=A||{}).ipc||(d.ipc={}),So.getType=function(t){return So.typeDict[t]},So.mergeTypedArraysUnsafe=function(t,e){var n=new t.constructor(t.length+e.length);return n.set(t),n.set(e,t.length),n},So.fromHexString=function(t){return new Uint8Array(((t||"").match(/.{1,2}/g)||[]).map(function(t){return parseInt(t,16)}))},So.toHexString=function(t){for(var e="",n=0;n<t.length;n++){var i=t[n].toString(16);e+=1===i.length?"0"+i:i}return e},So.pack=function(t){for(var e=[],n=0,i=t.length;n<i;)e.push((255&t[n++])<<8|255&t[n++]);return String.fromCharCode.apply(null,e)},So.base64=function(t){return btoa(String.fromCharCode.apply(null,t))},So.toMessage=function(t){var e=So.createBuffer(8);return e.wi(1),e.wi(t.length+8),So.mergeTypedArraysUnsafe(e.data,t)},So.createBuffer=function(t){var e={data:new Uint8Array(t),i:0,wb:function(t){e.data[e.i++]=t},wi:function(t){_.times(4,function(){e.wb(255&t),t>>=8})}};return e},So.typeDict={10:d.QString,0:d.List,"-1":d.Boolean,"-2":d.Symbol,"-4":d.Byte,"-5":d.Short,"-6":d.Int,"-7":d.QLong,"-8":d.Float,"-9":d.Double,"-10":d.Char,"-11":d.Symbol,"-12":d.Timestamp,"-13":d.Month,"-14":d.QDate,"-15":d.DateTime,"-16":d.Timespan,"-17":d.Minute,"-18":d.Second,"-19":d.Time},d.Util=So,Ve=A=A||{},_o.getFunctionList='kys: raze (raze k!{@[{ {".",(string y),".",string x}[;x] each key[`$".",string x] };x;{`}]} each k: (key `) except `j`q`Q`h`o`u; string key `.); select name,parameters:{flip `name`type!(x 1;`Symbol)} each parameters from ({`name`parameters!((`$x);(value (value x))) } each exec name from ({ `name`t!(x;type value x) } each kys) where (not (name like "*.")) and t=100h)',_o.getFunctions=".api.getFunctions",_o.executeSql=".s.e",_o.getTables='raze (raze k!{@[{ {".",(string y),".",string x}[;x] each tables[`$".",string x] };x;{`}]} each k: key `; tables `.)',_o.isSqlSupported="`e in key `.s",Ve.KdbQuery=_o;Ne=A=A||{};To=m.Model,e(Mo,To),Mo.prototype.defaults=function(){return{listViewThumb:null,ghostViewThumb:null,buildViewThumb:null,appKey:null,appArgs:null,name:null,description:null}};var To,Co,Do=Mo;function Mo(){return null!==To&&To.apply(this,arguments)||this}function Eo(){var t=null!==Co&&Co.apply(this,arguments)||this;return t.model=Do,t}Ne.ComponentDefinition=Do,Co=m.Collection,e(Eo,Co),Ne.ComponentDefinitionCollection=Eo,m.emulateHTTP=!0;Be=A=A||{};Po=m.Model,e(Ao,Po),Ao.prototype.defaults=function(){return{name:"default",type:"kdb",connections:[],connectionsType:[]}};var Po,Io,ko=Ao;function Ao(){return null!==Po&&Po.apply(this,arguments)||this}function xo(){var t=null!==Io&&Io.apply(this,arguments)||this;return t.model=ko,t}(Be.ConnectionGroup=ko).prototype.idAttribute="name",Io=m.Collection,e(xo,Io),Be.ConnectionGroupCollection=xo,m.emulateHTTP=!0;n=A=A||{};No=m.Model,e(Oo,No),Oo.prototype.defaults=function(){return{name:"default",type:"q",host:"localhost",port:"80",tls:"false",user:"",password:""}};var No,Lo,Vo=Oo;function Oo(){return null!==No&&No.apply(this,arguments)||this}function Bo(){var t=null!==Lo&&Lo.apply(this,arguments)||this;return t.model=Vo,t}function Ro(t,e){t=yi.call(this,t,e)||this;return(mi.Document.parent=t).listenTo(t,"change:selectedDocumentId",t.resetCommands.bind(t)),t}function $o(){}function Uo(e){var n=bi.call(this,e)||this;return n.$dialog=null,n.$nameInput=null,n.container=null,n.appModel=null,n.viewModel=null,n.appModel=e.appModel,n.container=e.container,n.viewModel=e.viewModel,n.el.className="quick-base window dashboard-name-prompt",n.$el.html(vi.T.AboutDialog(_.extend({DeltaClientHost:location.hostname,DeltaClientPort:location.port||("https:"==location.protocol?443:80)},n.appModel.toJSON()))),n.$nameInput=n.$el.find(".name-input"),n.$dialog=n.$el.dialog(_.extend({appendTo:n.container,dialogClass:"quick-base about-dialog",title:t("About"),resizable:!0,height:329,width:470,modal:!0,autoOpen:!0,draggable:!0,open:function(){$('<i class="fa fa-info-circle" ></i>').insertBefore(n.$el.parent().find(".ui-dialog-title"))},close:function(){n.remove()}},e)),n}function Fo(t){var n=wi.call(this)||this;return n.HEADING_HEIGHT=28,n.onUpdate=t.onUpdate,n.sections=t.sections||[],n.$el=t.el,n.$el.addClass("dash-accordion accordion"),n.sections.forEach(function(t,e){t.$el&&(t.$heading=t.$el.find(t.$heading),t.$content=t.$el.find(t.$content),t.$el.addClass("section"),t.$heading.click(function(){n.onClick(t)}))}),n.debouncedRemoveAnimate=_.debounce(function(){n.$el.removeClass("animate"),n.onUpdate&&n.onUpdate(n.sections)},300),n.updateLayout(!1),n}function qo(){_.extend(this,m.Events)}(n.Service=Vo).prototype.idAttribute="name",Lo=m.Collection,e(Bo,Lo),n.ServiceCollection=Bo,mi=A=A||{},yi=m.Model,e(Ro,yi),Ro.GetModel=function(t){return new Ro(t)},Ro.prototype.defaults=function(){return{commands:[],commandIndex:-1,buildMode:!0,isInspecting:!1,selectedDocumentId:null,selectedScreenId:null,selectedWidgetId:null,selectedSubComponent:null,userConfigurable:!1,componentsPanel:new m.Model({search:null})}},Ro.prototype.goToCommandIndex=function(t){var e=this.get("commandIndex"),n=this.get("commands"),i=mi.DocumentCollection.singleton.get(this.get("selectedDocumentId"));if(t===e&&(t-=1),e<t)for(var o=e+1;o<=t;o++)0<=o&&o<n.length&&i.doCommand(_.clone(n[o].path),n[o].todo);else if(t<e)for(o=e;t<o;o--)0<=o&&o<n.length&&i.doCommand(_.clone(n[o].path),n[o].undo);this.set("commandIndex",t)},Ro.prototype.doCommand=function(t,e){},Ro.prototype.postCommand=function(t,e){var n=this.get("commands"),i=this.get("commandIndex");i<n.length-1&&n.splice(i+1,n.length-i-1),n.push(e),mi.Log.Info("AppViewModel::onCommand",this.get("commands")),this.goToCommandIndex(i+1)},Ro.prototype.redo=function(){this.goToCommandIndex(this.get("commandIndex")+1)},Ro.prototype.resetCommands=function(){this.set("commands",[],{silent:!0}),this.set("commandIndex",-1,{silent:!0}),this.trigger("change:commandIndex")},Ro.prototype.undo=function(){this.goToCommandIndex(this.get("commandIndex")-1)},mi.AppViewModel=Ro,$e=A=A||{},$o.AboutDialog=U.template({1:function(t,e,n,i,o){var s,a=t.lambda,r=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"            <tr>\n                <td>Delta Control Host:</td>\n                <td>"+r(a(null!=(s=null!=e?t(e,"dashboardControlDetails"):e)?t(s,"dchost"):s,e))+"</td>\n            </tr>\n            <tr>\n                <td>Delta Control Port:</td>\n                <td>"+r(a(null!=(s=null!=e?t(e,"dashboardControlDetails"):e)?t(s,"dcport"):s,e))+"</td>\n            </tr>\n            <tr>\n                <td>Delta Control TLS:</td>\n                <td>"+r(a(null!=(s=null!=e?t(e,"dashboardControlDetails"):e)?t(s,"dctls"):s,e))+"</td>\n            </tr>\n            <tr>\n                <td>KDB Banner:</td>\n                <td>"+r(a(null!=(s=null!=e?t(e,"dashboardControlDetails"):e)?t(s,"bannerText"):s,e))+"</td>\n            </tr>\n            <tr>\n                <td>KDB Version:</td>\n                <td>"+r(a(null!=(s=null!=e?t(e,"dashboardControlDetails"):e)?t(s,"kdbVersion"):s,e))+"</td>\n            </tr>\n            <tr>\n                <td>KDB Release Date:</td>\n                <td>"+r(a(null!=(s=null!=e?t(e,"dashboardControlDetails"):e)?t(s,"releaseDate"):s,e))+"</td>\n            </tr>\n            <tr>\n                <td>KDB Update Date:</td>\n                <td>"+r(a(null!=(s=null!=e?t(e,"dashboardControlDetails"):e)?t(s,"updateDate"):s,e))+"</td>\n            </tr>\n"},3:function(t,e,n,i,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"            <tr>\n                <td>"+l("function"==typeof(s=null!=(s=t(n,"key")||(null!=e?t(e,"key"):e))?s:r)?s.call(a,{name:"key",hash:{},data:o,loc:{start:{line:63,column:20},end:{line:63,column:27}}}):s)+":</td>\n                <td>"+l("function"==typeof(s=null!=(s=t(n,"value")||(null!=e?t(e,"value"):e))?s:r)?s.call(a,{name:"value",hash:{},data:o,loc:{start:{line:64,column:20},end:{line:64,column:29}}}):s)+"</td>\n            </tr>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r="function",l=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},l='<div class="splash">\n    <div class="version">'+l(typeof(c=null!=(c=u(n,"PackageName")||(null!=e?u(e,"PackageName"):e))?c:a)==r?c.call(s,{name:"PackageName",hash:{},data:o,loc:{start:{line:2,column:25},end:{line:2,column:40}}}):c)+'</div>\n    <div class="scroll">\n        <p>Copyright in Kx Dashboards belongs to First Derivatives plc. © First Derivatives plc 2009-2018. All rights reserved. Use of the software is subject to the terms of First Derivatives plc’s license agreement. Kx and kdb+ are trademarks of Kx Systems Inc.<br>Kx System Inc. is a subsidiary of First Derivatives plc. Portions of the Kx Dashboards software use code and/or materials under license from third-party suppliers.</p>\n        <table style="width: 100%;">\n            <tr>\n                <td>'+l((u(n,"t")||e&&u(e,"t")||a).call(s,"User Name",{name:"t",hash:{},data:o,loc:{start:{line:7,column:20},end:{line:7,column:37}}}))+":</td>\n                <td>"+l(typeof(c=null!=(c=u(n,"userName")||(null!=e?u(e,"userName"):e))?c:a)==r?c.call(s,{name:"userName",hash:{},data:o,loc:{start:{line:8,column:20},end:{line:8,column:32}}}):c)+"</td>\n            </tr>\n            \x3c!--\n            <tr>\n                <td>"+l((u(n,"t")||e&&u(e,"t")||a).call(s,"Delta Client Host",{name:"t",hash:{},data:o,loc:{start:{line:12,column:20},end:{line:12,column:45}}}))+":</td>\n                <td>"+l(typeof(c=null!=(c=u(n,"DeltaClientHost")||(null!=e?u(e,"DeltaClientHost"):e))?c:a)==r?c.call(s,{name:"DeltaClientHost",hash:{},data:o,loc:{start:{line:13,column:20},end:{line:13,column:39}}}):c)+"</td>\n            </tr>\n            <tr>\n                <td>"+l((u(n,"t")||e&&u(e,"t")||a).call(s,"Delta Client Port",{name:"t",hash:{},data:o,loc:{start:{line:16,column:20},end:{line:16,column:45}}}))+":</td>\n                <td>"+l(typeof(c=null!=(c=u(n,"DeltaClientPort")||(null!=e?u(e,"DeltaClientPort"):e))?c:a)==r?c.call(s,{name:"DeltaClientPort",hash:{},data:o,loc:{start:{line:17,column:20},end:{line:17,column:39}}}):c)+"</td>\n            </tr>\n            <tr>\n                <td>&nbsp;</td>\n            </tr>\n            <tr>\n                <td>"+l((u(n,"t")||e&&u(e,"t")||a).call(s,"Delta Control",{name:"t",hash:{},data:o,loc:{start:{line:23,column:20},end:{line:23,column:41}}}))+":</td>\n            </tr>--\x3e\n"+(null!=(p=u(n,"unless").call(s,null!=e?u(e,"isLite"):e,{name:"unless",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:25,column:12},end:{line:54,column:23}}}))?p:"")+"            <tr>\n                <td>&nbsp;</td>\n            </tr>\n            <tr>\n                <td>"+l((u(n,"t")||e&&u(e,"t")||a).call(s,"UI Components",{name:"t",hash:{},data:o,loc:{start:{line:59,column:20},end:{line:59,column:41}}}))+":</td>\n            </tr>\n",c=null!=(c=u(n,"paths")||(null!=e?u(e,"paths"):e))?c:a,a={name:"paths",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:61,column:12},end:{line:66,column:22}}},p=typeof c==r?c.call(s,a):c;return null!=(p=u(n,"paths")?p:t.hooks.blockHelperMissing.call(e,p,a))&&(l+=p),l+"        </table>\n    </div>\n</div>"},useData:!0}),$o.AreYouSureDialog=U.template({1:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<p>\n    "+t.escapeExpression("function"==typeof(n=null!=(n=s(n,"message")||(null!=e?s(e,"message"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"message",hash:{},data:o,loc:{start:{line:3,column:4},end:{line:3,column:15}}}):n)+"\n</p>\n"},3:function(t,e,n,i,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<p>\n    Components "+(null!=(s=r(n,"if").call(a,null!=e?r(e,"dashChanged"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o,loc:{start:{line:8,column:15},end:{line:8,column:46}}}))?s:"")+"have unsaved changes:\n    <ul>\n"+(null!=(s=r(n,"each").call(a,null!=e?r(e,"components"):e,{name:"each",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:8},end:{line:12,column:17}}}))?s:"")+"    </ul>\n</p>\n"},4:function(t,e,n,i,o){return"also "},6:function(t,e,n,i,o){var s=t.lambda,a=t.escapeExpression,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <li><span title="'+a(s(null!=e?r(e,"widget"):e,e))+'">'+a(s(null!=e?r(e,"component"):e,e))+"</span>"+(null!=(a=r(n,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"message"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:11,column:67},end:{line:11,column:112}}}))?a:"")+"</li>\n"},7:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return": "+t.escapeExpression(t.lambda(null!=e?s(e,"message"):e,e))},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(s=r(n,"if").call(a,null!=e?r(e,"dashChanged"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:5,column:7}}}))?s:"")+(null!=(s=r(n,"if").call(a,null!=e?r(e,"components"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:0},end:{line:15,column:7}}}))?s:"")+'<p>Would you like to save?</p>\n<div class="error-info" style="color: red;">\n    There was an error saving this dashboard.\n\n    <ul class="error-list"></ul>\n</div>'},useData:!0}),$o.ColorPickr=U.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){return'\n<div class="color-pickr-container">\n    <div class="color-pickr">\n    </div>\n</div>'},useData:!0}),$o.ComponentView=U.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="border-div">\n    <div class="title-div"></div>\n    <div class="app-div dashboard-dark"></div>\n</div>\n\n<div class="errorMessage ui-state-header">\n    <div class="errorPanel ui-state-error">\n        <div class="errorTitle"><i class="fa fa-exclamation-triangle"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Error",{name:"t",hash:{},data:o,loc:{start:{line:8,column:80},end:{line:8,column:93}}}))+'</span></div>\n        <span class="errorText"></span>\n    </div>\n    <div class="errorPanel ui-state-warning">\n        <div class="errorTitle"><i class="fa fa-exclamation-circle"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Warning",{name:"t",hash:{},data:o,loc:{start:{line:12,column:78},end:{line:12,column:93}}}))+'</span></div>\n        <span class="errorText"></span>\n    </div>\n    <div class="errorPanel ui-state-highlight">\n        <div class="errorTitle"><i class="fa fa-info-circle"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Info",{name:"t",hash:{},data:o,loc:{start:{line:16,column:71},end:{line:16,column:83}}}))+'</span></div>\n        <span class="errorText"></span>\n    </div>\n</div>\n\n<div class="queryStatus ui-state-header">\n    <div class="statusPanel Error ui-state-error">\n        <div class="statusTitle"><i class="fa fa-exclamation-triangle"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Error",{name:"t",hash:{},data:o,loc:{start:{line:23,column:81},end:{line:23,column:94}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n    <div class="statusPanel Warning ui-state-warning">\n        <div class="statusTitle"><i class="fa fa-exclamation-circle"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Warning",{name:"t",hash:{},data:o,loc:{start:{line:27,column:79},end:{line:27,column:94}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n    <div class="statusPanel Info ui-state-highlight">\n        <div class="statusTitle"><i class="fa fa-info-circle"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Info",{name:"t",hash:{},data:o,loc:{start:{line:31,column:72},end:{line:31,column:84}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n    <div class="statusPanel Loading ui-state-highlight">\n        <div class="statusTitle"><i class="fa fa-spinner fa-pulse"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Loading",{name:"t",hash:{},data:o,loc:{start:{line:35,column:77},end:{line:35,column:92}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n<div class="statusPanel NoResults ui-state-highlight">\n        <div class="statusTitle"><i class="fa fa-info-circle"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"No Results",{name:"t",hash:{},data:o,loc:{start:{line:39,column:72},end:{line:39,column:90}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n</div>\n\n<div class="progress-bar-div" style="width: 100%; height: 100%; overflow: hidden; position: absolute; left: 0; top: 0; z-index: 999;">\n    <div class="loading" style="display: table; width: 100%; height: 100%; max-height: 100%; opacity: 0.9; overflow: hidden;">\n        <div style="display: table-cell; width: 100%; height: 100%; max-height: 100%; vertical-align: middle; text-align: center;">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32" fill="#ffffff">\n                <circle cx="16" cy="3" r="0">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(45 16 16)" cx="16" cy="3" r="0">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.125s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(90 16 16)" cx="16" cy="3" r="0">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.25s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(135 16 16)" cx="16" cy="3" r="0.567031">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.375s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(180 16 16)" cx="16" cy="3" r="1.82452">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.5s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(225 16 16)" cx="16" cy="3" r="2.88475">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.625s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(270 16 16)" cx="16" cy="3" r="2.1029">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.75s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(315 16 16)" cx="16" cy="3" r="0.60761">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.875s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(180 16 16)" cx="16" cy="3" r="1.82452">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.5s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n            </svg>\n            <div class="loadingText" style="font-weight: bold; margin-top: 7px; font-size: 11px; letter-spacing: 1px;">\n                '+r((t(n,"t")||e&&t(e,"t")||a).call(s,"loading",{name:"t",hash:{},data:o,loc:{start:{line:77,column:16},end:{line:77,column:31}}}))+" "+r("function"==typeof(r=null!=(r=t(n,"componentName")||(null!=e?t(e,"componentName"):e))?r:a)?r.call(s,{name:"componentName",hash:{},data:o,loc:{start:{line:77,column:32},end:{line:77,column:49}}}):r)+"...\n            </div>\n        </div>\n    </div>\n</div>"},useData:!0}),$o.DocumentSelector=U.template({1:function(t,e,n,i,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <option value="'+l("function"==typeof(s=null!=(s=t(n,"id")||(null!=e?t(e,"id"):e))?s:r)?s.call(a,{name:"id",hash:{},data:o,loc:{start:{line:3,column:19},end:{line:3,column:25}}}):s)+'">'+l("function"==typeof(s=null!=(s=t(n,"name")||(null!=e?t(e,"name"):e))?s:r)?s.call(a,{name:"name",hash:{},data:o,loc:{start:{line:3,column:27},end:{line:3,column:35}}}):s)+"</option>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){return"<select>\n"+(null!=(n=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(n,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:4,column:13}}}))?n:"")+"</select>\n"},useData:!0}),$o.DocumentView=U.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){return'<div class="screen-view-div">\n</div>\n\n'},useData:!0}),$o.InBrowserNotification=U.template({1:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <i class="icon fa fa-'+t.escapeExpression("function"==typeof(n=null!=(n=s(n,"icon")||(null!=e?s(e,"icon"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"icon",hash:{},data:o,loc:{start:{line:3,column:25},end:{line:3,column:33}}}):n)+'"></i>\n'},3:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div class="ttl">'+t.escapeExpression("function"==typeof(n=null!=(n=s(n,"title")||(null!=e?s(e,"title"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"title",hash:{},data:o,loc:{start:{line:7,column:21},end:{line:7,column:30}}}):n)+"</div>\n"},5:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div class="msg">'+(null!=(s="function"==typeof(n=null!=(n=s(n,"message")||(null!=e?s(e,"message"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"message",hash:{},data:o,loc:{start:{line:11,column:21},end:{line:11,column:34}}}):n)?s:"")+"</div>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="inBrowserNotification">\n'+(null!=(s=r(n,"if").call(a,null!=e?r(e,"icon"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:4,column:11}}}))?s:"")+"\n"+(null!=(s=r(n,"if").call(a,null!=e?r(e,"title"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:4},end:{line:8,column:11}}}))?s:"")+"\n"+(null!=(s=r(n,"if").call(a,null!=e?r(e,"message"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:4},end:{line:12,column:11}}}))?s:"")+'\n    <i class="fa fa-times-circle"></i>\n</div>'},useData:!0}),$o.LoginDialog=U.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="login-container quick-base login-dialog ui-widget ui-widget-content ui-corner-all ui-front">\n    <div class="logo"></div>\n    <div class="login-form user-login-form open">\n\n        <div class="input-container" style="margin-top: 7px">\n\n            <span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"User",{name:"t",hash:{},data:o,loc:{start:{line:7,column:18},end:{line:7,column:30}}}))+':\n            </span>\n            <span>\n                <input class="username" tabindex="1" type="text" name="username" ></input>\n            </span>\n\n        </div>\n        <div class="input-container" style="margin-top: 11px;">\n            <span >'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Password",{name:"t",hash:{},data:o,loc:{start:{line:15,column:19},end:{line:15,column:35}}}))+':\n            </span>\n            <span>\n                <input class="password" tabindex="2" type="password" name="password"></input>\n            </span>\n        </div>\n        <div class="forgot-info">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"forgot password",{name:"t",hash:{},data:o,loc:{start:{line:21,column:33},end:{line:21,column:56}}}))+'?</div>\n        <div class="loginErrorPanel">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,null!=e?t(e,"An"):e,null!=e?t(e,"error"):e,null!=e?t(e,"has"):e,null!=e?t(e,"occurred"):e,e,{name:"t",hash:{},data:o,loc:{start:{line:22,column:37},end:{line:22,column:65}}}))+'</div>\n    </div>\n    <div class="login-form forgot-password-form">\n        <div class="form-text">Reset Password</div>\n        <div class="input-container">\n            <span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"User",{name:"t",hash:{},data:o,loc:{start:{line:27,column:18},end:{line:27,column:30}}}))+':\n            </span>\n            <span>\n                <input class="reset-username" type="text"></input>\n            </span>\n        </div>\n        <div class="reset-password-error">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Please enter valid user name",{name:"t",hash:{},data:o,loc:{start:{line:33,column:42},end:{line:33,column:78}}}))+'</div>\n    </div>\n    <div class="login-form password-reset-info">\n        <div class="recovery-response form-text"></div>\n    </div>\n    <div class="login-button-panel ui-dialog-buttonpane ui-helper-clearfix">\n        <button class="login-btn ui-button ui-widget" tabindex="3" ></button>\n        <button class="reset-btn ui-button ui-widget"></button>\n        <button class="back-btn ui-button ui-widget"></button>\n    </div>\n</div>'},useData:!0}),$o.ProfileMenu=U.template({1:function(t,e,n,i,o){var s=t.escapeExpression,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <option value="'+s(t.lambda(null!=e?a(e,"id"):e,e))+'">'+s((a(n,"t")||e&&a(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},null!=e?a(e,"name"):e,{name:"t",hash:{},data:o,loc:{start:{line:6,column:40},end:{line:6,column:55}}}))+"</option>\n"},3:function(t,e,n,i,o){var s=t.lambda,a=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <option value="'+a(s(null!=e?t(e,"value"):e,e))+'">'+a(s(null!=e?t(e,"label"):e,e))+"</option>\n"},5:function(t,e,n,i,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <optgroup label="'+t.escapeExpression("function"==typeof(s=null!=(s=r(n,"key")||o&&r(o,"key"))?s:t.hooks.helperMissing)?s.call(a,{name:"key",hash:{},data:o,loc:{start:{line:43,column:29},end:{line:43,column:37}}}):s)+'">\n'+(null!=(s=r(n,"each").call(a,e,{name:"each",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:44,column:16},end:{line:46,column:25}}}))?s:"")+"            </optgroup>\n"},7:function(t,e,n,i,o){var s=t.lambda,a=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <option value="'+a(s(null!=e?t(e,"value"):e,e))+'">'+a(s(null!=e?t(e,"label"):e,e))+"</option>\n"},9:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li data-options="document-breadcrumbs" class="breadcrumbs '+(null!=(n=s(n,"if").call(null!=e?e:t.nullContext||{},null!=e?s(e,"showBreadcrumbs"):e,{name:"if",hash:{},fn:t.program(10,o,0),inverse:t.noop,data:o,loc:{start:{line:64,column:63},end:{line:64,column:100}}}))?n:"")+'">\n        <label>Show Selection Breadcrumb</label>\n        <i class="fa fa-check ui-checkboxradio-icon"></i>\n    </li>\n'},10:function(t,e,n,i,o){return"checked"},12:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li class="ext-link" data-options="open-viewer">'+t.escapeExpression((s(n,"t")||e&&s(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"Open Viewer",{name:"t",hash:{},data:o,loc:{start:{line:70,column:52},end:{line:70,column:71}}}))+'<i class="fa fa-external-link"\n            aria-hidden="true"></i></li>\n'},14:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(n=s(n,"if").call(null!=e?e:t.nullContext||{},null!=e?s(e,"isLite"):e,{name:"if",hash:{},fn:t.program(15,o,0),inverse:t.noop,data:o,loc:{start:{line:73,column:4},end:{line:76,column:11}}}))?n:""},15:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li class="ext-link" data-options="open-editor">'+t.escapeExpression((s(n,"t")||e&&s(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"Open Editor",{name:"t",hash:{},data:o,loc:{start:{line:74,column:52},end:{line:74,column:71}}}))+'<i class="fa fa-external-link"\n            aria-hidden="true"></i></li>\n'},17:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li data-options="login-history">'+t.escapeExpression((s(n,"t")||e&&s(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"Login History",{name:"t",hash:{},data:o,loc:{start:{line:79,column:37},end:{line:79,column:58}}}))+"</li>\n"},19:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li data-options="helpguide">'+t.escapeExpression((s(n,"t")||e&&s(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"Help",{name:"t",hash:{},data:o,loc:{start:{line:83,column:33},end:{line:83,column:45}}}))+"</li>\n"},21:function(t,e,n,i,o){var s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li data-options="logout-local">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Local Logout",{name:"t",hash:{},data:o,loc:{start:{line:86,column:36},end:{line:86,column:56}}}))+'</li>\n    <li data-options="logout-global">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Global Logout",{name:"t",hash:{},data:o,loc:{start:{line:87,column:37},end:{line:87,column:58}}}))+"</li>\n"},23:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(n=s(n,"unless").call(null!=e?e:t.nullContext||{},null!=e?s(e,"isLite"):e,{name:"unless",hash:{},fn:t.program(24,o,0),inverse:t.noop,data:o,loc:{start:{line:89,column:4},end:{line:92,column:15}}}))?n:""},24:function(t,e,n,i,o){var s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li data-options="change-password">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Change Password",{name:"t",hash:{},data:o,loc:{start:{line:90,column:39},end:{line:90,column:62}}}))+'</li>\n    <li data-options="logout">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Logout",{name:"t",hash:{},data:o,loc:{start:{line:91,column:30},end:{line:91,column:44}}}))+"</li>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="row theme">\n    <div class="label">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Editor Theme",{name:"t",hash:{},data:o,loc:{start:{line:2,column:23},end:{line:2,column:43}}}))+'</div>\n    <div class="control">\n        <select style="width: 100%" class="select-theme">\n'+(null!=(s=u(n,"each").call(a,null!=e?u(e,"themes"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:12},end:{line:7,column:21}}}))?s:"")+'        </select>\n    </div>\n</div>\n<div class="row viewer-theme">\n    <div class="label">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Theme",{name:"t",hash:{},data:o,loc:{start:{line:12,column:23},end:{line:12,column:36}}}))+'</div>\n    <div class="control">\n        <select style="width: 100%" class="select-viewer-theme">\n'+(null!=(s=u(n,"each").call(a,null!=e?u(e,"themes"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:15,column:12},end:{line:17,column:21}}}))?s:"")+'        </select>\n    </div>\n</div>\n\x3c!-- <div class="row language">\n    <div class="label">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Language",{name:"t",hash:{},data:o,loc:{start:{line:22,column:23},end:{line:22,column:39}}}))+'</div>\n    <div class="control">\n        <select style="width: 100%" class="select-language">\n            <option value="en">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"English",{name:"t",hash:{},data:o,loc:{start:{line:25,column:31},end:{line:25,column:46}}}))+'</option>\n            <option value="zh-HK">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Chinese HK",{name:"t",hash:{},data:o,loc:{start:{line:26,column:34},end:{line:26,column:52}}}))+'</option>\n            <option value="de">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"German",{name:"t",hash:{},data:o,loc:{start:{line:27,column:31},end:{line:27,column:45}}}))+'</option>\n            <option value="ja">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Japanese",{name:"t",hash:{},data:o,loc:{start:{line:28,column:31},end:{line:28,column:47}}}))+'</option>\n            <option value="ar">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Arabic",{name:"t",hash:{},data:o,loc:{start:{line:29,column:31},end:{line:29,column:45}}}))+'</option>\n        </select>\n    </div>\n</div> --\x3e\n<div class="row timezone">\n    <div class="label">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Timezone",{name:"t",hash:{},data:o,loc:{start:{line:34,column:23},end:{line:34,column:39}}}))+'</div>\n    <div class="control">\n        <select style="width: 100%" class="select-timezone">\n            <optgroup label="Major">\n'+(null!=(s=u(n,"each").call(a,null!=e?u(e,"majorTimezones"):e,{name:"each",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:38,column:16},end:{line:40,column:25}}}))?s:"")+"            </optgroup>\n"+(null!=(s=u(n,"each").call(a,null!=e?u(e,"timezones"):e,{name:"each",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:42,column:12},end:{line:48,column:21}}}))?s:"")+'        </select>\n    </div>\n</div>\n<div class="row log-level">\n    <div class="label">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Log Level",{name:"t",hash:{},data:o,loc:{start:{line:53,column:23},end:{line:53,column:40}}}))+'</div>\n    <div class="control">\n        <select style="width: 100%" class="select-log-level">\n'+(null!=(s=u(n,"each").call(a,null!=e?u(e,"logLevel"):e,{name:"each",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:56,column:12},end:{line:58,column:21}}}))?s:"")+'        </select>\n    </div>\n</div>\n<ul class="buttonset">\n'+(null!=(s=u(n,"if").call(a,null!=e?u(e,"editor"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.noop,data:o,loc:{start:{line:63,column:4},end:{line:68,column:11}}}))?s:"")+(null!=(s=u(n,"if").call(a,null!=e?u(e,"editor"):e,{name:"if",hash:{},fn:t.program(12,o,0),inverse:t.program(14,o,0),data:o,loc:{start:{line:69,column:4},end:{line:77,column:11}}}))?s:"")+(null!=(s=u(n,"unless").call(a,null!=e?u(e,"isLite"):e,{name:"unless",hash:{},fn:t.program(17,o,0),inverse:t.noop,data:o,loc:{start:{line:78,column:4},end:{line:80,column:15}}}))?s:"")+'    <li data-options="about">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"About",{name:"t",hash:{},data:o,loc:{start:{line:81,column:29},end:{line:81,column:42}}}))+"</li>\n"+(null!=(s=u(n,"if").call(a,null!=e?u(e,"editor"):e,{name:"if",hash:{},fn:t.program(19,o,0),inverse:t.noop,data:o,loc:{start:{line:82,column:4},end:{line:84,column:11}}}))?s:"")+(null!=(s=u(n,"if").call(a,null!=e?u(e,"saml"):e,{name:"if",hash:{},fn:t.program(21,o,0),inverse:t.program(23,o,0),data:o,loc:{start:{line:85,column:4},end:{line:93,column:11}}}))?s:"")+"</ul>"},useData:!0}),$o.fileExporter=U.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="pnlButtons">\n    <span class="lnksExport link-disabled">\n        <i class="fa fa-fw fa-download" title="'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Data",{name:"t",hash:{},data:o,loc:{start:{line:3,column:47},end:{line:3,column:59}}}))+'"></i>\n        <a class="lnkExcelExport" title="'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Download the current dataset in Excel format",{name:"t",hash:{},data:o,loc:{start:{line:4,column:41},end:{line:4,column:93}}}))+'">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Excel",{name:"t",hash:{},data:o,loc:{start:{line:4,column:95},end:{line:4,column:108}}}))+'</a>\n        <a class="lnkCsvExport" title="'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Download the current dataset in CSV format",{name:"t",hash:{},data:o,loc:{start:{line:5,column:39},end:{line:5,column:89}}}))+'">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"CSV",{name:"t",hash:{},data:o,loc:{start:{line:5,column:91},end:{line:5,column:102}}}))+'</a>\n        <a class="lnkFullExport" title="'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Download the full dataset from the server",{name:"t",hash:{},data:o,loc:{start:{line:6,column:40},end:{line:6,column:89}}}))+'">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Full",{name:"t",hash:{},data:o,loc:{start:{line:6,column:91},end:{line:6,column:103}}}))+'</a>\n        <a class="lnkDownloadScreenshot" title="'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Download a PNG image of the chart",{name:"t",hash:{},data:o,loc:{start:{line:7,column:48},end:{line:7,column:89}}}))+'">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"PNG",{name:"t",hash:{},data:o,loc:{start:{line:7,column:91},end:{line:7,column:102}}}))+"</a>\n    </span> \n</div> \n"},useData:!0}),$o.popup=U.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){return'<div class="dialog">\n    <div class="content-panel" tabindex="1"></div>\n</div>'},useData:!0}),$e.T=$o,vi=A=A||{},bi=m.View,e(Uo,bi),Uo.prototype.remove=function(){return this.stopListening(),this.$el.off(),m.View.prototype.remove.call(this)},vi.AboutDialog=Uo,s=A=A||{},wi=m.View,e(Fo,wi),Fo.prototype.adjustWeights=function(t,n){var i=this.sum(_.map(t,function(t){return t.weight})),o=this.sum(n);_.each(t,function(t,e){t.weight=i*(n[e]/o)})},Fo.prototype.onClick=function(t){t.isExpanded=!t.isExpanded,this.updateLayout(!0)},Fo.prototype.onSectionResize=function(t,e,n){for(var i,o,s=0,a=t.$el.height(),r=a-n.originalSize.height,l=[t],u=[a],c=this.sections.indexOf(t)+1;c<this.sections.length&&(!(i=this.sections[c]).isExpanded||i.fixed||(o=Math.max(this.HEADING_HEIGHT,i.startHeight-(r-s)),s+=Math.min(i.startHeight-this.HEADING_HEIGHT,r-s),i.$el.height(o+"px"),l.push(i),u.push(o),s!==r));c+=1);this.adjustWeights(l,u)},Fo.prototype.resize=function(){this.updateLayout(!1)},Fo.prototype.setExpanded=function(t,e,n){n=n||!0,this.sections[t].isExpanded=e,this.updateLayout(n)},Fo.prototype.sum=function(t){return _.reduce(t,function(t,e){return t+e},0)},Fo.prototype.updateLayout=function(t){var n,e,i=this,o=i.$el.height();i.$el.toggleClass("animate",t),e=_.filter(i.sections,{isExpanded:!0}),o=(o-=(i.sections.length-e.length)*i.HEADING_HEIGHT)-this.sum(_.map(_.filter(e,function(t){return t.isExpanded&&t.fixed}),function(t){return t.fixed})),e=this.sum(_.map(e,function(t){return t.weight})),n=o/e,_.each(i.sections,function(t,e){t.$el.toggleClass("expanded",t.isExpanded),t.isExpanded?t.$el.height((t.fixed||t.weight*n)+"px"):t.$el.height(0),t.resize&&t.resize(),t.isResizable&&t.isExpanded&&!t.fixed&&e<i.sections.length-1&&_.some(i.sections.slice(e+1),function(t){return t.isExpanded&&!t.fixed})?t.resizeable=t.$el.resizable({handles:"s",resize:$.proxy(i.onSectionResize,i,t),start:function(){_.each(i.sections,function(t){t.startHeight=t.$el.height()}),t.$el.resizable("option","maxHeight",i.$el.height()-(i.sections.length-1)*i.HEADING_HEIGHT)},stop:function(){i.updateLayout()}}):t.resizeable&&(t.$el.resizable("destroy"),delete t.resizeable)}),t?this.debouncedRemoveAnimate():i.onUpdate&&i.onUpdate(i.sections)},s.AccordionView=Fo,c=A=A||{},qo.prototype.on=function(t,e,n){},qo.prototype.off=function(t,e,n){},qo.prototype.trigger=function(t){for(var e=1;e<arguments.length;e++)e-1,0},qo.prototype.bind=function(t,e,n){},qo.prototype.unbind=function(t,e,n){},qo.prototype.once=function(t,e,n){},qo.prototype.listenTo=function(t,e,n){},qo.prototype.listenToOnce=function(t,e,n){},qo.prototype.stopListening=function(t,e,n){},c.CustomEvents=qo;ks.getComponentViewStates=function(t,n){void 0===n&&(n=!0);function i(e){e&&(e instanceof A.Component?(n&&(e.get("components").each(function(t){i(t)}),e.get("widgets").each(function(t){i(t.get("component"))})),i(e.get("options"))):_.isArray(e)?_.each(e,function(t){i(t)}):e.attributes?e.path?e.get("_dataSource")||_.includes(o,e.path)||(o.push(e.path),"dict"===e.get("_type")&&_.each(e.get("_default"),function(t){t instanceof A.DocumentViewModel&&o.push(t.path)})):i(e.attributes):!_.isObject(e)||e instanceof m.View||("viewstate"===e._dashboardsType?_.includes(o,e.value)||o.push(e.value):_.each(_.keys(e),function(t){i(e[t])})))}var o=[];return i(t),o},ks.mergeViewStates=function(t,s){var a;t&&s&&(_.each(t,function(t,e){if(!s.get("viewState").getByPath(e)){var n=e.split("/"),i=null,e=void 0;if(n.length<=1)a=n[0],i=new A.DocumentViewModel(t,null);else{for(var i=s.get("viewState"),o=0;o<n.length-1;o+=1)i.set(n[o],i.get(n[o])||new A.DocumentViewModel(null,null)),i=i.get(n[o]),a=0===o?n[o]:n.slice(0,o).join("/"),i.path=a;a=n.join("/"),e=new A.DocumentViewModel(t,null),i.set(n[n.length-1],e),e.path=a}s.get("viewState").getByPath(a)||(i.path=a,s.get("viewState").set(a,i))}}),s.get("viewState").postInitialize())},ks.getMappingDataSources=function(n,t){var i=[];return t.get("data").getTreeList().forEach(function(e){e.get("_mappings")&&_.each(e.get("_mappings").mappings,function(t){_.includes(n,t.value)&&(i[e.path]=e.toJSON())})}),i},ks.mergeDataSources=function(t,r){var l;t&&(l=r.get("data"),_.each(t,function(t,e){for(var n,i=_.filter(e.split("/"),function(t){return t&&0<t.length}),o=l,s="",a=0;a<i.length;a+=1)s=(s+=0===a?"":"/")+i[a],n=new A.DocumentDataModel(a!==i.length-1?{}:t,l,s,r.get("viewState"),a!==i.length-1),o=r.get("data").getByPath(s)?r.get("data").getByPath(s):(o.set(i[a],n),n.viewState=r.attributes.viewState,n)}))},ks.getComponentDataSources=function(t,n,i,o){void 0===o&&(o=!0);var s,a={},r={},l=function(t){return t._cpKey||(_.isObject(t)||_.isArray(t))&&(Object.defineProperty(t,"_cpKey",{enumerable:!1,writable:!0}),t._cpKey=_.uniqueId("_cpKey_")),t._cpKey||null},u=function(e){!e||(s=l(e))&&r[s]||(s&&(r[s]=!0),!o&&(e instanceof A.WidgetCollection||e instanceof A.ComponentCollection))||(_.isArray(e)?_.each(e,function(t){u(t)}):e.attributes?(e.attributes._dataType&&_.includes(["analytic","pivot","query","virtual","builder"],e.attributes._dataType)&&(_.each(e.getViewStateDict(),function(t){_.includes(n,t.path)||(n.push(t.path),"dict"===t.get("_type")&&_.each(t.get("_default"),function(t){t instanceof A.DocumentViewModel&&n.push(t.path)}))}),"virtual"===e.attributes._dataType&&_.each(e.get("_virtualParams"),function(t){var e;"datasource"===t.type&&(e=i.getByPath(t.value))&&(_.each(e.getViewStateDict(),function(t){_.includes(n,t.path)||n.push(t.path)}),a[t.value]=e.toJSON())}),a[e.path]=e.toJSON()),u(e.attributes)):!_.isObject(e)||e instanceof m.View||("data"===e._dashboardsType?a[e.value]||u(i.getByPath(e.value)):_.each(_.keys(e),function(t){u(e[t])})))};return u(t),a};var Yo,Ho,Ko,k,zo,Qo,Wo,jo,Go,Xo,Zo,Jo,ts,es,ns,is,os,ss,as,rs,ls,us,cs,ps,ds,hs,gs,fs,ms,ys,vs,bs,ws,Ss,_s,Ts,Cs,Ds,Ms,Es,A,Ps,Is=ks;function ks(t){}function As(t,e,n,i,o){var s=Ho.call(this)||this;return s.nodes={},s.edges={},s.edgesR={},s.subscriptions={},s.activeViewStateToSubscriptions={},s.getDataSourceByPath=i,s.viewState=t,s.dataSources=e,s.onNodeUpdate=o,s.viewState.getViewStateList().forEach(function(t){var e=s.addNode("vs",t.path,t.model);"dict"===t.model.get("_type")&&_.each(t.model.get("value"),function(t){t&&t.path&&(t=s.addNode("vs",t.path,t),s.addEdge({fromNodeId:t,toNodeId:e}))})}),_.each(s.dataSources.flatten(),function(e){var n;e&&e.path&&(n=s.addNode("ds",e.path,e),_.each(e.getViewStateDict(),function(t){t&&t.path&&s.addEdge({fromNodeId:"vs:"+t.path,toNodeId:n})}),_.each(e.getMappedViewStates(),function(t){t&&t.path&&s.addEdge({fromNodeId:n,toNodeId:"vs:"+t.path})}),"virtual"===e.get("_dataType"))&&_.each(_.filter(e.get("_virtualParams"),{type:"datasource"}).map(function(t){return t.value}),function(t){s.getDataSourceByPath(t)?(t=s.addNode("ds",t,e),s.addEdge({fromNodeId:t,toNodeId:n})):Yo.Log.Warn("DocumentGraph: "+e.path+" has invalid source parameter  "+e.path)})}),_.isUndefined(s.hierarchical)&&(s.hierarchical=_.keys(s.nodes).length<20),_.each(n,function(t){var n,e=Is.getComponentViewStates(t,!1),i=Is.getComponentDataSources(t,e,s.dataSources,!1);!e.length&&_.isEmpty(i)||(n=s.addNode(t.get("key"),t.get("key")+"-"+t.get("_cpKey").substring(7),t),_.each(e,function(t){s.addEdge({fromNodeId:"vs:"+t,toNodeId:n})}),_.each(i,function(t,e){s.addEdge({fromNodeId:"ds:"+e,toNodeId:n})}))}),s}Yo=A=A||{},Ho=Yo.CustomEvents,e(As,Ho),As.addEdgeToCollection=function(t,e,n){var i=t[e];i?-1===i.indexOf(n)&&i.push(n):t[e]=[n]},As.prototype.getFormDataSources=function(t,e,n){var i=this,o=this.getRelatedDataSources(_.map(t,function(t){return"vs:"+t}),this.edges),t=this.getRelatedDataSources(_.map(t,function(t){return"vs:"+t}),this.edgesR),e=this.getRelatedDataSources(_.map(e,function(t){return"ds:"+t}),this.edgesR),n=this.getRelatedDataSources(_.map(n,function(t){return"vs:"+t}),this.edgesR);return _.map(_.union(_.intersection(o,e),_.intersection(o,t),n),function(t){return i.nodes[t].model})},As.prototype.getIsolatedNodes=function(t,e){var n=this;return _.filter(t,function(t){t=e+t.path;return!n.edges[t]&&!n.edgesR[t]})},As.prototype.getIsolatedDataSources=function(){return this.getIsolatedNodes(this.dataSources.flatten(),"ds:")},As.prototype.getIsolatedViewStates=function(){return this.getIsolatedNodes(this.viewState.getViewStateList().filter(function(t){return!t.path.startsWith("_settings/")}),"vs:")},As.prototype.onSearch=function(t){var e=this;_.each(this.nodes,function(t){t.searched=!1}),_.each(t,function(t){e.depthFirstSearch(t)})},As.prototype.unsubscribeAll=function(){var e=this;_.each(this.subscriptions,function(t){return e.unsubscribe(t.source)}),_.each(this.activeViewStateToSubscriptions,function(t){return e.unsubscribeViewStates(t)})},As.prototype.addEdge=function(t){var e=t.fromNodeId,t=t.toNodeId;As.addEdgeToCollection(this.edges,e,t),As.addEdgeToCollection(this.edgesR,t,e)},As.prototype.addNode=function(t,e,n){var i=t+":"+e;return this.nodes[i]||(this.nodes[i]={id:i,label:e,model:n,visited:!1,searched:!1}),this.onNodeUpdate&&("ds"===t&&n.agent.subscriberCount()&&this.subscribe(n,this.onNodeUpdate(i),i),"vs"===t)&&(this.activeViewStateToSubscriptions[n.path]=n,this.listenTo(n,"change:value",this.onNodeUpdate(i))),i},As.prototype.breadthFirstSearch=function(t,e){return _.each(this.nodes,function(t){t.visited=!1}),this.visitAndMeetNeighbors(t,e)},As.prototype.depthFirstSearch=function(t){var e=this,n=this.edges[t]||[],i=this.edgesR[t]||[];this.nodes[t].searched=!0,_.each(n.concat(i),function(t){e.nodes[t].searched||e.depthFirstSearch(t)})},As.prototype.getDataSourceKey=function(t){if(t)return t.path||t.cid},As.prototype.getRelatedDataSources=function(t,n){var i=this,t=_.reduce(t,function(t,e){return t.concat(i.breadthFirstSearch(e,n))},[]);return _.uniq(t.filter(function(t){return 0===t.indexOf("ds")}))},As.prototype.subscribe=function(t,e,n,i,o){var s=this.getDataSourceKey(t);return this.subscriptions[s]?(this.subscriptions[s].callback=e,!1):(this.subscriptions[s]={source:t,onData:e},this.subscriptions[s].key=_.uniqueId(n+"_"),t.subscribe(this.subscriptions[s].key,this.subscriptions[s],i,o),!0)},As.prototype.unsubscribe=function(t){var e=this.getDataSourceKey(t);this.subscriptions[e]&&(t.unsubscribe(this.subscriptions[e].key),delete this.subscriptions[e])},As.prototype.unsubscribeViewStates=function(i){var o=this;_.each(this.activeViewStateToSubscriptions,function(t,e){var n=i.getByPath(e);o.stopListening(n,"change:value"),delete o.activeViewStateToSubscriptions[e]})},As.prototype.visitAndMeetNeighbors=function(t,n){var i=this,e=[];return e=this.nodes[t]&&!this.nodes[t].visited&&(this.nodes[t].visited=!0,e.push(t),t=n[t])?_.reduce(t,function(t,e){return t.concat(i.visitAndMeetNeighbors(e,n))},e):e},Yo.DocumentGraph=As;d=A=A||{};function xs(t){this.datasources={},this.templates={},this.triggers=[],this.sendNotification=t}xs.prototype.onTriggerChange=function(t){var o=this,e=(this.triggers=t).map(function(t){if(t.source)return t.source.cid});t.forEach(function(t){var e=t.template,n=t.source,i=t.icon,t=t.sound;n&&!o.datasources[n.cid]?o.datasources[n.cid]=new Ns(n,e,i,t,o.sendNotification):n&&o.datasources[n.cid].updateTemplate(e,i,t)}),Object.keys(this.datasources).filter(function(t){return-1===e.indexOf(t)}).forEach(function(t){o.datasources[t].unsubscribe(),o.datasources[t]=void 0,delete o.datasources[t]})},d.DatasourceNotifier=xs,Ls.prototype.updateTemplate=function(t,e,n){this.template=U.compile(t),this.icon=e,this.sound=n},Ls.prototype.subscribe=function(){this.source.subscribe("notifications",this),this.source.dataSet.noBackground=!0},Ls.prototype.unsubscribe=function(){this.source.unsubscribe("notifications")},Ls.prototype.onData=function(t,e){var o=this;e.add&&e.add.length&&e.add.forEach(function(t){t=_.omit(t,["_rowIndex"]);var t=o.template(t),e=o.source.path,n=o.sound,i=o.icon;o.sendNotification("datasource-notifications",{title:e,message:t,icon:i},{sound:n})})};var Ns=Ls;function Ls(t,e,n,i,o){this.source=t,this.sound=i,this.icon=n,this.template=U.compile(e),this.sendNotification=o,this.subscribe()}function x(){}function N(t){var e,n,i,o,s=zo.call(this)||this,a=(s.saveSettingsNowDebounced=_.debounce(s.saveSettingsNow.bind(s),100),s.activeViewStateToPropertyPaths={},s.propertyPathsToViewStates={},s.activeViewStateToSubscriptions={},s.subscriptionsToViewStates={},s.viewStateSubscriptions={},s.interface={},s.subscriptions={},s.getTemplateViewStates=function(t){return this.processTemplateViewStates(this.getViewStates(this.extractTemplateViewStates(t)))},s.notifyViewStateSubscriber=function(t){var e=this.viewStateSubscriptions[t],t=this.subscriptionsToViewStates[t];_.isFunction(e)&&e(this.getViewStates(t))},s.subscribe=function(t,e,n,i){var o;if("data"===this.getSourceType(t)){if(o=this.getDataSourceKey(t),this.subscriptions[o])return this.subscriptions[o].callback=e,!1;this.subscriptions[o]={key:this.getSubscriptionKey(t.path),source:t,onData:e},t.subscribe(this.subscriptions[o].key,this.subscriptions[o],n,i)}else k.Log.Warn("Source type not implemented")},s.subscribeTemplateViewStates=function(t,e){var n=this;return this.subscribeViewStates(this.extractTemplateViewStates(t),function(t){e(n.processTemplateViewStates(t))})},s.subscribeViewStates=function(t,e){var n=this,i=_.uniqueId("vs_");return this.viewStateSubscriptions[i]=e,this.subscriptionsToViewStates[i]=[],_.each(t,function(t){t=n.docViewModel.getByPath(t);t&&(n.subscriptionsToViewStates[i].push(t.path),n.activeViewStateToSubscriptions[t.path]?-1===n.activeViewStateToSubscriptions[t.path].indexOf(i)&&n.activeViewStateToSubscriptions[t.path].push(i):(n.activeViewStateToSubscriptions[t.path]=[i],n.listenTo(t,"change:value",function(t,e){var n=this;_.each(this.activeViewStateToSubscriptions[t.path],function(t){n.notifyViewStateSubscriber(t)})})))}),this.notifyViewStateSubscriber(i),i},s.unsubscribe=function(t){var e;switch(this.getSourceType(t)){case"data":e=this.getDataSourceKey(t),this.subscriptions[e]&&(t.unsubscribe(this.subscriptions[e].key),delete this.subscriptions[e]);break;case"viewstate":this.stopListening(t,"change:value")}},s.unsubscribeAll=function(){var i=this;_.each(this.subscriptions,function(t,e){t.source.unsubscribe(t.key),delete i.subscriptions[e]}),_.defer(function(){_.each(i.activeViewStateToPropertyPaths,function(t,e){var n=i.docViewModel.getByPath(e);i.stopListening(n,"change:value"),delete i.activeViewStateToPropertyPaths[e]}),_.each(i.activeViewStateToSubscriptions,function(t,e){var n=i.docViewModel.getByPath(e);i.stopListening(n,"change:value"),delete i.activeViewStateToSubscriptions[e]})})},s.unsubscribeViewStates=function(n){var i=this;this.viewStateSubscriptions[n]&&(_.each(this.subscriptionsToViewStates[n],function(t){var e;i.activeViewStateToSubscriptions[t]=_.without(i.activeViewStateToSubscriptions[t],n),_.isEmpty(i.activeViewStateToSubscriptions[t])&&_.isEmpty(i.activeViewStateToPropertyPaths[t])&&(e=i.docViewModel.getByPath(t),i.stopListening(e,"change:value"),delete i.activeViewStateToSubscriptions[t])}),delete this.subscriptionsToViewStates[n],delete this.viewStateSubscriptions[n])},s.unsubscribeTemplateViewStates=function(t){this.unsubscribeViewStates(t)},[]);return s.appKey=t.appKey,s.componentId=t.componentId,s.dashboardAppModel=t.dashboardAppModel,s.dashboardViewModel=t.dashboardViewModel,s.deltaClient=t.deltaClient,s.deltaClientLib=t.deltaClientLib,s.docDataModel=t.docDataModel,s.docViewModel=t.docViewModel,s.settingsModel=t.settingsModel,s.quickView=t.quickView,s.widgetId=t.widgetId,s.activeViewStateToPropertyPaths={},s.propertyPathsToViewStates={},s.interface={},s.subscriptions={},a=_.union(a,N.API_METHODS),t.advancedMethods&&(a=_.union(a,N.ADVANCED_METHODS)),_.each(a,_.bind(function(t){_.isFunction(this[t])?this.interface[t]=_.bind(this[t],this):_.isUndefined(this[t])||(this.interface[t]=this[t])},s)),t.docViewModel&&t.docViewModel.viewStates&&(a=t.docViewModel.viewStates.filter(function(t){return t.path.startsWith("_settings/")}),e=t.deltaClientLib.username,n=t.dashboardViewModel.get("selectedDocumentId"),i=t.dashboardAppModel.get("documents").get(n).get("name"),o=k.Tools.timezone,_.each(a,function(t){switch(t.path.slice("_settings/".length)){case"dashboardUser":t.model.set("value",e,{silent:!0});break;case"dashboardUrl":t.model.set("value",document.URL,{silent:!0});break;case"dashboardTitle":t.model.set("value",i,{silent:!0});break;case"dashboardTimezone":t.model.set("value",o,{silent:!0})}})),s.listenTo(s.docViewModel,"change",function(t,e){var i,o;e&&e.unset?(this.renamingViewState=(t.path?t.path+"/":"")+_.first(_.keys(t.changed)),_.defer(_.bind(function(){this.renamingViewState=null},this))):(this.renamingViewState&&(i=this.renamingViewState,o=(t.path?t.path+"/":"")+_.first(_.keys(t.changed)),i!==o)&&(this.activeViewStateToPropertyPaths[i]&&(this.activeViewStateToPropertyPaths[o]=this.activeViewStateToPropertyPaths[i],delete this.activeViewStateToPropertyPaths[i]),this.activeViewStateToSubscriptions[i]&&(this.activeViewStateToSubscriptions[o]=this.activeViewStateToSubscriptions[i],delete this.activeViewStateToSubscriptions[i]),_.each(this.propertyPathsToViewStates,_.bind(function(t,e){t===i&&(this.propertyPathsToViewStates[e]=o)},this)),_.each(this.subscriptionsToViewStates,_.bind(function(t,n){_.each(t,function(t,e){t===i&&(this.subscriptionsToViewStates[n][e]=o)})},this))),this.renamingViewState=null)}),s}function Vs(t){var e=Wo.call(this,t)||this;return e.$appDiv=null,e.app=null,e.appOnSettingsChange=null,t.el||e.el.classList.add("component-build-view"),_.extend(e,_.pick(t,Vs.COMMON_OPTIONS)),t.key?(e.componentId=t.namespace||_.uniqueId("component_"),e.appOptions=t.appOptions,e.key=t.key,e.settingsModel=t.settings instanceof m.Model?t.settings:new Qo.ComponentOptions(t.settings,{},null)):(e.componentId=e.model.id,e.key=e.model.get("key"),e.settingsModel=e.model.get("options")),e.initializeApi(),e.render(),e.requireApp(),e}function Os(t){var e=Go.call(this,t)||this;return e.isCancel=!1,e.options=t,e.preRender(),e.render(),e.postRender(),e.resizeListener=e.onResize.bind(e),$(window).on("resize",e.resizeListener),e}function Bs(t){return Zo.call(this,_.extend({iconClass:"fa-asterisk",dialogTitle:"Save Changes",minHeight:110,width:300},t,{userClass:"areyousure-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function Rs(e){var n=ts.call(this,e)||this,i=(n.MESSAGE_TYPES=["error","success","warning"],n.clicked=!1,m.Model.extend({schema:{username:{title:t("Username")},oldpassword:{title:t("Current Password"),type:"Password",validators:["required"]},password1:{title:t("New Password"),type:"Password",validators:["required"]},password2:{title:t("Re-Enter"),type:"Password",validators:[{type:"match",field:"password1",message:"Passwords must match!"},"required"]}}}));return n.boundToggleCaps=n.toggleCapsLockMsg.bind(n),n.model=new i({username:void 0}),delete n.model.schema.username,n.form=new m.Form({model:n.model}).render(),n.$el.append(n.form.el),n.$el.append('<div class="message-box">'),$(n.form.el).submit($.proxy(n.onSubmit,n)),n.$messageBox=n.$el.find(".message-box"),e.message?n.showMessage(e.message):n.showMessage(),n.onChangeSuccess=e.onChangeSuccess,n.$dialog=n.$el.dialog(_.extend({appendTo:e.container,dialogClass:"quick-base change-password-dialog",title:t("Change Password"),resizable:!1,height:262,width:320,modal:!0,autoOpen:!0,draggable:!0,buttons:[{text:t("OK"),click:$.proxy(n.onSubmit,n),icons:{primary:"fa fa-check"}},{text:t("Cancel"),click:$.proxy(n.close,n),icons:{primary:"fa fa-times"}}],open:function(){$('<i class="fa fa-check"></i>').insertBefore(n.$el.parent().find(".ui-dialog-title")),$(".quick-base").addClass("disturbed"),n.$okBtn=$(n).parent().find(".ui-dialog-buttonpane button").first(),n.$el.find(".old-password-input").focus()},close:function(){$(".quick-base").removeClass("disturbed"),Jo.ErrorTooltip.clearAll(),_.isFunction(e.onClose)&&e.onClose(),n.onRemove(),_.isFunction(e.onDialogClose)&&e.onDialogClose()}},e)),$(n.form.el).find("input").on("keydown",function(t){13===t.which&&n.onSubmit()}),$(n.form.el).find("input").on("keypress",function(e){Jo.LoginDialog.checkCapslockOn(e.originalEvent)?n.showMessage('<i class="fa fa-warning"></i>'+t("Caps Lock is on"),"warning"):n.showMessage()}),window.addEventListener("keydown",n.boundToggleCaps,!0),n}function $s(t){var e=es.call(this,_.extend({iconClass:"fa-trash-o",dialogTitle:"Confirm Delete",minHeight:110,width:275},t,{userClass:"confirm-dialog"+(t.userClass?" "+t.userClass:"")}))||this;return _.isFunction(t.renderTemplate)&&(e.renderTemplate=t.renderTemplate),e}function Us(t){return ns.call(this,_.extend({iconClass:"fa-exclamation-triangle",dialogTitle:"Error",minHeight:110,width:275},t,{userClass:"error-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function Fs(t){return os.call(this,_.extend({dialogTitle:"Warning"},t,{userClass:"warning-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function L(t){t=as.call(this,t)||this;return t.COMPONENT_SAVE_TIMEOUT=2e3,t.QUERY_STATUS_DELAY=200,t.QUERY_STATUS_FADE=3e3,t.showNoResultsIndicators=!1,t.customErrorClass="",t.model.set("upgrading",!0,{silent:!0}),L._instances.push(t),t}function V(t){t=ls.call(this,t)||this;return t.widgetClass="component-drop-widget",t}function qs(t){var e=cs.call(this,t)||this;return e.appModel=null,e.availableHeight=0,e.documentsList=null,e.documentTypeMap=null,e.showManage=!1,e.viewModel=null,e.RECENT_DOCUMENT_COUNT=3,e.appModel=t.appModel,e.viewModel=t.viewModel,e.showManage=t.showManage,e.debouncedRender=_.debounce(e.render,100),e.initializeEvents(),e}function Ys(t){var e=ds.call(this,t)||this;return e.cssClasses=null,e.customCss=null,e.$customCss=null,e.popups=[],e.prevCssViewModel=null,e.appModel=t.appModel,e.viewModel=t.viewModel,e.quickView=t.quickView,e.model.upgrade(),e.el.className="document-view",e.$el.html(ps.T.DocumentView({})),e.initializeEvents(),e.applyCustomCss(),e.onCssClassesChanged(),e.onSelectedScreenChanged(),e.quickView||e.onResetPopups(),e}function Hs(t){var e=gs.call(this,t)||this;return e.errorMessage=t.errorMessage,e.appModel=t.appModel,e.container=t.container,e.doLogin=t.doLogin,e.container.html(e.render().$el),e.boundCapsLockFn=$.proxy(e.onWindowCapsLockClick,e),e.initializeEvents(),e}function Ks(){}function zs(t){var e=ms.call(this,t)||this;return e.MAJOR_TIMEZONES=[{label:"UTC / Unaltered",value:"UTC"},{label:"Frankfurt",value:"Europe/Berlin"},{label:"London",value:"Europe/London"},{label:"New York",value:"America/New_York"},{label:"Sydney",value:"Australia/Sydney"},{label:"Tokyo",value:"Asia/Tokyo"}],e.logLevels=[{label:"None",value:0},{label:"Errors",value:1},{label:"Handled/Warnings",value:2},{label:"Log & Debugs",value:3},{label:"All",value:4}],e.dialogContainer=null,e.isQuickView=!1,e.el.className="account-menu ui-widget ui-widget-content",e.appModel=t.appModel,e.dialogContainer=t.dialogContainer,e.themes=t.themes,e.viewModel=t.viewModel,e.isQuickView=!!t.isQuickView,e.$el.click(function(t){$(t.target).is("li")||t.stopPropagation()}),e.listenTo(e.viewModel,"change:themeSwitchable",e.onThemeSwitchableChange),e.getTimezones(),e.render(),e}function Qs(t){var e=vs.call(this,t)||this;return e.viewStateListeners={},e.appModel=t.appModel,e.viewModel=t.viewModel,e.quickView=t.quickView,e.isEditing=t.isEditing,e.$el.html(ys.T.popup({})),e.$dialog=e.$el.find(".dialog"),e.$contentPanel=e.$dialog.find(".content-panel"),t.container?e.$dialogContainer=t.container:e.$dialogContainer=$(".quick-dash > .content-panel > .document-view"),e.onDialogAttributeChange=_.debounce(e.initializeDialog,100),e.initializeDialog(),e.initializeEvents(),e.initializeVisible(),e}function Ws(t){var e=ws.call(this,t)||this;return e.isCancel=!1,e.options=t,e.initColorPicker(e.options.path),e}function js(){}function Gs(){}function Xs(t){return Ts.call(this,_.extend({iconClass:"fa-keyboard-o",dialogTitle:"Simple Input",userClass:"simpleinput-dialog",width:275,height:140},t,{userClass:"simpleinput-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function Zs(t){this.csvExportDelimiter=t.csvExportDelimiter,this.dataSet=t.dataSet,this.metaData=t.metaData,this.configSets=t.configSets,this.workSheetTitle=t.workSheetTitle,this.fileFormat=t.fileFormat,this.fileName=t.fileName,this.actions=t.actions,this.selectedDashboard=t.selectedDashboard,this.bookType={".xlsx":"xlsx",".xls":"xlml",".csv":"csv"}[t.fileFormat]}function Js(t){var e=Ms.call(this,t)||this;return e.DATA_SOURCE_PROPERTY="Basics.Data",e.EXPORT_PROPERTY_OBJECT="FileExport",e.EXPORT_PROPERTY_KEYS=["ShowExportCsvButton","ShowExportExcelButton","ShowFullExportButton","ShowClipboard","ShowScreenshot"],_.extend(e,_.pick(t,e.SETTINGS)),e.isIE=HTMLCanvasElement&&HTMLCanvasElement.prototype&&HTMLCanvasElement.prototype.msToBlob,e.$el.html(Ds.T.fileExporter({})),e.$root=e.$el.find(">.pnlButtons"),e.$lnksExport=e.$el.find(".lnksExport"),e.$lnkCsvExport=e.$el.find("a.lnkCsvExport"),e.$lnkExcelExport=e.$el.find("a.lnkExcelExport"),e.$lnkFullExport=e.$el.find("a.lnkFullExport"),e.$lnksScreenshot=e.$el.find(".lnksScreenshot"),e.$lnkCopyScreenshot=e.$el.find("a.lnkCopyScreenshot"),e.$lnkDownloadScreenshot=e.$el.find("a.lnkDownloadScreenshot"),e.initializeEvents(),e}function O(){}function ta(){}function B(){}Ko=A=A||{},x.generateAggregatedMessage=function(t){var e=[];return _.each(t,function(t){t&&t[1]&&(t=t[1].message||"",e.push(37<t.length?t.substring(0,37)+" ..":t))}),e.join("\r\n")},x.generateAudio=function(t){var e=_.now(),n=x.suspendedAudioNotifications[t];return void 0===n||n<e?(x.suspendedAudioNotifications[t]=e+5e3,new Audio(x.MEDIA_LOCATION+t+".mp3")):null},x.notify=function(t,e,n){var i=x.currentSettings.Notifications;if(t!==x.AGGREGATED_ID&&i.Grouping&&i.GroupingInterval)0===x.pendingNotifications.length&&(x.pendingNotificationsTimeoutId=setTimeout(function(){1<x.pendingNotifications.length?x.notify(x.AGGREGATED_ID,{title:x.pendingNotifications.length+" alerts received",message:x.generateAggregatedMessage(x.pendingNotifications)},!0):(x.pendingNotifications[0][0]=x.AGGREGATED_ID,x.notify.apply(x,x.pendingNotifications[0])),x.pendingNotificationsTimeoutId=void 0,x.pendingNotifications=[]},1e3*i.GroupingInterval)),x.pendingNotifications.push(_.concat([],arguments));else{if(n&&i.SoundVolume&&"Audio"in window)try{var o=void 0;_.isBoolean(n)&&"none"!==i.Sound?o=x.generateAudio(i.Sound):"none"!=n.sound&&(o=x.generateAudio(n.sound)),o&&(o.volume=i.SoundVolume/100,o.play().then(function(){}).catch(function(){x.hasNotified||(x.notify("Notification API",{icon:"fa-volume-off",message:"Your browser is blocking notification audio, interact with the page to enable audio.",title:"Notification Audio Error"}),x.hasNotified=!0)}))}catch(t){Ko.Log.Error("Audio API ERROR",arguments)}if(e){var o=i.InBrowserNotifications||!("Notification"in window)||"denied"===Notification.permission,s=e.title||"Alert",a=e.message||"",r=e.icon||("none"!==i.Icon?i.Icon:null);if(r=r.substring(3),o)x.$pnlNotifications||(o=function(){var t=$(this).closest(".inBrowserNotification"),e=t.data("fadeOutId");e&&clearTimeout(e),t.remove()},(x.$pnlNotifications=$("<div></div>",{class:"pnlInBrowserNotifications"}).appendTo($(".document-view"))).on("click","i",o),x.$pnlNotifications.on("dblclick",".inBrowserNotification",o)),x.positionPanel(x.$pnlNotifications,i.Position),x.$pnlNotifications.children().length>=i.MaxVisibleCount&&x.$pnlNotifications.children().first().remove(),o=$(Ko.T.InBrowserNotification({title:s,message:a.replace(/\r\n/g,"<br>"),icon:r})).appendTo(x.$pnlNotifications),i.FadeOut&&o.data("fadeOutId",setTimeout(o.remove.bind(o),1e3*i.FadeOut));else try{var l,u=new Notification(s,{body:a,icon:r?x.isWindows10()?x.ICON_LOCATION_LIGHT+r+".png":x.ICON_LOCATION+r+".png":void 0,silent:!0});i.FadeOut&&(l=function(){u.close(),window.removeEventListener("beforeunload",l)},u.onshow=function(){setTimeout(l,1e3*i.FadeOut)},window.addEventListener("beforeunload",l))}catch(t){Ko.Log.Error("Notification API ERROR",arguments)}}}},x.positionPanel=function(t,e){e={"Top Left":"","Top Center":"position_center","Top Right":"position_right","Center Left":"position_middle","Center Center":"position_middle position_center","Center Right":"position_middle position_right","Bottom Left":"position_bottom","Bottom Center":"position_bottom position_center","Bottom Right":"position_bottom position_right"}[e];t.removeClass("position_middle position_bottom position_center position_right").addClass(e)},x.isWindows10=function(){return 0<=window.navigator.userAgent.search(/(Windows 10.0)|(Windows NT 10.0)/)},x.setOptions=function(t){x.currentSettings=t,x.datasourceNotifier.onTriggerChange(t.Notifications.triggers||[]),x.pendingNotificationsTimeoutId&&(clearTimeout(x.pendingNotificationsTimeoutId),x.pendingNotificationsTimeoutId=void 0,x.pendingNotifications=[])},x.show=function(t,e,n){var i;x.currentSettings.Notifications.Enabled&&(!x.currentSettings.Notifications.InBrowserNotifications&&"Notification"in window&&"granted"!==Notification.permission&&"denied"!==Notification.permission?(i=arguments,Notification.requestPermission(function(){x.show.apply(this,i)})):x.notify(t,e,n))},x.upgradeConfig=function(t){var e;return t?(e=void 0,t.Notifications._Version!==(e=x.DEFAULT_JSON.Notifications._Version)&&(t.Notifications._Version=e)):t=x.DEFAULT_JSON,t.Notifications.triggers=t.Notifications.triggers?t.Notifications.triggers.map(function(t){var e=t.source;return tt(tt({},t),{source:"data"===e._dashboardsType?x.documentDataModel.getByPath(e.value):e})}):[],t},x.setDocumentDataModel=function(t){this.documentDataModel=t},x.pendingNotifications=[],x.AGGREGATED_ID="AGGREGATED_NOTIFICATION",x.hasNotified=!1,x.suspendedAudioNotifications={},x.MEDIA_LOCATION=require.toUrl("QuickBase").replace("/main","")+"/notifications/",x.ICON_LOCATION=require.toUrl("QuickBase").replace("/main","")+"/images/black/",x.ICON_LOCATION_LIGHT=require.toUrl("QuickBase").replace("/main","")+"/images/white/",x.SCHEMA={type:"object",title:"Properties",properties:{Notifications:{type:"object",title:"Notifications",options:{collapsed:!0},properties:{_Version:{type:"string",default:"4.2.0s2",options:{hidden:!0}},Enabled:{title:"Enabled",propertyOrder:100,type:"boolean",format:"checkbox",default:!0},InBrowserNotifications:{title:"InBrowser",propertyOrder:110,type:"boolean",format:"checkbox",default:!1},Position:{title:"Position",propertyOrder:120,type:"string",enum:["Top Left","Top Center","Top Right","Center Left","Center Center","Center Right","Bottom Left","Bottom Center","Bottom Right"],default:"Bottom Right"},MaxVisibleCount:{title:"Max Count",propertyOrder:130,type:"number",minimum:1,default:3},FadeOut:{title:"FadeOut (s)",propertyOrder:140,type:"number",minimum:0,default:5},Icon:{title:"Icon",propertyOrder:150,type:"icon",default:"fa-bell-o",iconTypes:"fa"},Sound:{title:"Sound",propertyOrder:160,type:"string",enum:x.NOTIFICATION_SOUNDS=["beep","beepbeep","ding","exquisite","long-expected","festive","job-done","arcade","echo","case-closed","none"],default:"beep"},SoundVolume:{title:"Sound Volume",propertyOrder:170,type:"number",format:"range",minimum:0,maximum:100,default:100},Grouping:{title:"Group Notifications",propertyOrder:180,type:"boolean",format:"checkbox",default:!1},GroupingInterval:{title:"Grouping Interval (s)",propertyOrder:190,type:"number",minimum:0,default:1},triggers:{title:"Additional Triggers",type:"array",items:{type:"object",id:"arrItem",additionalProperties:!1,options:{collapsed:!0},title:"Datasource Trigger",properties:{source:{type:"data",propertyOrder:100,title:"Datasource"},template:{type:"tooltipTemplate",propertyOrder:101,title:"Notification Template",default:"{{#each this}}{{@key}}: {{this}}\n{{/each}}"},sound:{title:"Sound",propertyOrder:103,type:"string",enum:x.NOTIFICATION_SOUNDS,default:"beep"},icon:{title:"Icon",iconTypes:"fa",propertyOrder:102,type:"icon",default:"fa-bell-o"}}}}}}}},x.DEFAULT_JSON={Notifications:_.mapValues(x.SCHEMA.properties.Notifications.properties,"default")},x.currentSettings=x.DEFAULT_JSON,x.datasourceNotifier=new Ko.DatasourceNotifier(x.show),x.CONFIG={SCHEMA:x.SCHEMA,upgradeConfig:x.upgradeConfig},Ko.NotificationManager=x,k=A=A||{},zo=k.CustomEvents,e(N,zo),N.prototype.getDataSourceMap=function(t,e,n){var i=this.dashboardViewModel.get("selectedDocumentId"),i=this.dashboardAppModel.get("documents").get(i);try{return new k.DocumentGraph(i.get("viewState"),i.get("data"),i.getComponents(),i.get("data").getByPath.bind(i.get("data")),null).getFormDataSources(t,e,n)}catch(t){console.error("ComponentApi.getDataSourceMap error",t)}},N.prototype.convertPathsToModels=function(t,e,a){var r,l=m.DeepModel.keyPathSeparator;if(!t)return!1;switch(t){case"data":r=$.proxy(this.docDataModel.getByPath,this.docDataModel);break;case"viewstate":r=$.proxy(this.docViewModel.getByPath,this.docViewModel)}t=this.getPropertiesByType(t,e.properties,e.definitions),_.each(t,function(t){var n,i,o,s,e,t=t.replace(/\.properties/g,"");1<(e=(t=t.replace(/\.oneOf\.\d+/g,"")).split(".items.")).length?(o=e[0],s=e[1],e=a.get(o),_.each(e,function(t,e){(i=function(t,e){e=e.split(".");for(var n=t,i=0;i<e.length;i++)n=n&&n[e[i]];return n}(t,s))&&"string"==typeof(i=i._dashboardsType?i.value:i)&&(n=(n=r(i))||{},a.set(o+l+e+l+s,n,{silent:!0}))})):(i=a.get(t))&&"string"==typeof(i=i._dashboardsType?i.value:i)&&(n=(n=r(i))||{},a.set(t,n,{silent:!0}))})},N.prototype.humanFileSize=function(t,e,n){void 0===n&&(n=1);var i=(e=void 0===e?!0:e)?1e3:1024;if(Math.abs(t)<i)return t+" B";for(var o=e?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],s=-1,a=Math.pow(10,n);t/=i,++s,Math.round(Math.abs(t)*a)/a>=i&&s<o.length-1;);return t.toFixed(n)+" "+o[s]},N.prototype.destroySettings=function(){var t;this.quickView&&(t=this.docViewModel.get(".settings"))&&t.unset(this.componentId)},N.prototype.exportData=function(o,s,a,r){var l=this;"data"===this.getSourceType(o)?o.exportData(function(t){var e,n,i;(-1<navigator.userAgent.toLowerCase().indexOf("firefox")||-1<navigator.userAgent.toLowerCase().indexOf("safari"))&&-1===navigator.userAgent.toLowerCase().indexOf("chrome")?((e=document.createElement("a")).setAttribute("href",t),e.setAttribute("download",""),document.body.appendChild(e),e.click(),document.body.removeChild(e)):(window.open(t,"_blank"),e=t,n=function(t){t=l.humanFileSize(t);try{l.onTransferAction(r,a.exportName,_.get(o,"dataSet.columnDict"),"success","zip",t,"download")}catch(t){l.onTransferAction(r,a.exportName,_.get(o,"dataSet.columnDict"),"failed","zip",0,"download")}},(i=new XMLHttpRequest).open("HEAD",e,!0),i.onreadystatechange=function(){this.readyState===this.DONE&&n(parseInt(i.getResponseHeader("Content-Length")))},i.send()),_.isFunction(s)&&s(t)},function(t){t="Export Data error"+(t?": "+t.toString():"");l.onTransferAction(r,a.exportName,_.get(o,"dataSet.columnDict"),t,"zip",0,"download"),k.Log.Error(t),k.ErrorDialog.ShowError(t),_.isFunction(s)&&s()},a):_.isFunction(s)&&s()},N.prototype.onTransferAction=function(i,o,s,a,r,l,u){_.each(_.get(i,"actions"),function(t){var e=_.get(t,"EventType"),n="success"===a,e="all"===e||"onSuccess"===e&&n||"onFail"===e&&!n;_.get(t,"Result.attributes")&&e&&t.Result.set("value",{component:_.get(i,"component"),dashboard:{dashboardId:_.get(i,"dashboardId"),dashboardName:_.get(i,"dashboardName")},fileRowLength:_.get(i,"fileLength")?_.get(i,"fileLength"):"na",fileMetaData:_.isNil(s)?"na":s,fileName:o,size:l,fileType:r,isSuccess:n,status:a,timestamp:Date.now(),type:_.isNil(u)?"download":u,username:k.DeltaClientLib.username})})},N.prototype.getDashboardName=function(e){var t=this.dashboardAppModel.get("documents").models,t=_.filter(t,function(t){return t.get("id")===e});return 0<t.length?t[0].get("name"):""},N.prototype.doActions=function(t,a){var r=this,l={dashboard:"<none>",screen:"<none>",target:""};_.each(t,function(t,e){t._Type||(_.isObject(t)?t._Type="nav":t={_Type:"nav",Value:t});var e=t._PropertyIndex||e,n=(a||"Actions")+"."+e;switch(t._Type){case"map":var i=r.getPropertyMeta(n+".Current"),o=r.getPropertyMeta(n+".Target"),s=void 0;l.viewstate||(l.viewstate={}),i&&(s=_.has(t,"Value")?t.Value:"viewstate"===i.type?i.value:t.Current,k.Tools.isKDBTemporal(s)&&(s=k.Tools.convertKDBTemporalToMoment(s).toDashString()),o&&"viewstate"===o.type&&o.path?r.setProperty(n+".Target",s):l.viewstate[t.Target]=s);break;case"nav":i=r.getPropertyMeta(n+".SelectDashboardScreen"),o="viewstate"===i.type?i.value:t.SelectDashboardScreen;_.isString(o)?(l.dashboard=o,l.screen=null):_.isObject(t)&&(t["SelectDashboardScreen._dashboardsType"]?_.extend(l,{dashboard:t["SelectDashboardScreen.dashboard"],screen:t["SelectDashboardScreen.screen"]}):_.isObject(o)&&_.extend(l,o)),t.Target&&(l.target=t.Target);break;case"query":t.DataSource&&t.DataSource.forceExecute(void 0,t.callback);break;case"url":s=t.Url;/\S+/g.test(s)&&(/^https?:\/\//i.test(s)||(s="//"+s),window.open(s,t.Target||"_blank"))}}),"<none>"===l.dashboard&&"<none>"===l.screen||r.navigate(l)},N.prototype.removeTooltip=function(){var t;this.unsubscribeTemplateViewStates(this.tooltipSubscriptionKey),this.tooltipSubscriptionKey="",null!=(t=this.genericTooltip)&&t.remove(),delete this.genericTooltip},N.prototype.setTooltip=function(t){var e=this;return this.genericTooltip?this.genericTooltip.updateTooltip(t):this.genericTooltip=new k.GenericTooltip(_.extend(t,{cssClass:this.appKey+"-tooltip"})),this.unsubscribeTemplateViewStates(this.tooltipSubscriptionKey),this.tooltipSubscriptionKey=this.subscribeTemplateViewStates(this.genericTooltip.text,function(t){e.genericTooltip.renderTemplate(t)}),this.genericTooltip},N.prototype.extractTemplateViewStates=function(t){var e=this,t=t.match(/\$[^$]*\$/gi);return _.map(_.uniq(t),function(t){t=e.docViewModel.getByPath(t.substring(1,t.length-1).replace(/\./g,"/"));if(t)return t.path})},N.prototype.getDashboardId=function(e){var t="<none>"===e?null:e&&"<this>"!==e?this.dashboardAppModel.get("documents").find(function(t){return t.get("name")===e}):this.dashboardAppModel.get("documents").get(this.dashboardViewModel.get("selectedDocumentId"));return t?t.id:"<none>"},N.prototype.getScreenId=function(t,e){var n,i,o,t=this.dashboardAppModel.get("documents").get(t);return t&&(e&&"<none>"!==e?t.has("screens")?(o=t.get("screens").find(function(t){return t.get("name")===e}))&&(i=o.id):(n=_.find(t.get("screenDetails"),function(t){return t.label===e}))&&(i=n.value):(n=t.get("screenDetails")[0])&&(i=n.value)),i||"<none>"},N.prototype.getDataSourceKey=function(t){return!!t&&(t.path||t.cid)},N.prototype.getDictValue=function(t){var i=this,o={};return"dict"!==t.get("_type")||"object"!=typeof t.get("value")?t.get("value"):(_.each(t.get("value"),function(t,e){var n;t instanceof k.DocumentViewModel?n=t.path:t instanceof m.Model?o[e]=t.get("value"):_.isObject(t)&&t.name?n=t.name:_.isString(t)&&t.match(k.DocumentDataModel.PARAMETER_RX)&&(n=t.substring(2,t.length-2)),n?(n=i.docViewModel.getByPath(n),o[e]=n?n.get("value"):t):o[e]=t}),o)},N.prototype.getPropertiesByType=function(n,t,i,o,s){var a=this,r=m.DeepModel.keyPathSeparator;return o=o||"",i=i||{},s=s||[],t&&(t.type===n?s.push(o):t&&t.constructor===Object?_.each(t,function(t,e){"$ref"===e?a.getPropertiesByType(n,i[t.replace("#/definitions/","")],i,o,s):a.getPropertiesByType(n,t,i,(o?o+r:"")+e,s)}):t&&t.constructor===Array&&_.each(t,function(t,e){a.getPropertiesByType(n,t,i,(o?o+r:"")+e,s)})),_.uniq(s)},N.prototype.getProperty=function(t){var e,n;if(!t)return null;switch(e=this.settingsModel.get(t),this.getSourceType(e)){case"data":n=null;break;case"viewstate":n=this.getPropertyValue(e);break;default:n=e}return n},N.prototype.getPropertyMeta=function(t){var e,n,i,o;if(!t)return null;if(null==(e=this.settingsModel.get(t)))return null;switch(t=this.getSourceType(e)){case"data":o=null;break;case"viewstate":o=this.getPropertyValue(e),n=e.get("_default"),i=e.get("_type");break;default:o=e}return{path:e.path||null,type:t,value:o,viewstateType:i||null,defaultValue:n||null}},N.prototype.getPropertyValue=function(t){return"viewstate"===this.getSourceType(t)?"dict"===t.get("_type")?this.getDictValue(t):t.get("value"):t},N.prototype.getSourceType=function(t){return t?t instanceof k.DocumentViewModel||t.get&&t.get("_viewType")||t.has&&t.has("_default")&&t.has("value")?"viewstate":t instanceof k.DocumentDataModel||t.subscribe&&t.unsubscribe?"data":null:null},N.prototype.getSubscriptionKey=function(t){var e=this.appKey?this.appKey+" ":"";return e+=t||this.widgetId,_.uniqueId(e+":")},N.prototype.getViewState=function(t){return!(!t||!t.attributes)&&t.get("value")},N.prototype.getViewStates=function(t){var e=this;return _.zipObject(t,_.map(t,function(t){t=e.docViewModel.getByPath(t);if(t)return t.get("value")}))},N.prototype.hideErrorMessage=function(){this.trigger("hideErrorMessage")},N.prototype.hideQueryStatus=function(){this.trigger("hideQueryStatus")},N.prototype.isBuildMode=function(){return this.dashboardViewModel.get("buildMode")&&!this.quickView},N.prototype.isSelected=function(){var t=this.dashboardViewModel.get("selectedWidget");return!!t&&t.id===this.widgetId},N.prototype.loadApp=function(t,e,n,i,o,s){t&&e&&(s=s||t,new k.AppView(_.extend({},{el:e,key:t,settings:n,appOptions:i,callback:function(t){_.isFunction(o)&&o(t)},namespace:this.componentId+N.NAMESPACE_SEPARATOR+s},_.pick(this,k.AppView.COMMON_OPTIONS))))},N.prototype.loadSetting=function(t,e){var n,i;return t&&this.quickView&&(i=this.docViewModel.get(".settings"),n=this.componentId,e&&(n+=N.NAMESPACE_SEPARATOR+e),i)&&(e=i.get(n))?e.get(t):null},N.prototype.navigate=function(t){var e,n,i=null,o=null,s=null,a=null,r=null,l="";_.isString(t)?(n=t,s=this.dashboardAppModel.get("documents").get(n)?n:this.getDashboardId(n),r="<none>"):_.isObject(t)&&(i=t.dashboard,a=t.screen,e=t.viewstate,i instanceof m.Model?i=i.get("value"):_.isObject(i)&&i.id&&(i=i.id),a instanceof m.Model?a=a.get("value"):_.isObject(a)&&a.id&&(a=a.id),"<this>"===i&&(i=this.dashboardViewModel.get("selectedDocumentId")),(o=this.dashboardAppModel.get("documents").get(i))?s=i:(s=this.getDashboardId(i),o=this.dashboardAppModel.get("documents").get(s)),o)&&(r=_.isEmpty(o.get("screenDetails"))&&k.Helpers.validateGuid(a)||_.find(o.get("screenDetails"),function(t){return t.value===a})?a:this.getScreenId(s,a)),_.isObject(e)&&!_.isEmpty(e)&&(l="?viewstate="+encodeURIComponent(JSON.stringify(e))),s&&r&&"<none>"!==s&&("_blank"===t.target||"FSBL"in window&&s!==window.finApi.documentId?(n=(n="#"+s)+(r?"/"+r:"")+(l||""),window.open(n)):"<none>"===r?this.dashboardAppModel.get("router").navigate(s+l,{trigger:!0}):this.dashboardAppModel.get("router").navigate(s+"/"+r+l,{trigger:!0}))},N.prototype.page=function(t,e){if(!_.isObject(e)||"data"!==this.getSourceType(t))return!1;e=_.pick(e,"_pagingType","_pagingNum","_pageSize","_pageSort"),t.set(e)},N.prototype.processSettings=function(t,u){var c=this,p=m.DeepModel.keyPathSeparator,d=function(e,n,i,o){var s,a,r,l,t;if(n=n||"",o=o||{},l=_.isUndefined(i)?n:i,e&&e.constructor===Object&&!_.isEmpty(e))_.each(e,function(t,e){d(r=t,a=(n?n+p:"")+e,s=(i?i+p:"")+e,o)});else if(e&&e.constructor===Array&&!_.isEmpty(e))_.keys(e).length<e.length?_.each(_.keys(e),function(t){r=e[t],d(r,a=(n?n+p:"")+t,s=(i?i+p:"")+t,o)}):_.each(e,function(t,e){o[l]||(o[l]=[]),r=t,a=(n?n+p:"")+e,s="",o[l][e]=d(r,a,s,null)});else if("viewstate"===c.getSourceType(e)&&(c.activeViewStateToPropertyPaths[e.path]?-1===c.activeViewStateToPropertyPaths[e.path].indexOf(n)&&c.activeViewStateToPropertyPaths[e.path].push(n):(c.activeViewStateToPropertyPaths[e.path]=[n],c.listenTo(e,"change:value",function(t,e){var n=c.activeViewStateToPropertyPaths[t.path],t=("dict"===t.get("_type")&&(e=_.transform(e,function(t,e,n){t[n]=c.getPropertyValue(e)})),_.zipObject(n,_.times(n.length,_.constant(e))));u&&u(t)})),c.propertyPathsToViewStates[n]=e.path),t=c.getPropertyValue(e),!_.isUndefined(t)){if(!l)return t;o[l]=t}return o},t=d(t);return _.each(c.activeViewStateToPropertyPaths,function(t,e){var t=_.filter(t,function(t){return c.propertyPathsToViewStates[t]===e&&"viewstate"===c.getSourceType(c.settingsModel.get(t))});0<t.length?c.activeViewStateToPropertyPaths[e]=t:(t=c.docViewModel.getByPath(e),c.stopListening(t,"change:value"),delete c.activeViewStateToPropertyPaths[e])}),t},N.prototype.processTemplateViewStates=function(t){return _.mapKeys(t,function(t,e){return"$"+e.replace(/\//g,".")+"$"})},N.prototype.saveSetting=function(t,e,n,i){var o;!this.dashboardViewModel.get("disableAutosave")&&t&&this.quickView&&(o=this.componentId,n&&(o+=N.NAMESPACE_SEPARATOR+n),(n=this.docViewModel.get(".settings"))||(n=new m.Model,this.docViewModel.set(".settings",n)),(n=n.get(o))||(n=new m.Model,this.docViewModel.get(".settings").set(o,n),n.set("version",0)),n.set(t,e),this.autosaveDashboardId=this.getDashboardId(null),i?this.setDocumentViewModelSettings(i):this.saveSettingsNowDebounced())},N.prototype.setDocumentViewModelSettings=function(n){var e=this.docViewModel.get(".settings");new k.DocumentViewModel({id:n},null).fetch({success:function(t){t.set(".settings",e),console.log("Current Settings",e),t.save({},{error:function(){k.Log.Error("Autosave user settings FAILED",n)},success:function(){k.Log.Info("Autosave user settings SUCCEEDED",n)}})}.bind(this),error:function(t,e){this.dashboardAppModel.get("isLite")&&"Record Not Found"===e?new k.DocumentViewModel({id:n},null).save({},{success:function(){this.saveSettingsNow()}.bind(this)}):k.Log.Error("Unable to fetch user settings for Autosave",n)}.bind(this)})},N.prototype.saveSettingsNow=function(){var t=this.getDashboardId(null);this.dashboardViewModel.get("disableAutosave")||this.autosaveDashboardId!==t||this.setDocumentViewModelSettings(t)},N.prototype.setProperty=function(t,e,n){var i;t&&(i=this.settingsModel.get(t),"viewstate"===this.getSourceType(i)?i.setModelValue(e):this.settingsModel.set(t,e,_.extend({},n,{propertyPath:t})))},N.prototype.setViewState=function(t,e){return!(!t||!t.attributes)&&t.set("value",e)},N.prototype.showErrorMessage=function(t){this.trigger("showErrorMessage",t)},N.prototype.showNotification=function(t,e){k.NotificationManager.show(this.widgetId,t,e)},N.prototype.showQueryStatus=function(t){this.trigger("showQueryStatus",t)},N.prototype.updateTable=function(t,e,n,i){"data"===this.getSourceType(t)&&(e.query=t?t.get("_updateQueryString"):"",e.connection=t?t.get("_connection"):"",e.updateType=t?t.get("_updateType"):"",e.updateAnalytic=t?t.get("_updateAnalytic"):"",e.updateParams=t.bindViewStateToKdbParams(t.get("_updateQueryParams")),k.DeltaClientLib.updateTable(e,function(){n(),t.isDirty=!0,t.forceInternalReset=!0,t.execute()},i))},N.ADVANCED_METHODS=["deltaClient"],N.NAMESPACE_SEPARATOR=":",N.API_METHODS=["destroySettings","doActions","onTransferAction","exportData","getProperty","getPropertyMeta","getDataSourceMap","getViewState","getTemplateViewStates","getDashboardName","hideErrorMessage","hideQueryStatus","humanFileSize","isBuildMode","isSelected","loadApp","loadSetting","navigate","page","removeTooltip","saveSetting","setProperty","setTooltip","setViewState","showErrorMessage","showNotification","showQueryStatus","subscribe","subscribeTemplateViewStates","unsubscribe","unsubscribeTemplateViewStates","updateTable"],k.ComponentApi=N,Qo=A=A||{},Wo=m.View,e(Vs,Wo),Vs.prototype.initializeApi=function(){this.componentApi=new Qo.ComponentApi(_.extend({},_.pick(this,Vs.COMMON_OPTIONS),{advancedMethods:!0,appKey:this.key,componentId:this.componentId,deltaClient:this.deltaClient?this.deltaClient.deltaClient:null,deltaClientLib:this.deltaClient,settingsModel:this.settingsModel}))},Vs.prototype.initalizeEvents=function(){this.settingsModel&&this.listenTo(this.settingsModel,"change",this.onSettingsModelChange)},Vs.prototype.initializeOnSettingsChange=function(){var t=!1;this.app&&_.isFunction(this.app.onSettingsChange)&&(this.appOnSettingsChange=_.bind(this.app.onSettingsChange,this.app)),this.appOnSettingsChange&&_.isFunction(this.settingsModel.toFlat)&&(this.appOnSettingsChange(this.componentApi.processSettings(this.settingsModel.toFlat(),this.appOnSettingsChange)),"BasicComponents"!==this.key||_.isFunction(this.app.$view.onSettingsChange))&&(t=!0),this.model&&(t?this.model.set("hasOnSettingsChange",!0,{silent:!0}):this.model.unset("hasOnSettingsChange"))},Vs.prototype.onSettingsModelChange=function(s,t){try{var e,a=s.changedAttributes(null,t&&t.propertyPath?t.propertyPath:null);_.each(a,function(t,e){var n,i;function o(t,e){var n,i=/^(\w+)((?:\.\w+)+)$/.exec(e);return i?(n=_.isArray(t)?Number(i[1]):i[1],_.isObject(t)?o(t[n],i[2].substring(1)):t):_.isObject(t)?t[e]:t}n=o(s.attributes,e),i=o(s.previousAttributes(),e),_.isEqual(i,n)&&delete a[e]}),e=this.componentApi.processSettings(a,this.appOnSettingsChange),this.appOnSettingsChange&&!_.isEmpty(e)&&this.appOnSettingsChange(e)}catch(t){Qo.Log.Error("AppView Settings Error",t,this)}},Vs.prototype.onResize=function(t){this.app&&this.app.onResize&&this.app.onResize(t)},Vs.prototype.onResizeStart=function(t){this.app&&this.app.onResizeStart&&this.app.onResizeStart(t)},Vs.prototype.onResizeStop=function(t){this.app&&this.app.onResizeStop&&this.app.onResizeStop(t)},Vs.prototype.remove=function(){return this.app&&_.isFunction(this.app.remove)&&this.app.remove(),this.componentApi&&(this.componentApi.removeTooltip(),this.componentApi.unsubscribeAll()),m.View.prototype.remove.apply(this)},Vs.prototype.render=function(){return this.$appDiv=this.$el,this},Vs.prototype.requireApp=function(){var e=this;requirejs([e.key],function(t){try{e.initializeApi(),e.app=new t(_.extend({el:e.$appDiv,viewModel:e.docViewModel,dataModel:e.docDataModel,dashboardAppModel:e.dashboardAppModel,dashboardViewModel:e.dashboardViewModel,settingsModel:e.settingsModel,websiteUrl:e.dashboardAppModel.get("websiteUrl"),DeltaClientLib:e.deltaClient,api:e.componentApi.interface,widgetId:e.widgetId},e.appOptions)),e.initalizeEvents(),e.initializeOnSettingsChange(),_.isFunction(e.callback)&&e.callback(e.app)}catch(t){Qo.Log.Error("loading app error, require key: "+e.key,t),_.isFunction(e.callback)&&e.callback(t)}},function(t){Qo.Log.Error("ComponentView:loadApp require error",t),_.isFunction(e.callback)&&e.callback(t)})},Vs.COMMON_OPTIONS=["callback","dashboardAppModel","dashboardViewModel","deltaClient","docDataModel","docViewModel","widgetId","quickView"],Qo.AppView=Vs,jo=A=A||{},Go=m.View,e(Os,Go),Os.prototype.dialogClass=function(){return"dialog-base "+(this.options.userClass||"")},Os.prototype.dialogButtons=function(){var t=this;return[{text:"Cancel",click:function(){return t.dialogClose()},icons:{primary:"fa fa-times"}}]},Os.prototype.dialogClose=function(){function t(){e.$dialog&&e.$dialog.dialog("close")}var e=this;this.isCancel?(this.options.cancelBtnCallback&&this.options.cancelBtnCallback(),t()):this.options.requireSuccess?this.options.callback&&this.options.callback(this.model,t,function(t,e){jo.ErrorDialog.ShowError(e||"Unspecified Error")}):(this.options.callback&&this.options.callback(this.model),t())},Os.prototype.dialogOpen=function(){},Os.prototype.onResize=function(){var t=.95*$(window).height()-(this.$dialogTitlebar.outerHeight(!0)+this.$dialogButtonpane.outerHeight(!0));this.$dialog.css("max-height",t),this.$dialogRoot.position({of:$(window)})},Os.prototype.preRender=function(){},Os.prototype.postRender=function(){},Os.prototype.remove=function(){return this.$dialog&&this.$dialog.dialog("destroy"),this.options=null,this.$dialog=null,this.$dialogTitlebar=null,this.$dialogButtonpane=null,this.$dialogRoot=null,$(window).off("resize",this.resizeListener),m.View.prototype.remove.apply(this)},Os.prototype.openDialog=function(){this.$el.dialog("open")},Os.prototype.render=function(){var t=this,e={};return this.options.container&&(e.appendTo=this.options.container),this.preRender(),this.$el.html((this.options.renderTemplate?this.options:this).renderTemplate()),this.$dialog=this.$el.dialog(_.extend({dialogClass:this.dialogClass(),title:this.options.dialogTitle,resizable:!1,minHeight:this.options.minHeight||300,width:this.options.width||"57em",height:this.options.height||"auto",modal:!0,autoOpen:!0,draggable:this.options.draggable||!1,closeOnEscape:!0,buttons:this.dialogButtons(),position:this.options.position||{my:"center",at:"center",of:$(window)},open:function(){t.$el.parent().find(".titleIcon").remove(),$('<i class="titleIcon fa '+t.options.iconClass+'" />').insertBefore(t.$el.parent().find(".ui-dialog-title")),t.$dialogRoot=$(".ui-dialog.dialog-base"),t.$dialogTitlebar=t.$dialogRoot.find(".ui-dialog-titlebar"),t.$dialogButtonpane=t.$dialogRoot.find(".ui-dialog-buttonpane"),t.dialogOpen(),t.$dialogButtonpane.find(".ui-dialog-buttonpane > div > button:nth-child(1)").focus(),t.options.onOpen&&t.options.onOpen()},close:function(){t.trigger("closing"),t.options.onClose&&t.options.onClose(),t.remove()},resize:$.proxy(this.onResize,this)},e)),this},Os.prototype.renderTemplate=function(){return""},jo.DialogBase=Os,Xo=A=A||{},Zo=Xo.DialogBase,e(Bs,Zo),Bs.prototype.dialogButtons=function(){return[{text:"Save",click:_.bind(this.onClickSave,this),icons:{primary:"fa fa-floppy-o"}},{text:"Don't Save",click:_.bind(this.onClickDontSave,this),icons:{primary:"fa fa-ban"}},{text:"Cancel",click:_.bind(this.onClickCancel,this),icons:{primary:"fa fa-times"}}]},Bs.prototype.doSave=function(){var t=$.Deferred();return this.model.saveNow(t.reject,t.resolve),t.promise()},Bs.prototype.onKeyDown=function(t){switch(t.stopPropagation(),t.keyCode){case $.ui.keyCode.ESCAPE:this.onClickCancel();break;case 78:this.onClickDontSave();break;case 83:case 89:this.onClickSave()}},Bs.prototype.onClickCancel=function(){this.isCancel=!0,this.closeArgs="cancel",this.dialogClose()},Bs.prototype.onClickDontSave=function(){this.options&&this.options.noSaveCb&&this.options.noSaveCb(),this.dialogClose()},Bs.prototype.onClickSave=function(){this.options&&this.options.saveCb?(this.options.saveCb(),this.dialogClose()):(this.$firstBtn.button("disable"),this.$firstBtn.next().button("disable"),this.$firstBtn.next().next().button("disable"),this.doSave().done(_.bind(this.onSaveDone,this)).fail(_.bind(this.onSaveFail,this)))},Bs.prototype.onSaveDone=function(){var n,i=this,o=[];_.isEmpty(this.options.components)?this.dialogClose():(n=_.after(this.options.components.length,function(){_.isEmpty(o)?i.dialogClose():(i.$errorInfo.show(),i.$errorList.empty(),_.each(o,function(t){var e=$("<li></li>"),n=$("<span></span>");n.attr("title",t.widget),n.text(t.component),e.text(": "+t.message),e.prepend(n),i.$errorList.append(e)}),i.$firstBtn.button("enable"),i.$firstBtn.next().button("enable"),i.$firstBtn.next().next().button("enable"))}),_.each(this.options.components,function(e){_.isFunction(e.callback)&&e.callback(function(t){t&&o.push(_.extend({message:t},_.pick(e,["component","widget"]))),n()})}))},Bs.prototype.onSaveFail=function(){this.$errorInfo.show(),this.$firstBtn.button("enable"),this.$firstBtn.next().button("enable"),this.$firstBtn.next().next().button("enable")},Bs.prototype.getPromptMessage=function(){return this.options.message||"There are unsaved changes in this dashboard."},Bs.prototype.postRender=function(){$(window).on("keydown.AreYouSureDialog",_.bind(this.onKeyDown,this)),this.$errorInfo=this.$(".error-info"),this.$errorList=this.$(".error-list"),this.$firstBtn=this.$dialog.next().find("button").first(),this.$errorInfo.hide()},Bs.prototype.renderTemplate=function(){return Xo.T.AreYouSureDialog({dashChanged:this.options.dashChanged,components:this.options.components,message:this.getPromptMessage()})},Bs.prototype.remove=function(){return $(window).off(".AreYouSureDialog"),this.trigger("close",this.closeArgs),Xo.DialogBase.prototype.remove.apply(this)},Xo.AreYouSureDialog=Bs,Jo=A=A||{},ts=m.View,e(Rs,ts),Rs.prototype.close=function(){this.$dialog.dialog("close")},Rs.prototype.onSubmit=function(e){var n,i,o,s,a=this;e&&e.stopPropagation(),this.clicked||(e=this.form.commit(),_.isEmpty(e)&&(this.clicked=!0,this.$messageBox.hide(),s=function(){o.removeClass("fa-spinner fa-pulse"),o.css({width:"",height:""}),o.addClass("fa-check"),n.find(".ui-button-text").text(t("OK")),i.button("enable"),a.clicked=!1,Jo.DeltaClientLib.changingPassword=!1},n=this.$okBtn,(o=n.find(".ui-button-icon-primary.fa-check")).removeClass("fa-check"),o.css({width:"auto",height:"auto"}),o.addClass("fa-spinner fa-pulse"),n.find(".ui-button-text").text(t("wait...")),(i=n.next()).button("disable"),Jo.DeltaClientLib.changeUserPassword(a.model.get("oldpassword"),a.model.get("password1"),function(){Jo.Log.Info("Password changed successfully"),a.showMessage("Password changed successfully","success"),_.isFunction(a.onChangeSuccess)&&a.onChangeSuccess(),_.delay(function(){a.close()},1e3)},function(t){Jo.Log.Error("Password change failed"),a.showMessage(t),s()})))},Rs.prototype.onRemove=function(){$(this.form.el).find("input").off(),window.removeEventListener("keydown",this.boundToggleCaps,!0),this.remove()},Rs.prototype.showMessage=function(t,e){t?(this.$messageBox.html(t),this.$messageBox.removeClass(this.MESSAGE_TYPES.join(" ")).addClass(e||"error"),this.$messageBox.show()):(this.$messageBox.html(),this.$messageBox.removeClass(this.MESSAGE_TYPES.join(" ")),this.$messageBox.hide())},Rs.prototype.toggleCapsLockMsg=function(e){20===e.which&&(e.getModifierState("CapsLock")?this.showMessage('<i class="fa fa-warning"></i>'+t("Caps Lock is on"),"warning"):this.showMessage())},Jo.ChangePasswordDialog=Rs,Ve=A=A||{},es=Ve.DialogBase,e($s,es),$s.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:function(){t.dialogClose()},icons:{primary:"fa fa-check"}},{text:"Cancel",click:function(){t.isCancel=!0,t.dialogClose()},icons:{primary:"fa fa-times"}}]},$s.prototype.renderTemplate=function(){return t("Are you sure you want to delete this item?")},$s.ShowDelete=function(t,e){new $s(_.extend({iconClass:"fa-trash-o",dialogTitle:"Confirm Delete",callback:t},e?{renderTemplate:function(){return e}}:{}))},$s.ShowConfirm=function(e){var n=e.txt||"",i=e.container?{container:e.container}:{};new $s(_.extend({iconClass:e.iconClass||"fa-question-circle",dialogTitle:e.dialogTitle||"Confirmation",callback:e.callback,cancelBtnCallback:e.cancelBtnCallback||_.noop,renderTemplate:e.renderTemplate||function(){return n+t("<br></br>Are you sure you want to reload the Application?")}},i))},Ve.ConfirmDialog=$s,Ne=A=A||{},ns=Ne.DialogBase,e(Us,ns),Us.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:function(){t.dialogClose()},icons:{primary:"fa fa-check"}}]},Us.prototype.renderTemplate=function(){return t("Are you sure you want to delete this item?")},Us.ShowError=function(t,e){new Us(_.extend({callback:_.isFunction(e)?e:_.noop},t?{renderTemplate:function(){return t}}:{}))},Ne.ErrorDialog=Us,is=A=A||{},os=is.ErrorDialog,e(Fs,os),Fs.ShowWarning=function(e,n){new is.ErrorDialog(_.extend({dialogTitle:"Warning",callback:_.isFunction(n)?n:_.noop},e?{renderTemplate:function(){return t(e)}}:{}))},is.WarningDialog=Fs,ss=A=A||{},as=ss.AppView,e(L,as),L.getInstances=function(){return L._instances},L.prototype.initalizeEvents=function(){var n=this,t=this.getContainerDocument();ss.AppView.prototype.initalizeEvents.apply(this,arguments),this.listenTo(this.model,"beforeRemove",this.beforeRemove),this.listenTo(this.dashboardViewModel,"change:buildMode",this.onBuildModeChanged),this.listenTo(this.componentApi,"hideErrorMessage",this.hideErrorMessage),this.listenTo(this.componentApi,"hideQueryStatus",this.hideQueryStatus),this.listenTo(this.componentApi,"showErrorMessage",this.showErrorMessage),this.listenTo(this.componentApi,"showQueryStatus",this.showQueryStatus),this.listenTo(t,"change:borderBackground",function(t,e){return n.setOptionsValue("format",{tileBackgroundColor:"#"+e})}),this.listenTo(t,"change:transparentBackground",function(t,e){return n.setOptionsValue("format",{tileTransparentBackground:e})}),this.listenTo(t,"change:borderColor",function(t,e){return n.setOptionsValue("format",{tileBorderColor:"#"+e})}),this.listenTo(t,"change:borderRounding",function(t,e){return n.setOptionsValue("format",{tileBorderRounding:e})}),this.listenTo(t,"change:borderSpacing",function(t,e){return n.setOptionsValue("Alignment",{innerPaddingLeft:e,innerPaddingRight:e,innerPaddingTop:e,innerPaddingBottom:e,titlePaddingLeft:e,titlePaddingRight:e,titlePaddingTop:e})}),this.listenTo(t,"change:borderWidth",function(t,e){return n.setOptionsValue("format",{tileBorderWidth:e})}),this.listenTo(t,"change:widgetsSpacing",function(t,e){return n.setOptionsValue("Alignment",{paddingLeft:e,paddingRight:e,paddingTop:e,paddingBottom:e})}),this.listenTo(t,"change:borderShadow",function(t,e){return n.setOptionsValue("format",{tileShadow:e})}),this.listenTo(t,"change:showLoadingIndicators",this.onShowLoadingIndicatorsChanged),this.debouncedOnFormatChanged=_.debounce(this.onFormatChanged,240),this.listenTo(this.model.get("options"),"change:format",this.debouncedOnFormatChanged),this.debouncedOnAlignmentChanged=_.debounce(this.onAlignmentChanged,240),this.listenTo(this.model.get("options"),"change:Alignment",this.debouncedOnAlignmentChanged)},L.prototype.applyCustomCss=function(t){t?(this.$customCss&&this.$customCss.length?this.$customCss.html(t):this.$customCss=$("<style></style>",{"data-widgetid":this.widgetId,html:t,type:"text/css"}).appendTo(document.head),this.customCss=t):this.$customCss&&(this.$customCss.remove(),this.$customCss=null,this.customCss=null)},L.prototype.applyCssClasses=function(t){this.$appDiv.removeClass(this.cssClasses),t?(_.isString(t)?this.cssClasses=t:this.cssClasses=_.reduce(t,function(t,e){return t+" "+e}),this.$appDiv.addClass(this.cssClasses)):this.cssClasses=null},L.prototype.applyDashboardStyleSettings=function(){var t=this.dashboardViewModel.get("selectedDocumentId"),t=this.dashboardAppModel.get("documents").get(t),e=this.model.get("options").get("format"),n=this.model.get("options").get("Alignment");null===e.tileBackgroundColor&&(e.tileBackgroundColor="#"+t.get("borderBackground")),null===e.tileBorderColor&&(e.tileBorderColor="#"+t.get("borderColor")),null===e.tileBorderRounding&&(e.tileBorderRounding=t.get("borderRounding")),null===e.tileBorderWidth&&(e.tileBorderWidth=t.get("borderWidth")),null===e.tileTransparentBackground&&(e.tileTransparentBackground=t.get("transparentBackground")),null===e.tileShadow&&(e.tileShadow=t.get("borderShadow")),this.model.get("options").set("format",e),null===n.innerPaddingLeft&&(n.innerPaddingLeft=t.get("borderSpacing")),null===n.innerPaddingRight&&(n.innerPaddingRight=t.get("borderSpacing")),null===n.innerPaddingTop&&(n.innerPaddingTop=t.get("borderSpacing")),null===n.innerPaddingBottom&&(n.innerPaddingBottom=t.get("borderSpacing")),null===n.titlePaddingLeft&&(n.titlePaddingLeft=t.get("borderSpacing")),null===n.titlePaddingRight&&(n.titlePaddingRight=t.get("borderSpacing")),null===n.titlePaddingTop&&(n.titlePaddingTop=t.get("borderSpacing")),null===n.titlePaddingBottom&&(n.titlePaddingBottom=0),null===n.paddingLeft&&(n.paddingLeft=t.get("widgetsSpacing")),null===n.paddingRight&&(n.paddingRight=t.get("widgetsSpacing")),null===n.paddingTop&&(n.paddingTop=t.get("widgetsSpacing")),null===n.paddingBottom&&(n.paddingBottom=t.get("widgetsSpacing")),this.model.get("options").set("Alignment",n)},L.prototype.beforeRemove=function(){var i,t,e,o=this;if(this.app&&_.isFunction(this.app.beforeRemove)&&((e=this.app.beforeRemove())&&(_.isFunction(e)?i=e:_.isFunction(e.callback)&&(i=e.callback,t=e.message)),i))return{callback:function(t){var e=_.once(t),n=_.delay(function(){e("Timed out")},o.COMPONENT_SAVE_TIMEOUT);try{i(function(t){clearTimeout(n),e(t)})}catch(t){ss.Log.Error("Save error",t),clearTimeout(n),e("Save error")}},component:o.model.get("key"),message:t,widget:o.model.id}},L.prototype.getComponentName=function(){var t=this.dashboardAppModel.get("components").get(this.model.get("definitionId"))||this.dashboardAppModel.get("components").find({appKey:this.model.get("key")});return t?t.get("componentName"):""},L.prototype.getContainerDocument=function(){var t=this.dashboardViewModel.get("selectedDocumentId");return this.dashboardAppModel.get("documents").get(t)},L.prototype.hideErrorMessage=function(){this.$errorMessage.hide()},L.prototype.hideQueryStatus=function(){var t=this;clearTimeout(this.queryStatusTimer),clearInterval(this.loadingTimer),this.queryStatusRemoveTimer=_.delay(function(){t.$queryStatus.hide()},200)},L.prototype.onAlignmentChanged=function(t){var e={"margin-left":this.getAlignmentValue("paddingLeft"),"margin-right":this.getAlignmentValue("paddingRight"),"margin-top":this.getAlignmentValue("paddingTop"),"margin-bottom":this.getAlignmentValue("paddingBottom")},e=(this.$borderDiv.css(e),e={"margin-left":this.getAlignmentValue("titlePaddingLeft"),"margin-right":this.getAlignmentValue("titlePaddingRight"),"padding-top":this.getAlignmentValue("titlePaddingTop"),"padding-bottom":this.getAlignmentValue("titlePaddingBottom")},this.$titleDiv.css(e),this.getTitleDivHeight(this.$titleDiv,this.getFormatValue("titleFontSize"),this.getAlignmentValue("titlePaddingTop"),this.getAlignmentValue("titlePaddingBottom"))),e=this.getFormatValue("widgetTitle")?e+this.getAlignmentValue("innerPaddingTop"):this.getAlignmentValue("innerPaddingTop"),e={left:this.getAlignmentValue("innerPaddingLeft"),right:this.getAlignmentValue("innerPaddingRight"),top:e,bottom:this.getAlignmentValue("innerPaddingBottom")};this.$appDiv.css(e),t||this.onResize()},L.prototype.onBuildModeChanged=function(t,e,n){this.dashboardViewModel.get("buildMode")?this.$el.removeClass("build-off"):this.$el.addClass("build-off")},L.prototype.getTitleDivHeight=function(t,e,n,i){return 1<t.outerHeight(!0)&&t.is(":visible")?t.outerHeight(!0):1.2*(n+i+e)},L.prototype.getFormatValue=function(t){var e=this.model.get("options").get("format");return this.componentApi.getPropertyValue(e[t])},L.prototype.getAlignmentValue=function(t){var e=this.model.get("options").get("Alignment");return Number(this.componentApi.getPropertyValue(e[t]))},L.prototype.onFormatChanged=function(t){var e,n={"border-width":this.getFormatValue("tileBorderWidth"),"border-radius":this.getFormatValue("tileBorderRounding"),"border-color":this.getFormatValue("tileBorderColor"),"background-color":this.getFormatValue("tileTransparentBackground")?"transparent":this.getFormatValue("tileBackgroundColor"),"box-shadow":this.getFormatValue("tileShadow")?"rgba(0, 0, 0, 0.78) 2px 2px 5px":"none"},n=(this.$borderDiv.css(n),{"font-size":this.getFormatValue("titleFontSize"),"font-weight":this.getFormatValue("titleFontBold")?"bold":"normal","text-align":this.getFormatValue("titleHorizontal"),color:this.getFormatValue("titleColor"),"background-color":this.getFormatValue("titleTransparentBackground")?"transparent":this.getFormatValue("titleBackgroundColor"),"border-bottom-width":this.getFormatValue("titleBottomBorderWidth"),"text-shadow":this.getFormatValue("titleShadow")?"rgba(0, 0, 0, 0.5) 2px 2px 3px":"none"}),i=0;0<this.getFormatValue("tileBorderRounding")&&(i=.85*this.getFormatValue("tileBorderRounding")-this.getFormatValue("tileBorderWidth")/4),this.$titleDiv.css("border-top-left-radius",i),this.$titleDiv.css("border-top-right-radius",i),i=this.model.get("options").get("Alignment"),(e=this.getFormatValue("widgetTitle"))?(this.$titleDiv.css(n),this.$titleDiv.text(e),this.$titleDiv.show(),n=this.getTitleDivHeight(this.$titleDiv,this.getFormatValue("titleFontSize"),this.getAlignmentValue("titlePaddingTop"),this.getAlignmentValue("titlePaddingBottom")),this.$appDiv.css("top",i.innerPaddingTop+n)):(this.$titleDiv.hide(),this.$appDiv.css("top",i.innerPaddingTop)),t||this.onResize()},L.prototype.onShowLoadingIndicatorsChanged=function(t,e){this.showLoadingIndicators=e},L.prototype.onShowNoResultsIndicatorsChanged=function(t,e){this.showNoResultsIndicators=e},L.prototype.onStyleChanged=function(){function t(t){return e.componentApi.getPropertyValue(n[t])}var e=this,n=this.model.get("options").get("Style"),i=t("advanced"),i=(i!==this.customCss&&this.applyCustomCss(i),t("cssClasses"));i!==this.cssClasses&&this.applyCssClasses(i)},L.prototype.postComponentLoad=function(n,i){var t,o=this;this.appOnSettingsChange=function(t){var e=Object.keys(t);o.quickStart(n.appArgs.quickStart),_.find(e,function(t){return 0===t.indexOf("Style")})&&o.onStyleChanged(),_.find(e,function(t){return 0===t.indexOf("format")})&&o.onFormatChanged(),_.find(e,function(t){return 0===t.indexOf("Alignment")})&&o.onAlignmentChanged(),i?i.settings=t:o.app&&_.isFunction(o.app.onSettingsChange)&&o.app.onSettingsChange(t)},this.appOnSettingsChange&&this.model.get("options").toFlat&&(t=this.componentApi.processSettings(this.model.get("options").toFlat(),this.appOnSettingsChange),i?(i.settings=t,this.quickStart(n.appArgs.quickStart)):(this.app&&_.isFunction(this.app.onSettingsChange)&&(this.app.onSettingsChange(t),this.quickStart(n.appArgs.quickStart)),_.isFunction(this.app.onSettingsChange)&&("BasicComponents"!==this.model.get("key")||_.isFunction(this.app.$view.onSettingsChange))?this.model.set("hasOnSettingsChange",!0,{silent:!0}):this.model.unset("hasOnSettingsChange",{silent:!0}))),this.model.trigger("componentLoaded")},L.prototype.processComponentDefinition=function(t,e){var n=this;t&&t.set(_.omit(e,"id","componentName","componentDescription","appKey","buildModeOnly","listViewThumb")),e.buildModeOnly&&this.$el.addClass("build-mode-only"),this.dashboardViewModel.get("buildMode")||this.$el.addClass("build-off"),this.updateComponentDefinition(e,this.model),$.isEmptyObject(this.model.get("options").attributes)&&e?this.model.get("options").set(e.appArgs.json):(this.model.get("options").set("Alignment",_.extend({},e.appArgs.json.Alignment,this.model.get("options").get("Alignment")),{silent:!0}),this.model.get("options").set("Style",_.extend({},e.appArgs.json.Style,this.model.get("options").get("Style")),{silent:!0}),delete(t=_.extend({},e.appArgs.json.format,this.model.get("options").get("format"))).titlePaddingLeft,delete t.titlePaddingRight,delete t.titlePaddingTop,delete t.titlePaddingBottom,this.model.get("options").set({format:null},{silent:!0}),this.model.get("options").set({format:t},{silent:!0})),this.componentApi.convertPathsToModels("data",e.appArgs.schema,this.model.get("options")),this.componentApi.convertPathsToModels("viewstate",e.appArgs.schema,this.model.get("options")),ss.Component.convertDashboardTypesToModels(this.model.get("options"),function(t){return n.docDataModel.getByPath(t)},function(t){return n.docViewModel.getByPath(t)}),this.applyDashboardStyleSettings(),this.model.unset("upgrading",{silent:!0}),this.onStyleChanged(),this.onFormatChanged(),this.onAlignmentChanged()},L.prototype.quickStart=function(e){var i=this;_.each(e,function(e){var n;if(!i.settingsModel.get(e.path)&&!i.quickView)return n=e.message||"populate widget",i.showErrorMessage({error:t("Click to ")+" <b> "+n+"</b>",type:"QuickStart",onClick:function(){i.dashboardViewModel.get("selectedWidgetId")!==i.widgetId&&i.$el.trigger("click"),i.model.get("options").trigger("quickStart",e.path)}}),!1;i.hideErrorMessage()})},L.prototype.remove=function(){this.$customCss&&this.$customCss.remove(),L._instances=_.without(L._instances,this),ss.AppView.prototype.remove.apply(this,arguments)},L.prototype.render=function(){var t=this.getContainerDocument().get("showLoadingIndicators");return this.$el.html(ss.T.ComponentView(this.model.toJSON())),this.$errorMessage=this.$el.find(".errorMessage"),this.$queryStatus=this.$el.find(".queryStatus"),this.$titleDiv=this.$el.find(".title-div"),this.$borderDiv=this.$el.find(".border-div"),this.$appDiv=this.$el.find(".app-div"),this.widgetId&&(this.$customCss=$("head style[data-widgetid='"+this.widgetId+"']")),this.$progressBarDiv=this.$el.find(".progress-bar-div"),this.onShowLoadingIndicatorsChanged(null,t),this.model.set("upgrading",!0,{silent:!0}),this},L.prototype.requireApp=function(){var e,n=this,i=this,t=i.model.get("key"),o=i.dashboardAppModel.get("components").get(i.model.get("definitionId")),s=(o=o||i.dashboardAppModel.get("components").find({appKey:i.model.get("key")})).get("customElement");s&&customElements.get(s)?(e=document.createElement(s),i.$appDiv.append(e),e.addEventListener("componentDefinition",function(t){t=t.detail;e.componentApi=n.componentApi.interface,n.processComponentDefinition(o,t),n.initalizeEvents(),e.theme=n.dashboardViewModel.get("DashboardTheme"),n.listenTo(i.dashboardViewModel,"change:DashboardTheme",function(){e.theme=n.dashboardViewModel.get("DashboardTheme")}),n.listenTo(i.dashboardViewModel,"change:buildMode",function(){return e.resize=""}),n.postComponentLoad(t,e)}),_.delay(function(){e.options={api:i.componentApi.interface,componentId:parseInt(i.model.get("definitionId"),10),componentModel:i.model,dashboardAppModel:i.dashboardAppModel,dashboardViewModel:i.dashboardViewModel,dataModel:i.docDataModel,settingsModel:i.model.get("options"),viewModel:i.docViewModel,websiteUrl:i.dashboardAppModel.get("websiteUrl")},n.$progressBarDiv.fadeOut(0,function(){$(this).remove()})},1e3)):requirejs([t],function(t){try{i.$progressBarDiv.fadeOut(0,function(){$(this).remove()}),t.mergeWithDefault&&i.model.set("options",t.mergeWithDefault(i.model.get("options")),{silent:!0}),t.getDefaultJSONTemplates&&(i.model.get("options")._templates=t.getDefaultJSONTemplates(),i.model.get("options")._templates.Defaults=_.extend({},i.model.get("options")._templates.Defaults));var e=_.isFunction(t.getComponentDefinition)?t.getComponentDefinition({api:i.componentApi.interface,componentId:parseInt(i.model.get("definitionId"),10),componentModel:i.model,dashboardAppModel:i.dashboardAppModel,dashboardViewModel:i.dashboardViewModel,dataModel:i.docDataModel,settingsModel:i.model.get("options"),viewModel:i.docViewModel,websiteUrl:i.dashboardAppModel.get("websiteUrl")}):_.cloneDeep({appArgs:{json:{},schema:{properties:{},type:"object"}}}),n=i.dashboardAppModel.get("transformComponentDefinition");_.isFunction(n)&&n(e),i.processComponentDefinition(o,e),i.app=new t({el:i.$appDiv[0],viewModel:i.docViewModel,dataModel:i.docDataModel,dashboardAppModel:i.dashboardAppModel,dashboardViewModel:i.dashboardViewModel,settingsModel:i.model.get("options"),websiteUrl:i.dashboardAppModel.get("websiteUrl"),componentModel:i.model,DeltaClientLib:i.deltaClient,api:i.componentApi.interface,widgetId:i.widgetId,quickView:i.quickView}),i.initalizeEvents(),i.postComponentLoad(e),_.isFunction(i.callback)&&i.callback(i.app)}catch(t){ss.Log.Error("loading app error, require key: "+i.model.get("key"),t),_.isFunction(i.callback)&&i.callback(t)}},function(t){ss.Log.Error("ComponentView:loadApp require error",t),_.isFunction(i.callback)&&i.callback(t)})},L.prototype.showErrorMessage=function(n){var e=this,i=n.type||"Error",o=n.error,s=this.$errorMessage.find(".errorText");0===o.indexOf("0.0")&&(o=o.substring(4)),this.$errorMessage.removeClass("Error Warning Info QuickStart").addClass(i),this.$errorMessage.find(".errorTitle span").text(t(i)),s.html(o),this.$errorMessage.show(),this.fadeTimer&&clearTimeout(this.fadeTimer),this.$errorMessage.off("click"),n.onClick&&this.$errorMessage.click(function(t){var e=$(t.target);(e.hasClass("errorPanel")||e.parents(".errorPanel").length)&&(t.stopPropagation(),n.onClick(t))}),"Info"===i&&(this.fadeTimer=_.delay(function(){return e.$errorMessage.fadeOut("slow")},3e3))},L.prototype.showQueryStatus=function(e){var n,i=this,o=e.message||e.error||"",e=e.type||"Error";if(i.customErrorClass&&(i.$queryStatus.removeClass(i.customErrorClass),i.customErrorClass=""),clearInterval(i.loadingTimer),"Loading"===e){var s,a=p();if(!i.showLoadingIndicators)return;o="0s",i.loadingTimer=setInterval(function(){s=p.duration(p().diff(a)),o=s.format("m[m] s[s]"),i.$queryStatus.find(".statusText").html(o)},1e3)}n="NoResults"===e?"No Results":e,0===o.indexOf("0.0")&&(o=o.substring(4)),i.$queryStatus.css("margin",i.$borderDiv.css("border-width")),i.$queryStatus.css("border-radius",i.$borderDiv.css("border-radius")),i.$queryStatus.removeClass("Error Warning Info Loading NoResults").addClass(e),i.$queryStatus.find(".statusTitle span").text(t(n)+(o&&"Loading"!==e?": ":"")),"Error"===e&&(n=/(.*)cssClass:"(.*)":(.*)/m.exec(o))&&(i.customErrorClass=n[2],i.$queryStatus.addClass(i.customErrorClass),o=n[3]),i.$queryStatus.find(".statusText").html(o),clearTimeout(i.queryStatusTimer),clearTimeout(i.queryStatusRemoveTimer),i.queryStatusTimer=_.delay(function(){i.$queryStatus.show()},i.QUERY_STATUS_DELAY),i.fadeTimer&&clearTimeout(i.fadeTimer),"Info"===e&&(i.fadeTimer=_.delay(function(){i.$queryStatus.fadeOut("slow")},i.QUERY_STATUS_FADE))},L.prototype.updateComponentDefinition=function(t,e){var n=_t(),i=t.appArgs.schema.properties.Alignment,o=t.appArgs.schema.properties.format,s=t.appArgs.schema.properties.Style,a=t.appArgs.json.Style;s?_.each(n.appArgs.schema.properties.Style.properties,function(t,e){s.properties[e]=t}):t.appArgs.schema.properties.Style=n.appArgs.schema.properties.Style,t.appArgs.json.Style=a?_.extend({},n.appArgs.json.Style,a):_.clone(n.appArgs.json.Style),i?_.each(n.appArgs.schema.properties.Alignment.properties,function(t,e){i.properties[e]=t}):t.appArgs.schema.properties.Alignment=n.appArgs.schema.properties.Alignment,a=t.appArgs.json.Alignment,t.appArgs.json.Alignment=a?_.extend({},n.appArgs.json.Alignment,a):_.clone(n.appArgs.json.Alignment),o?(_.each(n.appArgs.schema.properties.format.properties,function(t,e){o.properties[e]=t}),delete o.properties.titlePaddingLeft,delete o.properties.titlePaddingRight,delete o.properties.titlePaddingTop,delete o.properties.titlePaddingBottom):t.appArgs.schema.properties.format=n.appArgs.schema.properties.format,(a=t.appArgs.json.format)?(t.appArgs.json.format=_.extend({},n.appArgs.json.format,a),delete t.appArgs.json.format.titlePaddingLeft,delete t.appArgs.json.format.titlePaddingRight,delete t.appArgs.json.format.titlePaddingTop,delete t.appArgs.json.format.titlePaddingBottom):t.appArgs.json.format=_.clone(n.appArgs.json.format)},L.prototype.setOptionsValue=function(t,e){var n=this.model.get("options").get(t);this.model.get("options").set(t,_.extend({},n,e))},L._instances=[],ss.ComponentView=L,rs=A=A||{},ls=m.View,e(V,ls),V.prototype.initialize=function(t){this.$el.addClass("component-drop"),this.dashboardAppModel=t.dashboardAppModel,this.dashboardViewModel=t.dashboardViewModel,this.DeltaClientLib=t.DeltaClientLib,this.quickView=t.quickView,this.websiteUrl=t.websiteUrl,this.widgetsCollection=this.widgetsCollection||t.widgets,this.widgets=this.widgets||[],this.ignoreWidgetSelect=!1,this.widgetClass="component-drop-widget",this.initializeEvents(),this.initializeEvents_widgetCollection(),this.quickView?this.switchOffBuildMode():this.switchBuildMode(this.dashboardViewModel.get("buildMode")),this.applyCurrentWidgets()},V.prototype.initializeEvents=function(){this.listenTo(this.dashboardViewModel,"change:buildMode",this.onBuildModeChanged),this.listenTo(this.dashboardViewModel,"change:selectedWidget",this.onSelectedWidgetChanged),this.listenTo(this.dashboardAppModel,"change:pendingSelectionWidgetId",this.onSelectingWidget)},V.prototype.initializeEvents_widgetCollection=function(){this.listenTo(this.widgetsCollection,"add",this.onWidgetCollectionAdd),this.listenTo(this.widgetsCollection,"remove",this.onWidgetCollectionRemove)},V.prototype.events=function(){return{dragenter:"onDragEnter",dragleave:"onDragLeave",dragover:"onDragOver",drop:"onDrop"}},V.prototype.addComponentToWidget=function(t,e,n){var i=this.dashboardAppModel.get("components").get(e),i=this.getAppKey(i),o=t.get("component"),s=this.findWidgetItem(t.id),e=this.createNewComponent(e,i,t);o?"Tabs"===(i=o.get("key"))?((o=o.getInnermostComponents(i)).add(e),e.setParent(o)):(s&&s.view&&(s.view.remove(),s.view=null),n?t.commandSet({component:e}):t.set("component",e)):n?t.commandSet({component:e}):t.set("component",e)},V.prototype.addWidget=function(e,t,n){var i=this,o=this,s=e.id,a=this.renderWidget(e),r=$(document.createElement("div")),l=(r.addClass("fa fa-times remove-btn"),r.appendTo(a),r.click(function(t){t.preventDefault(),t.stopPropagation(),e.trigger("removeWidget")}),a.addClass(this.getWidgetClass(n)),a.attr("data-widgetid",s),this.dashboardViewModel.get("buildMode")||a.addClass("build-off"),this.addWidgetEvents(a),{$remove:r,$widget:a,widgetId:s,model:e,view:null});return this.widgets.push(l),e.get("component")&&this.renderComponent(l,t?function(){}:function(){return i.selectWidget(l)}),o.stopListening(e,"change:component"),o.listenTo(e,"change:component",_.bind(function(){l.view&&(l.view.remove(),l.view=null),l.$widget.find(".grid-stack-item-content").remove(),o.renderComponent(l,function(){return o.selectWidget(l)})},o,l)),o.stopListening(e,"removeWidget"),o.listenTo(e,"removeWidget",o.onRemoveWidget.bind(o,e)),l},V.prototype.addNewWidget=function(t,e,n){return t=t||new rs.Widget({},{},this.widgetsCollection),e&&!n&&this.addComponentToWidget(t,e,!1),this.widgetsCollection.commandAdd(t,n?"Paste":null),_.findLast(this.widgets,{widgetId:t.id})},V.prototype.addWidgetEvents=function(t){var e,n=this;if(!(t instanceof $))throw"Wrong parameter.";_.each(t,function(t){(e=$(t)).off("click"),e.on("click",$.proxy(n.onWidgetClick,n))})},V.prototype.applyCurrentWidgets=function(){var e=this;_.each(this.widgetsCollection.models,function(t){e.addWidget(t,!0,null)})},V.prototype.clearWidgets=function(t){this.deselectCurrentWidget(),0<this.widgets.length&&(_.each(this.widgets,function(t){t.view&&_.isFunction(t.view.remove)&&t.view.remove()}),this.widgets=[]),t&&t()},V.prototype.createComponentView=function(t,e){var n=t.model.get("component"),i=this.getSelectedDocument(),n=(this.listenToOnce(n,"componentLoaded",function(){t.model.trigger("componentLoaded")}),new rs.ComponentView({model:n,callback:e,dashboardAppModel:this.dashboardAppModel,dashboardViewModel:this.dashboardViewModel,deltaClient:this.dashboardAppModel.get("isLite")?rs.DashClient:rs.DeltaClientLib,docViewModel:i.get("viewState"),docDataModel:i.get("data"),quickView:this.quickView,websiteUrl:this.websiteUrl,widgetId:t.widgetId}));return(t.view=n).model&&(t.$widget.attr("data-componentid",n.model.get("key")),t.$remove.attr("title",n.getComponentName())),n},V.prototype.createNewComponent=function(t,e,n){n=new rs.Component({},{},n);return n.set({definitionId:t,key:e}),n},V.prototype.deselectCurrentWidget=function(){this.dashboardViewModel.set("selectedWidget",null),this.dashboardViewModel.set("selectedWidgetView",null,{silent:!0})},V.prototype.disableWidgetSelect=function(t){t&&t.stopPropagation&&t.stopPropagation(),this.ignoreWidgetSelect=!0},V.prototype.enableWidgetSelect=function(){this.ignoreWidgetSelect=!1},V.prototype.findWidgetItem=function(e){return e?_.find(this.widgets,function(t){return t.widgetId===e}):null},V.prototype.getAppKey=function(t){var e=t.get("appKey");return e=t.get("user")&&!e.match(/^(?:[a-z]+:)?\/\/|^\//)?e.replace(/\.js$/,""):e},V.prototype.getSafeDragNDropHandler=function(e){return function(t){return!(!this.isDragValid()&&!this.isDraggingSupportedFile(t))&&e.apply(this,arguments)}.bind(this)},V.prototype.getSelectedDocument=function(){return this.dashboardAppModel.get("documents").get(this.dashboardViewModel.get("selectedDocumentId"))},V.prototype.getWidgetClass=function(t){return this.widgetClass},V.prototype.isDragValid=function(){return this.dashboardAppModel.has("draggedComponentId")&&!this.quickView},V.prototype.isDraggingSupportedFile=function(t){return!!t.originalEvent.dataTransfer&&_.includes(t.originalEvent.dataTransfer.types,"Files")&&!this.quickView&&(void 0===t.originalEvent.dataTransfer.items||_.some(t.originalEvent.dataTransfer.items,function(t){return _.includes(["application/json","text/xml"],t.type)}))},V.prototype.onBuildModeChanged=function(t,e,n){this.switchBuildMode(this.dashboardViewModel.get("buildMode"),n.userInitiated)},V.prototype.onDragEnter=function(t){return this.isDragValid()&&this.userCan("addNew")&&this.$el.addClass("drop-target"),!1},V.prototype.onDragLeave=function(t){this.isDragValid()&&this.$el.removeClass("drop-target")},V.prototype.onDragOver=function(t){return this.isDragValid()&&!this.$el.hasClass("drop-target")&&this.$el.addClass("drop-target"),!1},V.prototype.onDrop=function(t){var e,n,i;if(this.isDragValid()){if(this.$el.removeClass("drop-target"),!(n=t.originalEvent.dataTransfer?t.originalEvent.dataTransfer.getData("text"):n))return!1;if(e=this.dashboardAppModel.get("components").get(n),t=$(t.currentTarget).find(".component-drop-widget").first().attr("data-widgetid"),!e)return!1;t&&(i=this.findWidgetItem(t),this.deselectCurrentWidget()),i?this.addComponentToWidget(i.model,n,!0):this.addNewWidget(new rs.Widget({},{},this.widgetsCollection),n,!1)}return!1},V.prototype.onRemoveWidget=function(t){this.widgetsCollection.commandRemove(t)},V.prototype.onResizeStart=function(){_.each(this.widgets,function(t){t.view.onResizeStart&&t.view.onResizeStart(!0)})},V.prototype.onResize=function(t){_.each(this.widgets,function(t){t.view.onResize&&t.view.onResize(!0)})},V.prototype.onResizeStop=function(){_.each(this.widgets,function(t){t.view.onResizeStop&&t.view.onResizeStop(!0)}),this.userCan()?this.$el.find(".component-build-view").removeClass("build-off"):this.$el.find(".component-build-view").addClass("build-off")},V.prototype.onSelectedWidgetChanged=function(t,e){this.selected&&this.selected.$widget.removeClass("selected"),e?(e=this.findWidgetItem(e.id))&&(this.selected=e,this.selected.$widget.addClass("selected")):this.selected=null},V.prototype.onSelectingWidget=function(t,e){t&&(this.onWidgetClick(null,e),this.dashboardAppModel.set("pendingSelectionWidgetId",null,{silent:!0}))},V.prototype.onWidgetClick=function(t,e){t&&(e=$(t.currentTarget).attr("data-widgetid"));var n=this.findWidgetItem(e);!n||!e&&$(t.target).is(n.$remove)||this.ignoreWidgetSelect||(t&&t.stopPropagation&&t.stopPropagation(),t&&$(t.target).parent().hasClass("QuickStart"))||(this.dashboardViewModel.get("selectedWidget")===n.model?(this.dashboardViewModel.set("selectedWidget",null),this.dashboardViewModel.set("selectedWidgetView",null,{silent:!0})):(this.dashboardViewModel.set("selectedWidget",n.model),this.dashboardViewModel.set("selectedWidgetView",n.view,{silent:!0})))},V.prototype.onWidgetCollectionAdd=function(t,e,n){this.addWidget(t,!1,null)},V.prototype.onWidgetCollectionRemove=function(t,e,n){this.removeWidget(t)},V.prototype.remove=function(){return this.clearWidgets(),m.View.prototype.remove.apply(this)},V.prototype.removeWidget=function(t){t=_.find(this.widgets,{model:t});t&&(this.selected&&this.selected===t&&this.deselectCurrentWidget(),this.widgets=_.without(this.widgets,t),t.$widget.css({border:"none",background:"none","box-shadow":"none","pointer-events":"none"}),t.view&&_.isFunction(t.view.remove)&&t.view.remove(),t.$widget.off(),t.$widget.remove())},V.prototype.renderComponent=function(t,e){e=this.createComponentView(t,e);t.$widget.append(e.$el),this.$el.append(t.$widget)},V.prototype.renderWidget=function(t){return $("<div></div>")},V.prototype.selectWidget=function(t){this.ignoreWidgetSelect||(this.dashboardViewModel.set("selectedWidget",t.model),this.dashboardViewModel.set("selectedWidgetView",t.view,{silent:!0}))},V.prototype.setTheme=function(e){_.each(this.widgets,function(t){t.view&&t.view.app&&_.isFunction(t.view.app.setTheme)&&t.view.app.setTheme(e)})},V.prototype.showReplaceConfirmationDialog=function(e,n){var i=_.get(this.dashboardAppModel.get("components").get(_.get(n,"model.attributes.component.attributes.definitionId",null)),"attributes.componentName","");rs.ConfirmDialog.ShowConfirm({dialogTitle:"Confirm Replace",renderTemplate:function(){return t("Are you sure you would like to replace this ".concat(i," component?"))},callback:e})},V.prototype.switchBuildMode=function(t,e){t?this.switchOnBuildMode(e):this.switchOffBuildMode(e)},V.prototype.switchOffBuildMode=function(t){this.disableWidgetSelect(),_.each(this.widgets,function(t){t.$widget&&t.$widget.addClass("build-off")})},V.prototype.switchOnBuildMode=function(t){this.enableWidgetSelect(),_.each(this.widgets,function(t){t.$widget&&t.$widget.removeClass("build-off")})},V.prototype.userCan=function(t){return this.dashboardViewModel.get("buildMode")&&!this.quickView},rs.ComponentDropView=V,us=A=A||{},cs=m.View,e(qs,cs),qs.prototype.initializeEvents=function(){var t=this.appModel.get("documents");this.listenTo(t,"reset",this.onDocumentsReset),this.listenTo(t,"add",this.onDocumentsAdd),this.listenTo(t,"remove",this.onDocumentsRemove),this.listenTo(this.viewModel,"change:selectedDocumentId",this.onViewModelSelectedChanged)},qs.prototype.blurSelect=function(){this.select2.data("select2").$container.find(".select2-selection").blur()},qs.prototype.getDocuments=function(){var e=this,n=[],i=[],o=[];this.documentTypeMap={},_.sortBy(this.appModel.get("documents").map(function(t){return t.attributes}),function(t){return-Date.parse(t.lastUpdateDate)}).forEach(function(t){e.appModel.get("quickview")&&0===t.name.indexOf("Draft:")||(_.includes(t.tags,"starred")?(o.push(t),e.documentTypeMap[t.id]="starred"):i.length<e.RECENT_DOCUMENT_COUNT?(i.push(t),e.documentTypeMap[t.id]="recent"):(n.push(t),e.documentTypeMap[t.id]="other"))}),o=_.sortBy(o,function(t){return t.name.toLowerCase()}),n=_.sortBy(n,function(t){return t.name.toLowerCase()}),this.documentsList=i.concat(o,n)},qs.prototype.onDocumentsAdd=function(t){this.listenTo(t,"change:name",this.render),0<this.$el.find("select").length&&(this.$el.find("select").select2("close"),this.render())},qs.prototype.onDocumentsRemove=function(t){this.stopListening(t),this.render()},qs.prototype.onDocumentsReset=function(t,e){var n=this;_.each(e.previousModels,function(t){n.stopListening(t)}),t.each(function(t){n.listenTo(t,"change:name",n.render)}),this.render()},qs.prototype.onResize=function(){this.availableHeight=.4*$("body").height()},qs.prototype.onViewModelSelectedChanged=function(t,e){e!==this.$el.find("select").val()&&this.selectDocument(e)},qs.prototype.render=function(){var i=this,o=this;return this.getDocuments(),this.$el.html(us.T.DocumentSelector(this.documentsList)),this.select2=this.$el.find("select").select2({language:{noResults:function(){return"No Dashboards found"}},templateResult:function(t,e){var n;switch(o.documentTypeMap[t.id]){case"starred":n=$('<span><i class="dashboard-selector-icon fa fa-star" title="Starred"></i>'+_.escape(t.text)+"</span>"),$(e).addClass("starred");break;case"recent":n=$('<span><i class="dashboard-selector-icon fa fa-clock-o" title="Recent"></i>'+_.escape(t.text)+"</span>"),$(e).addClass("recent");break;default:n=$("<span>"+_.escape(t.text)+"</span>")}return n},theme:"document-selector",width:"225px"}),this.onResize(),this.select2.on("select2:open",function(){var e,n=$(".select2-container--document-selector .select2-dropdown");i.showManage&&0==n.find(".manage").length&&((e=$('<a class="manage" title="'+t("Manage Dashboards")+'">'+t("Manage Dashboards")+"</a>")).button({icons:{secondary:"fa fa-share-square-o"}}).click(function(){e.removeClass("ui-state-hover"),i.select2.select2("close"),i.trigger("manage")}),n.append("<hr>"),n.append(e)),n.find(".select2-results > ul").css("max-height",i.availableHeight+"px"),us.Tools.isIE()||$(".select2-search__field").attr("placeholder","Search...")}),this.select2.on("select2:close",function(){_.defer(function(){o.blurSelect()})}),this.select2.on("select2:select",function(){var t=o.select2.val();if(t!==o.viewModel.get("selectedDocumentId"))try{o.appModel.get("router").onNavCancel=function(){o.select2.val(o.viewModel.get("selectedDocumentId")).trigger("change")},o.appModel.get("router").navigate(t,{trigger:!0})}catch(t){us.Log.Error("Select Document Error:",t)}o.blurSelect()}),this.selectDocument(this.viewModel.get("selectedDocumentId")),this},qs.prototype.selectDocument=function(t){var e=this.$el.find("select"),n=this.appModel.get("documents").get(t);e.val(t).trigger("change"),n&&this.$el.find("input").val(n.get("name"))},us.DocumentSelector=qs,ps=A=A||{},ds=m.View,e(Ys,ds),Ys.prototype.initializeEvents=function(){this.listenTo(this.model.get("popups"),"reset viewStatesParsed",this.onResetPopups),this.listenTo(this.model.get("popups"),"add",this.onAddPopup),this.listenTo(this.model.get("popups"),"remove",this.onRemovePopup),this.listenTo(this.model,"change:advancedCss",this.applyCustomCss),this.listenTo(this.model,"change:cssClasses",this.onCssClassesChanged),this.listenTo(this.viewModel,"change:selectedScreenId",this.onSelectedScreenChanged),this.listenTo(this.viewModel,"change:DashboardTheme",function(t){this.applyTheme(t.get("DashboardTheme"))}),$(window).on("keydown",this.onKeyDown.bind(this))},Ys.prototype.applyCustomCss=function(){var t=this.model.get("advancedCss");t?t!==this.customCss&&(this.$customCss&&this.$customCss.length?this.$customCss.html(t):this.$customCss=$("<style></style>",{documentid:this.model.id,html:t,type:"text/css"}).appendTo(document.head),this.customCss=t):this.$customCss&&(this.$customCss.remove(),this.$customCss=null,this.customCss=null)},Ys.prototype.applyCssClasses=function(t){t?(t=_.isArray(t)?_.reduce(t,function(t,e){return t+" "+e}):t)!==this.cssClasses&&(this.$el.removeClass(this.cssClasses),this.$el.addClass(t),this.cssClasses=t):(this.$el.removeClass(this.cssClasses),this.cssClasses=null)},Ys.prototype.applyDataSources=function(){_.each(this.model.get("data").flatten(),function(t){t.isMapping()&&t.get(ps.DocumentDataModel.AUTO_EXECUTE)&&t.apply()})},Ys.prototype.applyTheme=function(e){var n=this;this.screenView&&_.each(this.screenView.widgets,function(t){n.applyThemeToWidget(t,e)})},Ys.prototype.applyThemeToWidget=function(t,e){t.view.app&&t.view.app.setTheme&&t.view.app.setTheme(e)},Ys.prototype.changeScreen=function(e){this.screenView&&this.screenView.remove();var n=$(document.createElement("div"));n.addClass("screen-view"),n.appendTo(this.$el.find(".screen-view-div")),this.screenView=null,require(["Panel"],function(t){this.screenView||(this.applyDataSources(),this.passScreenPropertiesToDocumentModel(e,this.model),this.screenView=new t({el:n,model:e,dashboardAppModel:this.appModel,documentModel:this.model,dashboardViewModel:this.viewModel,websiteUrl:this.appModel.get("websiteUrl"),DeltaClientLib:this.deltaClient,api:{},isBasePanel:!0,quickView:this.quickView}))}.bind(this))},Ys.prototype.createPopup=function(t){return new ps.PopupView({viewModel:this.viewModel,appModel:this.appModel,container:this.$el,quickView:this.quickView,model:t})},Ys.prototype.onAddPopup=function(){this.popups.push(this.createPopup(arguments[0]))},Ys.prototype.onRemovePopup=function(e){var t=_.find(this.popups,function(t){return t.model.get("id")===e.get("id")});this.popups.splice(this.popups.indexOf(t),1),t.remove()},Ys.prototype.onResetPopups=function(){var e=this;_.each(this.popups,function(t){t.remove()}),this.popups=[],this.model.get("popups").each(function(t){e.popups.push(e.createPopup(t))})},Ys.prototype.onKeyDown=function(t){var e,n=t.keyCode;(t.ctrlKey||t.metaKey)&&(t=this.model.get("shortcuts"),e=String.fromCharCode(n).toLowerCase(),n=_.find(t,function(t){return t.Key===e}))&&n.Data&&n.Data.forceExecute()},Ys.prototype.onCssClassesChanged=function(){var t=this.model.get("cssClasses");t&&t._dashboardsType||(this.prevCssViewModel&&(this.stopListening(this.prevCssViewModel),this.prevCssViewModel=null),t instanceof m.Model&&(this.listenTo(t,"change:value",function(t,e){this.applyCssClasses(e)}),t=(this.prevCssViewModel=t).get("value")),this.applyCssClasses(t))},Ys.prototype.onResize=function(){this.screenView&&this.screenView.onResize(!0)},Ys.prototype.onSelectedScreenChanged=function(){var t,e=!1,n=this.viewModel.get("selectedScreenId");n&&(t=this.model.get("screens").get(n))&&(this.changeScreen(t),e=!0),e||((t=this.model.get("screens").findWhere({isDefault:!0}))?this.viewModel.set("selectedScreenId",t.id):(t=this.model.get("screens").first())&&(t.set("isDefault",!0),this.viewModel.set("selectedScreenId",t.id)))},Ys.prototype.passScreenPropertiesToDocumentModel=function(t,e){var n=t.get("relativeHeight"),i=t.get("rowCount")||24,o=t.get("rowHeight")||25;void 0===n&&void 0===(n=e.get("relativeHeight"))&&(n=!0),t.set(n={relativeHeight:n,rowCount:i,rowHeight:o}),e.set(_.extend(n,{colCount:t.get("colCount"),floatable:t.get("floatable")})),e.trigger("basePanelLayoutChanged")},Ys.prototype.pasteWidget=function(t){this.screenView&&!this.quickView&&this.screenView.pasteWidget(t)},Ys.prototype.remove=function(){var t;return this.stopListening(),this.screenView&&this.screenView.remove(),_.each(this.popups,function(t){t.remove()}),this.$customCss&&this.$customCss.remove(),(t=this.model.get("data"))&&(t.stopPolledQueries&&t.stopPolledQueries(),t.removeSubscriptions)&&t.removeSubscriptions(),$(window).off("keydown"),m.View.prototype.remove.call(this)},ps.DocumentView=Ys,hs=A=A||{},gs=m.View,e(Hs,gs),Hs.checkCapslockOn=function(t){var e=/Mac/.test(navigator.platform),n=t.charCode,i=t.shiftKey,o=!1;return 97<=n&&n<=122?o=i:!(65<=n&&n<=90)||i&&e?122<n&&t.getModifierState("CapsLock")&&(o=!0):o=!i,o},Hs.prototype.onWindowCapsLockClick=function(t){20===t.which&&(t.getModifierState("CapsLock")?this.setErrorMessage("capsLock","#ffc800"):this.$el.find(".loginErrorPanel").css("visibility","hidden"))},Hs.prototype.render=function(){var e=this;return this.$el.html(hs.T.LoginDialog({})),$(".quick-base").addClass("disturbed"),$(document).find(".loadingScreen svg").hide(),$(document).find(".loading-info svg").hide(),e.$userLoginForm=this.$el.find(".user-login-form"),e.$forgotPasswordForm=this.$el.find(".forgot-password-form"),e.$forgotPasswordBtn=this.$el.find(".forgot-info"),e.$passwordResetInfo=this.$el.find(".password-reset-info"),e.$recoveryResponse=this.$el.find(".recovery-response"),e.$resetUserName=this.$el.find(".reset-username"),this.$restPasswordError=this.$el.find(".reset-password-error"),e.$dialog=this.$el.find(".login-form"),e.$buttonPanel=this.$el.find(".login-button-panel"),this.$el.find(".login-btn").button({label:t("Login"),icons:{primary:"fa fa-check"}}),this.$el.find(".back-btn").button({label:t("Back"),icons:{primary:"fa fa-arrow-left"}}),this.$el.find(".reset-btn").button({icons:{primary:"fa fa-undo"},label:t("Reset")}),e.$loginBtn=this.$el.find(".login-btn"),e.$backBtn=this.$el.find(".back-btn"),e.$backBtn.hide(),e.$resetBtn=this.$el.find(".reset-btn"),e.$resetBtn.hide(),(e=$.cookie("deltaLoginError"))?$.removeCookie("deltaLoginError",{path:"/"}):e=this.errorMessage,e&&this.setErrorMessage(e),this},Hs.prototype.initializeEvents=function(){var e=this;e.$el.find(".password, .username").on("keydown",function(t){13===t.which&&e.onLoginButtonClick(t)}),window.addEventListener("keydown",this.boundCapsLockFn,!0),e.$el.find(".password").on("keypress",function(t){Hs.checkCapslockOn(t.originalEvent)?e.setErrorMessage("capsLock","#ffc800"):e.$el.find(".loginErrorPanel").css("visibility","hidden")}),e.$forgotPasswordBtn.on("click",function(){e.showForgotPasswordForm()}),e.$loginBtn.on("click",function(t){t.preventDefault(),e.onLoginButtonClick(t)}),e.$backBtn.on("click",function(t){t.preventDefault(),e.hideForgotPasswordForm()}),e.$resetBtn.on("click",function(t){t.preventDefault(),e.onResetButtonClick()}),$(hs.DeltaClientLib).one("DeltaClientLogin",$.proxy(e.onLoginSuccess,e))},Hs.prototype.clickLoginButton=function(){this.onLoginButtonClick({currentTarget:$(".login-button-panel .login-btn")})},Hs.prototype.onLoginButtonClick=function(e){var n,i,o=this;this.clicked||(n=this.$el.find(".username").val(),i=this.$el.find(".password").val(),this.$buttonText=$(e.currentTarget).find(".ui-button-text"),n&&i?(this.setErrorMessage("Connecting please wait...","#fff"),this.clicked=!0,e&&($(e.currentTarget).find(".ui-button-icon-primary").removeClass("fa-check"),$(e.currentTarget).find(".ui-button-icon-primary").css({width:"auto",height:"auto"}),$(e.currentTarget).find(".ui-button-icon-primary").addClass("fa-spinner fa-pulse"),this.$buttonText.text(t("wait")+"...")),this.$el.find("input").attr("disabled","disabled"),_.isFunction(o.doLogin)&&o.doLogin(n,i,function(t){o.setErrorMessage(t)})):(this.setErrorMessage("Please enter your username and password."),e.preventDefault()))},Hs.prototype.onLoginSuccess=function(){this.appModel.set("userName",hs.DeltaClientLib.deltaClient.user()),$.cookie("deltaToken",hs.DeltaClientLib.deltaClient.tokenKey(),{expires:30,path:"/"}),$(".quick-base").removeClass("disturbed"),this.onRemove()},Hs.prototype.onRemove=function(){this.$loginBtn.off(),this.$backBtn.off(),this.$resetBtn.off(),this.$forgotPasswordBtn.off(),$(document).find(".loadingScreen svg").show(),$(document).find(".loading-info svg").show(),$(hs.DeltaClientLib).off("DeltaClientLogin",this.onLoginSuccess),window.removeEventListener("keydown",this.boundCapsLockFn,!0),this.remove()},Hs.prototype.onResetButtonClick=function(){var t,n=this;this.$restPasswordError.css("visibility","hidden"),this.$userLoginForm.removeClass("open"),(t=this.$resetUserName.val())&&0<t.length?(this.showPasswordResetInfo(),$.get("/kxuseradmin?operation=request&data="+t).done(function(t){n.$recoveryResponse.text(t)}).fail(function(t){var e="Error";_.isString(t)?e+=": "+t:t&&t.statusText&&(e+=": "+t.statusText),n.$recoveryResponse.text(e)})):this.$restPasswordError.css("visibility","visible")},Hs.prototype.setErrorMessage=function(e,n){var i=this,o=i.$dialog.parent().find(".ui-button-icon-primary.fa-spinner.fa-pulse");this.$el.find(".loginErrorPanel").removeClass("warning"),"#fff"===n?this.$el.find(".loginErrorPanel").addClass("info"):"#ffc800"===n?this.$el.find(".loginErrorPanel").addClass("warning"):this.$el.find(".loginErrorPanel").removeClass("info"),"locked"===e?e=t("Account is locked; please contact your administrator"):"capsLock"===e&&(e='<i class="fa fa-warning"></i>'+t("Caps Lock is on")),this.$el.find(".loginErrorPanel").css({}),this.$el.find(".loginErrorPanel").html(e).css("visibility","visible"),i.clicked=!1,o.length&&(o.removeClass("fa-spinner fa-pulse"),o.addClass("fa-check"),this.$loginBtn.find(".ui-button-text").text(t("Login"))),i.$el.find("input").removeAttr("disabled"),"Please reset password"!==e&&"Your password has expired"!==e||i.changePasswordDialog||(i.changePasswordDialog=new hs.ChangePasswordDialog({appModel:i.appModel,container:i.container,message:e,onChangeSuccess:function(){i.$el.find(".loginErrorPanel").css("visibility","hidden"),i.$el.data("uiDialog")&&i.$el.dialog("close")},onDialogClose:_.bind(function(){i.changePasswordDialog=null},i)}))},Hs.prototype.showForgotPasswordForm=function(){this.$userLoginForm.removeClass("open"),this.$forgotPasswordForm.addClass("open"),this.$passwordResetInfo.removeClass("open"),this.$loginBtn.hide(),this.$backBtn.show(),this.$resetBtn.show()},Hs.prototype.showPasswordResetInfo=function(){this.$userLoginForm.removeClass("open"),this.$forgotPasswordForm.removeClass("open"),this.$passwordResetInfo.addClass("open"),this.$loginBtn.hide(),this.$resetBtn.hide(),this.$backBtn.show()},Hs.prototype.hideForgotPasswordForm=function(){this.$forgotPasswordForm.removeClass("open"),this.$passwordResetInfo.removeClass("open"),this.$userLoginForm.addClass("open"),this.$loginBtn.show(),this.$backBtn.hide(),this.$resetBtn.hide()},hs.LoginDialog=Hs,Be=A=A||{},Ks.getStringColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){return 11===Number(t.get("kdbType"))}).map(function(t){return t.id})},Ks.getScalarColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){t=Number(t.get("kdbType"));return 3<t&&t<11||11<t&&t<20}).map(function(t){return t.id})},Ks.getNumericColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){t=Number(t.get("kdbType"));return 3<t&&t<11}).map(function(t){return t.id})},Ks.getTimeColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){t=Number(t.get("kdbType"));return 11<t&&t<20}).map(function(t){return t.id})},Ks.getListColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){return 0===Number(t.get("kdbType"))}).map(function(t){return t.id})},Be.HeuristicHelpers=Ks,(A||(A={})).HelpDialog=m.View.extend({$dialog:null,appModel:null,className:"quick-base window",viewModel:null,initialize:function(t){this.appModel=t.appModel,this.container=t.container,this.viewModel=t.viewModel,this.tag=t.tag,this.render()},remove:function(){this.$el.dialog("destroy").remove(),this.stopListening(),this.$el.off(),this.$el.remove()},render:function(){var e=this,n=$(document),i=this.appModel.get("DocsUrl"),o=this.appModel.get("websiteUrl").replace("/edit",""),i=void 0!==i?i:o+"docs/",o=this.appModel.get("isHelpDialogTabbed")||!1,i=void 0!==this.tag?i+"/"+this.tag:i;o?window.open(i,"_blank"):(this.$el.html($("<iframe></iframe>").attr("src",i)),this.$dialog=this.$el.dialog(_.extend({appendTo:this.container,dialogClass:"quick-base help-dialog",title:t("Help"),resizable:!0,height:.8*n.height(),width:.8*n.width(),modal:!0,autoOpen:!0,draggable:!0,open:function(){$('<i class="fa fa-question-circle"></i>').insertBefore(e.$el.parent().find(".ui-dialog-title"))},close:function(){e.remove()}},this.options)))}}),fs=A=A||{},ms=m.View,e(zs,ms),zs.prototype.getTimezones=function(){this.timezones=_.map(p.tz.names(),function(t){return{group:t.substr(0,t.indexOf("/")),label:t.substr(t.indexOf("/")+1),value:t}}),this.timezones=_.groupBy(this.timezones,"group")},zs.prototype.onAbout=function(){new fs.AboutDialog({appModel:this.appModel,container:this.dialogContainer,viewModel:this.viewModel})},zs.prototype.onHelp=function(){new fs.HelpDialog({appModel:this.appModel,container:this.dialogContainer,viewModel:this.viewModel})},zs.prototype.onChangeLanguage=function(){var t=this.$selectLanguage.val();t&&t!==$.cookie("dashboard-language")&&($.cookie("dashboard-language",t,{expires:90,path:"/",secure:"https:"===_.get(window,"location.protocol")}),window.location.reload(!1))},zs.prototype.onChangeLogLevel=function(){var t=this.$selectLogLevel.val();t&&t!==$.cookie("dashboard-log-level")&&$.cookie("dashboard-log-level",t,{expires:90,path:"/",secure:"https:"===_.get(window,"location.protocol")}),fs.Log.trace(t.toString())},zs.prototype.onChangePassword=function(){new fs.ChangePasswordDialog({appModel:this.appModel,container:this.dialogContainer})},zs.prototype.onChangeTheme=function(){var t=this.$selectTheme.val();t&&t!==$.cookie("dashboard-theme")&&($.cookie("dashboard-theme",t,{expires:90,path:"/",secure:"https:"===_.get(window,"location.protocol")}),this.trigger("themeChange",t))},zs.prototype.onChangeViewerTheme=function(){var t=this.$selectViewerTheme.val();t&&t!==$.cookie("dashboard-viewer-theme")&&($.cookie("dashboard-viewer-theme",t,{expires:90,path:"/",secure:"https:"===_.get(window,"location.protocol")}),this.trigger("themeChange",t))},zs.prototype.onChangeTimezone=function(){var t=this.$selectTimezone.val();t&&t!==$.cookie("dashboard-timezone")&&($.cookie("dashboard-timezone",t,{expires:90,path:"/",secure:"https:"===_.get(window,"location.protocol")}),window.location.reload(!1))},zs.prototype.onLogout=function(){var e=this,n=this.viewModel.get("selectedDocumentId"),i=this.appModel.get("documents").find(function(t){return t.id===n});!(this.isQuickView?i&&i.get("viewState").wasChanged:i&&i.get("wasChanged"))||this.isQuickView&&!i.get("unsavedViewerPrompt")?fs.DeltaClientLib.logout():new fs.AreYouSureDialog({userClass:this.isQuickView?"quick-view":"quick-dash",container:this.dialogContainer,noSaveCb:_.bind(fs.DeltaClientLib.logout,fs.DeltaClientLib),saveCb:function(){var t;e.isQuickView?((t=i.get("viewState")).withAllProperties=!0,i.get("viewState").save({id:n},{success:_.bind(fs.DeltaClientLib.logout,fs.DeltaClientLib)}),t.withAllProperties=!1):i.saveNow($.noop,_.bind(fs.DeltaClientLib.logout,fs.DeltaClientLib))}})},zs.prototype.onThemeSwitchableChange=function(){this.viewModel.get("themeSwitchable")?this.$selectViewerTheme.prop("disabled",!1):this.$selectViewerTheme.prop("disabled",!0)},zs.prototype.render=function(){var t,e=this;return this.$el.html(fs.T.ProfileMenu({majorTimezones:this.MAJOR_TIMEZONES,saml:this.appModel.get("saml"),isLite:this.appModel.get("isLite"),logLevel:this.logLevels,themes:this.themes,timezones:this.timezones,editor:!this.isQuickView,showBreadcrumbs:this.appModel.get("showBreadcrumbs")})),this.$buttonset=this.$el.find(".buttonset"),this.$selectLanguage=this.$el.find(".select-language"),this.$selectLogLevel=this.$el.find(".select-log-level"),this.$selectTheme=this.$el.find(".select-theme"),this.$selectTimezone=this.$el.find(".select-timezone"),this.$selectViewerTheme=this.$el.find(".select-viewer-theme"),this.$breadcrumbs=this.$el.find(".breadcrumbs"),this.$buttonset.buttonset(),this.$buttonset.menu({select:function(t){switch($(t.currentTarget).attr("data-options")){case"change-password":e.onChangePassword();break;case"about":e.onAbout();break;case"helpguide":e.onHelp();break;case"logout":e.onLogout();break;case"login-history":e.trigger("login-history");break;case"logout-local":e.ssoLogout("local");break;case"logout-global":e.ssoLogout("global");case"open-editor":window.open("./edit#"+fs.Tools.getHash(),"_blank");break;case"open-viewer":window.open("../#"+fs.Tools.getHash(),"_blank");break;case"document-breadcrumbs":e.toggleBreadcrumbs()}}}),t=[{$el:this.$selectLanguage,value:$.cookie("dashboard-language")||"en",options:{},callback:this.onChangeLanguage},{$el:this.$selectLogLevel,value:$.cookie("dashboard-log-level")||"4",options:{minimumResultsForSearch:10},callback:this.onChangeLogLevel},{$el:this.$selectTheme,value:$.cookie("dashboard-theme")||"kx-darkroom",options:{minimumResultsForSearch:3},callback:this.onChangeTheme},{$el:this.$selectViewerTheme,value:$.cookie("dashboard-viewer-theme")||"kx-darkroom",options:{minimumResultsForSearch:3},callback:this.onChangeViewerTheme},{$el:this.$selectTimezone,value:fs.Tools.timezone,options:{},callback:this.onChangeTimezone}],_.each(t,function(t){t.$el.val(t.value),t.$el.select2(_.extend({theme:"dashboards"},t.options)),t.$el.on("select2:select",_.bind(t.callback,e)),t.$el.on("select2:open",function(){$("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment"),$(".select2-search__field").on("click",function(t){t.stopPropagation()})}),t.$el.on("select2:close",function(){$(".select2-search__field").off()})}),(this.isQuickView?this.$el.find(".row.theme"):this.$el.find(".row.viewer-theme")).css("display","none"),this},zs.prototype.ssoLogout=function(t){fs.DeltaClientLib.ssoLogout(t)},zs.prototype.toggleBreadcrumbs=function(){this.appModel.set("showBreadcrumbs",!this.appModel.get("showBreadcrumbs")),this.appModel.get("showBreadcrumbs")?this.$breadcrumbs.addClass("checked"):this.$breadcrumbs.removeClass("checked")},fs.ProfileMenu=zs,ys=A=A||{},vs=m.View,e(Qs,vs),Qs.prototype.initializeEvents=function(){this.listenTo(this.viewModel,"change:buildMode",this.onBuildModeChange),this.listenTo(this.model,"change:dialogTitle change:dialogWidth change:dialogHeight change:modal change:resizable",this.onDialogAttributeChange),this.listenTo(this.model,"change:visible",this.initializeVisible)},Qs.prototype.destroyDialog=function(){this.$dialog.dialog("instance")&&this.$dialog.dialog("destroy")},Qs.prototype.initializeComponentDrop=function(){var t;this.componentDropView||(t=$("<div></div>",{class:"component-drop"}),this.$contentPanel.append(t),this.componentDropView=new ys.ComponentDropView({el:t,dashboardAppModel:this.appModel,dashboardViewModel:this.viewModel,DeltaClientLib:ys.DeltaClientLib,quickView:this.quickView,widgets:this.model.get("widgets")}))},Qs.prototype.popupPosition=function(){var t,e=this.model.get("dialogTop"),n=this.model.get("dialogLeft"),i=$(".main-toolbar").height()||34;return!e&&0!==e||!n&&0!==n||((t=localStorage.getItem("popupDialog-"+this.model.get("id")))&&(e=(t=JSON.parse(t)).top,n=t.left),e=parseFloat(e)-i,n=parseFloat(n)),{top:e,left:n}},Qs.prototype.initializeDialog=function(){var o=this,t=!1,e=this.processSettings(),n=this.popupPosition(),i={my:"center",at:"center",of:this.$dialogContainer},s={appendTo:this.$dialogContainer,autoOpen:!1,close:function(){var t=o.model.get("visible");!o.isEditing&&t instanceof m.Model&&!1!==t.get("value")&&t.set("value",!1),o.doActions(o.model.get("Actions")),o.isEditing?o.remove():o.removeComponentDropView()},dialogClass:"popup-dialog",drag:function(t,e){localStorage.setItem("popupDialog-"+o.model.get("id"),JSON.stringify(e.offset))},dragStop:function(t,e){var n=_.get(e,"offset"),i=_.get(e,"offset.top"),e=_.get(e,"offset.left");_.isNil(n)&&(_.isNil(i)||o.model.get("dialogTop").set("value",i),_.isNil(e)||o.model.get("dialogLeft").set("value",e),localStorage.setItem("popupDialog-"+o.model.get("id"),JSON.stringify(n)))},open:function(){o.componentDropView&&o.componentDropView.onResize(),o.$dialog.dialog("option",{position:i});var t=o.$dialog.parent();t.attr("data-widgetid",o.widgetId),(n=o.popupPosition()).top&&n.left&&t.css({top:n.top,left:n.left}),o.isEditing&&$("<div></div>").addClass("popup-mask ui-widget-overlay").appendTo(o.$dialogContainer).click(function(){o.$dialog.dialog("close")})},position:i,resizeStop:function(){o.componentDropView&&o.componentDropView.onResize()},title:e.dialogTitle};_.assign(s,this.getAdjustedSize(e)),this.isEditing?(s.modal=!1,s.resizable=!1):(s.modal=!0===e.modal,s.resizable=!0===e.resizable),this.$dialog.dialog("instance")?(this.$dialog.dialog("option","modal")!==s.modal&&(t=this.$dialog.dialog("isOpen")),this.$dialog.dialog("option",s),t&&(this.$dialog.dialog("close"),this.$dialog.dialog("open"))):this.$dialog.dialog(s),(n=this.popupPosition()).top&&n.left&&this.$dialog.parent().css({top:n.top,left:n.left})},Qs.prototype.initializeVisible=function(){var t=this.model.get("visible");this.visibleListener&&this.stopListening(this.visibleListener),t instanceof ys.DocumentViewModel&&(this.listenTo(t,"change:value",this.onVisibleChange),this.visibleListener=t),this.onVisibleChange()},Qs.prototype.onBuildModeChange=function(){this.isEditing?this.remove():this.viewModel.get("buildMode")?this.$dialog.dialog("close"):(this.initializeDialog(),this.onVisibleChange())},Qs.prototype.getAdjustedSize=function(t){return{height:Math.min(t.dialogHeight,this.$dialogContainer.height())||.8*this.$dialogContainer.height(),width:Math.min(t.dialogWidth,this.$dialogContainer.width())||.8*this.$dialogContainer.width()}},Qs.prototype.onVisibleChange=function(){var t=this,e=this.model.get("visible");this.viewModel.get("buildMode")||(e instanceof ys.DocumentViewModel&&(e=e.get("value")),this.$dialog.dialog("instance")&&_.defer(function(){t.toggleDialog(e)}))},Qs.prototype.pasteWidget=function(t){var e=t.get("component").get("definitionId"),n=this.componentDropView.widgetsCollection.first();n?((t=t.clone(n.get("id"))).setParent(this.componentDropView.widgetsCollection),n.commandSet({component:t.get("component")})):(t.setParent(this.componentDropView.widgetsCollection),this.componentDropView.addNewWidget(t,e,!0))},Qs.prototype.processSettings=function(){var n=this,t=_.omit(this.model.attributes,"visible"),i={};return _.each(this.viewStateListeners,function(t){n.stopListening(t,"change:value")}),this.viewStateListeners={},_.each(t,function(t,e){t instanceof ys.DocumentViewModel?(i[e]=t.get("value"),n.viewStateListeners[t.path]||(n.listenTo(t,"change:value",function(){n.$dialog.dialog("instance")&&n.$dialog.dialog("isOpen")&&("height"===t.path||"width"===t.path)?n.$dialog.dialog(n.getAdjustedSize(n.processSettings())):n.initializeDialog()}),n.viewStateListeners[t.path]=t)):i[e]=t}),i},Qs.prototype.remove=function(){return this.isEditing&&this.$dialogContainer.find(".popup-mask").remove(),this.onDialogAttributeChange.cancel(),this.destroyDialog(),this.removeComponentDropView(),this.viewStateListeners={},m.View.prototype.remove.apply(this)},Qs.prototype.removeComponentDropView=function(){this.componentDropView&&(this.componentDropView.remove(),this.componentDropView=null)},Qs.prototype.stringToBoolean=function(t){if("boolean"==typeof t)return t;if(!t)return!1;var e=t.toString();switch(e.toLowerCase().trim()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}},Qs.prototype.toggleDialog=function(t){var t=_.isUndefined(t)?!this.$dialog.dialog("isOpen"):t;this.$dialog.dialog("instance")&&(this.stringToBoolean(t)?(this.initializeComponentDrop(),t=_.pick(this.$dialog.dialog("option"),["width","height"]),0!==Number(t.width)&&0!==Number(t.height)||this.$dialog.dialog("option",this.getAdjustedSize(this.processSettings())),this.$dialog.dialog("open"),this.viewModel.get("buildMode")&&(this.viewModel.set("selectedWidget",this.model),this.viewModel.set("selectedWidgetView",this,{silent:!0}))):this.$dialog.dialog("close"))},Qs.prototype.doActions=function(t){var o=this;_.each(t,function(t,e){var n=o.getPropertyMeta(e,"Current"),i=o.getPropertyMeta(e,"Target");n&&(n="viewstate"===n.type?n.value:t.Current,ys.Tools.isKDBTemporal(n)&&(n=ys.Tools.convertKDBTemporalToMoment(n).toDashString()),i)&&"viewstate"===i.type&&i.path&&o.model.get("Actions")[e].Target.set("value",n)})},Qs.prototype.getPropertyMeta=function(t,e){var n,i,o,t=this.model.get("Actions")[t][e];return _.isNil(t)?null:("viewstate"===(e=this.getSourceType(t))?(o=t.get("value"),n=t.get("_default"),i=t.get("_type")):o=t,{path:t.path||null,type:e,value:o,viewstateType:i||null,defaultValue:n||null})},Qs.prototype.getSourceType=function(t){return t&&(t instanceof ys.DocumentViewModel||t.get&&t.get("_viewType")||t.has&&t.has("_default")&&t.has("value"))?"viewstate":null},ys.PopupView=Qs,bs=A=A||{},ws=bs.DialogBase,e(Ws,ws),Ws.prototype.dialogButtons=function(){return[{text:"OK",click:this.onSave.bind(this),icons:{primary:"fa fa-check"}},{text:"Cancel",click:this.onCancel.bind(this),icons:{primary:"fa fa-times"}}]},Ws.prototype.preRender=function(){this.options.minHeight=250,this.options.width=325,this.options.dialogTitle="Color",this.options.userClass="quick-dash color-pickr-dialog",this.options.position={my:"left top",at:"left bottom",collision:"flip flip",of:$(this.options.target)}},Ws.prototype.renderTemplate=function(){return bs.T.ColorPickr()},Ws.prototype.postRender=function(){this.cPickerDiv=this.el.querySelectorAll(".color-pickr")[0]},Ws.prototype.initColorPicker=function(t){var i=this,t=this.cPickr=new R({el:this.cPickerDiv,inline:!0,showAlways:!0,useAsButton:!0,theme:"classic",default:t,defaultRepresentation:"HEXA",swatches:null,lockOpacity:"false"===this.options.noColor,components:{preview:!0,opacity:"true"===this.options.noColor,hue:!0,interaction:{hex:!0,rgba:!0,hsla:!0,hsva:!1,cmyk:!1,input:!0,clear:!1,save:!1}}});document.querySelector(".pcr-result").classList.add("ui-widget","ui-state-default","ui-corner-all"),document.querySelectorAll(".pcr-type").forEach(function(t){t.classList.add("ui-widget","ui-state-default","ui-corner-all")}),this.initOverlayClick(),t.on("save",function(t,e){var n=i.options.selectCallback,t=t.toHEXA().toString();n&&n(t)}),t.show()},Ws.prototype.initOverlayClick=function(){this.overlay=this.el.parentElement.parentElement.querySelector(".ui-widget-overlay:last-child"),this.overlay.addEventListener("click",this.onCancel.bind(this))},Ws.prototype.onCancel=function(){this.overlay.removeEventListener("click",this.onCancel.bind(this)),this.isCancel=!0,this.dialogClose()},Ws.prototype.onSave=function(){this.cPickr.applyColor(),this.dialogClose()},bs.ColorPickr=Ws,Ss=A=A||{},js.applyFormatToValue=function(t,e,n,i,o){var s={1:"Boolean",2:"String",4:"Number",5:"Number",6:"Number",7:"Number",8:"Number",9:"Number",10:"String",11:"String",12:"Timestamp",13:"Month",14:"Date",15:"Datetime",16:"Timespan",17:"Minute",18:"Second",19:"Time"}[i],i=3<i&&i<10?"Number":11<i&&i<20?"DateTime":"String";return"TO_STRING"==e?t.toString():e?js._applyFormat(t,e,n,s,o,i):js._applyDefaultFormat(t,n,s,o,i)},js._applyFormat=function(t,e,n,i,o,s){var a=t.toString();switch(i=0===e.indexOf("SmartNumber")?"Smart Number":i){case"Smart Number":"DateTime"===s&&(u=Ss.Tools.convertKDBTemporalToMoment(t),t=_.escape(u)),r=-1!==e.indexOf(".")?e.split(".")[1].length:0,a=Ss.Tools.smartFormatNumber(t,r,!o);break;case"Number":!_.isNaN(Number(t))&&_.isFinite(Number(t))&&(a=XLSX.SSF.format(e,Number(t)),o)&&(a=js._hideTrailingZeroes(a));break;case"Date":case"Month":case"Timestamp":case"Datetime":case"Timespan":case"Minute":case"Second":case"Time":var r="Time"===n,l="DateTime"===n,u=Ss.Tools.convertKDBTemporalToMoment(t);"Number"===n?(a=_.escape(u),!_.isNaN(Number(a))&&_.isFinite(Number(a))&&(a=XLSX.SSF.format(e,Number(a)),o)&&(a=js._hideTrailingZeroes(a))):a=_.isFunction(u.isValid)&&!u.isValid()?_.escape(u):r||l?u.formatNano(e,{trim:!1,trimNano:!1}):u.formatNano(e);break;default:a=t.toString()}return a},js._applyDefaultFormat=function(t,e,n,i,o){var s=t.toString(),a=null;return Ss.Tools.isKDBTemporal(t)&&(a=Ss.Tools.convertKDBTemporalToMoment(t)),"DateTime"===o?"Number"===e?s=_.escape(a):a&&_.isFunction(a.format)?s=a.format():_.isFunction(t.toString)&&(s=t.toString()):"Number"===o&&i&&(s=js._hideTrailingZeroes(s)),s},js._hideTrailingZeroes=function(t){var e=t;if(0<=e.indexOf(".")){for(e[e.length-1],0;"0"===e[e.length-1];)e=e.slice(0,-1);"."===e[e.length-1]&&(e=e.slice(0,-1)),e+=""}return e},Ss.RawDataFormatter=js,_s=A=A||{},Gs.getFormData=function(i,t,o){var e=[],s=[];e.push(_.map(t,function(t,e){t=t.colName||t.colId;return i.length||(s[e]={isStringType:!1,format:"",type:"String"}),{formattedVal:t,value:t,type:"String"}}));for(var a=0;a<i.length;a++){var r=[];_.each(t,function(t,e){var n=i[a][t.colId];null!=n?(n=Gs.generateExportData(t,n,e,o,s),r.push(n)):(s[e]=s[e]||{isStringType:!1,format:t.dataFormat,type:t.dataType},r.push({formattedVal:"",value:"",type:null}),console.log("Cell value is either undefined or null: "+t.colId))}),e.push(r)}return{data:e,columnHeaders:s}},Gs.generateExportData=function(t,e,n,i,o){var s,a=t.dataFormat,r=t.dataKdbType,l=t.dataType,u=t.hideTrailingZeroes,c=t.prefix,t=t.suffix,p={},d=Gs.checkIfFormatXLSXCompatible(a),d=!("Boolean"===l||a&&d);return o[n]=o[n]||{isStringType:!1,format:a,type:l},""!==e?(r=_s.RawDataFormatter.applyFormatToValue(e,a,l,r,u),"csv"===i&&/^[-\+=@]/.test(r)&&(r="'"+r),d?(p={formattedVal:r,value:c+r+t},o[n].type="String"):"Boolean"===l?p={formattedVal:r,value:"true"===r}:"Number"===l&&"%"===t?(s=0<(d=100*Number(e))-Math.floor(d)?d.toFixed(2):d.toFixed(0),r=d+"%",a=-1!==s.indexOf(".")?"0.00%":"0%",16<s.length&&(o[n].isStringType=!0),p={formattedVal:r,value:Number(e),format:a}):_.includes(["Date","Time","DateTime","Boolean"],l)||!c&&!t?p=Gs._convertToExportFormat(n,r,e,l,a,i,u,o):(p={formattedVal:r,value:c+r+t},o[n].type="String")):p={formattedVal:"",value:"",type:"String"},p},Gs.checkIfFormatXLSXCompatible=function(t){var e=!0;return e=!_.includes(Gs.EXCEL_INCOMPATIBLE_FORMATS,t)&&-1===t.indexOf(".SSS")?e:!1},Gs._convertToExportFormat=function(t,e,n,i,o,s,a,r){var l,u,c={format:void 0,formattedVal:e,value:"",type:void 0};switch("Number"===i&&(isNaN(Number(n))||!_.isFinite(Number(n))?c.type=i="String":_.isString(e)&&16<e.length&&(i="String",r[t].isStringType=!0)),i){case"Number":a&&!/[%]/.test(o)&&(u=(u=-1!==e.indexOf(".")?e.split(".")[1].length:0)?"."+Array(u+1).join("0"):"",(u=(-1!==o.indexOf(".")?o.split(".")[0]:o)+u)!==o)&&(c.format=u),l=Number(n);break;case"Date":"csv"!==s&&p.utc(e,o).isValid()&&"Invalid date"!==p.utc(e,o).format()?l=p.utc(e,o).format():"csv"===s?(l=e,r[t].type="String"):(l=e,r[t].isStringType=!0);break;case"Time":case"DateTime":l=e,r[t].type="String";break;default:l=e}return c.value=l,c},Gs.EXCEL_INCOMPATIBLE_FORMATS=["","SmartNumber","SmartNumber.0","SmartNumber.00","SmartNumber.000","SmartNumber.0000","SmartNumber.00000","SmartNumber.000000","SmartNumber.0000000","SmartNumber.00000000","SmartNumber.000000000","SmartNumber.0000000000","HH:mm","HH:mm:ss","HH:mm:ss.SSS","HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS","YYYY-MM-DD HH:mm:ss.SSS","YYYY-MM-DD HH:mm:ss.SSSSSS","YYYY-MM-DD HH:mm:ss.SSSSSSSSS","mm:ss","mm:ss.SSS","Mm:ss.SSSSSS","mm:ss.SSSSSSSSS","ss","ss.SSS","ss.SSSSSS","ss.SSSSSSSSS"],_s.FileExportDataGenerator=Gs,n=A=A||{},Ts=n.DialogBase,e(Xs,Ts),Xs.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:function(){t.options&&(t.options.showLoading?(t.showLoadingSpinner(),_.defer(function(){t.dialogClose()})):t.dialogClose())},icons:{primary:"fa fa-check"}},{text:"Cancel",click:function(){t.isCancel=!0,t.dialogClose()},icons:{primary:"fa fa-times"}}]},Xs.prototype.postRender=function(){var e=this;this.$("input").val(this.options.inputValue),this.$("input").on("input",function(t){e.options.inputValue=e.inputValue=$(t.target).val()})},Xs.prototype.renderTemplate=function(){return t("<span>what?</span><input>")},Xs.prototype.showLoadingSpinner=function(){var t=this.$dialogButtonpane.find("span.fa.fa-check");t.removeClass("fa-check"),t.addClass("fa-spinner fa-pulse")},Xs.ShowInput=function(e,n,i,o,s,a,r){return new Xs(_.extend({iconClass:o,dialogTitle:n,callback:e,inputValue:s,userClass:a,showLoading:r},i?{renderTemplate:function(){return t("<div>"+i+"</div><input style='width: 100%; box-sizing: border-box;'>")}}:{}))},n.SimpleInputDialog=Xs,Cs=A=A||{},Zs.prototype.createExportOfCurrentData=function(n){var i,o,s=this,t=s.configSets,e=s.dataSet,a=s.metaData,r=[],l={SheetNames:[],Sheets:{}},u=s.bookType,c=",";t&&_.keys(t).length?_.each(t,function(t){r.push(Cs.FileExportDataGenerator.getFormData(t.dataSet,t.metaData,u))}):e&&e.length&&a&&a.length&&(r[0]=Cs.FileExportDataGenerator.getFormData(e,a,u)),r.length&&r[0].data.length?(_.each(r,function(t,e){var n=s.workSheetTitle||"Work_sheet";n+=1<r.length?"_"+e:"",e=s.convertDataToWorksheet(t.data,t.columnHeaders),l.SheetNames.push(n),l.Sheets[n]=e}),"csv"!==u?(i=XLSX.write(l,{bookType:u,bookSST:!1,type:"binary"}),t=Zs.s2ab(i),s.downloadExportFile(n,t)):(o=1,s.csvExportDelimiter&&s.csvExportDelimiter.length&&(c=s.csvExportDelimiter),_.each(l.Sheets,function(t){var e=1<r.length?n.slice(0,-4)+"part"+o+".csv":n;try{i=XLSX.utils.sheet_to_csv(t,{FS:c}),s.onTransferAction(s.actions,"success",n)}catch(t){return s.onTransferAction(s.actions,t,n),void console.log("Error",t)}0===i.indexOf("ID")&&(/[-\+\{\}\[\]\?\^\*\.\|\$]/.test(c)&&(c="\\"+c),t=new RegExp("(ID[^"+c+"\n]*)"),i=i.replace(t,'"$1"')),s.downloadExportFile(e,i),o+=1}))):(s.onTransferAction(s.actions,e="Data formatter function returned invalid parameter or no data",n),console.error(e))},Zs.prototype.downloadExportFile=function(t,e){var n,i,o="application/octet-stream",s=document.createElement("a");window.Blob?(n=new Blob([e],{type:o}),window.navigator.msSaveOrOpenBlob?s.onclick=function(){window.navigator.msSaveOrOpenBlob(n,t)}:void 0!==s.download&&s.setAttribute("href",URL.createObjectURL(n)),i=this.humanFileSize(n.size)):s.setAttribute("href",encodeURI(o+","+e)),void 0!==s.download&&s.setAttribute("download",t),document.body.appendChild(s),s.click(),document.body.removeChild(s),this.onTransferAction(this.actions,"success",t,i)},Zs.prototype.humanFileSize=function(t,e,n){void 0===n&&(n=1);var i=(e=void 0===e?!0:e)?1e3:1024;if(Math.abs(t)<i)return t+" B";for(var o=e?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],s=-1,a=Math.pow(10,n);t/=i,++s,Math.round(Math.abs(t)*a)/a>=i&&s<o.length-1;);return t.toFixed(n)+" "+o[s]},Zs.prototype.onTransferAction=function(t,i,o,s){var a=this,r=this.dataSet,l=this.metaData;"ChartGL"===this.workSheetTitle&&(r=_.get(this,"configSets.chartGLExport.dataSet"),l=_.get(this,"configSets.chartGLExport.metaData")),_.each(t,function(t){var e=_.get(t,"EventType"),n="success"===i,e="all"===e||"onSuccess"===e&&n||"onFail"===e&&!n;_.get(t,"Result.attributes")&&e&&t.Result.set("value",{component:a.workSheetTitle,dashboard:a.selectedDashboard,fileRowLength:r?r.length:"na",fileMetaData:_.isNil(l)?"na":l,fileName:o,fileType:a.bookType,isSuccess:n,status:i,timestamp:Date.now(),username:Cs.DeltaClientLib.username,size:s})})},Zs.prototype.showDialog=function(){var e=this,n=e.fileFormat,i={".csv":"Csv",".xlsx":"Excel"}[n],o=e.fileName+n;Cs.SimpleInputDialog.ShowInput(function(){var t=this.inputValue;t=(t=""+t||Cs.ExportTools.getDefaultExportFileName(i,!0)).replace(/:/g,"-").replace(/[^\w \.\-]/g,""),new RegExp(n+"$").test(t)||(t+=n),e.createExportOfCurrentData(t)},t("Export file"),t("Please enter the filename"),"fa fa-download",o,"",!0)},Zs.prototype.convertDataToWorksheet=function(t,e){for(var n={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}},o=0;o!=t.length;++o)for(var s=0;s!=t[o].length;++s){i.s.r>o&&(i.s.r=o),i.s.c>s&&(i.s.c=s),i.e.r<o&&(i.e.r=o),i.e.c<s&&(i.e.c=s);var a=t[o][s],r=(void 0!==a.type&&""!==a.type?a:e[s]).type,l=a.format||e[s].format,u={};if(null!==r){e[s].isStringType&&(r="String",a.value=a.formattedVal||a.value);var c=XLSX.utils.encode_cell({c:s,r:o});switch(r){case"Number":l?(u.t="n",u.z=l):u.t="s";break;case"Boolean":u.t="b";break;case"Date":case"DateTime":u.t="d",u.z=l;break;default:u.t="s"}u.s={alignment:{horizontal:"top"}},u.v=a.value,n[c]=u}}return i.s.c<1e7&&(n["!ref"]=XLSX.utils.encode_range(i)),n},Zs.s2ab=function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),i=0;i!=t.length;++i)n[i]=255&t.charCodeAt(i);return e},Cs.FileExport=Zs,Ds=A=A||{},Ms=m.View,e(Js,Ms),Js.prototype.initializeEvents=function(){this.listenTo(this.appViewModel,"change:"+this.EXPORT_PROPERTY_OBJECT+this.EXPORT_PROPERTY_KEYS.concat(" change:"+this.EXPORT_PROPERTY_OBJECT),this.displayChoiceLinkButtons),this.$lnkCsvExport.click(_.bind(this.fileExport,this,".csv")),this.$lnkExcelExport.click(_.bind(this.fileExport,this,".xlsx")),this.$lnkFullExport.click(_.bind(this.apiExport,this)),this.$lnkDownloadScreenshot.click(_.bind(this.downloadImage,this))},Js.prototype.apiExport=function(){var e=this,n=this.getExportConfig(),n=Ds.ExportTools.getExportFileName(n.fileName,n.altFileName,"FullExport"),i=$("<span></span>").addClass("export-spinner fa fa-spinner fa-pulse").attr("title",t("Download in progress")).appendTo(this.$lnkFullExport);e.$lnkFullExport.addClass("export-in-progress"),e.api.exportData(this.appViewModel.get(e.DATA_SOURCE_PROPERTY),function(){i.remove(),e.$lnkFullExport.removeClass("export-in-progress")},{exportName:n})},Js.prototype.displayChoiceLinkButtons=function(){var t=!1,e=!1,n=this.appViewModel.get(this.EXPORT_PROPERTY_OBJECT);n&&(n.changed&&(t=!0),n.ShowExportCsvButton||n.ShowExportExcelButton||n.ShowFullExportButton||n.ShowScreenshot&&!this.isIE?(this.$lnksExport.hasClass("link-disabled")&&t&&(e=!0),this.$lnksExport.removeClass("link-disabled"),this.$lnkCsvExport.toggleClass("link-disabled",!n.ShowExportCsvButton),this.$lnkExcelExport.toggleClass("link-disabled",!n.ShowExportExcelButton),this.$lnkFullExport.toggleClass("link-disabled",!n.ShowFullExportButton),this.$lnkDownloadScreenshot.toggleClass("link-disabled",!(n.ShowScreenshot&&!this.isIE))):(this.$lnksExport.addClass("link-disabled"),t&&(e=!0)),n.ShowExportCsvButton||n.ShowExportExcelButton||n.ShowFullExportButton||n.ShowScreenshot&&!this.isIE?this.trigger("enable-links"):this.trigger("disable-links"),e)&&this.trigger("redraw-chart")},Js.prototype.downloadImage=function(){var e=this.getFileName(),e=_.isString(e)&&e.length?e:"Screenshot";e+=".png",this.generateImage(function(t){Ds.Tools.fileSave(e,t)})},Js.prototype.generateImage=function(t){var i,o,e,n,s=document.createElement("canvas"),a=s.getContext("2d"),r=new Image,l=this.getSvgNode();function u(t){var n=document.defaultView.getComputedStyle(t,"");try{return n.cssText||Array.from(n).reduce(function(t,e){return t+e+": "+n[e]+"; "},"").trim()}catch(t){return""}}n=l.getBoundingClientRect(),i=Math.round(n.height),o=Math.round(n.width),s.width=o,s.height=i,s.style.display="block",l.style.width=o,l.style.height=i,n=function(t){var t=function(t){for(var e=t,t=t.cloneNode(!0),n=(t.style.cssText=u(e),e.getElementsByTagName("*")),i=t.getElementsByTagName("*"),o=n.length;o--;){var s=n[o];i[o].style.cssText=u(s)}return t}(t),e=(new XMLSerializer).serializeToString(t);if(e=(e=(e=e.replace(/<svg/,'<svg width="'+o+'" height="'+i+'"')).replace(/(\w+)?:?xlink=/g,"xmlns:xlink=")).replace(/NS\d+:href/g,"xlink:href"),/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))for(var n=void 0;n=/(<rect[^>]*) style="[^>]*"([^>]*>)/.exec(e);)e=e.replace(n[0],n[1]+n[2]);return e}(l),this.isIE?alert("This feature is not supported in your browser"):(a.clearRect(0,0,o,i),a.fillStyle=function t(e){var n=document.defaultView.getComputedStyle(e)["background-color"];return/^rgb\(/.test(n)?n:t(e.parentNode)}(l),a.fillRect(0,0,o,i),l=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),e=URL.createObjectURL(l),r.onload=function(){URL.revokeObjectURL(e),a.drawImage(r,0,0),s.toBlob(t)},r.src=e)},Js.prototype.getButtonSettings=function(){},Js.prototype.getFileName=function(){var t=this.getExportConfig(),e="";return e=_.isObject(t)&&(_.isArray(t.fileName)&&t.fileName.length||t.altFileName)?Ds.ExportTools.getExportFileName(t.fileName,t.altFileName,""):e},Js.prototype.remove=function(){return this.$lnkCsvExport.off(),this.$lnkExcelExport.off(),this.$lnkFullExport.off(),this.$lnkCopyScreenshot.off(),this.$lnkDownloadScreenshot.off(),m.View.prototype.remove.apply(this,arguments)},Js.prototype.showExportError=function(t){t=t||"Export of .csv or .xlsx for pivot charts is not supported.";Ds.ErrorDialog.ShowError(t)},$e=Js,(Ds.FileExporterView=$e).prototype.SETTINGS=["api","appViewModel"],Es=A=A||{},O.resolveChartColumnFormatAndType=function(t,e,n){var i=O.CHARTS_DATA_FORMAT_MAP[e],o=!!O.CHARTS_DATE_FORMAT_MAP[i],s=8===n||9===n,a=11<n&&n<20,r=3<n&&n<10;return 3===n||n<1||19<n?(n=11,i="TO_STRING",t="String"):void 0===(i=o||s||-1===i.indexOf(".")?i:i.split(".")[0])?(console.log("Invalid format: "+i+" or kdbType: "+n+". Exporting with default formats as String type"),i="",t="String"):("String"===t?i="":(!a||"Number"!==t&&o)&&(a||!o&&"Date"!==t)?"Number"!==t||r||(t="String"):(t="String",i="",console.log("!ExportTools format mismatch, using default format.Params, value kdbType : "+n+", col type: "+t+", format: "+e)),"Date"===t&&o&&(t=O.getTemporalTypeFromFormat(i)),0===i.indexOf("SmartNumber")&&(t="String")),{dataType:t=1===n?"Boolean":t,dataFormat:i,dataKdbType:n}},O.getExportFileName=function(t,e,n){return t=(t=(t=t&&_.isObject(t)?_.map(t,function(t){t=t.FileNamePart;return(t=null!==t&&!_.isObject(t)?t:"").toString()}).join(""):t)?O.getDefaultExportFileName(t,!0):e||O.getDefaultExportFileName(n,!1)).replace(/:/g,"-").replace(/[^\w \.\-]/g,"")},O.getDefaultExportFileName=function(t,e){function n(t){return t=1===(t=""+t).length?"0"+t:t}var i=new Date,o=i.getMonth()+1,s=i.getDate(),a=i.getHours(),r=i.getMinutes(),l=i.getSeconds();return e?t.replace(/{{now}}/g,i.getFullYear()+n(o)+n(s)+"_"+n(a)+n(r)+n(l)):(t?t+"_":"")+i.getFullYear()+n(o)+n(s)},O.onQueryChange=function(e,n){var i;e&&(i=e.get("_dataType"),e=e.get("_subscriptionType"),"virtual"===i||"streaming"===e?(n.toggleClass("events-disabled",!0),n.attr("title",t("Full export is not supported in Virtual and Streaming queries"))):(n.toggleClass("events-disabled",!1),n.attr("title",t("Download the full dataset from the server"))))},O.openFileExportDialog=function(t){var e,n={};try{if(!(4<=_.keys(t).length))throw"Incorrect number of FileExport parameters expected 5, got: "+t.length;if(t.configSets&&_.keys(t.configSets).length)n.configSets=t.configSets;else{if(!(t.dataSet&&_.isArray(t.dataSet)&&_.isObject(t.dataSet[0])))throw"Missing or invalid dataSet parameter";if(n.dataSet=t.dataSet,!t.metaData||!_.isArray(t.metaData))throw"Missing or invalid metaData parameter";if(e=t.metaData,!_.every(e,function(t){var e=0===_.difference(_.keys(t),["colId","dataType","dataKdbType","dataFormat","hideTrailingZeroes","prefix","suffix","colName"]).length,t=0<t.dataKdbType&&t.dataKdbType<20&&3!==t.dataKdbType;return e&&t}))throw"Invalid metaData properities.";n.metaData=t.metaData}if(void 0===t.fileFormat||!_.isString(t.fileFormat)||!_.includes([".xlsx",".xls",".csv"],t.fileFormat))throw"Invalid file format property";if(n.fileFormat=t.fileFormat,void 0===t.fileName||!_.isString(t.fileName))throw"Invalid file name property";if(n.fileName=t.fileName,void 0===t.workSheetTitle||!_.isString(t.workSheetTitle))throw"Invalid workSheetTitle property";n.workSheetTitle=t.workSheetTitle,void 0!==t.csvExportDelimiter&&_.isString(t.csvExportDelimiter)&&(n.csvExportDelimiter=t.csvExportDelimiter),n.actions=t.actions||[],n.selectedDashboard=t.selectedDashboard||{},new Es.FileExport(n).showDialog()}catch(t){console.error("FileConverterTools validation error: ",t)}},O.getTemporalTypeFromFormat=function(t){var e,n="";return t&&(e=!!/[M,Y,D,d,Q]/.test(t),t=!!/[H,h,k,m,S,s]/.test(t),e?n=t?"DateTime":"Date":t&&(n="Time")),n},O.regExValidateColumnIDs=function(t,e){var t=0==t.indexOf("/")?t.substring(1):"^"+t.replace(/\*/g,"(.*)")+"$",n=new RegExp(t);return _.filter(e,function(t){return t.match(n)})},O.FileExporterView=Es.FileExporterView,O.CHARTS_DATETIME_FORMAT_MAP={"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ss","YYYY-MM-DD hh:mm:ss":"YYYY-MM-DD hh:mm:ss","YYYY-MM-DD kk:mm:ss":"YYYY-MM-DD kk:mm:ss","YYYY-MM-DD HH:mm:ss.SSS":"YYYY-MM-DD HH:mm:ss.SSS","YYYY-MM-DD HH:mm:ss.SSSSSS":"YYYY-MM-DD HH:mm:ss.SSSSSS","YYYY-MM-DD HH:mm:ss.SSSSSSSSS":"YYYY-MM-DD HH:mm:ss.SSSSSSSSS"},O.TIME_FORMAT_MAP={"HH:mm":"HH:mm","HH:mm:ss":"HH:mm:ss","hh:mm:ss":"hh:mm:ss","kk:mm:ss":"kk:mm:ss","hh:mm:ss.SS":"hh:mm:ss.SS","HH:mm:ss.SSS":"HH:mm:ss.SSS","HH:mm:ss.SSSSSS":"HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS":"HH:mm:ss.SSSSSSSSS","mm:ss":"mm:ss","kk:mm":"kk:mm","mm:ss.SS":"mm:ss.SS","mm:ss.SSS":"mm:ss.SSS","mm:ss.SSSSSS":"mm:ss.SSSSSS","mm:ss.SSSSSSSSS":"mm:ss.SSSSSSSSS",ss:"ss","ss.SSS":"ss.SSS","ss.SSSSSS":"ss.SSSSSS","ss.SSSSSSSSS":"ss.SSSSSSSSS"},O.DATE_FORMAT_MAP={"YYYY-MM-DD":"YYYY-MM-DD","DD.MM.YYYY":"DD.MM.YYYY","YYYY-MMM-DD":"YYYY-MMM-DD","YYYY-MMMM-DD":"YYYY-MMMM-DD","YYYY-MM":"YYYY-MM","YYYY-MMM":"YYYY-MMM","YYYY-MMMM":"YYYY-MMMM","MM/DD/YYYY":"MM/DD/YYYY","DD/MM/YYYY":"DD/MM/YYYY","D/M/YYYY":"D/M/YYYY","M/D/YYYY":"M/D/YYYY","D/M/YY":"D/M/YY","M/D/YY":"M/D/YY","D MMM":"D MMM","D MMM YYYY":"D MMM YYYY","MMM D":"MMM D","MMM DD":"MMM DD","MMM Do":"MMM Do","MMM D, YYYY":"MMM D, YYYY","MM/YYYY":"MM/YYYY","M/YY":"M/YY","MMM YYYY":"MMM YYYY"},O.CHARTS_DATE_FORMAT_MAP=_.extend({},O.DATE_FORMAT_MAP,O.TIME_FORMAT_MAP,O.CHARTS_DATETIME_FORMAT_MAP),O.CHARTS_NUMBERS_FORMAT_MAP={"no decimal":"0","No Decimal Point":"0",0:"0",1:"#0.0","1 decimal":"#0.0","1 Decimal Points":"#0.0",2:"#0.00","2 decimal":"#0.00","2 Decimal Points":"#0.00",3:"#0.000","3 decimal":"#0.000","3 Decimal Points":"#0.000",4:"#0.0000","4 decimal":"#0.0000","4 Decimal Points":"#0.0000",5:"#0.00000","5 Decimal Points":"#0.00000",6:"#0.000000","6 Decimal Points":"#0.000000","no decimal + seperator":"#,##0","1 decimal + seperator":"#,##0.0","2 decimal + seperator":"#,##0.00","3 decimal + seperator":"#,##0.000","4 decimal + seperator":"#,##0.0000","Smart Number":"SmartNumber",Logarithmic:"","no format":""},O.CHARTS_DATA_FORMAT_MAP=_.extend({},O.CHARTS_DATE_FORMAT_MAP,O.CHARTS_NUMBERS_FORMAT_MAP),Es.ExportTools=O,s=A=A||{},ta.buildDocumentSync=function(i,o){return function(t,e,n){if(e.get("isDemo"))o.apply(e,[t,e,n]);else switch(t){case"read":i.read(e.get("id")).then(function(t){n.success&&n.success(t)});break;case"update":e.set("thumb",e.get("thumb")?e.get("thumb"):""),e.get("notSavedYet")?(delete e.attributes.notSavedYet,i.create(e.attributes).then(function(t){n.success&&n.success(t)})):i.update(e.attributes).then(function(t){n.success&&n.success(t)});break;case"delete":i.delete(e.get("id")).then(function(t){n.success&&n.success(t)});break;default:throw"data operation not supported for Document"}}},ta.buildDocumentCollectionSync=function(i){return function(t,e,n){if("read"!==t)throw"data operation not supported for DashCollection";i.readAll().then(function(t){n.success&&n.success(t.map(function(t){return t.data||t}))})}},s.DocumentSyncHelpers=ta,Ps=A=A||{},B.initMultiClient=function(p,e){function o(){var t=p.get("documents").get(e.get("selectedDocumentId"));return!(!t||!t.get("isDemo"))}var d=this;B.originalGetQ||(B.originalGetQ=Ps.DashClient.getQueryData2,B.originalGetA=Ps.DashClient.runAnalytic2);Ps.DashClient.getQueryData2=function(s,a,r,l,u,c,t,e,n){o()?B.originalGetQ.call(Ps.DashClient,s,a,r,l,u,c,t,e,n):"kdb"===s&&r===Ps.KdbQuery.isSqlSupported?u({rows:[{boolean:!0}]},null):r===Ps.KdbQuery.getTables?d.getAssemblyInfoCached(p).then(function(t){u({rows:[B.getAvailableTableNames(t,!0)]},null)}):d.getAssemblyInfoCached(p).then(function(t){var n=void 0;if("q"===s){if(!a)return void c("Select a target");var n="qsql",e=Ps.DashClient.parametersToString(l),e=(e&&(r=r+"["+e+"]"),a.split("|")),i=e[0],e=e[1],o={query:r,assembly:i,target:e}}else o="sql"===s?(n="sql",{query:r=Ps.DocumentDataModel.prototype.toSQLString(r,l)}):d.convertParamsToJson(t,l);p.get("getData")(o,n).then(function(t){if(t.error)c(t.error);else{var e=t.table;if(e)u(e,null,o);else{e=t.arrayBuffer,t=void 0;try{t=Ps.deserialize(e)}catch(t){throw"Unsupported type"===t&&c(t="Unable to deserialize, check syntax"),t}"sql"===n&&(t=t.values[1]),u(t,e,o)}}},function(t){c(t||"qe API call failed")})})},Ps.DashClient.runAnalytic2=function(s,t,a,r,l,e,n,i){o()?B.originalGetA.call(Ps.DashClient,s,t,a,r,l,e,n,i):s===Ps.KdbQuery.getFunctions?r&&r({qtype:101},new ArrayBuffer(0)):s===Ps.KdbQuery.executeSql&&a&&1===a.length?Ps.DashClient.getQueryData2("sql","sql",a[0].value,null,r,l,e,n,i):d.getAssemblyInfoCached(p).then(function(t){var n,e=!1,i=void 0,o=void 0;"getData"===s?e=!0:(e=_.map(_.get(t,"0.api",[]),"api").includes(s),i="api",o=s),e?(n=d.convertParamsToJson(t,a),p.get("getData")(n,i,o).then(function(t){var e;t.error?l(t.error):(e=t.table)?r(e,null,n):(e=t.arrayBuffer,t=Ps.deserialize(e),r(t.values[1],e,n))},function(t){l(t||"getData API call failed")})):l("api not available / supported")})}},B.convertParamsToJson=function(t,e){function n(t,o){var s=[];function a(t,e){e=o[e];if(e){var n=t,i=n.match(Ps.RTTI.REGEX_ROLLING);if(i||n.match(/\d\d\d\d[\.\-]\d\d[\.\-]\d\d[DT ]\d/)){if(i)switch(n=Ps.Helpers.convertRollingToDate(n,e),e){case"timespan":n=n.substr(11,18);break;case"time":n=n.substr(11,12);break;case"second":n=n.substr(11,8);break;case"minute":n=n.substr(11,5)}else n=_.trim(n.replace("D"," ").replace("Z","")),n=Ps.Tools.convertUserInputToMoment(n,void 0).toDashString();n=n.replace("T"," ").replace("Z","")}return n}return i=t,i=_.includes(["true","false","1b","0b"],i)?"true"===i||"1b"===i:i}return _.each(t,function(t){var n,i,e=t.split(/[`;]+/).filter(Boolean),o=e[0];_.includes(["in","within","<",">","like","not","<=",">=","="],o)&&(n=e[1],i=e[2],_.includes(["in","within"],o)?(e=t.match(/[\w<>=]+;[\w\- ]+;(.+)/))&&e[1]&&(i=(i=e[1]).replace(/[\(\)\[\]]/g,"").split(/[ ,;`]+/),_.each(i,function(t,e){i[e]=a(t,n)})):i=a(i,n),s.push([o,n,i]))}),s}var o={},s={},a=void 0,e=(_.each(e,function(t){var e,i;"list"===t.type?"labels"===t.name?(_.each(t.value,function(t){t=t.split(/[:,;]/);s[t[0]]=t[1]||""}),_.extend(o,s)):"filter"===t.name?_.isEmpty(t.value)||(a=t.value):"agg"===t.name?_.isEmpty(t.value)||(e=t.value,i=[],_.each(e,function(t){var t=t.split(/[`;]+/).filter(Boolean),e=t[0],n=t[1],t=t[2];_.includes(["count","first","last","sum","prd","min","max","all","any","var","avg","wsum","wavg","var","dev","cov","cor","svar","sdev","scov"],n)&&i.push([e,n,t])}),e=i,_.isEmpty(e))||(o[t.name]=e):_.isEmpty(t.value)||(o[t.name]=t.value):_.isNil(t.value)||""===t.value||(o[t.name]="timestamp"===t.type?t.value.replace("Z",""):t.value)}),o.table);return e&&a&&(t=B.getTemporalColumnMeta(t,e,s),e=n(a,t),_.isEmpty(e)||(o.filter=e)),Ps.Log.Log("getData params",o),o},B.getAssemblyInfoCached=function(t){var i,o=B;return o.cachedAssemblyInfo?Promise.resolve(o.cachedAssemblyInfo):o.pendingAssemblyInfoPromise||(i=new Promise(function(e,n){t.get("getAssemblyInfo")().then(function(t){i===o.pendingAssemblyInfoPromise&&(0<B.getAvailableTableNames(t).length&&(o.cachedAssemblyInfo=t),o.pendingAssemblyInfoPromise=void 0,e(t))}).catch(function(t){n(t)})}),o.pendingAssemblyInfoPromise=i)},B.getTemporalColumnMeta=function(t,e,n){var i={},t=_.filter(t,function(t){return _.has(t.tableSchemas,e)});return 1===(t=1<t.length?_.filter(t,function(t){return _.find([t.assemblyLabels],n)}):t).length&&_.each(t[0].tableSchemas[e].columns,function(t){var e=B.getTemporalTypeString(Math.abs(t.typ));e&&(i[t.column]=e)}),i},B.getTemporalTypeString=function(t){return{12:"timestamp",13:"month",14:"date",15:"datetime",16:"timespan",17:"minute",18:"second",19:"time"}[t]},B.getAvailableTableNames=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!1);var i=[];return(t||[]).forEach(function(t){_.each(t.tableSchemas,function(t,e){i.push(e),n&&t.columns.forEach(function(t){return i.push(t.column)})})}),e?i.reduce(function(t,e){return t[e]=e,t},{}):i},B.addTimeRangeAggFnParams=function(t){return _.each(t,function(t){!_.includes([".kxi.getData",".kxi.ping"],t.api)&&_.isArray(_.get(t,"metadata.params"))&&(t.metadata.params.unshift({name:"startTS",type:-12,isReq:!1,description:"Inclusive start time for period of interest."},{name:"endTS",type:-12,isReq:!1,description:"Exclusive end time for period of interest."}),t.metadata.params.push({name:"aggFn",type:-11,isReq:!1,description:"Agg function (optional)"}))}),t},B.modifyAPI=function(t){var n=t.get("getAssemblyInfo"),s=t.get("getData");t.set("getAssemblyInfo",function(t){return void 0===t&&(t=!1),new Promise(function(e){_.isFunction(n)?n(t).then(function(n){var i=_.keys(_.get(n,"rc[0].labels[0]",{})),o=(0===n.api.length&&(n.assembly.push({assembly:B.GETDATA_API_DUMMY_ASSEMBLY_NAME}),n.api=_.cloneDeep(B.GETDATA_API_SNAPSHOT),n.api[0].isMissing=!0),B.addTimeRangeAggFnParams(n.api)),t=_.map(n.assembly,function(t){var e=t.assembly;return{confirmPassword:"",database:"",dapInstances:_.map(_.filter(n.dap,function(t){return t.assembly===e}),"instance"),dbtype:"json",host:"",name:e,password:"",port:"",tls:"",type:"api",user:"",tableSchemas:_.keyBy(_.filter(n.schema,function(t){return _.includes(t.assembly,e)}),"table"),assemblyLabels:_.pick(t,i),api:o}});e(t)}):e([])})},{silent:!0}),t.set("getData",function(n,i,o){return new Promise(function(e,t){_.isFunction(s)?s(n,i,o).then(function(t){e({error:t.error||"",table:t.table,arrayBuffer:t.arrayBuffer})},t):e(null)})},{silent:!0})},B.resetAssemblyInfoCache=function(){B.cachedAssemblyInfo=void 0,B.pendingAssemblyInfoPromise=void 0},B.GETDATA_API_DUMMY_ASSEMBLY_NAME="GETDATA_API_DUMMY_ASSEMBLY",B.GETDATA_API_SNAPSHOT=[{api:".kxi.getData",aggFn:".sgagg.getData",custom:!1,full:!0,metadata:{description:"Get timeseries and splayed data from data access processes.",params:[{name:"table",type:-11,isReq:!0,description:"Table to select from."},{name:"startTS",type:-12,isReq:!1,description:"Inclusive start time for period of interest."},{name:"endTS",type:-12,isReq:!1,description:"Exclusive end time for period of interest."},{name:"filter",type:0,isReq:!1,default:"",description:"Custom filter."},{name:"groupBy",type:[-11,11],isReq:!1,default:"",description:"Column(s) to determine aggregation grouping"},{name:"agg",type:[-11,11,0],isReq:!1,default:"",description:"Column(s) to return or aggregations to perform (where ` returns all columns)."},{name:"sortCols",type:[-11,11],isReq:!1,default:"",description:"Column names to sort response payload on."},{name:"slice",type:[18,19],isReq:!1,default:"",description:"Timerange to grab from each date in request range"},{name:"fill",type:-11,isReq:!1,default:"",description:"Fills option to apply to null data"},{name:"temporality",type:-11,isReq:!1,default:"",description:"How to interpret time range, as continuous or as slice"}],return:{type:0,description:"Triple consisting of sort columns (symbol[]), return columns (symbol[]), and table data (table)"},misc:{safe:!0},aggReturn:{type:98,description:"Returns the raze of the tables."}},procs:[]}],Ps.CustomAPIHelpers=B,A.BigInteger=et.BigInteger;c={language:$.cookie("dashboard-language")||"en",logLevel:$.cookie("dashboard-log-level")||1,theme:$.cookie("dashboard-theme")||"kx-darkroom",viewerTheme:$.cookie("dashboard-viewer-theme")||"kx-darkroom"};return $.cookie("dashboard-language",c.language,{expires:30,path:"/",secure:"https:"===_.get(window,"location.protocol")}),$.cookie("dashboard-log-level",c.logLevel,{expires:30,path:"/",secure:"https:"===_.get(window,"location.protocol")}),$.cookie("dashboard-theme",c.theme,{expires:30,path:"/",secure:"https:"===_.get(window,"location.protocol")}),$.cookie("dashboard-viewer-theme",c.viewerTheme,{expires:30,path:"/",secure:"https:"===_.get(window,"location.protocol")}),_.extend(m.History.prototype,{decodeFragment:function(t){return t}}),A});