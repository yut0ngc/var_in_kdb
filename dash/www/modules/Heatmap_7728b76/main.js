define(["Handlebars","echarts","QuickBase","moment","xlsx","backbone","css!./css/app.css"],function(d,a,u,l,A,i){"use strict";var r,o,e=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,o=1,a=arguments.length;o<a;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},V=(o=i.DeepModel,e(n,o),n.prototype.setBreakdown=function(e){this.breakdownCol=e},n.prototype.setTreeMapOpts=function(e){var t=this.get("NodeLabel"),o=t.Show,a=t.BorderColor,r=t.BorderWidth,i=t.gapWidth,n=t.upperLabel,l=t.upperLabelColour,s=t.labelColor,p=t.upperLabelHeight,c=t.upperFontSize,t=(t.MinValue,t.MaxValue,this.get("ColorPalette")),u=t.FixedColor,t=t.HoverColor,h=this.get("GroupBy").headerColor,d=this.get("Animation");return{series:[{animation:d.Duration,animationEasing:d.Easing,breadcrumb:{show:!1},data:e,emphasis:{itemStyle:{color:""===t?null:t}},height:"100%",itemStyle:{normal:{borderColor:h}},label:{color:s,show:o},levels:[{color:[u]},{itemStyle:{normal:{borderColor:a,borderWidth:r,gapWidth:_.clone(i)}}}],nodeClick:"false",roam:"false",type:"treemap",upperLabel:{normal:{color:l,fontSize:c,height:p,show:n}},width:"100%"}]}},n.prototype.getPaletteColor=function(e,t,o){var a,r,i,n,l,s,p,c,u,h,d,m,g,y,f,b,C,S=this.get("ColorPalette"),v=S.ColorScheme,x=S.ColorType,D=S.FixedColor,S=this.get("NodeLabel").Scale,w=_.clone(v);return"Fixed"===x?(y=_.map(this.treeData,function(e){return{type:D}}),a=_.map(y,"type")):"Iterative Children"===x?(y=_.map(this.treeData,function(e){return{type:w[t%w.length].type}}),a=_.map(y,"type")):"Iterative"===x?(a=[],_.each(this.treeData,function(e,t){a.push(w[t%w.length].type)}),a=_.reverse(a)):"Scaled"===x?(r="{breakdownId}"===e.Size?this.breakdownCol:e.Size,i="{breakdownId}"===e.Color?this.breakdownCol:e.Color,g=_.map(this.treeData,function(e){return{color:isNaN(parseFloat(e.get(i)))?0:parseFloat(e.get(i)),size:isNaN(parseFloat(e.get(r)))?0:parseFloat(e.get(r))}}),n=this.getMinVal(g,"color"),l=this.getMaxVal(g,"color"),g=S?_.reverse(_.sortBy(g,"size")):_.reverse(g),a=n===l?D:_.map(g,function(e){return k.getHexSaturation(D,(e.color-n)/(l-n))})):"Gradient"===x?(s="{breakdownId}"===e.Size?this.breakdownCol:e.Size,p="{breakdownId}"===e.Color?this.breakdownCol:e.Color,v=this.treeData,g=_.map(v,function(e){return{color:isNaN(parseFloat(e.get(p)))?0:parseFloat(e.get(p)),size:isNaN(parseFloat(e.get(s)))?0:parseFloat(e.get(s))}}),c=this.getMinVal(g,"color"),u=this.getMaxVal(g,"color"),o&&(g=this.getGrouping(g,o,p,s)),h=_.map(w,"type"),g=S?_.reverse(_.sortBy(g,"size")):_.reverse(g),a=_.map(g,function(e){e=.99<(e=(e.color-c)/(u-c))?.99:e,e=isNaN(e*h.length)?0:Math.floor(e*h.length);return h[e]})):"Gradient Percentage"===x&&(d="{breakdownId}"===e.Size?this.breakdownCol:e.Size,m="{breakdownId}"===e.Color?this.breakdownCol:e.Color,g=_.map(this.treeData,function(e){return{color:isNaN(parseFloat(e.get(m)))?0:parseFloat(e.get(m)),size:isNaN(parseFloat(e.get(d)))?0:parseFloat(e.get(d))}}),y=this.get("NodeLabel"),f=y.MinValue,b=y.MaxValue,o&&(g=this.getGrouping(g,o,m,d)),C=_.map(w,"type"),g=_.reverse(_.sortBy(g,"size")),a=_.map(g,function(e){return C[Math.floor((e.color-f)/(b-f)*(C.length-1))]})),this.getHighlightRules(a,e,t)},n.prototype.getHighlightRules=function(e,t,l){var s=this,o=t.HighlightRules,p=e,c=[],u=this.get("NodeLabel").Scale;return _.each(o,function(o,e){var e=s.get("Data."+l+".HighlightRules."+e),a=e.BackgroundColor,r=e.ConditionOperator,i=e.ConditionSource,n=e.ConditionValue,e=u?_.sortBy(s.treeData,[function(e){return parseFloat(e.get(t.Size))}]):s.treeData;_.each(_.reverse(e),function(e,t){c[t]||c.push(_.isString(p)?p:p[t]),c[t]=k.getConditionResult(e.get("{breakdownId}"===i?s.breakdownCol:i),n,r,o.Inverse)?s.blendColors(c[t],a,o.Opacity/100):c[t]})}),0===c.length?e:c},n.prototype.getTreeData=function(e,t){var n,a,l=this,o=this.get("NodeLabel"),s=o.Scale,o=o.customLabel,p=this.get("ColorPalette").ColorType,r=this.collection.models[0].get("GroupBy"),i=r.UseGroupBy,c=r.ShowHeader,u=r.GroupByColumns,h=r.ScaleByChildren;return this.treeData=t,n=void 0!==o&&""!==o?d.compile(o):function(e){},i?(a=t.map(function(e){e=e.get(u);return l.setGeneralFormat(e)}).filter(function(e,t,o){return o.indexOf(e)===t}),_.map(e,function(r,o){var i=2*Math.abs(_.min(_.map(t,function(e){return parseFloat(e.get(r.Size))})));return{children:_.map(a,function(a){return{children:_.map(t,function(e,t){return l.getNodeObject(s,e,t,r,l.breakdownCol,p,n,u,a,i,o)}),color:l.getPaletteColor(r,o,a),name:a,upperLabel:{show:c},value:h?_.reduce(t,function(e,t,o){return e+l.getNodeValue(s,t,r.Size,l.breakdownCol,p,u,a,i)},0):1}}),name:r.Name,value:1}})):_.map(e,function(o,a){var r=2*Math.abs(_.min(_.map(t,function(e){return parseFloat(e.get(o.Size))})));return{children:_.map(t,function(e,t){return l.getNodeObject(s,e,t,o,l.breakdownCol,p,n,void 0,void 0,r,a)}),color:l.getPaletteColor(o,a,null),name:o.Name,value:1}})},n.prototype.setFormat=function(e){var t=this.get("NodeLabel"),o=t.Format,a=t.Precision,r=t.HideTrailingZeroes,i=t.PieceLabelRender,n=t.Prefix,t=t.Suffix;return n+k.getFormatter(o,a,r,i)(e)+t},n.prototype.blendColors=function(e,t,o){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),e=[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)],t=[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)],a=[];return a[0]=Math.round(t[0]*o+e[0]*(1-o)),a[1]=Math.round(t[1]*o+e[1]*(1-o)),a[2]=Math.round(t[2]*o+e[2]*(1-o)),"#"+this.componentToHex(a[0])+this.componentToHex(a[1])+this.componentToHex(a[2])},n.prototype.componentToHex=function(e){e=e.toString(16);return 1===e.length?"0"+e:e},n.prototype.getGrouping=function(e,t,o,a){this.treeData;var r="{breakdownId}"===(r=this.get("GroupBy.GroupByColumns"))?this.breakdownCol:r,i=_.filter(this.treeData,function(e){return e.get(r)===t});return _.map(i,function(e){return{color:isNaN(parseFloat(e.get(o)))?0:parseFloat(e.get(o)),size:isNaN(parseFloat(e.get(a)))?0:parseFloat(e.get(a))}})},n.prototype.getMinVal=function(e,t){e=_.minBy(e,function(e){return e[t]});return _.get(e,t)?_.get(e,t):null},n.prototype.getMaxVal=function(e,t){e=_.maxBy(e,function(e){return e[t]});return _.get(e,t)?_.get(e,t):null},n.prototype.getNodeValue=function(e,t,o,a,r,i,n,l){return void 0!==i?this.setGeneralFormat(t.get(i))===n?this.getNodeValue(e,t,o,a,r,void 0,void 0,l):0:e||"Scaled"===r?(this.get("NodeLabel.ShowAbsolute")?l:0)+parseFloat(t.get(this.getColumn(o,a))):1},n.prototype.getNodeObject=function(e,t,o,a,r,i,n,l,s,p,c){p=this.getNodeValue(e,t,a.Size,r,i,l,s,p);return{displayVal:this.getNodeValue(e,t,a.Size,r,i,l,s,0),id:o,label:{formatter:n(t.attributes)},name:this.setFormat(t.get(this.getColumn(a.Column,r))),parentId:c,value:p}},n.prototype.setGeneralFormat=function(e){return k.getFormatter("General",void 0,void 0,void 0)(e)},n.prototype.getColumn=function(e,t){return"{breakdownId}"!==e?e:t},n);function n(){var e=null!==o&&o.apply(this,arguments)||this;return e.colorCache={},e.columns=[],e.labels=[],e.labelData=[],e.previousChartData={},e.chartType="treeMap",e}p=i.Collection,e(c,p),c.prototype.modelId=function(e){return e};var p,R=c;function c(){var e=null!==p&&p.apply(this,arguments)||this;return e.model=V,e}h.sourceKey=function(e){return e.getPath()},h.mergeChanges=function(t,o,e,a,r,i){return e&&(t=_.fromPairs(_.map(e,function(e){return[o(e),e]}))),a&&_.each(a,function(e){return _.extend(t[o(e)],e)}),r&&_.each(r,function(e){t[o(e)]=e}),i&&_.each(i,function(e){delete t[o(e)]}),t},h.prototype.setFocus=function(e){this.focus=e,this.updateChildren(),this.childDataSource&&this.childDataSource.setFocus(e)},h.prototype.isFocused=function(){return this.focus.length===this.depth&&(0===this.depth||this.source.id===this.focus[this.depth])},h.prototype.getColumnNames=function(){if(this.breakdownColumns&&this.breakdownColumns.length)return[h.BREAKDOWN_ID,this.breakdownColumns[0]].concat(_.difference(_.keys(this.meta),this.breakdownColumns));try{return _.map(this.meta,function(e){return[e.id,e.index]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}catch(e){return _.keys(this.meta)}},h.prototype.getColumnType=function(e){return this.childDataSource?this.childDataSource.getColumnType(e):e===h.BREAKDOWN_ID?this.meta[this.primaryKey].kdbType:this.meta[e]?this.meta[e].kdbType:11},h.prototype.getData=function(){return this.childDataSource?this.childDataSource.getData():this.source.dataSet&&this.source.dataSet.collection},h.prototype.getDepth=function(){return this.childDataSource?this.childDataSource.getDepth():this.depth},h.prototype.getKey=function(){return this.source.cid},h.prototype.getPrimaryKey=function(){return this.childDataSource?this.childDataSource.getPrimaryKey():this.primaryKey},h.prototype.getPropertyFromColumn=function(e){return e===h.BREAKDOWN_ID?this.getPrimaryKey():e},h.prototype.getPath=function(){return this.source.path},h.prototype.getSource=function(){return this.source},h.prototype.hasData=function(){return this.childDataSource?this.childDataSource.hasData():this.hasDataFlag},h.prototype.onData=function(e,t,o){e.primaryKey!==this.primaryKey&&(this.primaryKey=e.primaryKey),this.meta=h.mergeChanges(this.meta,function(e){return e.id},e.columns.reset,e.columns.change,e.columns.add,e.columns.remove),0!==this.depth||_.isEqual(e.breakdownColumns,this.breakdownColumns)||(this.breakdownColumns=e.breakdownColumns,this.removeChild()),t.reset&&0<t.reset.length&&this.removeChild(),o?this.updateError(this,o):this.listener&&this.listener.updateError(this,void 0),this.hasDataFlag=!0,this.updateChildren()&&this.listener.updateDataSource(this)},h.prototype.subscribe=function(){this.api.subscribe(this.source,this.onData.bind(this))},h.prototype.updateDataSource=function(e){this.listener.updateDataSource(this)},h.prototype.updateError=function(e,t){this.listener.updateError(this,t)},h.prototype.unsubscribe=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource),this.api.unsubscribe(this.source)},h.prototype.removeChild=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource)},h.prototype.updateChildren=function(){var e;return!(this.breakdownColumns&&this.breakdownColumns.length&&this.depth<this.breakdownColumns.length-1&&(this.focus.length>this.depth?(this.childDataSource&&this.focus[this.depth]!==this.childDataSource.getSource().id&&this.removeChild(),this.childDataSource||(e=this.source.dataSet&&this.source.dataSet.collection.get(this.focus[this.depth]))&&(this.childDataSource=new h(e,this,this.api,this.focus,this.depth+1,this.breakdownColumns),this.childDataSource.subscribe())):(this.removeChild(),this.focus.length!==this.depth||!this.hasDataFlag||0!==this.depth&&this.focus[this.depth-1]!==this.source.id||this.listener.updateDataSource(this)),1))},h.BREAKDOWN_ID="{breakdownId}";var j=h;function h(e,t,o,a,r,i){this.breakdownColumns=[],this.hasDataFlag=!1,this.focus=[],this.meta={},this.source=e,this.listener=t,this.api=o,this.depth=r||0,this.breakdownColumns=i,this.setFocus(a)}m=i.DeepModel,e(g,m);var m,G=g;function g(){return null!==m&&m.apply(this,arguments)||this}y=i.DeepModel,e(f,y);var y,z=f;function f(){return null!==y&&y.apply(this,arguments)||this}b=i.DeepModel,e(C,b);var b,Y=C;function C(){return null!==b&&b.apply(this,arguments)||this}S=i.DeepModel,e(v,S);var S,K=v;function v(){return null!==S&&S.apply(this,arguments)||this}x=i.DeepModel,e(D,x);var x,W=D;function D(){return null!==x&&x.apply(this,arguments)||this}w.compareKDBTimes=function(e,t){return e.i>t.i?1:e.i<t.i?-1:e.n>t.n?1:e.n<t.n?-1:0},w.expandNestedViewStates=function(e,t){var o=!1,a=Object.keys(e);if(o=1===a.length?(r=t.getPropertyMeta(a[0]))&&"viewstate"===r.type:o){var r=/^((?:\w+\.)*)(\d+)/.exec(a[0]);if(r)return o=r[1].slice(0,-1),a=t.getProperty(o),(r={})[o]=a,r}return e},w.focus2Array=function(e){var t=[],o=/"([^"]*)"/g,e=e.toString?e.toString():"",a=/^\[([^\]]*)]$/.exec(e);if(null!=a){if(/^(?:"[^"\\]*(?:\\[\S\s][^"\\]*)*")(?:,"[^"\\]*(?:\\[\S\s][^"\\]*)*")*/.test(a[1]))for(var r=void 0;null!==(r=o.exec(a[1]));)t.push(_.map(r[1].split(","),function(e){return e.replace(/&#44;/g,",")}))}else t.push(e.split(","));return _.filter(t,function(e){return 0<(""+e).length})},w.getConditionResult=function(e,t,o,a){var i={isMatch:function(e,t){var o,a=!1,r=e.split(/ +and +| +/);for(_.includes(r,"or")&&(r=_.without(r,"or"),a=!0),o=0;o<r.length;o++)0!==r[o].indexOf("-")&&r[o].indexOf("*")<0&&(r[o]="*"+r[o]+"*");return _[a?"some":"every"](r,function(e){return i.isSimpleMatch(e,t)})},isSimpleMatch:function(e,t){var o=!1;return 0===e.indexOf("-")&&(e=e.replace("-",""),o=!0),e=new RegExp("^"+e.replace(/\*/g,".*")+"$").test(t),o?!e:e}},r=!1,n=isNaN(parseFloat(e))?(""+e).toLowerCase():parseFloat(e),l=isNaN(parseFloat(t))?(""+t).toLowerCase():parseFloat(t);switch(o){case"contains":r=0<=n.toString().indexOf(l.toString());break;case"starts with":r=0===n.toString().indexOf(l.toString());break;case"ends with":r=-1!==n.toString().indexOf(l.toString(),n.toString().length-l.toString().length);break;case"==":r=n==l;break;case"<":r=n<l;break;case">":r=l<n;break;case"<=":r=n<=l;break;case">=":r=l<=n;break;case"!=":r=n!==l;break;case"search":r=i.isMatch(l,n);break;case"regexp":r=new RegExp(t.toString()).test(e.toString())}return r=a?!r:r},w.getHexSaturation=function(e,t){var o,e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),a=parseInt(e[1],16),r=parseInt(e[2],16),i=parseInt(e[3],16),e=Math.max(a,r,i),n=Math.min(a,r,i),l=e,s=e-n;if(e===n)o=0;else{switch(e){case a:o=(r-i)/s+(r<i?6:0);break;case r:o=(i-a)/s+2;break;case i:o=(a-r)/s+4}o/=6}n=.2+.8*t;var e=Math.floor(6*o),t=6*o-e,p=l*(1-n),c=l*(1-t*n),u=l*(1-(1-t)*n);switch(e%6){case 0:a=l,r=u,i=p;break;case 1:a=c,r=l,i=p;break;case 2:a=p,r=l,i=u;break;case 3:a=p,r=c,i=l;break;case 4:a=u,r=p,i=l;break;case 5:a=l,r=p,i=c}return a=parseInt(a.toString(),10),r=parseInt(r.toString(),10),i=parseInt(i.toString(),10),"#"+this.componentToHex(a)+this.componentToHex(r)+this.componentToHex(i)},w.getSaturatedArray=function(e){var s,p,c=this,e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),t=parseInt(e[1],16),o=parseInt(e[2],16),a=parseInt(e[3],16),e=Math.max(t,o,a),r=Math.min(t,o,a),u=e,i=e-r;if(e===r)s=0;else{switch(e){case t:s=(o-a)/i+(o<a?6:0);break;case o:s=(a-t)/i+2;break;case a:s=(t-o)/i+4}s/=6}var h=[];return _.each([.2,.28,.36,.44,.52,.6,.68,.76,.84,.92,.1],function(e){p=e;var t,o,a,e=Math.floor(6*s),r=6*s-e,i=u*(1-p),n=u*(1-r*p),l=u*(1-(1-r)*p);switch(e%6){case 0:t=u,o=l,a=i;break;case 1:t=n,o=u,a=i;break;case 2:t=i,o=u,a=l;break;case 3:t=i,o=n,a=u;break;case 4:t=l,o=i,a=u;break;case 5:t=u,o=i,a=n}t=parseInt(t,10),o=parseInt(o,10),a=parseInt(a,10),h.push("#"+c.componentToHex(t)+c.componentToHex(o)+c.componentToHex(a))}),h},w.componentToHex=function(e){e=e.toString(16);return 1===e.length?"0"+e:e},w.getFormatter=function(a,r,i,n){return"Number"===a||"Formatted Number"===a||"Smart Number"===a||"Datetime"===a||"Currency"===a||"SmartCurrency"===a?function(e){var t,o=e;if(null==(e="Smart Number"!==a&&"Formatted Number"!==a||_.isNumber(e)?e:_.isNumber(parseFloat(e))?parseFloat(e):e))return"";if("Smart Number"===a)o=_.isNumber(e)?L.smartFormatNumber(e,r):_.escape(e);else{if("Datetime"===a)return t=e,(l.isMoment(e)||l.isDuration(e)?e:L.isKDBTemporal(e)?L.convertKDBTemporalToMoment(e):("number"==typeof e&&(t=new Date(e)),L.convertDateStringValueToMoment(t.toString()))).format(n);o="Formatted Number"===a&&e.toFixed?L.formatNumber(e,r):e.toFixed?e.toFixed(r):_.escape(o)}if(i&&0<=o.toString().indexOf(".")){for(;"0"===o[o.length-1];)o=o.slice(0,-1);"."===o[o.length-1]&&(o=o.slice(0,-1))}return o}:"General"===a?function(e){return l.isMoment(e)||l.isDuration(e)?e.format():e}:"Boolean"===a?function(e){return _.escape(e)}:void 0},w.pump=function(o){var e,a,r;if(null!=o&&void 0!==o)return!_.isObject(o)||(e=Object.getPrototypeOf(o),_.isObject(o)&&e!==Object.prototype&&e!==Array.prototype)?o:e===Array.prototype?o.map(w.pump):(a=/^(\d+)((?:\.\w+)+)$/,Object.keys(o).every(function(e){return a.test(e)})?Object.keys(o).map(function(e){var t=a.exec(e);return{index:Number(t[1]),tail:t[2].substring(1),value:o[e]}}).reduce(function(e,t){var o={};return o[t.index]={},o[t.index][t.tail]=t.value,$.extend(!0,e,w.pump(o))},[]):(r={greedy:/^(\w+)((?:\.\w+)*)$/,nonGreedy:/^(\w+)((?:\.\w+)+)$/},Object.keys(o).some(function(e){return r.nonGreedy.test(e)})?Object.keys(o).map(function(e){var t=r.greedy.exec(e);return{head:t[1],tail:""!==t[2]?t[2].substring(1):null,value:o[e]}}).reduce(function(e,t){var o={};return null!==t.tail?(o[t.head]={},o[t.head][t.tail]=t.value):o[t.head]=t.value,$.extend(!0,e,w.pump(o))},{}):_.mapValues(o,w.pump)))},w.replaceViewStatesWithValue=function(e,t,o){return w.replaceViewStates(e,t,function(e,t,o,a){return a.value},o)},w.replaceViewStatesWithModel=function(e,t,r){return w.replaceViewStates(e,t,function(e,t,o,a){return o instanceof i.Model&&o.get("_viewType")?o:(e=r.getProperty(e)[t],_.isUndefined(o)?void 0:(e.get("value")!==o&&e.set("value",o),e))},r)},w.safeHandle=function(o){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{o.apply(this,e)}catch(e){}}},w.alpha=function(e,t){return new Color(e).alpha(t/100).rgbaString()},w.replaceViewStates=function(o,e,l,s){var p=function(e,t){return function o(e,t,a){a=a?a+".":"";t+="";var r=s.getPropertyMeta(a+t);{var i,n;return r&&"data"===r.type?e:r&&"viewstate"===r.type?(n=(a+t).split("."),i=n.pop(),n=n.join("."),l(n,i,e,r)):!_.isArray(e)&&!_.isObject(e)||e.has&&e.has("_dataSource")&&e.has("_dataType")?e:(a+=t,p=function(e,t){return o(e,t,a)},(c=_.isArray(e)?_.map:_.mapValues)(e,p))}}(e,t,o||"")},c=_.isArray(e)?_.map:_.mapValues;return c(e,p)};var k=w;function w(){}var E={Trigger:{default:"Click",enum:["Click","Hover","Double Click"],propertyOrder:2,title:"Trigger Action",type:"string"},TriggerColumn:{default:"",enumSource:"possible_columns",propertyOrder:1,title:"Trigger Column",type:"string",watch:{possible_columns:"root.possibleLabels"}}},F=(O.getSchemes=function(){return{"blue green":[{type:"#5680bf"},{type:"#5792bd"},{type:"#629fc7"},{type:"#63b0c7"},{type:"#63c7c7"},{type:"#65c2af"},{type:"#54bf9d"},{type:"#5dbd86"},{type:"#69bf74"},{type:"#67b860"}],default:[{type:"#0061FF"},{type:"#F23A66"},{type:"#009BAB"},{type:"#7647CC"},{type:"#FFC300"},{type:"#9FA3A6"},{type:"#003A99"},{type:"#A90B31"},{type:"#005D67"},{type:"#452481"}],"green blue":[{type:"#67b860"},{type:"#69bf74"},{type:"#5dbd86"},{type:"#54bf9d"},{type:"#65c2af"},{type:"#63c7c7"},{type:"#63b0c7"},{type:"#629fc7"},{type:"#5792bd"},{type:"#5680bf"}],"green red":[{type:"#63BE7B"},{type:"#86C97E"},{type:"#A9D27F"},{type:"#CCDD82"},{type:"#EEE683"},{type:"#FEDC81"},{type:"#FCBF7B"},{type:"#FBA276"},{type:"#F98570"},{type:"#F8696B"}],"green yellow":[{type:"#83c478"},{type:"#8ad67c"},{type:"#97e388"},{type:"#b1e396"},{type:"#cbe396"},{type:"#e2e398"},{type:"#e8de88"},{type:"#ebdc6c"},{type:"#f2df4b"},{type:"#f7da36"}],"red green":[{type:"#F8696B"},{type:"#F98570"},{type:"#FBA276"},{type:"#FCBF7B"},{type:"#FEDC81"},{type:"#EEE683"},{type:"#CCDD82"},{type:"#A9D27F"},{type:"#86C97E"},{type:"#63BE7B"}],"yellow green":[{type:"#f7da36"},{type:"#f2df4b"},{type:"#ebdc6c"},{type:"#e8de88"},{type:"#e2e398"},{type:"#cbe396"},{type:"#b1e396"},{type:"#97e388"},{type:"#8ad67c"},{type:"#83c478"}]}},O.getComponentDefinition=function(e){var t,o,a={appArgs:{quickStart:[{path:"Basics.Data",message:"populate Data Source"}],json:{Animation:{Duration:1500,Easing:"quinticInOut"},Basics:{Actions:[],Data:"",Focus:"",Selected:"",SelectedAttr:"",Theme:"Dark"},ColorPalette:{ColorScheme:O.getSchemes()["red green"],ColorType:"Fixed",FixedColor:"#0061FF",HoverColor:"",SelectedColor:"",SelectedColorScheme:"red green"},Data:[{Color:"",Column:"",HighlightRules:[],Name:"",Size:""}],FileExport:{FileName:[],ShowExportCsvButton:!1,ShowExportExcelButton:!1,ShowScreenshot:!1,Actions:[]},GroupBy:{GroupByColumns:"",ScaleByChildren:!1,ShowHeader:!1,UseGroupBy:!1,headerColor:"#ffffff"},NodeLabel:{BorderColor:"#f0f0f0",BorderWidth:2,DateFormat:"HHHH-MM-DD",Format:"General",HideTrailingZeros:!1,MaxValue:100,MinValue:0,Precision:0,Prefix:"",Scale:!0,Show:!0,ShowAbsolute:!1,ShowLegend:!0,Suffix:"",customLabel:"",gapWidth:2,labelColor:"#ffffff",upperFontSize:"12",upperLabel:!1,upperLabelColour:"#000",upperLabelHeight:"15"},Tooltip:{ShowTooltip:!0,TooltipTemplate:'<table><thead><tr style="padding-right: 10px;"><th>{{_name}}</th><th></th></tr></thead><tr><td><svg style="padding: 0 5px; vertical-align: middle;" width="12" height="12"><rect width="12" height="12"style="fill: {{_color}} ;stroke-width:3;stroke: {{_color}}"></rect></svg>{{_label}}:</td><td style="padding-right: 10px; text-align: left;"><span style="padding-left:10px">{{_value}}</span></td></tr></table>'},possibleColumns:[""],possibleLabels:[""],version:"4.7.5"},schema:{notificationEvent:{default:["sym"],format:"table",items:{type:"string"},options:{collapsed:!0,hidden:!0},type:"array"},properties:{possibleColumns:{default:["sym"],format:"table",items:{type:"string"},options:{collapsed:!0,hidden:!0},propertyOrder:2,type:"array"},possibleLabels:{default:["sym"],format:"table",items:{type:"string"},options:{collapsed:!0,hidden:!0},propertyOrder:1,type:"array"},possibleRules:{default:[],format:"table",items:{type:"string"},options:{collapsed:!0,hidden:!0},propertyOrder:1,type:"array"},Basics:{options:{collapsed:!1},properties:{Actions:{fields:{map:_.extend({Current:{enumSource:"possible_columns",title:"Source",type:"string",watch:{possible_columns:"root.possibleColumns"}}},E),nav:E,query:E,url:E},options:{collapsed:!0},type:"actions"},DashboardTheme:{options:{hidden:!0}},Data:{default:"",format:"string",propertyOrder:1,title:"Data Source",type:"data"},FixedColumn:{title:"Column Def",type:"string"},Focus:{default:"",propertyOrder:4,title:"Focus",type:"viewstate"},Selected:{default:"",propertyOrder:3,title:"Selected Value",type:"viewstate"},SelectedAttr:{enumSource:"possible_labels",propertyOrder:2,title:"Selected Value Attribute",type:"string",watch:{possible_labels:"root.possibleLabels"}},Theme:{enum:["Light","Dark"],options:{hidden:!0},title:"Theme",type:"string"}},propertyOrder:3,title:"Basics",type:"object"},Data:{format:"object",items:{properties:{Color:{default:"",enumSource:"possibleColumns",propertyOrder:3,title:"Color",type:"string",watch:{possibleColumns:"root.possibleColumns"}},Column:{default:"",enumSource:"possibleColumns",propertyOrder:2,title:"Column",type:"string",watch:{possibleColumns:"root.possibleColumns"}},HighlightRules:{format:"object",items:{headerTemplate:"Rule {{ i1 }} {{self.Name}}",options:{collapsed:!0},properties:{BackgroundColor:{default:"",options:{gradient:!0,noColor:!0},title:"Background Color",type:"gradient"},ConditionOperator:{default:"",enum:["","search","contains","starts with","ends with","==","<",">","<=",">=","!=","Fill Left-to-Right","Fill Right-to-Left"],title:"Condition Operator",type:"string"},ConditionSource:{default:"",enumSource:"possibleColumns",title:"Condition Source",type:"string",watch:{possibleColumns:"root.possibleColumns"}},ConditionValue:{default:"previous value",title:"Condition Value",type:"string"},Inverse:{default:!1,format:"checkbox",title:"Inverse",type:"boolean"},Opacity:{default:100,format:"range",maximum:100,minimum:0,title:"Opacity",type:"number"}},propertyOrder:5,title:"Rule",type:"object"},options:{collapsed:!0,hidden:!1},title:"Highlight Rules",type:"array"},Name:{propertyOrder:1,title:"Name",type:"string"},Size:{default:"",enumSource:"possibleColumns",propertyOrder:3,title:"Size",type:"string",watch:{possibleColumns:"root.possibleColumns"}}},title:"Column",type:"object"},options:{collapsed:!0,reset:!0},propertyOrder:4,title:"Data",type:"array",uniqueItems:!1},ColorPalette:{options:{collapsed:!0},properties:{ColorScheme:{format:"table",items:{properties:{type:{default:"#0061FF",options:{gradient:!1},title:"Color",type:"gradient"}},title:"Color",type:"object"},options:{collapsed:!1},propertyOrder:5,title:"Color Scheme",type:"array",uniqueItems:!1},ColorType:{enum:["Fixed","Iterative","Iterative Children","Scaled","Gradient","Gradient Percentage"],propertyOrder:1,title:"Coloring",type:"string"},FixedColor:{propertyOrder:2,title:"Fixed Color",type:"gradient"},HoverColor:{options:{gradient:!1,noColor:!0},propertyOrder:3,title:"Hover Color",type:"gradient"},SelectedColor:{options:{gradient:!1,noColor:!0},propertyOrder:3,title:"Selected Color",type:"gradient"},SelectedColorScheme:{default:"red green",enum:["default","red green","green red","green yellow","yellow green","blue green","green blue"],propertyOrder:4,title:"Color Scheme Defaults",type:"string"}},propertyOrder:5,title:"Color Palette",type:"object"},NodeLabel:{options:{collapsed:!0},properties:{BorderColor:{propertyOrder:20,title:"Border Color",type:"gradient"},BorderWidth:{default:"0",propertyOrder:19,title:"Border Width",type:"number"},DateFormat:{default:"YYYY-MM-DD",enum:["YYYY-MM-DD","YYYY-MMM-DD","YYYY-MMMM-DD","YYYY-MM","YYYY-MMM","YYYY-MMMM","MMM DD","MMM Do","YYYY-MM-DD HH:mm:ss","YYYY-MM-DD hh:mm:ss","YYYY-MM-DD kk:mm:ss","hh:mm:ss","kk:mm:ss","hh:mm:ss.SS","hh:mm","kk:mm","mm:ss","mm:ss.SS"],propertyOrder:3,title:"Date/Time format",type:"string"},Format:{enum:["General","Number","Smart Number","Formatted Number","Datetime"],propertyOrder:2,title:"Format",type:"string"},HideTrailingZeros:{default:!1,format:"checkbox",propertyOrder:4,title:"Hide Trailing Zeros",type:"boolean"},MaxValue:{default:100,propertyOrder:9,title:"Max Value",type:"number"},MinValue:{default:0,propertyOrder:10,title:"Min Value",type:"number"},Precision:{default:2,format:"number",maximum:10,minimum:0,propertyOrder:5,title:"Precision",type:"number"},Prefix:{default:"",propertyOrder:6,title:"Prefix",type:"string"},Scale:{format:"checkbox",title:"Scale Node Size",type:"boolean"},Show:{format:"checkbox",propertyOrder:1,title:"Show Label",type:"boolean"},ShowAbsolute:{format:"checkbox",propertyOrder:12,title:"Show Absolute",type:"boolean"},ShowLegend:{format:"checkbox",propertyOrder:13,title:"Show Legend",type:"boolean"},Suffix:{default:"",propertyOrder:7,title:"Suffix",type:"string"},customLabel:{default:"",propertyOrder:8,title:"Custom Label",type:"handlebar"},gapWidth:{default:"0",propertyOrder:18,title:"Gap Width",type:"number"},labelColor:{default:"#ffffff",propertyOrder:2,title:"Label Color",type:"gradient"},upperFontSize:{default:"12",enum:["12","14","16","18","20","22","24","26","28"],propertyOrder:17,title:"Header Font Size",type:"string"},upperLabel:{default:!0,format:"checkbox",propertyOrder:14,title:"Show Node Header",type:"boolean"},upperLabelColour:{propertyOrder:15,title:"Header Font Colour",type:"gradient"},upperLabelHeight:{format:"range",maximum:"30",minimum:"12",propertyOrder:16,title:"Header Height",type:"number"}},propertyOrder:6,title:"Node",type:"object"},Tooltip:{options:{collapsed:!0},properties:{ShowTooltip:{format:"checkbox",title:"Show Tooltip",type:"boolean"},TooltipTemplate:{title:"Custom Template",type:"tooltipTemplate"}},propertyOrder:7,title:"Tooltip",type:"object"},GroupBy:{options:{collapsed:!0},properties:{GroupByColumns:{default:"",enumSource:"possibleColumns",title:"Group By",type:"string",watch:{possibleColumns:"root.possibleColumns"}},ScaleByChildren:{format:"checkbox",title:"Scale By Children",type:"boolean"},ShowHeader:{format:"checkbox",title:"Show Group By Header",type:"boolean"},UseGroupBy:{format:"checkbox",title:"Use Group By",type:"boolean"},headerColor:{title:"Header Color",type:"gradient"}},propertyOrder:8,title:"Group By",type:"object"},Style:{options:{collapsed:!0},properties:{advanced:{default:"",propertyOrder:14,title:"Advanced CSS",type:"css"}},propertyOrder:11,title:"Style",type:"object"},Animation:{options:{collapsed:!0},properties:{Duration:{default:"1500",format:"range",maximum:"3000",minimum:"0",title:"Duration",type:"number"},Easing:{default:"quinticInOut",enum:["linear","quadraticIn","quadraticOut","quadraticInOut","cubicIn","cubicOut","cubicInOut","quarticIn","quarticOut","quarticInOut","quinticIn","quinticOut","quinticInOut","sinusoidalIn","sinusoidalOut","sinusoidalInOut","exponentialIn","exponentialOut","exponentialInOut","circularIn","circularOut","circularInOut","elasticIn","elasticOut","elasticInOut","backIn","backOut","backInOut","bounceIn","bounceOut","bounceInOut"],title:"Animation Effect",type:"string"}},propertyOrder:9,title:"Animation",type:"object"},FileExport:{options:{collapsed:!0},properties:{FileName:{format:"table",items:{options:{collapsed:!0},properties:{FileNamePart:{title:"FileName Part",type:"string"}},title:"Filename Part",type:"object"},options:{collapsed:!0,hidden:!1},title:"FileName",type:"array"},ShowExportCsvButton:{default:!1,format:"checkbox",title:"Show Export Csv Button",type:"boolean"},ShowExportExcelButton:{default:!1,format:"checkbox",title:"Show Export Excel Button",type:"boolean"},ShowFullExportButton:{default:!1,format:"checkbox",options:{hidden:!0},title:"Show Full Export Button",type:"boolean"},ShowScreenshot:{default:!1,format:"checkbox",title:"Show Screenshot Button",type:"boolean"},Actions:{type:"array",format:"table",title:"Actions",options:{collapsed:!0},items:{type:"object",title:"Action",options:{collapsed:!0},properties:{EventType:{title:"Event Type",type:"string",default:"all",enum:["all","onSuccess","onFail"]},Result:{title:"Last Result",type:"string",default:""}}}}},propertyOrder:10,title:"File Export",type:"object"}},title:"properties",type:"object"}},componentDescription:"",componentName:"Treemap",id:1,version:"4.7.5"};if(0<_.keys(e.settingsModel.attributes).length)for(o=O.upgrades.indexOf(_.find(O.upgrades,{version:e.settingsModel.get("version")}))+1;o<O.upgrades.length;o+=1)(t=O.upgrades[o]).fn(e.settingsModel),e.settingsModel.set("version",t.version);return a},O);function O(){}F.upgrades=[{fn:function(r){var e=r.get("Data"),t=r.get("Group"),o=r.get("Style"),a=r.get("Data.0.KeyByDisplay"),i=r.get("Basics.ColorScale"),n=r.get("Style.percentage"),l=r.get("Data.0.Color"),s=r.get("SelectedNode.SelectedColor"),p=r.get("Basics.ShowScaleLegend"),c=r.get("Format.labelFormat"),u=r.get("Style.ColorText"),h=r.get("Style.HeaderColorText"),d=r.get("Style.advancedLabel"),m=r.get("Style.min"),g=r.get("Style.max"),y=r.get("Basics.SizeScale"),f=!r.get("Style.hideTooltips"),h=(t&&(t={GroupByColumns:t.Data,ScaleByChildren:!1,ShowHeader:t.ShowHeader,UseGroupBy:t.IsGroupBy,headerColor:h},r.set("GroupBy",t)),r.get("heatmap_possibleColumns")),t=r.get("heatmap_possibleLabels"),h=(h&&(r.set("possibleRules",h),r.set("possibleColumns",h)),h&&r.set("possibleLabels",t),"Fixed"),t="#0061FF",a=(a&&(h="Iterative"),i&&(h="Gradient"),!1===n&&(h="Gradient Percentage"),l&&(t=r.get("Data.0.Color")),{ColorScheme:o.colorScale,ColorType:h,FixedColor:t,HoverColor:"",SelectedColor:s,SelectedColorScheme:void 0===o.ColorScheme?null:o.ColorScheme}),i=(r.get("ColorPalette")||r.set("ColorPalette",a),r.get("Basics.Actions")||r.set("Basics.Actions",[]),"General"),n=0,l=(c&&0<=c.indexOf("Number")?i="Number":!c||"Date"!==c&&"Datetime"!==c&&"Time"!==c||(i="Datetime"),c&&0<=c.indexOf("Number")&&("Number - 1 decimal"===c?n=1:"Number - 2 decimal"===c?n=2:"Number - 3 decimal"===c?n=3:"Number - 4 decimal"===c?n=4:"Number - 5 decimal"===c?n=5:"Number - 6 decimal"===c&&(n=6)),{BorderColor:"#f0f0f0",BorderWidth:2,DateFormat:"YYYY-MM-DD",Format:i,HideTrailingZeros:!1,MaxValue:g,MinValue:m,Precision:n,Prefix:"",Scale:y,Show:!0,ShowLegend:p,Suffix:"",customLabel:d,gapWidth:2,labelColor:u,upperFontSize:"12",upperLabel:!1,upperLabelColour:"#000",upperLabelHeight:"15"}),h=(r.get("NodeLabel")||r.set("NodeLabel",l),r.get("Animation")||r.set("Animation",{Duration:1500,Easing:"quinticInOut"}),{ShowTooltip:f,TooltipTemplate:'<table><thead><tr style="padding-right: 10px;"><th>{{_name}}</th><th></th></tr></thead><tr><td><svg style="padding: 0 5px; vertical-align: middle;" width="12" height="12"><rect width="12" height="12"style="fill: {{_color}} ;stroke-width:3;stroke: {{_color}}"></rect></svg>{{_label}}:</td><td style="padding-right: 10px; text-align: left;"><span style="padding-left:10px">{{_value}}</span></td></tr></table>'});r.get("Tooltip")||r.set("Tooltip",h),_.each(e,function(o,a){o.Size=void 0===o.Size?o.Column:o.Size,o.Column=void 0===o.Display?void 0===o.Column?o.Name:o.Column:o.Display,o.Name=void 0===o.Display?o.Name:o.Display,_.each(o.HighlightRules,function(e,t){r.unset("Data."+a+".HighlightRules."+t+".RuleName"),r.unset("Data."+a+".HighlightRules."+t+".RuleBorderColor"),r.unset("Data."+a+".HighlightRules."+t+".Show"),o.HighlightRules[t].ConditionSource=e.RuleSource,o.HighlightRules[t].ConditionOperator=e.RuleOperation,o.HighlightRules[t].ConditionValue=e.RuleValue,o.HighlightRules[t].BackgroundColor=e.RuleColor,r.unset("Data."+a+".HighlightRules."+t+".RuleSource"),r.unset("Data."+a+".HighlightRules."+t+".RuleOperation"),r.unset("Data."+a+".HighlightRules."+t+".RuleValue"),r.unset("Data."+a+".HighlightRules."+t+".RuleColor")}),r.unset("Data."+a+".KeyByDisplay"),r.unset("Data."+a+".ColumnColor"),r.unset("Data."+a+".Color"),r.unset("Data."+a+".Display")}),r.set("Data",e),r.unset("Basics.Source"),r.unset("Basics.Calc"),r.unset("Basics.NodeFillColour"),r.unset("Basics.Node"),r.unset("Basics.NodeLabel"),r.unset("Basics.AdjustForNeg"),r.unset("Basics.ColorScale"),r.unset("Basics.RelativeScale"),r.unset("Basics.ShowScaleLegend"),r.unset("Basics.SizeScale"),r.unset("Basics.SelectedObjectRouting"),r.unset("Group"),r.unset("SelectedNode"),r.unset("heatmap_possibleColumns"),r.unset("heatmap_possibleLabels"),r.unset("Style.ColorText"),r.unset("Style.colorScale"),r.unset("Style.handlebarhelper"),r.unset("Style.advancedTooltip"),r.unset("Style.FontSize"),r.unset("Style.StyleArea"),r.unset("Style.ColorTextOverride"),r.unset("Style.ColorScheme"),r.unset("Style.hideTooltips"),r.unset("Style.min"),r.unset("Style.max"),r.unset("Style.percentage"),r.unset("Style.colorScaleLabelFormat"),r.unset("Style.advancedLabel"),r.unset("Style.DashboardTheme")},version:"4.4.0"},{fn:function(e){e=e.get("Data");_.each(e,function(e){_.each(e.HighlightRules,function(e){e.Opacity=void 0===e.Opacity?100:e.Opacity,e.Inverse=void 0!==e.Inverse&&e.Inverse})})},version:"4.4.0p2"},{fn:function(e){e=e.get("Data");_.each(e,function(e){e.Color=void 0===e.Color?e.Size:e.Color})},version:"4.4.1"},{fn:function(e){var t=e.get("NodeLabel");t.ShowAbsolute=void 0!==t.ShowAbsolute&&t.ShowAbsolute,e.set("NodeLabel",t)},version:"4.5.0"},{fn:function(e){e=e.get("FileExport");e.Actions=_.isNil(e.Actions)?[]:e.Actions},version:"4.7.5"}];B.app=d.template({compiler:[8,">= 4.3.0"],main:function(e,t,o,a,r){var i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="treemap-container">\n    <div class="treemap" id='+e.escapeExpression("function"==typeof(o=null!=(o=i(o,"id")||(null!=t?i(t,"id"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"id",hash:{},data:r,loc:{start:{line:2,column:28},end:{line:2,column:34}}}):o)+' >\n    </div>\n    <div class="legend"></div>\n\n</div>'},useData:!0}),B.fileExporter=d.template({compiler:[8,">= 4.3.0"],main:function(e,t,o,a,r){var i=null!=t?t:e.nullContext||{},n=e.hooks.helperMissing,l=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="tools-panel">\n    <div class="pnlButtons">\n        <span class="lnksExport link-disabled">\n            <i class="fa fa-fw fa-download" title="'+l((e(o,"t")||t&&e(t,"t")||n).call(i,"Data",{name:"t",hash:{},data:r,loc:{start:{line:4,column:51},end:{line:4,column:63}}}))+'"></i>\n            <a class="lnkExcelExport" title="'+l((e(o,"t")||t&&e(t,"t")||n).call(i,"Download the current dataset in Excel format",{name:"t",hash:{},data:r,loc:{start:{line:5,column:45},end:{line:5,column:97}}}))+'">'+l((e(o,"t")||t&&e(t,"t")||n).call(i,"Excel",{name:"t",hash:{},data:r,loc:{start:{line:5,column:99},end:{line:5,column:112}}}))+'</a>\n            <a class="lnkCsvExport" title="'+l((e(o,"t")||t&&e(t,"t")||n).call(i,"Download the current dataset in CSV format",{name:"t",hash:{},data:r,loc:{start:{line:6,column:43},end:{line:6,column:93}}}))+'">'+l((e(o,"t")||t&&e(t,"t")||n).call(i,"CSV",{name:"t",hash:{},data:r,loc:{start:{line:6,column:95},end:{line:6,column:106}}}))+'</a>\n            <a class="lnkDownloadScreenshot" title="'+l((e(o,"t")||t&&e(t,"t")||n).call(i,"Download a PNG image of the chart",{name:"t",hash:{},data:r,loc:{start:{line:7,column:52},end:{line:7,column:93}}}))+'">'+l((e(o,"t")||t&&e(t,"t")||n).call(i,"PNG",{name:"t",hash:{},data:r,loc:{start:{line:7,column:95},end:{line:7,column:106}}}))+"</a>\n        </span>\n    </div>\n</div>"},useData:!0}),B.legend=d.template({1:function(e,t,o,a,r){var i,n=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,s="function",p=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<li class="colorscaleItem" style="background-color:'+p(typeof(i=null!=(i=e(o,"color")||(null!=t?e(t,"color"):t))?i:l)==s?i.call(n,{name:"color",hash:{},data:r,loc:{start:{line:3,column:51},end:{line:3,column:60}}}):i)+";width:"+p(typeof(i=null!=(i=e(o,"width")||(null!=t?e(t,"width"):t))?i:l)==s?i.call(n,{name:"width",hash:{},data:r,loc:{start:{line:3,column:67},end:{line:3,column:76}}}):i)+'%"></li>\n'},3:function(e,t,o,a,r){var i,n=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,s="function",p=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <li class="colorscaleItemIndex" style="width:'+p(typeof(i=null!=(i=e(o,"width")||(null!=t?e(t,"width"):t))?i:l)==s?i.call(n,{name:"width",hash:{},data:r,loc:{start:{line:9,column:49},end:{line:9,column:58}}}):i)+'%">'+p(typeof(i=null!=(i=e(o,"percentage")||(null!=t?e(t,"percentage"):t))?i:l)==s?i.call(n,{name:"percentage",hash:{},data:r,loc:{start:{line:9,column:61},end:{line:9,column:75}}}):i)+"%</li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,o,a,r){var i,n=null!=t?t:e.nullContext||{},l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<ul class="colorscale">\n'+(null!=(i=l(o,"each").call(n,t,{name:"each",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:2,column:0},end:{line:4,column:9}}}))?i:"")+'</ul>\n<i class="indicatorIcon fa fa-map-marker"></i>\n<ul class="colorscaleIndex">\n'+(null!=(i=l(o,"each").call(n,t,{name:"each",hash:{},fn:e.program(3,r,0),inverse:e.noop,data:r,loc:{start:{line:8,column:0},end:{line:10,column:9}}}))?i:"")+"</ul>"},useData:!0}),B.legendMenu=d.template({1:function(e,t,o,a,r){var i,n=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,s="function",p=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <li class="legendMenuListItem">\n        <i class="fa fa-square" style="color:'+p(typeof(i=null!=(i=e(o,"color")||(null!=t?e(t,"color"):t))?i:l)==s?i.call(n,{name:"color",hash:{},data:r,loc:{start:{line:4,column:45},end:{line:4,column:54}}}):i)+'"></i> '+p(typeof(i=null!=(i=e(o,"text")||(null!=t?e(t,"text"):t))?i:l)==s?i.call(n,{name:"text",hash:{},data:r,loc:{start:{line:4,column:61},end:{line:4,column:69}}}):i)+"\n    </li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,o,a,r){return'<ul class="legendMenulList">\n'+(null!=(o=(e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]})(o,"each").call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:2,column:4},end:{line:6,column:13}}}))?o:"")+"</ul>"},useData:!0});var T=B;function B(){}N.getConfig=function(e){var r=this,i={},t={".csv":"Csv",".xlsx":"Excel"}[e.fileFormat],n=e.columnsConfig,l=n.dataSource;return i.fileName=u.ExportTools.getExportFileName(e.fileName,"",t),i.metaData=[],i.fileFormat=e.fileFormat,i.workSheetTitle=e.workSheetTitle,l&&(i.dataSet=l.getData().toJSON(),_.each(n.columns,function(t){var o,a=[],e=(_.each(["Column","Size","Color"],function(e){a=a.concat(u.ExportTools.regExValidateColumnIDs(t[e],l.getColumnNames()))}),l.getDepth());0<a.length&&l.breakdownColumns.length>e&&(o=l.breakdownColumns[e],_.each(a,function(e,t){"{breakdownId}"===e&&(a[t]=o)})),0<a.length&&_.uniq(a).forEach(function(e){i.metaData.push(r.getExportMetaData({colFormats:n.formats,colId:e,kdbType:l.getColumnType(e)},"layers"))})})),i},N.getExportMetaData=function(e,t){var o={},a=e.kdbType,r=(this.getValidPrecission(Number(e.colFormats.Precision)),e.colFormats.Prefix),i=e.colFormats.Suffix,n=e.colFormats.Format,l=e.colFormats.DateFormat,s=e.colFormats.HideTrailingZeroes,n=this.resolveColumnTypeAndFormat(n,l,e.colFormats.Precision,a);return o.colId=e.colId,o.colName=e.colId,o.dataType=n.dataType,o.dataKdbType=n.dataKdbType,o.dataFormat=n.dataFormat,o.hideTrailingZeroes=s,o.prefix=r,o.suffix=i,o},N.resolveColumnTypeAndFormat=function(e,t,o,a){var r=11<a&&a<20,i=o?"."+Array(o+1).join("0"):"";switch((3===a||a<1||19<a)&&(a=11,t="TO_STRING",e="String"),e){case"Number":t="#0"+i;break;case"Smart Number":e="Number",t="SmartNumber"+i;break;case"Datetime":e=u.ExportTools.getTemporalTypeFromFormat(t),t=u.ExportTools.CHARTS_DATE_FORMAT_MAP[t],t=r?t||"":(e="String","");break;default:e="String",t=""}return{dataFormat:t,dataKdbType:a,dataType:e=1===a?"Boolean":e}},N.getValidPrecission=function(e){e=void 0!==e?e:0;return e<0?e=0:10<e&&(e=10),e};var q=N;function N(){}M=i.View,e(I,M),I.prototype.initializeEvents=function(){this.listenTo(this.model,"change",this.displayChoiceLinkButtons),this.$lnkCsvExport.click(_.bind(this.fileExport,this,".csv")),this.$lnkExcelExport.click(_.bind(this.fileExport,this,".xlsx")),this.$lnkDownloadScreenshot.click(_.bind(this.downloadImage,this,".png"))},I.prototype.displayChoiceLinkButtons=function(e){var t=this.model.get("FileExport");!t||_.keys(t).length<5||(t.ShowExportCsvButton||t.ShowExportExcelButton||t.ShowScreenshot?(this.$lnksExport.removeClass("link-disabled"),this.$lnkCsvExport.toggleClass("link-disabled",!t.ShowExportCsvButton),this.$lnkExcelExport.toggleClass("link-disabled",!t.ShowExportExcelButton),this.$lnkDownloadScreenshot.toggleClass("link-disabled",!t.ShowScreenshot),this.$chartContainer.toggleClass("links-enabled",!this.$chartContainer.hasClass("links-enabled")),t.Enabled||this.model.set("FileExport.Enabled",!0)):(this.$lnksExport.addClass("link-disabled"),this.$chartContainer.removeClass("links-enabled"),t.Enabled&&this.model.set("FileExport.Enabled",!1)))},I.prototype.downloadImage=function(e){var t=u.ExportTools.getExportFileName(this.getExportConfig().fileName,"","Screenshot"),o=this.appView.dashboardViewModel.get("selectedDocumentId"),a=this.appView.api.getDashboardName(o),e=this.generateImage(t=("string"==typeof t?t:"Screenshot")+e),r=this.getExportConfig();this.appView.api.onTransferAction({actions:this.appView.api.getProperty("FileExport.Actions"),component:"Treemap",dashboardId:o,dashboardName:a,fileLength:_.get(r,"columnsConfig.dataSource.source.dataSet.collection.length")},t,_.get(r,"columnsConfig.dataSource.meta"),"success","png",e)},I.prototype.fileExport=function(e){var t=this.appView.dashboardViewModel.get("selectedDocumentId"),o=this.appView.api.getDashboardName(t),a=u.ExportTools,e=q.getConfig(_.extend(this.getExportConfig(),{fileFormat:e}));e.actions=this.appView.api.getProperty("FileExport.Actions"),e.selectedDashboard={dashboardId:t,dashboardName:o},a.openFileExportDialog(e)},I.prototype.generateImage=function(e){var t,o=this.getChart();return o?(o=o.getDataURL({type:"png",pixelRatio:2}).replace(/^data:image\/[^;]+/,"data:application/octet-stream"),(t=document.createElement("a")).download=e,t.href=o,t.click(),this.appView.api.humanFileSize(atob(t.href.substring(t.href.indexOf(",")+1)).length)):0},I.prototype.getTheme=function(){return this.appView.dashboardViewModel.get("DashboardTheme")},I.prototype.renderLinks=function(){this.$lnksExport=this.$el.find(".lnksExport"),this.$lnkCsvExport=this.$el.find("a.lnkCsvExport"),this.$lnkExcelExport=this.$el.find("a.lnkExcelExport"),this.$lnkDownloadScreenshot=this.$el.find("a.lnkDownloadScreenshot")},I.prototype.remove=function(){return this.$lnkCsvExport.off(),this.$lnkExcelExport.off(),this.$lnkDownloadScreenshot.off(),this.stopListening(),i.View.prototype.remove.apply(this)};var M,U=I;function I(e){var t=M.call(this,e)||this;return t.api=e.api,t.getChart=e.getChart,t.appView=e.appView,t.getExportConfig=e.getExportConfig,t.isIE=!1,HTMLCanvasElement&&HTMLCanvasElement.prototype&&HTMLCanvasElement.prototype.msToBlob&&(t.isIE=!0),t.$chartContainer=t.appView.$el.find(".chart-container"),t.render(),t.renderLinks(),t.initializeEvents(),t}var P,L=u.Tools;function H(e){var a=P.call(this,e)||this,r=(a.focus=[],a.layers=new R,a.dataSources={},a.treemapData=[],a.treemapID="",a.errors={},_.extend(a,_.pick(e,["api","dashboardViewModel"])),H.componentApi=e.api,a.api.setProperty),o=(a.api.setProperty=function(e,t,o){o&&o.bypass||(t=k.replaceViewStatesWithModel(e,t,a.api)),r.call(a.api,e,t,o)},a.onSettingsChange);return a.onSettingsChange=function(e){var t=this.onSettingsChange!==(this.onSettingsChange=o);this.onSettingsChange(e),t&&(this.isReadyForThemeChange=!0,this.setThemeAccordingToDashboardSettings())}.bind(a),a.treemapID="treemap-"+a.cid,a.$el.html(T.app({id:a.treemapID})),a.$el.addClass("treemap-app"),a.$treemap=a.$el.find(".treemap"),a.listenTo(a.layers,"add",function(e){this.setThemeAccordingToDashboardSettings()}),a.listenTo(a.layers,"reset",function(e){this.setThemeAccordingToDashboardSettings()}),a.listenTo(a.layers,"remove",function(e){e.stopListening()}),a.listenTo(a.layers,"update",function(e,t){this.updatePossibleLayers();t=0<t.changes.added.length+t.changes.removed.length;k.safeHandle(!t&&this.animation&&this.animation.get("Enabled")?this.updateChart:this.initializeChart).call(this)}),a.nodeLabel=new G,a.colorPalette=new z,a.groupBy=new Y,a.tooltip=new K,a.animation=new W,a.fileExportModel=new i.DeepModel,a.fileExporterView=new U({api:a.api,appView:a,el:T.fileExporter({id:a.id}),getChart:function(){return a.chart},getExportConfig:function(){var e=a.layers.at(0);return{altFileName:"",columnsConfig:{columns:e.get("Data"),dataSource:a.dataSources[e.get("Basics.Data").cid],formats:e.get("NodeLabel")},fileName:a.fileExportModel.get("FileExport.FileName"),workSheetTitle:"Treemap"}},model:a.fileExportModel}),a.$el.prepend(a.fileExporterView.$el),a.listenTo(a.fileExportModel,"change:FileExport.Enabled",k.safeHandle(a.toggleToolsPanel)),a}return P=i.View,e(H,P),H.prototype.onSettingsChange=function(e){e=k.expandNestedViewStates(e,this.api),e=k.replaceViewStatesWithValue("",e,this.api),e=k.pump(e);this.onSettingsChangeProcessed.call(this,e)},H.prototype.updateDataSource=function(o){var a=this;if(this.dataSources[o.getKey()]){var r=!1,e=this.layers.filter(function(e){e=e.get("Basics.Data");return e&&e.cid===o.getKey()}),i=u.HeuristicHelpers.getScalarColumns(o),n=u.HeuristicHelpers.getStringColumns(o),l=u.HeuristicHelpers.getListColumns(o),s=0===i.length?l:i,p=this.errors[o.getKey()],c=0===n.length?0===l.length?i:l:n;if(0===s.length&&(!p||"Loading"===_.get(p,"type")))return void this.api.showQueryStatus({error:t("Data Source provided is not valid for Heatmap"),type:"Warning"});e.forEach(function(e,t){e.set("possibleColumns",o.getColumnNames()),e.set("possibleRules",o.getColumnNames()),e.set("possibleLabels",o.getColumnNames()),a.api.setProperty("possibleColumns",e.get("possibleColumns")),a.api.setProperty("possibleRules",e.get("possibleRules")),a.api.setProperty("possibleLabels",e.get("possibleLabels")),0!==t||e.get("Data.0.Size")||(e.set("Data.0.Size",s[0]),a.api.setProperty("Data.0.Size",s[0]),r=!0),0!==t||e.get("Data.0.Column")||(e.set("Data.0.Column",c[0]),a.api.setProperty("Data.0.Column",c[0]),r=!0)}),r&&this.api.setProperty("Data",[{Color:"",Column:c[0],HighlightRules:[],Name:"",Size:s[0]}])}k.safeHandle(this.initializeChart).call(this)},H.prototype.onResize=function(){this.chart&&(this.chart.resize(),this.adjustCanvasHeight())},H.prototype.updateError=function(e,t){function o(e){return"Error"===e?3:"Loading"===e?2:"NoResults"===e?1:0}var a=this,e=e.getKey(),t=(t?this.errors[e]=t:delete this.errors[e],_.reduce(this.errors,function(e,t){t=t.type;return o(t)>o(e)?t:e},""));t&&("NoResults"!==t||Object.keys(this.dataSources).length===Object.keys(this.errors).length)?(e=_.map(this.errors,function(e,t){e=e.error,t=a.dataSources[t];return e?"["+t.getPath()+"]: "+e:null}).filter(function(e){return e}),this.api.showQueryStatus({error:e.join("\n"),type:t})):this.api.hideQueryStatus()},H.prototype.hideTooltip=function(){this.genericTooltip&&(this.api.removeTooltip(),delete this.genericTooltip)},H.prototype.onSettingsChangeProcessed=function(e){var t,o,a=this.layers.models[0];_.isObject(e.Basics)&&this.onSettingsBasicsChanged.call(this,e.Basics),_.isObject(e.Basics)&&e.Basics.Data&&this.onSettingsLayersChanged.call(this,e),_.isObject(e.Data)&&void 0!==a&&(a.get("NodeLabel")||a.set("NodeLabel",k.replaceViewStatesWithValue("",this.nodeLabel.attributes,this.api)),a.get("ColorPalette")||a.set("ColorPalette",k.replaceViewStatesWithValue("",this.colorPalette.attributes,this.api)),a.get("Tooltip")||a.set("Tooltip",k.replaceViewStatesWithValue("",this.tooltip.attributes,this.api)),a.get("Animation")||a.set("Animation",k.replaceViewStatesWithValue("",this.animation.attributes,this.api)),a.get("GroupBy")||a.set("GroupBy",k.replaceViewStatesWithValue("",this.groupBy.attributes,this.api)),this.onSettingsOnData(k.replaceViewStatesWithValue("",e,this.api))),_.isObject(e.NodeLabel)&&(this.onSettingsChanged(e,"NodeLabel"),this.nodeLabel.set(this.api.getProperty("NodeLabel"))),_.isObject(e.ColorPalette)&&(0===_.indexOf(Object.keys(e.ColorPalette),"SelectedColorScheme")&&(t=e.ColorPalette.SelectedColorScheme,o=F.getSchemes(),this.api.setProperty("ColorPalette.ColorScheme",o[t],{bypass:!0})),this.onSettingsChanged(e,"ColorPalette"),this.colorPalette.set(this.api.getProperty("ColorPalette"))),_.isObject(e.Tooltip)&&(this.onSettingsChanged(e,"Tooltip"),this.tooltip.set(this.api.getProperty("Tooltip"))),_.isObject(e.Animation)&&(this.onSettingsChanged(e,"Animation"),this.tooltip.set(this.api.getProperty("Animation"))),_.isObject(e.GroupBy)&&(this.onSettingsChanged(e,"GroupBy"),this.groupBy.set(this.api.getProperty("GroupBy"))),_.isObject(e.FileExport)&&this.onSettingsFileExportChanged.call(this,e.FileExport),a&&this.initializeChart()},H.prototype.onSettingsFileExportChanged=function(e){var o=this;this.fileExportModel&&(_.each(e,function(e,t){o.fileExportModel.set("FileExport."+t,e)}),4===_.keys(e).length)&&void 0===this.fileExportModel.get("FileExport.Enabled")&&(e.ShowExportCsvButton||e.ShowExportExcelButton||e.ShowScreenshot?this.fileExportModel.set("FileExport.Enabled",!0):this.fileExportModel.set("FileExport.Enabled",!1))},H.prototype.onSettingsChanged=function(e,o){var a=this.layers.models[0];a&&_.each(e[o],function(e,t){a.set(o+"."+t,e)})},H.prototype.onSettingsLayersChanged=function(e){this.layers.set(e);var e=e.Basics.Data,t=this.dataSources[e.cid];t?t.hasData()&&this.updateDataSource(t):(t=new j(e,this,this.api,this.focus),(this.dataSources[e.cid]=t).subscribe()),this.initializeChart()},H.prototype.onSettingsOnData=function(e){var r=this.layers.models[0];r&&(void 0===r.get("Data")||r.get("Data").length>e.Data.length?r.set("Data",e.Data):_.each(e.Data,function(t,a){_.each(Object.keys(t),function(e){"HighlightRules"===e?_.each(t.HighlightRules,function(t,o){_.each(Object.keys(t),function(e){r.set("Data."+a+".HighlightRules."+o+"."+e,t[e])})}):r.set("Data."+a+"."+e,t[e])})}),this.initializeChart())},H.prototype.onSettingsBasicsChanged=function(e){var t=this;void 0!==e.Focus&&(this.focus=_.first(k.focus2Array(e.Focus))||[],_.each(this.dataSources,function(e){e.setFocus(t.focus)})),void 0!==e.Selected&&0<this.layers.models.length&&(this.layers.models[0].set("Basics.Selected",e.Selected),this.initializeChart())},H.prototype.getSelectedAttr=function(e){var t,o=this.layers.models[0];return"{breakdownId}"===e&&(t=(o=o.get("Basics")).Data,o=o.Focus,e=t.dataSet.breakdownColumns[void 0===(t=o?_.first(k.focus2Array(o)):[])?0:t.length]),e},H.prototype.setActions=function(a,r){var i=this,n=[];this.api.getProperty("Basics.Actions").forEach(function(e,t){var o=i.getSelectedAttr(e.Current),o=a.get(o);e.Trigger===r&&(n.push(s(s({},e),{Value:o,_PropertyIndex:t})),i.api.doActions(n,"Basics.Actions"))})},H.prototype.setMousePosition=function(e){this.$el.find(".indicatorIcon").css({left:"calc("+e+"% - 3px)"})},H.prototype.setMouseData=function(e,t,o){var e=_.get(e,"data.parentId")?_.get(e,"data.parentId"):e.seriesIndex,a=this.layers.models[0],r=a.get("ColorPalette.ColorType"),i=this.api.getProperty("Data."+e+".Color"),e=_.map(t,function(e){return parseFloat(e.get(i))}),t=a.get("NodeLabel"),a=t.MinValue,t=t.MaxValue,r=("Gradient"!==r&&"Scaled"!==r||(a=_.min(e),t=_.max(e)),parseFloat(o.get(i)));this.setMousePosition((r-a)/(t-a)*100)},H.prototype.setSelected=function(s){var p=this,c=this.layers.models[0];this.chart.off("click",null),this.chart.on("click",function(r){var e,t,o=c.get("Basics.SelectedAttr"),i=c.get("NodeLabel.Scale"),n=c.get("ColorPalette.SelectedColor"),a=s[r.data.id],l=p.chart.getOption();_.each(l.series[0].data,function(e,o){var e=_.clone(e.children),a=c.get("Data."+o+".Name");i&&(e=_.sortBy(e,"value")),_.each(e,function(e,t){e.id===r.data.id&&r.treePathInfo[1].name===a&&""!==n&&((e=l.series[0].data[o].color)[e.length-1-t]=n)})}),p.chart.setOption(l),void 0!==a&&(o=p.getSelectedAttr(o),p.api.setProperty("Basics.Selected",a.get(o),{bypass:!0}),o=c.get("Basics.Data"),(o=p.dataSources[o.cid])&&0!==o.length&&(e=o.breakdownColumns,(o=o.getDepth())<e.length-1)&&((t=p.focus)[o]=a.get(e[o]),p.api.setProperty("Basics.Focus",t.join(","),{bypass:!0})),p.setActions(a,"Click"))}),this.chart.off("mousemove",null),this.chart.on("mousemove",function(e){var t;e&&e.data&&void 0!==(t=s[e.data.id])&&(p.setMouseData(e,s,t),p.setActions(t,"Hover"),p.showTooltip(e,c,s))}),this.chart.off("mouseout",null),this.chart.on("mouseout",this.hideTooltip.bind(this)),this.chart.off("dblclick",null),this.chart.on("dblclick",function(e){e=s[e.data.id];void 0!==e&&p.setActions(e,"Double Click")})},H.prototype.initializeChart=function(){var e,t=this.layers.models[0],o=t.get("Basics.Data"),o=this.dataSources[o.cid];this.chart=a.init(document.getElementById(this.treemapID)),o&&0!==o.length&&(this.treemapData=o.getData().models,o=o.breakdownColumns,e=void 0===(e=(e=this.focus)?_.first(k.focus2Array(e)):[])?0:e.length,void 0!==o&&t.setBreakdown(o[e]),this.treemapData)&&0!==this.treemapData.length&&(o=void 0,e=t.get("Data"),this.displayLegend(),o=0!==_.size(e)?(e=t.getTreeData(e,this.treemapData),t.setTreeMapOpts(e)):{series:[{breadcrumb:{show:!1},data:[],height:0,type:"treemap",width:0}]},this.chart.setOption(o),this.setSelected(this.treemapData),this.adjustCanvasHeight())},H.prototype.adjustCanvasHeight=function(){var e=this.$el.find(".treemap > div > canvas"),t=(this.$el.find(".treemap > div").height()||0)-(this.fileExportModel.get("FileExport.Enabled")?H.FILE_EXPORT_HEIGHT:0)+"px";e.css({height:t})},H.prototype.displayLegend=function(){var e,o,t,a,r,i,n,l,s,p=this,c=this.layers.models[0];c.get("NodeLabel")&&c.get("ColorPalette")&&(e=(t=c.get("NodeLabel")).ShowLegend,o=t.Scale,t=this.$el.find(".legend"),n=c.get("ColorPalette"),a=n.ColorScheme,r=n.ColorType,i=n.FixedColor,n=this.fileExportModel.get("FileExport.Enabled"),e&&"Iterative Children"===r?t.html(T.legendMenu(_.map(c.get("Data"),function(e,t){return{color:a[t%a.length].type,text:e.Name}}))):e&&0<=r.indexOf("Gradient")?t.html(T.legend(_.map(_.clone(a),function(e,t){return{color:e.type,percentage:t*(100/a.length),width:100/a.length}}))):e&&0<=r.indexOf("Scale")?(l=k.getSaturatedArray(i),t.html(T.legend(_.map([0,10,20,30,40,50,60,70,80,90],function(e,t){return{color:l[t],percentage:e,width:10}})))):e&&"Fixed"===r?t.html(T.legendMenu(_.map(c.get("Data"),function(e){return{color:i,text:e.Name}}))):e&&"Iterative"===r?(s=[],_.each(c.get("Data"),function(t){var e=_.map(p.treemapData,function(e){return e.get(t.Column)});o&&(e=_.map(_.sortBy(p.treemapData,[function(e){return parseFloat(e.get(t.Size))}]),function(e){return e.get(t.Column)})),_.each(e,function(e,t){s.push({color:a[t%a.length].type,text:e})})}),t.html(T.legendMenu(s))):t.html(""),this.adjustChart(e,n))},H.prototype.adjustChart=function(e,t){var o=this.$el.find(".legend"),a=this.$el.find(".treemap"),r=this.$el.find(".treemap > div"),e=e?H.LEGEND_HEIGHT:0,t=t?H.FILE_EXPORT_HEIGHT+"px":0;o.css({height:e+"px"}),a.css({height:"calc(100% - "+e+"px)"}),r.css({top:t}),this.chart.resize()},H.prototype.doActions=function(e){var t,o,e=this.chart.getElementAtEvent(e);e.length&&(o=(e=e[0])._datasetIndex,e=e._index,((o=this.layers.models.length-1-o)<0||o>this.layers.models.length-1)&&(o=this.layers.models.length-1),o=this.layers.models[o].get("Basics.Data"),t=this.dataSources[o.cid].getData().at(e),o=this.api.getProperty("Basics.Actions").map(function(e){return s(s({},e),{Value:t.get(e.Current)})}),this.api.doActions(o,"Basics.Actions"))},H.prototype.setThemeAccordingToDashboardSettings=function(){this.isReadyForThemeChange&&this.setTheme(this.dashboardViewModel.get("DashboardTheme"))},H.prototype.setTheme=function(e){var t;if("Light"===e)t="Dark";else{if("Dark"!==e)return;t="Light"}L.hasDefaultThemeColors(t,this.api.getProperty("NodeLabel.BorderColor"))&&this.api.setProperty("NodeLabel.BorderColor",L.getDefaultThemeColors(e)[0],{bypass:!0}),t=e.toLowerCase(),this.$el.removeClass("dark light"),this.$el.addClass(t)},H.prototype.showTooltip=function(e,t,o){var a=t.get("Tooltip"),r=a.TooltipTemplate;a.ShowTooltip&&void 0!==e&&void 0!==e.data&&void 0!==e.data.id&&(a=e.data.id,o=_.extend({},o[a]).attributes,a=e.treePathInfo&&e.treePathInfo[1]?e.treePathInfo[1].name:"",o._name=e.data.name,o._value=void 0===e.data.displayVal?e.data.value:e.data.displayVal,o._treePathInfo=e.treePathInfo,o._label="{breakdownId}"===a?t.breakdownCol:a,o._color=e.color,o.breakdownId=t.breakdownCol?o[t.breakdownCol]:"",this.genericTooltip=this.api.setTooltip({data:o,text:r,anchorEl:this.el,position:{left:e.event.offsetX+20,top:e.event.offsetY+20}}))},H.prototype.toggleToolsPanel=function(){this.fileExportModel.has("FileExport")&&0<this.layers.length&&(this.fileExportModel.get("FileExport.Enabled")?this.$el.find(".tools-panel").removeClass("disabled"):this.$el.find(".tools-panel").toggleClass("disabled",!this.$el.find(".tools-panel").hasClass("disabled")),this.initializeChart())},H.prototype.updatePossibleLayers=function(){this.layers.filter(function(e){return"Line"===e.get("_Hidden._Type")}).forEach(function(a){var e=a.collection.reduceRight(function(e,t,o){return[a===t?"nofill":"Layer "+(o+1)].concat(e)},["origin"]);a.set("_Hidden._PossibleLayers",e)})},H.getComponentDefinition=F.getComponentDefinition,H.FILE_EXPORT_HEIGHT=18,H.LEGEND_HEIGHT=40,H});